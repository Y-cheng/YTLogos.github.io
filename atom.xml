<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Logos</title>
  <subtitle>Stay hungry,Stay foolish</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ytlogos.github.io/"/>
  <updated>2018-07-12T09:21:03.922Z</updated>
  <id>https://ytlogos.github.io/</id>
  
  <author>
    <name>TaoYan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>改善R语言代码的5个小技巧</title>
    <link href="https://ytlogos.github.io/2018/07/10/%E6%94%B9%E5%96%84R%E8%AF%AD%E8%A8%80%E4%BB%A3%E7%A0%81%E7%9A%845%E4%B8%AA%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://ytlogos.github.io/2018/07/10/改善R语言代码的5个小技巧/</id>
    <published>2018-07-10T04:19:05.000Z</published>
    <updated>2018-07-12T09:21:03.922Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/0m7AJLj3he.png?imageslim" alt="mark"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这篇文章来源于<a href="https://twitter.com/drsimonj" target="_blank" rel="external">@drsimonj</a>的<a href="https://drsimonj.svbtle.com/five-simple-tricks-to-improve-your-r-cod" target="_blank" rel="external">博客</a></p>
<h2 id="从1开始排序"><a href="#从1开始排序" class="headerlink" title="从1开始排序"></a>从1开始排序</h2><p>当使用冒号(:)创建序列时，尝试用<code>seq()</code>.<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># sequence a <span class="type">vector</span></div><div class="line">x &lt;- runif(<span class="number">10</span>)</div><div class="line">seq(x)</div><div class="line">##  [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line"></div><div class="line">#sequence an <span class="type">integer</span></div><div class="line"></div><div class="line">seq(nrow(mtcars))</div><div class="line">##  [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span></div><div class="line">## [<span class="number">24</span>] <span class="number">24</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>冒号有时会产生意想不到的结果，它会在我们不注意的情况下产生各种问题，比如当我们对空向量的长度进行排序的时候：</p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># empty vector</span></div><div class="line"><span class="keyword">x</span> = c()</div><div class="line"><span class="number">1</span>:<span class="keyword">length</span>(<span class="keyword">x</span>)</div><div class="line"><span class="comment">## [1] 1 0</span></div><div class="line"></div><div class="line">se<span class="string">q(x)</span></div><div class="line"><span class="comment">## integer(0)</span></div></pre></td></tr></table></figure>
<p>利用<code>seq()</code>可以自动创建从1到对象长度的序列，这样就可以避免使用<code>length()</code></p>
<h2 id="vcetor-而非c"><a href="#vcetor-而非c" class="headerlink" title="vcetor()而非c()"></a><code>vcetor()</code>而非<code>c()</code></h2><p>创建空向量的时候，尝试使用<code>vector(&quot;type&quot;, length)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># a numeric vector with 5 elements</div><div class="line">vector(&quot;numeric&quot;, 10)</div><div class="line">##  [1] 0 0 0 0 0 0 0 0 0 0</div><div class="line"></div><div class="line">#a character vector with 5 elements</div><div class="line">vector(&quot;character&quot;, 5)</div><div class="line">## [1] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;</div></pre></td></tr></table></figure>
<p>使用<code>vector()</code>可以提高内存使用率并提高运行速度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">n &lt;- 1e05</div><div class="line">x_empty &lt;- c()</div><div class="line">system.time(</div><div class="line">  for (i in seq(n))&#123;</div><div class="line">    x_empty &lt;- c(x_empty,i)</div><div class="line">  &#125;</div><div class="line">)</div><div class="line">##    user  system elapsed </div><div class="line">##    9.69    0.03    9.97</div><div class="line">n &lt;- 1e05</div><div class="line">x_zeros &lt;- vector(&quot;integer&quot;, n)</div><div class="line">system.time(</div><div class="line">  for (i in seq(n))&#123;</div><div class="line">    x_zeros[i] &lt;- i</div><div class="line">  &#125;</div><div class="line">)</div><div class="line">##    user  system elapsed </div><div class="line">##       0       0       0</div></pre></td></tr></table></figure>
<h2 id="放弃which"><a href="#放弃which" class="headerlink" title="放弃which()"></a>放弃<code>which()</code></h2><p>使用R语言的时候，我们常常使用<code>which()</code>从某个布尔条件中获取索引，然后根据索引提取数据,其实没有必要使用<code>which()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#obtain elements greater than 5</div><div class="line">x &lt;- 3:7</div><div class="line">#use which (not necessary)</div><div class="line">x[which(x&gt;5)]</div><div class="line">## [1] 6 7</div><div class="line">#no which</div><div class="line">x[x&gt;5]</div><div class="line">## [1] 6 7</div></pre></td></tr></table></figure>
<p>或者计算大于5的元素个数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#use which</div><div class="line">length(which(x&gt;5))</div><div class="line">## [1] 2</div><div class="line"># no which</div><div class="line">sum(x&gt;5)</div><div class="line">## [1] 2</div></pre></td></tr></table></figure></p>
<p>实际上我们需要的是布尔值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">condition &lt;- x&gt;5</div><div class="line">condition</div><div class="line">## [1] FALSE FALSE FALSE  TRUE  TRUE</div><div class="line">x[condition]</div><div class="line">## [1] 6 7</div></pre></td></tr></table></figure></p>
<p>当与<code>sum()</code>或者<code>mean()</code>结合使用时，可以用布尔值来获取满足条件的值的计数或比例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sum(condition)</div><div class="line">## [1] 2</div><div class="line">mean(condition)</div><div class="line">## [1] 0.4</div></pre></td></tr></table></figure>
<p>但是<code>which()</code>可以告诉我们TRUE值的索引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">which(condition)</div><div class="line">## [1] 4 5</div></pre></td></tr></table></figure>
<p>测试任何或者所有的值是否为真，可以利用<code>any()</code>和<code>all()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">set.seed(23)</div><div class="line">x &lt;- runif(10)</div><div class="line">if (length(which(x&gt;0.5))&gt;0)</div><div class="line">  print(&quot;At least one value is greater than 0.5&quot;)</div><div class="line">## [1] &quot;At least one value is greater than 0.5&quot;</div><div class="line"></div><div class="line">if (any(x&gt;0.5))</div><div class="line">  print(&quot;At least one value is greater than 0.5&quot;)</div><div class="line">## [1] &quot;At least one value is greater than 0.5&quot;</div><div class="line"></div><div class="line">#use which and length to test if all values are less than 1</div><div class="line">if (length(which(x&lt;1))==length(x))</div><div class="line">  print(&quot;All values are less than 1&quot;)</div><div class="line">## [1] &quot;All values are less than 1&quot;</div><div class="line"></div><div class="line">if (all(x&lt;1))</div><div class="line">  print(&quot;All values are less than 1&quot;)</div><div class="line">## [1] &quot;All values are less than 1&quot;</div></pre></td></tr></table></figure>
<p>另外一点是可以节省时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x &lt;- runif(1e8)</div><div class="line"></div><div class="line">system.time(x[which(x &gt; .5)])</div><div class="line">##    user  system elapsed </div><div class="line">##    1.24    0.09    1.33</div><div class="line">system.time(x[x &gt; .5])</div><div class="line">##    user  system elapsed </div><div class="line">##    0.97    0.14    1.13</div></pre></td></tr></table></figure>
<h2 id="factor你的变量"><a href="#factor你的变量" class="headerlink" title="factor你的变量"></a><code>factor</code>你的变量</h2><p>当移除一个元素之后，被移除的元素仍然占据着一个位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">set.seed(23)</div><div class="line">x &lt;-factor(sample(letters,5,replace = FALSE))</div><div class="line">x</div><div class="line">## [1] o f h q s</div><div class="line">## Levels: f h o q s</div><div class="line">plot(x)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/dK2i1bjhG4.png?imageslim" alt="mark"></p>
<p>移除<strong>s</strong>之后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- x[x!=&quot;s&quot;]</div><div class="line">x</div><div class="line">## [1] o f h q</div><div class="line">## Levels: f h o q s</div><div class="line">plot(x)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/eAb8d887iA.png?imageslim" alt="mark"></p>
<p>一种解决办法是再次<code>factor()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- factor(x)</div><div class="line">x</div><div class="line">## [1] o f h q</div><div class="line">## Levels: f h o q</div><div class="line">plot(x)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/HId1H0ICc0.png?imageslim" alt="mark"></p>
<p>另外一种方法是利用<code>droplevels()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">set.seed(23)</div><div class="line">x &lt;-factor(sample(letters,5,replace = FALSE))</div><div class="line">x &lt;- x[x!=&quot;s&quot;]</div><div class="line">x &lt;- droplevels(x)</div><div class="line">x</div><div class="line">## [1] o f h q</div><div class="line">## Levels: f h o q</div><div class="line">plot(x)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/HId1H0ICc0.png?imageslim" alt="mark"></p>
<h2 id="优先使用"><a href="#优先使用" class="headerlink" title="优先使用$"></a>优先使用$</h2><p>从data.frame中提取数据时，在行$之前指定列[</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#row first,column second - not ideal</div><div class="line">mtcars[mtcars$cyl==4, ]$hp</div><div class="line">##  [1]  93  62  95  66  52  65  97  66  91 113 109</div><div class="line">#column first, row second - much better</div><div class="line">mtcars$hp[mtcars$cyl==4]</div><div class="line">##  [1]  93  62  95  66  52  65  97  66  91 113 109</div></pre></td></tr></table></figure>
<p>原因如下：</p>
<ul>
<li>尽量避免使用烦人的逗号</li>
<li>提高运行速度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># Simulate a data frame...</div><div class="line">n &lt;- 1e7</div><div class="line">d &lt;- data.frame(</div><div class="line">  a = seq(n),</div><div class="line">  b = runif(n)</div><div class="line">)</div><div class="line"></div><div class="line"># rows first, column second - not ideal</div><div class="line">system.time(d[d$b &gt; .5, ]$a)</div><div class="line">##    user  system elapsed </div><div class="line">##    0.47    0.00    0.47</div><div class="line"></div><div class="line"># column first, rows second - much better</div><div class="line">system.time(d$a[d$b &gt; .5])</div><div class="line">##    user  system elapsed </div><div class="line">##    0.11    0.00    0.11</div></pre></td></tr></table></figure>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line"></div><div class="line">## R version 3.5.1 (2018-07-02)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 10 x64 (build 16299)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C                              </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] compiler_3.5.1  backports_1.1.2 magrittr_1.5    rprojroot_1.3-2</div><div class="line">##  [5] tools_3.5.1     htmltools_0.3.6 yaml_2.1.19     Rcpp_0.12.17   </div><div class="line">##  [9] stringi_1.1.7   rmarkdown_1.10  knitr_1.20      stringr_1.3.1  </div><div class="line">## [13] digest_0.6.15   evaluate_0.10.1</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180712/0m7AJLj3he.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;head
    
    </summary>
    
      <category term="R语言" scheme="https://ytlogos.github.io/categories/R%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="tips" scheme="https://ytlogos.github.io/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>读取含有多个表头的数据</title>
    <link href="https://ytlogos.github.io/2018/07/10/%E8%AF%BB%E5%8F%96%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AA%E8%A1%A8%E5%A4%B4%E7%9A%84%E6%95%B0%E6%8D%AE/"/>
    <id>https://ytlogos.github.io/2018/07/10/读取含有多个表头的数据/</id>
    <published>2018-07-10T04:19:05.000Z</published>
    <updated>2018-07-10T06:39:28.032Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180710/DBBl3GJmEm.png?imageslim" alt="mark"><br><a id="more"></a></p>
<p>我们有时读取数据的时候，往往不是我们希望的表头只有一行，有时会出现多个表头数据用来描述列明，比如下面这样的数据：</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180710/HE0aJI6HbG.png?imageslim" alt="mark"></p>
<p>用EXCEL打开如下：</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180710/bJmgi9dlB6.png?imageslim" alt="mark"></p>
<p>此时我们读取该数据的话，显示如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">library(<span class="name">readr</span>)</div><div class="line">link &lt;- <span class="string">"https://dataverse.harvard.edu/api/access/datafile/2712105"</span></div><div class="line">stickers &lt;- read_tsv(<span class="name">link</span>)</div><div class="line">stickers</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># # A tibble: 402 x 18</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#    SubjectNumber Condition NumberStickers NumberEnvelopes Gender Agemonths</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#    &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;      &lt;dbl&gt;</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  1 [Included Sa~ 1=12:1; ~ 1=12; 2=30     1=1 recipient;~ 1=fem~        NA</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  2 1             1         1              1               1             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  3 2             1         1              1               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  4 3             1         1              1               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  5 4             1         1              1               1             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  6 5             1         1              1               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  7 6             1         1              1               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  8 7             2         1              2               1             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  9 8             2         1              2               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 10 9             3         2              1               2             36</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># # ... with 392 more rows, and 12 more variables: Ageyears &lt;dbl&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   Agegroups &lt;chr&gt;, `Subject'sEnvelope` &lt;chr&gt;, LeftEnvelope &lt;chr&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   RightEnvelope &lt;chr&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   `absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)` &lt;chr&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   `PercentGiven(Outof100percent)` &lt;chr&gt;, Giveornot &lt;chr&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   LargerEnvelopeabs &lt;chr&gt;, LargeEnvelopepercent &lt;chr&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   SmallerEnvelopeabs &lt;chr&gt;, SmallEnvelopepercent &lt;chr&gt;</span></span></div></pre></td></tr></table></figure>
<p>可以看出读取进来的数据有如下问题：</p>
<ul>
<li>第一行不是数据信息，而是作为列名的补充数据</li>
</ul>
<p>针对这种问题，<a href="https://github.com/tidyverse/readr/issues/179" target="_blank" rel="external">Hadley</a>给出了答案，很简单，分成两步来读取数据，首先读取列名，然后跳过列名读取数据进行组合</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">library(dplyr)</div><div class="line">library(janitor)</div><div class="line">#读取数据列名</div><div class="line">stickers_name &lt;- link%&gt;%</div><div class="line">  read_tsv(n_max = <span class="number">0</span>)%&gt;%</div><div class="line">  <span class="keyword">rename</span>(stickersgiven = <span class="string">"absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)"</span>)%&gt;% </div><div class="line">  names()</div><div class="line"></div><div class="line">#读取数据并设置列名</div><div class="line">stickers &lt;- link%&gt;%</div><div class="line">  read_tsv(skip = <span class="number">2</span>, col_names = stickers_name)%&gt;%</div><div class="line">  clean_names()</div><div class="line">stickers</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># # A tibble: 401 x 18</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#    subject_number condition number_stickers number_envelopes gender</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#             &lt;int&gt;     &lt;int&gt;           &lt;int&gt;            &lt;int&gt;  &lt;int&gt;</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  1              1         1               1                1      1</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  2              2         1               1                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  3              3         1               1                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  4              4         1               1                1      1</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  5              5         1               1                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  6              6         1               1                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  7              7         2               1                2      1</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  8              8         2               1                2      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  9              9         3               2                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 10             10         3               2                1      2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># # ... with 391 more rows, and 13 more variables: agemonths &lt;dbl&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   ageyears &lt;dbl&gt;, agegroups &lt;int&gt;, subjects_envelope &lt;int&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   left_envelope &lt;int&gt;, right_envelope &lt;int&gt;, stickersgiven &lt;int&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   percent_given_outof100percent &lt;dbl&gt;, giveornot &lt;int&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   larger_envelopeabs &lt;int&gt;, large_envelopepercent &lt;dbl&gt;,</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># #   smaller_envelopeabs &lt;int&gt;, small_envelopepercent &lt;dbl&gt;</span></span></div></pre></td></tr></table></figure>
<p>完美解决！！！</p>
<p>鉴于有两行作为列名，我们可以制作一个字典来存储列名信息：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">library(tidyr)</div><div class="line">stickers_dict &lt;- link%&gt;%</div><div class="line">  read_tsv(n_max = <span class="number">1</span>)%&gt;%</div><div class="line">  <span class="keyword">rename</span>(stickersgiven = <span class="string">'absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)'</span>) %&gt;% </div><div class="line">  clean_names()%&gt;%</div><div class="line">  gather(variable_name, variable_description)</div><div class="line">stickers_dict</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># # A tibble: 18 x 2</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#    variable_name                 variable_description                     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#    &lt;chr&gt;                         &lt;chr&gt;                                    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  1 subject_number                [Included Sample Only]                   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  2 condition                     1=12:1; 2=12:2, 3=30:1, 4=30:2           </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  3 number_stickers               1=12; 2=30                               </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  4 number_envelopes              1=1 recipient; 2=2 recipients            </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  5 gender                        1=female; 2=male                         </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  6 agemonths                     &lt;NA&gt;                                     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  7 ageyears                      &lt;NA&gt;                                     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  8 agegroups                     1=3-4yrs; 2=5-6yrs; 3=7-8yrs; 4=9-11yrs  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  9 subjects_envelope             How many stickers did the child keep for~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 10 left_envelope                 1 recipient conditions: How many sticker~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 11 right_envelope                1 recipient conditions: N/A; 2 recipient~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 12 stickersgiven                 Regardless of condition, the number of s~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 13 percent_given_outof100percent Regardless of condition, the proportion ~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 14 giveornot                     1=Donated 1 or more stickers to the reci~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 15 larger_envelopeabs            Raw number of stickers (out of 30: Condi~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 16 large_envelopepercent         Proportion of stickers (out of 100%; Con~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 17 smaller_envelopeabs           Raw number of stickers (out of 30: Condi~</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 18 small_envelopepercent         Proportion of stickers (out of 100%; Con~</span></span></div></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">sessionInfo</span><span class="params">()</span></span></div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># R version 3.5.1 (2018-07-02)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Running under: Windows 10 x64 (build 16299)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Matrix products: default</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># locale:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] LC_COLLATE=Chinese (Simplified)_China.936 </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [2] LC_CTYPE=Chinese (Simplified)_China.936   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [3] LC_MONETARY=Chinese (Simplified)_China.936</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [4] LC_NUMERIC=C                              </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [5] LC_TIME=Chinese (Simplified)_China.936    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># attached base packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># other attached packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] tidyr_0.8.1   janitor_1.0.0 dplyr_0.7.5   readr_1.1.1  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># loaded via a namespace (and not attached):</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [1] Rcpp_0.12.17     bindr_0.1.1      knitr_1.20       magrittr_1.5    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [5] hms_0.4.2        tidyselect_0.2.4 R6_2.2.2         rlang_0.2.1     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [9] stringr_1.3.1    tools_3.5.1      utf8_1.1.4       cli_1.0.0       </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [13] htmltools_0.3.6  yaml_2.1.19      rprojroot_1.3-2  digest_0.6.15   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [17] assertthat_0.2.0 tibble_1.4.2     crayon_1.3.4     bindrcpp_0.2.2  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [21] purrr_0.2.5      curl_3.2         snakecase_0.9.1  glue_1.2.0      </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [25] evaluate_0.10.1  rmarkdown_1.10   stringi_1.1.7    compiler_3.5.1  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [29] pillar_1.2.3     backports_1.1.2  pkgconfig_2.0.1</span></span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180710/DBBl3GJmEm.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="R语言" scheme="https://ytlogos.github.io/categories/R%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="数据读取" scheme="https://ytlogos.github.io/tags/%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96/"/>
    
  </entry>
  
  <entry>
    <title>三种方法在地图上绘制网络图</title>
    <link href="https://ytlogos.github.io/2018/06/10/%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%E5%9C%A8%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%BB%98%E5%88%B6%E7%BD%91%E7%BB%9C%E5%9B%BE/"/>
    <id>https://ytlogos.github.io/2018/06/10/三种方法在地图上绘制网络图/</id>
    <published>2018-06-10T10:19:05.000Z</published>
    <updated>2018-06-10T10:38:06.319Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/mA73K7a4gJ.png?imageslim" alt="mark"></p>
<p>最近为了绘制几幅简单地图，查阅了一些资料，看到了<strong>Markus konrad</strong>的<a href="https://datascience.blog.wzb.eu/2018/05/31/three-ways-of-visualizing-a-graph-on-a-map/" target="_blank" rel="external">帖子</a>，非常赞。其中他的部分思路对于我们学习可视化很有帮助。</p>
<a id="more"></a>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>我们需要用到以下包</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">library</span><span class="params">(pacman)</span></span></div><div class="line"><span class="function"><span class="title">p_load</span><span class="params">(assertthat,tidyverse,ggraph,igraph,ggmap)</span></span></div></pre></td></tr></table></figure>
<p>加载数据</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nodes &lt;- read.table(<span class="string">"country_coords.txt"</span>, <span class="selector-tag">header</span> = FALSE, <span class="selector-tag">quote</span> = <span class="string">"'"</span>,sep = <span class="string">""</span>,col<span class="selector-class">.names</span> = c(<span class="string">"id"</span>,<span class="string">"lon"</span>,<span class="string">"lat"</span>,<span class="string">"name"</span>))</div></pre></td></tr></table></figure>
<p>创建连接关系<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">42</span>)</div><div class="line"><span class="keyword">min</span> &lt;- <span class="number">1</span></div><div class="line"><span class="keyword">max</span> &lt;- <span class="number">4</span></div><div class="line">n_categories &lt;- <span class="number">4</span></div><div class="line">edges &lt;- map_dfr(nodes$<span class="keyword">id</span>, <span class="keyword">function</span>(<span class="keyword">id</span>)&#123;</div><div class="line">  n &lt;- <span class="keyword">floor</span>(runif(<span class="number">1</span>,<span class="keyword">min</span>,<span class="keyword">max</span>+<span class="number">1</span>))</div><div class="line">  <span class="keyword">to</span> &lt;- <span class="keyword">sample</span>(<span class="number">1</span>:<span class="keyword">max</span>(nodes$<span class="keyword">id</span>),n ,<span class="keyword">replace</span> = <span class="literal">FALSE</span>)</div><div class="line">  <span class="keyword">to</span> &lt;- <span class="keyword">to</span>[<span class="keyword">to</span>!=<span class="keyword">id</span>]</div><div class="line">  categories &lt;- <span class="keyword">sample</span>(<span class="number">1</span>:n_categories,<span class="keyword">length</span>(<span class="keyword">to</span>), <span class="keyword">replace</span> = <span class="literal">TRUE</span>)</div><div class="line">  weight &lt;- runif(<span class="keyword">length</span>(<span class="keyword">to</span>))</div><div class="line">  data_frame(<span class="keyword">from</span>=<span class="keyword">id</span>, <span class="keyword">to</span>=<span class="keyword">to</span>, weight=weight, <span class="keyword">category</span>=categories)</div><div class="line">&#125;)</div><div class="line">edges &lt;- edges%&gt;%mutate(<span class="keyword">category</span>=as.factor(<span class="keyword">category</span>))</div></pre></td></tr></table></figure></p>
<p>上面我们已经创建好了节点(node)以及连接(edge)，下面进行可视化</p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#生成图形结构</span></div><div class="line">g &lt;- graph_from_data_frame<span class="params">(edges, <span class="attr">directed</span> = FALSE, <span class="attr">vertices</span> = nodes)</span></div></pre></td></tr></table></figure>
<p>再额外定义四列用来绘制节点的起始位置<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">edges_for_plot &lt;- edges%&gt;%</div><div class="line">  inner_join(nodes%&gt;%select(id, lon, lat),by=c(<span class="string">"from"</span>=<span class="string">"id"</span>))%&gt;%</div><div class="line">  <span class="keyword">rename</span>(x=lon, y=lat)%&gt;%</div><div class="line">  inner_join(nodes%&gt;%select(id,lon,lat),by=c(<span class="string">"to"</span>=<span class="string">"id"</span>))%&gt;%</div><div class="line">  <span class="keyword">rename</span>(xend=lon,yend=lat)</div><div class="line">assert_that(nrow(edges_for_plot)==nrow(edges))</div><div class="line">nodes$weight &lt;- degree(g)</div></pre></td></tr></table></figure></p>
<p>下面再定义以下<strong>ggplot2</strong>主题用来绘制地图<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">maptheme &lt;- theme(</div><div class="line">  <span class="name">panel</span>.grid = element_blank(),</div><div class="line">  axis.text = element_blank(),</div><div class="line">  axis.ticks = element_blank(),</div><div class="line">  axis.title = element_blank(),</div><div class="line">  legend.position = <span class="string">"bottom"</span>,</div><div class="line">  panel.background = element_rect(<span class="name">fill=</span><span class="string">"#596673"</span>),</div><div class="line">  plot.margin = unit(<span class="name">c</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">0</span>),<span class="string">"cm"</span>)</div><div class="line">)</div><div class="line">country_shape &lt;- geom_polygon(<span class="name">aes</span>(<span class="name">x=long</span>, y=lat, group=group),</div><div class="line">                              data=map_data(<span class="string">"world"</span>),</div><div class="line">                              fill=<span class="string">"#CECECE"</span>, color=<span class="string">"#515151"</span>,size=0.<span class="number">1</span>)</div><div class="line">mapcoords &lt;- coord_fixed(<span class="name">xlim=c</span>(<span class="name">-150</span>,<span class="number">180</span>), ylim=c(<span class="name">-55</span>,<span class="number">80</span>))</div></pre></td></tr></table></figure></p>
<h3 id="方法一：ggplot2"><a href="#方法一：ggplot2" class="headerlink" title="方法一：ggplot2"></a>方法一：ggplot2</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ggplot(<span class="name">nodes</span>)+country_shape+</div><div class="line">  geom_curve(<span class="name">aes</span>(<span class="name">x=x</span>,y=y,xend=xend,yend=yend,color=category,size=weight),</div><div class="line">             data=edges_for_plot,curvature = <span class="number">0.33</span>,alpha=0.<span class="number">5</span>)+</div><div class="line">  scale_size_continuous(<span class="name">guide</span> = FALSE,range = c(<span class="number">0.25</span>,<span class="number">2</span>))+</div><div class="line">  geom_point(<span class="name">aes</span>(<span class="name">x=lon</span>,y=lat,size=weight),shape=21,fill=<span class="string">"white"</span>,color=<span class="string">"black"</span>,stroke=0.<span class="number">5</span>)+</div><div class="line">  scale_size_continuous(<span class="name">guide</span> = FALSE, range = c(<span class="number">1</span>,<span class="number">6</span>))+</div><div class="line">  geom_text(<span class="name">aes</span>(<span class="name">x=lon</span>,y=lat,label=name),hjust=0,nudge_x = <span class="number">1</span>,nudge_y = <span class="number">4</span>,size=3,color=<span class="string">"black"</span>,fontface=<span class="string">"bold"</span>)+</div><div class="line">  mapcoords+maptheme</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/mA73K7a4gJ.png?imageslim" alt="mark"></p>
<h3 id="方法二：ggplot2-ggraph"><a href="#方法二：ggplot2-ggraph" class="headerlink" title="方法二：ggplot2+ggraph"></a>方法二：ggplot2+ggraph</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="xml">nodes_pos <span class="tag">&lt;<span class="name">-</span> <span class="attr">nodes</span>%&gt;</span>%</span></div><div class="line">  select(lon,lat)%&gt;%</div><div class="line">  rename(x=lon,y=lat)</div><div class="line">lay <span class="tag">&lt;<span class="name">-</span> <span class="attr">create_layout</span>(<span class="attr">g</span>,"<span class="attr">manual</span>",<span class="attr">node.position</span>=<span class="string">nodes_pos)</span></span></div><div class="line"><span class="attr">assert_that</span>(<span class="attr">nrow</span>(<span class="attr">lay</span>)==<span class="string">nrow(nodes))</span></div><div class="line"><span class="attr">lay</span>$<span class="attr">weight</span> &lt;<span class="attr">-</span> <span class="attr">degree</span>(<span class="attr">g</span>)</div><div class="line"><span class="attr">ggraph</span>(<span class="attr">lay</span>)+</div><div class="line">  <span class="attr">country_shape</span>+</div><div class="line">  <span class="attr">geom_edge_arc</span>(<span class="attr">aes</span>(<span class="attr">color</span>=<span class="string">category,edge_width</span>=<span class="string">weight,circular</span>=<span class="string">FALSE),</span></div><div class="line">                <span class="attr">data</span> = <span class="string">edges_for_plot,curvature</span> = <span class="string">0.33,alpha</span>=<span class="string">0.5)+</span></div><div class="line">  <span class="attr">scale_edge_width_continuous</span>(<span class="attr">range</span> = <span class="string">c(0.5,2),guide</span>=<span class="string">FALSE)+</span></div><div class="line">  <span class="attr">geom_node_point</span>(<span class="attr">aes</span>(<span class="attr">size</span>=<span class="string">weight),shape</span>=<span class="string">21,fill</span>=<span class="string">"white"</span>,<span class="attr">color</span>=<span class="string">"black"</span>,<span class="attr">stroke</span>=<span class="string">0.5)+</span></div><div class="line">  <span class="attr">scale_size_continuous</span>(<span class="attr">range</span> = <span class="string">c(1,6),guide</span> = <span class="string">FALSE)+</span></div><div class="line">  <span class="attr">geom_node_text</span>(<span class="attr">aes</span>(<span class="attr">label</span>=<span class="string">name),repel</span> = <span class="string">TRUE,</span> <span class="attr">size</span>=<span class="string">3,color</span>=<span class="string">"black"</span>,<span class="attr">fontface</span>=<span class="string">"bold"</span>)+</div><div class="line">  <span class="attr">mapcoords</span>+<span class="attr">maptheme</span></div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/ifLkLd15Jh.png?imageslim" alt="mark"></p>
<h3 id="方法三：图形叠加"><a href="#方法三：图形叠加" class="headerlink" title="方法三：图形叠加"></a>方法三：图形叠加</h3><p>图形叠加，所以需要一个透明背景<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">theme_transp_overlay &lt;- theme(</div><div class="line">  <span class="name">panel</span>.background = element_rect(<span class="name">fill=</span><span class="string">"transparent"</span>,color=NA),</div><div class="line">  plot.background = element_rect(<span class="name">fill=</span><span class="string">"transparent"</span>,color=NA)</div><div class="line">)</div><div class="line">(<span class="name">p_base</span> &lt;- ggplot()+</div><div class="line">  country_shape+</div><div class="line">  mapcoords+</div><div class="line">  maptheme)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/Cfe1Bkf0Ga.png?imageslim" alt="mark"></p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="name">p_edges</span> &lt;- ggplot(<span class="name">edges_for_plot</span>)+</div><div class="line">  geom_curve(<span class="name">aes</span>(<span class="name">x=x</span>,y=y,xend=xend,yend=yend,color=category,size=weight),</div><div class="line">             curvature = <span class="number">0.33</span>,alpha=0.33)+</div><div class="line">  scale_size_continuous(<span class="name">guide</span> = FALSE, range = c(<span class="name">0.5</span>, <span class="number">2</span>)) + </div><div class="line">  mapcoords + maptheme + theme_transp_overlay +</div><div class="line">  theme(<span class="name">legend.position</span> = c(<span class="name">0.5</span>, <span class="number">-0.1</span>),</div><div class="line">        legend.direction = <span class="string">"horizontal"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/BCI696DJ3I.png?imageslim" alt="mark"></p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">(p_nodes &lt;- ggplot(nodes) +</div><div class="line">  geom_point(aes(<span class="attr">x</span> = lon, <span class="attr">y</span> = lat, <span class="attr">size</span> = weight),</div><div class="line">             <span class="attr">shape</span> = <span class="number">21</span>, <span class="attr">fill</span> = <span class="string">"white"</span>, <span class="attr">color</span> = <span class="string">"black"</span>,   </div><div class="line">             <span class="attr">stroke</span> = <span class="number">0.5</span>) +</div><div class="line">  scale_size_continuous(<span class="attr">guide</span> = FALSE, <span class="attr">range</span> = c(<span class="number">1</span>, <span class="number">6</span>)) +    </div><div class="line">  geom_text(aes(<span class="attr">x</span> = lon, <span class="attr">y</span> = lat, <span class="attr">label</span> = name),             </div><div class="line">            <span class="attr">hjust</span> = <span class="number">0</span>, <span class="attr">nudge_x</span> = <span class="number">1</span>, <span class="attr">nudge_y</span> = <span class="number">4</span>,</div><div class="line">            <span class="attr">size</span> = <span class="number">3</span>, <span class="attr">color</span> = <span class="string">"white"</span>, <span class="attr">fontface</span> = <span class="string">"bold"</span>) +</div><div class="line">  mapcoords + maptheme + theme_transp_overlay)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/hab81AIbfa.png?imageslim" alt="mark"></p>
<p>最后就是三图形叠加了（需要多次调整）<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p &lt;- p_base+</div><div class="line">  annotation_custom(<span class="name">ggplotGrob</span>(<span class="name">p_edges</span>),ymin = <span class="number">-74</span>)+</div><div class="line">  annotation_custom(<span class="name">ggplotGrob</span>(<span class="name">p_nodes</span>),ymin = <span class="number">-74</span>)</div><div class="line">print(<span class="name">p</span>)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/8HG1jbLaAf.png?imageslim" alt="mark"></p>
<h3 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">sessionInfo</span><span class="params">()</span></span></div></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">## R version <span class="number">3.5</span><span class="meta">.0</span> (<span class="number">2018</span>-<span class="number">04</span>-<span class="number">23</span>)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (<span class="number">64</span>-bit)</div><div class="line">## Running under: Windows <span class="number">10</span> x64 (build <span class="number">16299</span>)</div><div class="line">## </div><div class="line">## Matrix products: <span class="meta">default</span></div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [<span class="number">1</span>] LC_COLLATE=Chinese (Simplified)_China<span class="meta">.936</span> </div><div class="line">## [<span class="number">2</span>] LC_CTYPE=Chinese (Simplified)_China<span class="meta">.936</span>   </div><div class="line">## [<span class="number">3</span>] LC_MONETARY=Chinese (Simplified)_China<span class="meta">.936</span></div><div class="line">## [<span class="number">4</span>] LC_NUMERIC=C                              </div><div class="line">## [<span class="number">5</span>] LC_TIME=Chinese (Simplified)_China<span class="meta">.936</span>    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [<span class="number">1</span>] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">##  [<span class="number">1</span>] maps_3<span class="meta">.3</span><span class="meta">.0</span>         bindrcpp_0<span class="meta">.2</span><span class="meta">.2</span>     ggmap_2<span class="meta">.6</span><span class="meta">.1</span>       </div><div class="line">##  [<span class="number">4</span>] igraph_1<span class="meta">.2</span><span class="meta">.1</span>       ggraph_1<span class="meta">.0</span><span class="meta">.1</span>       forcats_0<span class="meta">.3</span><span class="meta">.0</span>     </div><div class="line">##  [<span class="number">7</span>] stringr_1<span class="meta">.3</span><span class="meta">.1</span>      dplyr_0<span class="meta">.7</span><span class="meta">.5</span>        purrr_0<span class="meta">.2</span><span class="meta">.5</span>       </div><div class="line">## [<span class="number">10</span>] readr_1<span class="meta">.1</span><span class="meta">.1</span>        tidyr_0<span class="meta">.8</span><span class="meta">.1</span>        tibble_1<span class="meta">.4</span><span class="meta">.2</span>      </div><div class="line">## [<span class="number">13</span>] ggplot2_2<span class="meta">.2</span><span class="meta">.1</span><span class="meta">.9000</span> tidyverse_1<span class="meta">.2</span><span class="meta">.1</span>    assertthat_0<span class="meta">.2</span><span class="meta">.0</span>  </div><div class="line">## [<span class="number">16</span>] pacman_0<span class="meta">.4</span><span class="meta">.6</span>      </div><div class="line">## </div><div class="line">## loaded via a namespace (<span class="keyword">and</span> <span class="keyword">not</span> attached):</div><div class="line">##  [<span class="number">1</span>] ggrepel_0<span class="meta">.8</span><span class="meta">.0</span>     Rcpp_0<span class="meta">.12</span><span class="meta">.17</span>      lubridate_1<span class="meta">.7</span><span class="meta">.4</span>  </div><div class="line">##  [<span class="number">4</span>] lattice_0<span class="meta">.20</span>-<span class="number">35</span>   png_0<span class="meta">.1</span>-<span class="number">7</span>         rprojroot_1<span class="meta">.3</span>-<span class="number">2</span>  </div><div class="line">##  [<span class="number">7</span>] digest_0<span class="meta">.6</span><span class="meta">.15</span>     psych_1<span class="meta">.8</span><span class="meta">.4</span>       ggforce_0<span class="meta">.1</span><span class="meta">.2</span>    </div><div class="line">## [<span class="number">10</span>] R6_2<span class="meta">.2</span><span class="meta">.2</span>          cellranger_1<span class="meta">.1</span><span class="meta">.0</span>  plyr_1<span class="meta">.8</span><span class="meta">.4</span>       </div><div class="line">## [<span class="number">13</span>] backports_1<span class="meta">.1</span><span class="meta">.2</span>   evaluate_0<span class="meta">.10</span><span class="meta">.1</span>   httr_1<span class="meta">.3</span><span class="meta">.1</span>       </div><div class="line">## [<span class="number">16</span>] pillar_1<span class="meta">.2</span><span class="meta">.3</span>      RgoogleMaps_1<span class="meta">.4</span><span class="meta">.1</span> rlang_0<span class="meta">.2</span><span class="meta">.1</span>      </div><div class="line">## [<span class="number">19</span>] lazyeval_0<span class="meta">.2</span><span class="meta">.1</span>    readxl_1<span class="meta">.1</span><span class="meta">.0</span>      geosphere_1<span class="meta">.5</span>-<span class="number">7</span>  </div><div class="line">## [<span class="number">22</span>] rstudioapi_0<span class="meta">.7</span>    rmarkdown_1<span class="meta">.9</span>     labeling_0<span class="meta">.3</span>     </div><div class="line">## [<span class="number">25</span>] proto_1<span class="meta">.0</span><span class="meta">.0</span>       udunits2_0<span class="meta">.13</span>     foreign_0<span class="meta">.8</span>-<span class="number">70</span>   </div><div class="line">## [<span class="number">28</span>] munsell_0<span class="meta">.4</span><span class="meta">.3</span>     broom_0<span class="meta">.4</span><span class="meta">.4</span>       compiler_3<span class="meta">.5</span><span class="meta">.0</span>   </div><div class="line">## [<span class="number">31</span>] modelr_0<span class="meta">.1</span><span class="meta">.2</span>      pkgconfig_2<span class="meta">.0</span><span class="meta">.1</span>   mnormt_1<span class="meta">.5</span>-<span class="number">5</span>     </div><div class="line">## [<span class="number">34</span>] htmltools_0<span class="meta">.3</span><span class="meta">.6</span>   tidyselect_0<span class="meta">.2</span><span class="meta">.4</span>  gridExtra_2<span class="meta">.3</span>    </div><div class="line">## [<span class="number">37</span>] viridisLite_0<span class="meta">.3</span><span class="meta">.0</span> crayon_1<span class="meta">.3</span><span class="meta">.4</span>      withr_2<span class="meta">.1</span><span class="meta">.2</span>      </div><div class="line">## [<span class="number">40</span>] MASS_7<span class="meta">.3</span>-<span class="number">49</span>       grid_3<span class="meta">.5</span><span class="meta">.0</span>        nlme_3<span class="meta">.1</span>-<span class="number">137</span>     </div><div class="line">## [<span class="number">43</span>] jsonlite_1<span class="meta">.5</span>      gtable_0<span class="meta">.2</span><span class="meta">.0</span>      magrittr_1<span class="meta">.5</span>     </div><div class="line">## [<span class="number">46</span>] units_0<span class="meta">.5</span>-<span class="number">1</span>       scales_0<span class="meta">.5</span><span class="meta">.0</span>      cli_1<span class="meta">.0</span><span class="meta">.0</span>        </div><div class="line">## [<span class="number">49</span>] stringi_1<span class="meta">.1</span><span class="meta">.7</span>     mapproj_1<span class="meta">.2</span><span class="meta">.6</span>     reshape2_1<span class="meta">.4</span><span class="meta">.3</span>   </div><div class="line">## [<span class="number">52</span>] viridis_0<span class="meta">.5</span><span class="meta">.1</span>     sp_1<span class="meta">.2</span>-<span class="number">7</span>          xml2_1<span class="meta">.2</span><span class="meta">.0</span>       </div><div class="line">## [<span class="number">55</span>] rjson_0<span class="meta">.2</span><span class="meta">.19</span>      tools_3<span class="meta">.5</span><span class="meta">.0</span>       glue_1<span class="meta">.2</span><span class="meta">.0</span>       </div><div class="line">## [<span class="number">58</span>] tweenr_0<span class="meta">.1</span><span class="meta">.5</span>      jpeg_0<span class="meta">.1</span>-<span class="number">8</span>        hms_0<span class="meta">.4</span><span class="meta">.2</span>        </div><div class="line">## [<span class="number">61</span>] parallel_3<span class="meta">.5</span><span class="meta">.0</span>    yaml_2<span class="meta">.1</span><span class="meta">.19</span>       colorspace_1<span class="meta">.3</span>-<span class="number">2</span> </div><div class="line">## [<span class="number">64</span>] rvest_0<span class="meta">.3</span><span class="meta">.2</span>       knitr_1<span class="meta">.20</span>        bindr_0<span class="meta">.1</span><span class="meta">.1</span>      </div><div class="line">## [<span class="number">67</span>] haven_1<span class="meta">.1</span><span class="meta">.1</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180610/mA73K7a4gJ.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;最近为了绘制几幅简单地图，查阅了一些资料，看到了&lt;strong&gt;Markus konrad&lt;/strong&gt;的&lt;a href=&quot;https://datascience.blog.wzb.eu/2018/05/31/three-ways-of-visualizing-a-graph-on-a-map/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;帖子&lt;/a&gt;，非常赞。其中他的部分思路对于我们学习可视化很有帮助。&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="map" scheme="https://ytlogos.github.io/tags/map/"/>
    
      <category term="ggraph" scheme="https://ytlogos.github.io/tags/ggraph/"/>
    
  </entry>
  
  <entry>
    <title>Linux之数据呈现</title>
    <link href="https://ytlogos.github.io/2018/05/22/Linux%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%91%88%E7%8E%B0/"/>
    <id>https://ytlogos.github.io/2018/05/22/Linux之数据呈现/</id>
    <published>2018-05-22T13:19:05.000Z</published>
    <updated>2018-05-24T05:51:41.420Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180524/8aj460AJAl.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p><strong>bash shell</strong>保留了前三个文件描述符(0、1、2),分别表示标准输入、标准输出、标准错误。如果需要将标准输出和标准错误重定向到同一个输出文件中，<strong>bash shell</strong>提供了特殊的重定向符<code>&amp;&gt;</code>。</p>
<h2 id="脚本中重定向输出"><a href="#脚本中重定向输出" class="headerlink" title="脚本中重定向输出"></a>脚本中重定向输出</h2><h3 id="临时重定向"><a href="#临时重定向" class="headerlink" title="临时重定向"></a>临时重定向</h3><p>在重定向到文件描述符时，必须在文件描述符数字前加一个<code>&amp;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ cat test8</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing STDERR messages</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"This is an error"</span> &gt;&amp;2</div><div class="line"><span class="built_in">echo</span> <span class="string">"This is normal output"</span></div><div class="line">$ ./test8 2&gt; test9</div><div class="line">This is normal output</div><div class="line">$ cat test9</div><div class="line">This is an error</div></pre></td></tr></table></figure>
<h3 id="永久重定向"><a href="#永久重定向" class="headerlink" title="永久重定向"></a>永久重定向</h3><p>可以在脚本中用<code>exec</code>命令告诉<code>shell</code>在脚本执行期间重定向某个特定文件描述符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ cat test11</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># redirecting output to different locations</span></div><div class="line"><span class="built_in">exec</span> 2&gt;testerror</div><div class="line"><span class="built_in">echo</span> <span class="string">"This is the start of the script"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"now redirecting all output to another location"</span></div><div class="line"><span class="built_in">exec</span> 1&gt;testout</div><div class="line"><span class="built_in">echo</span> <span class="string">"This output should go to the testout file"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"but this should go to the testerror file"</span> &gt;&amp;2</div><div class="line">$</div><div class="line">$ ./test11</div><div class="line">This is the start of the script</div><div class="line">now redirecting all output to another location</div><div class="line">$ cat testout</div><div class="line">This output should go to the testout file</div><div class="line">$ cat testerror</div><div class="line">but this should go to the testerror file</div></pre></td></tr></table></figure>
<h2 id="脚本中重定向输入"><a href="#脚本中重定向输入" class="headerlink" title="脚本中重定向输入"></a>脚本中重定向输入</h2><p><code>exec</code>命令允许将标准输入重定向到<strong>Linux</strong>系统上的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">exec</span> 0&lt; testfile</div></pre></td></tr></table></figure>
<blockquote>
<p>这个命令会告诉<code>shell</code>应该从文件testfile中获得输入而不是STDIN</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ cat test12</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># redirecting file input</span></div><div class="line"><span class="built_in">exec</span> 0&lt; testfile</div><div class="line">count=1</div><div class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Line #<span class="variable">$count</span>: <span class="variable">$line</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./test12</div><div class="line">Line <span class="comment">#1: This is the first line.</span></div><div class="line">Line <span class="comment">#2: This is the second line.</span></div><div class="line">Line <span class="comment">#3: This is the third line.</span></div></pre></td></tr></table></figure>
<h2 id="消息记录"><a href="#消息记录" class="headerlink" title="消息记录"></a>消息记录</h2><p><code>tee</code>命令相当于管道的一个T型接头，它将从STDIN过来的数据同时发往两处，一处是STDOUT，另一处是<code>tee</code>命令行指定的文件名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> date | tee testfile</span></div><div class="line">Sun Oct 19 18:56:21 EDT 2014</div><div class="line"><span class="meta">$</span><span class="bash"> cat testfile</span></div><div class="line">Sun Oct 19 18:56:21 EDT 2014</div></pre></td></tr></table></figure>
<blockquote>
<p><code>tee</code>命令在默认条件下会每次覆盖输出文件内容，如果需要追加数据到文件中，可以用<code>-a</code>参数</p>
</blockquote>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180524/8aj460AJAl.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux之获取用户输入</title>
    <link href="https://ytlogos.github.io/2018/05/21/Linux%E4%B9%8B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/"/>
    <id>https://ytlogos.github.io/2018/05/21/Linux之获取用户输入/</id>
    <published>2018-05-21T13:19:05.000Z</published>
    <updated>2018-05-22T09:12:25.425Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180522/CGbkeLBFc9.png?imageslim" alt="mark"><br><a id="more"></a></p>
<h2 id="基本读取"><a href="#基本读取" class="headerlink" title="基本读取"></a>基本读取</h2><p>read命令从标准输入（键盘）或另一个文件描述符中接受输入，在收到输入后，read命令会将数据放进一个变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat test21.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing the read command</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span> -n <span class="string">"Enter your name: "</span></div><div class="line"><span class="built_in">read</span> name</div><div class="line"><span class="built_in">echo</span> <span class="string">"Hello <span class="variable">$name</span>, welcome to my program. "</span></div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ ./test21.sh</div><div class="line">Enter your name: Rich Blum</div><div class="line">Hello Rich Blum, welcome to my program.</div></pre></td></tr></table></figure>
<p>echo命令使用了-n选项，该选项不会在字符串末尾输出换行符，允许脚本用户紧跟其后输入数据，而不是下一行。<br>read命令包含了-p选项，允许用户直接在read命令行指定提示符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat test22.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing the read -p option</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Please enter your age: "</span> age</div><div class="line">days=$[ <span class="variable">$age</span> * 365 ]</div><div class="line"><span class="built_in">echo</span> <span class="string">"That makes you over <span class="variable">$days</span> days old! "</span></div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ ./test22.sh</div><div class="line">Please enter your age: 10</div><div class="line">That makes you over 3650 days old!</div></pre></td></tr></table></figure>
<blockquote>
<p>read命令会将提示符后输入的所有数据分配给单个变量，要么指定多个变量，输入的每个数据值都会分配给变量列表中的下一个变量，如果变量数量不够，剩下的数据就全部分配给最后一个变量。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ cat test23.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># entering multiple variables</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Enter your name: "</span> first last</div><div class="line"><span class="built_in">echo</span> <span class="string">"Checking data for <span class="variable">$last</span>, <span class="variable">$first</span>…"</span></div><div class="line">$</div><div class="line">$ ./test23.sh</div><div class="line">Enter your name: Rich Blum</div><div class="line">Checking data <span class="keyword">for</span> Blum, Rich...</div></pre></td></tr></table></figure>
<p>也可以在read命令行中不指定变量，此时read会将它收到的任何数据存入环境变量REPLY中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat test24.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Testing the REPLY Environment variable</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Enter your name: "</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> Hello <span class="variable">$REPLY</span>, welcome to my program.</div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ ./test24.sh</div><div class="line">Enter your name: Christine</div><div class="line">Hello Christine, welcome to my program.</div></pre></td></tr></table></figure>
<h3 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h3><p>使用read命令时脚本很可能会一直等着用户输入，此时可以设置一个计时器来让脚本在超过输入时间后继续执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat test25.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># timing the data entry</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">"Please enter your name: "</span> name</div><div class="line"><span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Hello <span class="variable">$name</span>, welcome to my script"</span></div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Sorry, too slow! "</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">$</div><div class="line">$ ./test25.sh</div><div class="line">Please enter your name: Rich</div><div class="line">Hello Rich, welcome to my script</div><div class="line">$ ./test25.sh</div><div class="line">Please enter your name:</div><div class="line">Sorry, too slow!</div></pre></td></tr></table></figure>
<p>也可以不对输入过程计时，而是让read命令来统计输入的字符数，当输入的字符数达到预设的字符数时，就会自动退出，将输入的数据赋值给变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ cat test26.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># getting just one character of input</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -n1 -p <span class="string">"Do you want to continue [Y/N]? "</span> answer</div><div class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></div><div class="line">Y | y) <span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"fine, continue on…"</span>;;</div><div class="line">N | n) <span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> OK, goodbye</div><div class="line"><span class="built_in">exit</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"This is the end of the script"</span></div><div class="line">$</div><div class="line">$ ./test26.sh</div><div class="line">Do you want to <span class="built_in">continue</span> [Y/N]? Y</div><div class="line">fine, <span class="built_in">continue</span> on…</div><div class="line">This is the end of the script</div><div class="line">$</div><div class="line">$ ./test26.sh</div><div class="line">Do you want to <span class="built_in">continue</span> [Y/N]? n</div><div class="line">OK, goodbye</div></pre></td></tr></table></figure>
<p>将-n选项与值1一起使用，告诉read命令在接受单个字符后退出。</p>
<h3 id="隐藏方式读取"><a href="#隐藏方式读取" class="headerlink" title="隐藏方式读取"></a>隐藏方式读取</h3><p>-s选项可以避免在read命令中输入的数据出现在显示器上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ cat test27.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># hiding input data from the monitor</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -s -p <span class="string">"Enter your password: "</span> pass</div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Is your password really <span class="variable">$pass</span>? "</span></div><div class="line">$</div><div class="line">$ ./test27.sh</div><div class="line">Enter your password:</div><div class="line">Is your password really T3st1ng?</div></pre></td></tr></table></figure>
<h3 id="文件中读取"><a href="#文件中读取" class="headerlink" title="文件中读取"></a>文件中读取</h3><p>read可以用来直接读取文件里保存的数据，每次调用read命令，它都会从文件中读取一行，当文件中没有内容后，read退出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ cat test28.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># reading data from a file</span></div><div class="line"><span class="comment">#</span></div><div class="line">count=1</div><div class="line">cat <span class="built_in">test</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Line <span class="variable">$count</span>: <span class="variable">$line</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1]</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Finished processing the file"</span></div><div class="line">$</div><div class="line">$ cat <span class="built_in">test</span></div><div class="line">The quick brown dog jumps over the lazy fox.</div><div class="line">This is a <span class="built_in">test</span>, this is only a <span class="built_in">test</span>.</div><div class="line">O Romeo, Romeo! Wherefore art thou Romeo?</div><div class="line">$</div><div class="line">$ ./test28.sh</div><div class="line">Line 1: The quick brown dog jumps over the lazy fox.</div><div class="line">Line 2: This is a <span class="built_in">test</span>, this is only a <span class="built_in">test</span>.</div><div class="line">Line 3: O Romeo, Romeo! Wherefore art thou Romeo?</div><div class="line">Finished processing the file</div></pre></td></tr></table></figure>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180522/CGbkeLBFc9.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux之处理用户输入（三）</title>
    <link href="https://ytlogos.github.io/2018/05/20/Linux%E4%B9%8B%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5(%E4%B8%89)/"/>
    <id>https://ytlogos.github.io/2018/05/20/Linux之处理用户输入(三)/</id>
    <published>2018-05-20T13:19:05.000Z</published>
    <updated>2018-05-22T03:50:43.818Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180522/AHC1ACD4IH.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="使用getopt命令"><a href="#使用getopt命令" class="headerlink" title="使用getopt命令"></a>使用<code>getopt</code>命令</h2><p><code>getopt</code>能够识别命令行参数，从而在脚本中解析它们。<code>getopt</code>可以接受一系列任意形式的命令行选项和参数，并自动将它们转换为适当的格式。其命令行格式如下：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">getopt optstring paramaters</span></div></pre></td></tr></table></figure>
<blockquote>
<p><code>optstring</code>是这个过程的关键所在，它定义了命令行有效的选项字母，还定义了哪些选项字母需要参数值，在<code>optstring</code>中列出你要在脚本中用到的每个命令行选项字母，然后在每个需要参数值的选项字母后加一个冒号，<code>getopt</code>命令会基于你定义的optstring解析提供的参数。</p>
</blockquote>
<p>举个例子：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ getopt ad:cd -<span class="selector-tag">a</span> -<span class="selector-tag">b</span> test1 -cd test2 test3</div><div class="line">-<span class="selector-tag">a</span> -<span class="selector-tag">b</span> test1 -c -d -- test2 test3</div></pre></td></tr></table></figure>
<blockquote>
<p>optstring定义了四个有效选项字母，冒号在b之后，因为b选项需要一个参数值，当<code>getopt</code>命令运行时，它会检查提供的参数列表(-a -b test1 -cd test2 test3)，并基于提供的optstring进行解析，它会自动将-cd选项分成两个独立的选项，并插入双破折线来分隔行中的额外参数。</p>
</blockquote>
<p>如果指定了一个不在<code>optstring</code>中的选项，会报错，这时可以在命令行中加入<code>-q</code>选项以忽略错误消息</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ getopt ab:cd -<span class="selector-tag">a</span> -<span class="selector-tag">b</span> test1 -cde test2 test3</div><div class="line">getopt: invalid option -- e</div><div class="line">-<span class="selector-tag">a</span> -<span class="selector-tag">b</span> test1 -c -d -- test2 test3</div><div class="line">$ getopt -<span class="selector-tag">q</span> ab:cd -<span class="selector-tag">a</span> -<span class="selector-tag">b</span> test1 -cde test2 test3</div><div class="line">-<span class="selector-tag">a</span> -<span class="selector-tag">b</span> <span class="string">'test1'</span> -c -d -- <span class="string">'test2'</span> <span class="string">'test3'</span></div></pre></td></tr></table></figure>
<h3 id="脚本中使用getopt"><a href="#脚本中使用getopt" class="headerlink" title="脚本中使用getopt"></a>脚本中使用<code>getopt</code></h3><p>通过<code>set</code>命令来完成，set命令的选项之一是双破折线，它会将命令行参数替换成set命令的命令行值。该方法首先将原始脚本中的命令行参数传给getopt命令，之后再将getopt命令的输出传给set命令，用getopt格式化后的命令行参数来替换原始的命令行参数，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span> --$(gteopt -q ab:<span class="built_in">cd</span> <span class="string">"<span class="variable">$@</span>"</span>)</div></pre></td></tr></table></figure>
<p>现在原始的命令行参数变量的值就会被getopt命令行的输出替换，getopt已经将命令行参数全部格式化好了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ cat test18.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Extract command line options &amp; values with getopt</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">set</span> -- $(getopt -q ab:<span class="built_in">cd</span> <span class="string">"<span class="variable">$@</span>"</span>)</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line">    <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">    -a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;</div><div class="line">    -b) param=<span class="string">"<span class="variable">$2</span>"</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Found the -b option, with parameter value <span class="variable">$param</span>"</span></div><div class="line">        <span class="built_in">shift</span> ;;</div><div class="line">    -c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;</div><div class="line">    --) <span class="built_in">shift</span></div><div class="line">        <span class="built_in">break</span> ;;</div><div class="line">    *) <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is not an option"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line">    <span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#</span></div><div class="line">count=1</div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></div><div class="line"><span class="keyword">do</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>"</span></div><div class="line">    count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>现在运行含有复杂选项的脚本</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">$</span> ./test18.sh -ac</div><div class="line">Found the -a <span class="keyword">option</span></div><div class="line">Found the -c <span class="keyword">option</span></div><div class="line"><span class="symbol">$</span> ./test18.sh -a -b test1 -cd test2 test3 test4</div><div class="line">Found the -a <span class="keyword">option</span></div><div class="line">Found the -b <span class="keyword">option</span>, with <span class="keyword">parameter</span> value <span class="comment">'test1'</span></div><div class="line">Found <span class="comment">the -c option</span></div><div class="line"><span class="keyword">Parameter</span> <span class="comment">#1:</span> <span class="comment">'test2'</span></div><div class="line"><span class="keyword">Parameter</span> <span class="comment">#2:</span> <span class="comment">'test3'</span></div><div class="line"><span class="keyword">Parameter</span> <span class="comment">#3:</span> <span class="comment">'test4'</span></div></pre></td></tr></table></figure>
<p>但是还是存在一个问题，就是无法处理带空格和引号的参数值，它会将空格当作参数分隔符，而不是根据双引号将两者当作一个参数。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ ./test18.sh -<span class="keyword">a</span> -b test1 -cd <span class="string">"test2 test3"</span> test4</div><div class="line">Found <span class="keyword">the</span> -<span class="keyword">a</span> option</div><div class="line">Found <span class="keyword">the</span> -b option, <span class="keyword">with</span> parameter <span class="built_in">value</span> <span class="string">'test1'</span></div><div class="line">Found <span class="keyword">the</span> -c option</div><div class="line">Parameter <span class="comment">#1: 'test2</span></div><div class="line">Parameter <span class="comment">#2: test3'</span></div><div class="line">Parameter <span class="comment">#3: 'test4'</span></div></pre></td></tr></table></figure>
<h3 id="getopts"><a href="#getopts" class="headerlink" title="getopts"></a>getopts</h3><p>getopts相对于getopt来说更高级，它可以提供getopt无法实现的功能。每次调用getopts时，它一次只会处理命令行上检测到的一个参数，处理完所有参数后，它会退出并返回一个大于0的退出状态码，因此可以与while结合运行。getopts命令用到两个环境变量，如果选项需要跟一个参数值，OPTARG环境变量会保存这个值，OPTIND环境变量保存了参数列表中getopts正在处理的<strong>参数位置</strong>，这样就能在处理完选项之后继续处理其他命令行参数了，其主要格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">getopts</span> optstring variable</div></pre></td></tr></table></figure>
<blockquote>
<p>optstring存有效的选项字母，如果选项字母要求有个参数值，就加一个冒号，要去掉错误信息，在optstring之前加一个冒号，getopts命令会将当前参数保存到命令行中定义的variable中</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ cat test19.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># simple demonstration of the getopts command</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:c opt</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$opt</span>"</span> <span class="keyword">in</span></div><div class="line">a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;</div><div class="line">b) <span class="built_in">echo</span> <span class="string">"Found the -b option, with value <span class="variable">$OPTARG</span>"</span>;;</div><div class="line">c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;</div><div class="line">*) <span class="built_in">echo</span> <span class="string">"Unknown option: <span class="variable">$opt</span>"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$</div><div class="line">$ ./test19.sh -ab test1 -c</div><div class="line">Found the -a option</div><div class="line">Found the -b option, with value test1</div><div class="line">Found the -c option</div></pre></td></tr></table></figure>
<p>getopts在解析命令行选项时会移除开头的破折线所以在case定义中不用单破折线。getopts支持空格参数值输入及其他输入</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ./test19<span class="selector-class">.sh</span> -<span class="selector-tag">b</span> <span class="string">"test1 test2"</span> -<span class="selector-tag">a</span></div><div class="line">Found the -<span class="selector-tag">b</span> option, with value test1 test2</div><div class="line">Found the -<span class="selector-tag">a</span> option</div><div class="line">$ ./test19<span class="selector-class">.sh</span> -abtest1</div><div class="line">Found the -<span class="selector-tag">a</span> option</div><div class="line">Found the -<span class="selector-tag">b</span> option, with value test1</div></pre></td></tr></table></figure>
<p>getopts会将在命令行上找到的未定义的选项统一输出为问号</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">$</span> ./test19.sh -d</div><div class="line">Unknown <span class="keyword">option</span>: ?</div><div class="line"><span class="symbol">$</span></div><div class="line"><span class="symbol">$</span> ./test19.sh -acde</div><div class="line">Found the -a <span class="keyword">option</span></div><div class="line">Found the -c <span class="keyword">option</span></div><div class="line">Unknown <span class="keyword">option</span>: ?</div><div class="line">Unknown <span class="keyword">option</span>: ?</div></pre></td></tr></table></figure>
<p>getopts知道何时停止处理选项，在getopts处理每个选项时会将OPTIND环境变量值加一，在完成getopts之后，可以使用shift命令和OPTIND值来移动参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">$ cat test20.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Processing options &amp; parameters with getopts</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:<span class="built_in">cd</span> opt</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$opt</span>"</span> <span class="keyword">in</span></div><div class="line">a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;</div><div class="line">b) <span class="built_in">echo</span> <span class="string">"Found the -b option, with value <span class="variable">$OPTARG</span>"</span> ;;</div><div class="line">c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;</div><div class="line">d) <span class="built_in">echo</span> <span class="string">"Found the -d option"</span> ;;</div><div class="line">*) <span class="built_in">echo</span> <span class="string">"Unknown option: <span class="variable">$opt</span>"</span> ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">shift</span> $[ <span class="variable">$OPTIND</span> - 1 ]</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line">count=1</div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Parameter <span class="variable">$count</span>: <span class="variable">$param</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./test20.sh -a -b test1 -d test2 test3 test4</div><div class="line">Found the -a option</div><div class="line">Found the -b option, with value test1</div><div class="line">Found the -d option</div><div class="line">Parameter 1: test2</div><div class="line">Parameter 2: test3</div><div class="line">Parameter 3: test4</div></pre></td></tr></table></figure>
<h3 id="选项标准化"><a href="#选项标准化" class="headerlink" title="选项标准化"></a>选项标准化</h3><p>主要是与Linux里已经存在含有某种程度的标准含义的字母相吻合，比如o一般代表输出等。<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">选 项 描 述</div><div class="line">-<span class="ruby">a 显示所有对象</span></div><div class="line">-<span class="ruby">c 生成一个计数</span></div><div class="line">-<span class="ruby">d 指定一个目录</span></div><div class="line">-<span class="ruby">e 扩展一个对象</span></div><div class="line">-<span class="ruby">f 指定读入数据的文件</span></div><div class="line">-<span class="ruby">h 显示命令的帮助信息</span></div><div class="line">-<span class="ruby">i 忽略文本大小写</span></div><div class="line">-<span class="ruby">l 产生输出的长格式版本</span></div><div class="line">-<span class="ruby">n 使用非交互模式（批处理）</span></div><div class="line">-<span class="ruby">o 将所有输出重定向到的指定的输出文件</span></div><div class="line">-<span class="ruby">q 以安静模式运行</span></div><div class="line">-<span class="ruby">r 递归地处理目录和文件</span></div><div class="line">-<span class="ruby">s 以安静模式运行</span></div><div class="line">-<span class="ruby">v 生成详细输出</span></div><div class="line">-<span class="ruby">x 排除某个对象</span></div><div class="line">-<span class="ruby">y 对所有问题回答yes</span></div></pre></td></tr></table></figure></p>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180522/AHC1ACD4IH.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux之处理用户输入(二)</title>
    <link href="https://ytlogos.github.io/2018/05/19/Linux%E4%B9%8B%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5(%E4%BA%8C)/"/>
    <id>https://ytlogos.github.io/2018/05/19/Linux之处理用户输入(二)/</id>
    <published>2018-05-19T13:19:05.000Z</published>
    <updated>2018-05-21T02:24:46.491Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="特殊参数变量"><a href="#特殊参数变量" class="headerlink" title="特殊参数变量"></a>特殊参数变量</h2><p>在<code>bash shell</code>中有些特殊变量，它们会记录命令行参数</p>
<h3 id="参数统计"><a href="#参数统计" class="headerlink" title="参数统计"></a>参数统计</h3><p>特殊变量<code>$#</code>含有脚本运行时携带的命令行参数的个数，可以在脚本中任何地方使用这个特殊变量，就跟普通变量一样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cat test9.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Testing parameters</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 2 ]</div><div class="line"><span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> Usage: test9.sh a b</div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">else</span></div><div class="line">total=$[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> The total is <span class="variable">$total</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ bash test9.sh</div><div class="line">Usage: test9.sh a b</div><div class="line">$ bash test9.sh 10</div><div class="line">Usage: test9.sh a b</div><div class="line">$ bash test9.sh 10 15</div><div class="line">The total is 25</div></pre></td></tr></table></figure>
<p>如何获取最后一个命令行参数变量？可以通过以下方法获取：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ cat test10.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Grabbing the last parameter</span></div><div class="line"><span class="comment">#</span></div><div class="line">params=<span class="variable">$#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> The last parameter is <span class="variable">$params</span></div><div class="line"><span class="built_in">echo</span> The last parameter is $\&#123;!<span class="comment">#\&#125;</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ bash test10.sh 1 2 3 4 5</div><div class="line">The last parameter is 5</div><div class="line">The last parameter is 5</div></pre></td></tr></table></figure>
<h3 id="抓取所有数据"><a href="#抓取所有数据" class="headerlink" title="抓取所有数据"></a>抓取所有数据</h3><p><code>$*</code>和<code>$@</code>变量可以用来轻松访问所有参数，这两个变量能够在单个变量中存储所有的命令行参数。</p>
<ul>
<li><code>$*</code>变量会将命令行上提供的所有参数当作一个单词保存，这个单词包含了命令行中出现的每一个参数，基本上<code>$*</code>变量会将这些参数视为一个整体，而不是多个个体</li>
<li><code>$@</code>变量会将命令行上提供的所有参数当作同一字符串中的多个独立的单词，这样可以遍历所有的参数值，得到每个参数</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat test11.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing $* and $@</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Using the $* method: $*"</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Using the <span class="variable">$@</span> method: <span class="variable">$@</span>"</span></div><div class="line">$</div><div class="line">$ ./test11.sh rich barbara katie jessica</div><div class="line">Using the $* method: rich barbara katie jessica</div><div class="line">Using the <span class="variable">$@</span> method: rich barbara katie jessica</div></pre></td></tr></table></figure>
<p>二者的差异主要如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ cat test12.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing $* and $@</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line">count=1</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">"$*"</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"$* Parameter #<span class="variable">$count</span> = <span class="variable">$param</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line">count=1</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$@</span> Parameter #<span class="variable">$count</span> = <span class="variable">$param</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div><div class="line">$</div><div class="line">$ ./test12.sh rich barbara katie jessica</div><div class="line">$* Parameter <span class="comment">#1 = rich barbara katie jessica</span></div><div class="line"><span class="variable">$@</span> Parameter <span class="comment">#1 = rich</span></div><div class="line"><span class="variable">$@</span> Parameter <span class="comment">#2 = barbara</span></div><div class="line"><span class="variable">$@</span> Parameter <span class="comment">#3 = katie</span></div><div class="line"><span class="variable">$@</span> Parameter <span class="comment">#4 = jessica</span></div></pre></td></tr></table></figure>
<blockquote>
<p><code>$*</code>变量将所有参数当成单个参数，<code>$@</code>变量会单独处理每个参数</p>
</blockquote>
<h2 id="移动变量"><a href="#移动变量" class="headerlink" title="移动变量"></a>移动变量</h2><p><code>bash shell</code>的<code>shift</code>命令默认条件下会将每个参数变量向左移动一个位置，即变量<code>$3</code>的值会移到<code>$2</code>，以此类推，变量<code>$1</code>的值会被删除，变量<code>$0</code>的值即程序名不会改变</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ cat test13.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># demonstrating the shift command</span></div><div class="line"><span class="built_in">echo</span></div><div class="line">count=1</div><div class="line"><span class="keyword">while</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Parameter #<span class="variable">$count</span> = <span class="variable">$1</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$</div><div class="line">$ ./test13.sh rich barbara katie jessica</div><div class="line">Parameter <span class="comment">#1 = rich</span></div><div class="line">Parameter <span class="comment">#2 = barbara</span></div><div class="line">Parameter <span class="comment">#3 = katie</span></div><div class="line">Parameter <span class="comment">#4 = jessica</span></div></pre></td></tr></table></figure>
<h2 id="处理选项"><a href="#处理选项" class="headerlink" title="处理选项"></a>处理选项</h2><p>选项是跟在单破折号<code>-</code>后面的单个字母，比如<code>-n</code>，它能改变命令的行为。</p>
<h3 id="查找选项"><a href="#查找选项" class="headerlink" title="查找选项"></a>查找选项</h3><p>命令行选项在命令行上紧跟在脚本名之后，就跟命令行参数一样</p>
<h3 id="处理简单选项"><a href="#处理简单选项" class="headerlink" title="处理简单选项"></a>处理简单选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">$ cat test15.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># extracting command line options as parameters</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">-a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;</div><div class="line">-b) <span class="built_in">echo</span> <span class="string">"Found the -b option"</span> ;;</div><div class="line">-c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;</div><div class="line">*) <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is not an option"</span> ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$</div><div class="line">$ ./test15.sh -a -b -c -d</div><div class="line">Found the -a option</div><div class="line">Found the -b option</div><div class="line">Found the -c option</div><div class="line">-d is not an option</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line">$ ./test15.sh -d -c -a</div><div class="line">-d is not an option</div><div class="line">Found the -c option</div><div class="line">Found the -a option</div></pre></td></tr></table></figure>
<h3 id="分离参数和选项"><a href="#分离参数和选项" class="headerlink" title="分离参数和选项"></a>分离参数和选项</h3><p><strong>Linux</strong>处理同时含有选项和参数的情况时，利用特殊字符将两者分开，该字符会告诉脚本何时选项结束以及普通参数何时开始。这个特殊字符就是双破折线<code>--</code>，<code>shell</code>会用双破折线来表明选项列表结束，在双破折线之后，脚本就可以放心将剩下的命令行参数当作参数而不是选项来处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cat test16.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># extracting options and parameters</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">-a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;</div><div class="line">-b) <span class="built_in">echo</span> <span class="string">"Found the -b option"</span>;;</div><div class="line">-c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;</div><div class="line">--) <span class="built_in">shift</span></div><div class="line"><span class="built_in">break</span> ;;</div><div class="line">*) <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is not an option"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#</span></div><div class="line">count=1</div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>在遇到双破折线时脚本用<code>break</code>命令跳出<code>while</code>循环，由于过早跳出循环，需要再加一条<code>shift</code>命令来将双破折线移出参数变量。</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ ./test16.sh -c -a -b test1 test2 test3</div><div class="line">Found the -c <span class="keyword">option</span></div><div class="line">Found the -a <span class="keyword">option</span></div><div class="line">Found the -b <span class="keyword">option</span></div><div class="line">test1 <span class="keyword">is</span> <span class="keyword">not</span> an <span class="keyword">option</span></div><div class="line">test2 <span class="keyword">is</span> <span class="keyword">not</span> an <span class="keyword">option</span></div><div class="line">test3 <span class="keyword">is</span> <span class="keyword">not</span> an <span class="keyword">option</span></div></pre></td></tr></table></figure>
<p>结果说明在处理时脚本认为所有的命令行参数都是选项，下面用双破折线将命令行上的参数和选项分隔开</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ ./test16<span class="selector-class">.sh</span> -c -<span class="selector-tag">a</span> -<span class="selector-tag">b</span> -- test1 test2 test3</div><div class="line">Found the -c option</div><div class="line">Found the -<span class="selector-tag">a</span> option</div><div class="line">Found the -<span class="selector-tag">b</span> option</div><div class="line">Parameter #<span class="number">1</span>: test1</div><div class="line">Parameter #<span class="number">2</span>: test2</div><div class="line">Parameter #<span class="number">3</span>: test3</div></pre></td></tr></table></figure>
<p>当脚本遇到双破折线时它会停止处理选项，并将剩下的参数都当作命令行参数。</p>
<h3 id="处理带值的选项"><a href="#处理带值的选项" class="headerlink" title="处理带值的选项"></a>处理带值的选项</h3><p>有些选项会带有一个额外的参数值，比如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./testing<span class="selector-class">.sh</span> -<span class="selector-tag">a</span> test1 -<span class="selector-tag">b</span> -c -d test2</div></pre></td></tr></table></figure>
<p>当命令行选项要求有额外的参数时，处理如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">$ cat test17.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># extracting command line options and values</span></div><div class="line"><span class="built_in">echo</span></div><div class="line"><span class="keyword">while</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">-a) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span>;;</div><div class="line">-b) param=<span class="string">"<span class="variable">$2</span>"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Found the -b option, with parameter value <span class="variable">$param</span>"</span></div><div class="line"><span class="built_in">shift</span> ;;</div><div class="line">-c) <span class="built_in">echo</span> <span class="string">"Found the -c option"</span>;;</div><div class="line">--) <span class="built_in">shift</span></div><div class="line"><span class="built_in">break</span> ;;</div><div class="line">*) <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is not an option"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#</span></div><div class="line">count=1</div><div class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>"</span></div><div class="line">count=$[ <span class="variable">$count</span> + 1 ]</div><div class="line"><span class="keyword">done</span></div><div class="line">$</div><div class="line">$ ./test17.sh -a -b test1 -d</div><div class="line">Found the -a option</div><div class="line">Found the -b option, with parameter value test1</div><div class="line">-d is not an option</div></pre></td></tr></table></figure>
<p>在这个例子中，<code>case</code>语句定义了三个处理选项，<code>-b</code>选项还有一个额外的参数值，由于要处理的参数是<code>$1</code>，额外的参数值就应该位于<code>$2</code>(因为所有的参数在处理完之后都会被移出)。只要将参数值从<code>$2</code>变量中提取出来就行了，因为这个选项占用了两个参数位，所以需要使用<code>shift</code>命令多移动一个位置。</p>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux之处理用户输入</title>
    <link href="https://ytlogos.github.io/2018/05/18/Linux%E4%B9%8B%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/"/>
    <id>https://ytlogos.github.io/2018/05/18/Linux之处理用户输入/</id>
    <published>2018-05-18T13:19:05.000Z</published>
    <updated>2018-05-20T05:37:34.042Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>向<code>shell</code>脚本传递参数的最基本方法是使用命令行参数。命令行参数允许在运行脚本时向命令行添加数据。</p>
<h3 id="读取参数"><a href="#读取参数" class="headerlink" title="读取参数"></a>读取参数</h3><p><code>bash shell</code>将一些称为位置参数的特殊变量分配给输入到命令行中的所有参数，包括<code>shell</code>所执行的脚本名称。位置参数变量是标准的数字:\$0是程序名，\$1是第一个变量,依此类推到第九个参数\$9。</p>
<p>下面是在<code>shell</code>脚本中使用单个命令行参数的简单例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ cat test1.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># using one command line parameter</span></div><div class="line"><span class="comment">#</span></div><div class="line">factorial=1</div><div class="line"><span class="keyword">for</span> (( number = 1; number &lt;= <span class="variable">$1</span> ; number++ ))</div><div class="line"><span class="keyword">do</span></div><div class="line">factorial=$[ <span class="variable">$factorial</span> * <span class="variable">$number</span> ]</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="built_in">echo</span> The factorial of <span class="variable">$1</span> is <span class="variable">$factorial</span></div><div class="line">$</div><div class="line">$ ./test1.sh 5</div><div class="line">The factorial of 5 is 120</div></pre></td></tr></table></figure>
<blockquote>
<p>可以在<code>shell</code>脚本中像使用其他变量一样使用\$1变量，<code>shell</code>脚本会自动蒋命令行参数的值分配给变量，不需要用户做任何处理</p>
</blockquote>
<p>如果需要输入更多的命令行参数，则每个参数必须用空格分开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ cat test2.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing two command line parameters</span></div><div class="line"><span class="comment">#</span></div><div class="line">total=$[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</div><div class="line"><span class="built_in">echo</span> The first parameter is <span class="variable">$1</span>.</div><div class="line"><span class="built_in">echo</span> The second parameter is <span class="variable">$2</span>.</div><div class="line"><span class="built_in">echo</span> The total value is <span class="variable">$total</span>.</div><div class="line">$</div><div class="line">$ ./test2.sh 2 5</div><div class="line">The first parameter is 2.</div><div class="line">The second parameter is 5.</div><div class="line">The total value is 10.</div></pre></td></tr></table></figure>
<p><code>shell</code>会将每个参数分配给对应的变量</p>
<p>也可以在命令行中使用文本字符串<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ cat test3.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># testing string parameters</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span> Hello <span class="variable">$1</span>, glad to meet you.</div><div class="line">$</div><div class="line">$ ./test3.sh Rich</div><div class="line">Hello Rich, glad to meet you.</div></pre></td></tr></table></figure></p>
<p><code>shell</code>将输入到命令行的字符串值传给脚本，但碰到含有空格的文本字符串时就会出现问题：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> ./test3.sh Rich Blum</span></div><div class="line">Hello Rich, glad to meet you.</div></pre></td></tr></table></figure>
<blockquote>
<p>记住每个参数都是用空格分隔的，所以<code>shell</code>会将空格当成两个值的分隔符。要在参数值中包含空格，必须使用引号(单双引号均可)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> ./test3.sh <span class="string">'Rich Blum'</span></span></div><div class="line">Hello Rich Blum, glad to meet you.</div></pre></td></tr></table></figure>
<blockquote>
<p>将文本字符串作为参数传递时，引号并非数据的一部分，它们只是表明数据的起止位置</p>
</blockquote>
<p>如果脚本需要的命令行参数不止9个，需要在第九个变量之后的变量数字周围加上花括号,比如\${10}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ cat test4.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># handling lots of parameters</span></div><div class="line"><span class="comment">#</span></div><div class="line">total=$[ <span class="variable">$&#123;10&#125;</span> * <span class="variable">$&#123;11&#125;</span> ]</div><div class="line"><span class="built_in">echo</span> The tenth parameter is <span class="variable">$&#123;10&#125;</span></div><div class="line"><span class="built_in">echo</span> The eleventh parameter is <span class="variable">$&#123;11&#125;</span></div><div class="line"><span class="built_in">echo</span> The total is <span class="variable">$total</span></div><div class="line">$</div><div class="line">$ ./test4.sh 1 2 3 4 5 6 7 8 9 10 11 12</div><div class="line">The tenth parameter is 10</div><div class="line">The eleventh parameter is 11</div><div class="line">The total is 110</div></pre></td></tr></table></figure>
<h3 id="读取脚本名"><a href="#读取脚本名" class="headerlink" title="读取脚本名"></a>读取脚本名</h3><p>可以用\$0参数获取<code>shell</code>在命令行启动的脚本名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ cat test5.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Testing the $0 parameter</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">echo</span> The zero parameter is <span class="built_in">set</span> to: <span class="variable">$0</span></div><div class="line"><span class="comment">#</span></div><div class="line">$</div><div class="line">$ bash test5.sh</div><div class="line">The zero parameter is <span class="built_in">set</span> to: test5.sh</div></pre></td></tr></table></figure>
<p>这里存在一个潜在的问题，如果使用另一个命令来运行脚本，命令会和脚本名混在一起，出现在\$0参数中</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ./test5.<span class="keyword">sh</span></div><div class="line">The zero parameter <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span>: ./test5.<span class="keyword">sh</span></div></pre></td></tr></table></figure>
<p>另外如果传给\$0变量的实际字符串不仅仅是脚本名，而是完整的脚本路径时，变量\$0就会使用整个路径</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ bash /home/Christine/test5.<span class="keyword">sh</span></div><div class="line">The zero parameter <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span>: /home/Christine/test5.<span class="keyword">sh</span></div></pre></td></tr></table></figure>
<p>有个小命令可以解决这些问题，<code>basename</code>命令会返回不包含路径的脚本名</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ cat test5b.sh</div><div class="line"><span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment"># Using basename with the $0 parameter</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="attribute">name</span>=$(basename <span class="variable">$0</span>)</div><div class="line">echo</div><div class="line">echo The<span class="built_in"> script </span>name is: <span class="variable">$name</span></div><div class="line"><span class="comment">#</span></div><div class="line">$ bash /home/Christine/test5b.sh</div><div class="line">The<span class="built_in"> script </span>name is: test5b.sh</div><div class="line">$</div><div class="line">$ ./test5b.sh</div><div class="line">The<span class="built_in"> script </span>name is: test5b.sh</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> cat test6.sh</span></div><div class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></div><div class="line"><span class="meta">#</span><span class="bash"> Testing a Multi-function script</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line">name=$(basename $0)</div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line">if [ $name = "addem" ]</div><div class="line">then</div><div class="line">total=$[ $1 + $2 ]</div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line">elif [ $name = "multem" ]</div><div class="line">then</div><div class="line">total=$[ $1 * $2 ]</div><div class="line">fi</div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line">echo</div><div class="line">echo The calculated value is $total</div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> cp test6.sh addem</span></div><div class="line"><span class="meta">$</span><span class="bash"> chmod u+x addem</span></div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> ln -s test6.sh multem</span></div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> ls -l *em</span></div><div class="line">-rwxrw-r--. 1 Christine Christine 224 Jun 30 23:50 addem</div><div class="line">lrwxrwxrwx. 1 Christine Christine 8 Jun 30 23:50 multem -&gt; test6.sh</div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> ./addem 2 5</span></div><div class="line">The calculated value is 7</div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> ./multem 2 5</span></div><div class="line">The calculated value is 10</div></pre></td></tr></table></figure>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux结构化命令which</title>
    <link href="https://ytlogos.github.io/2018/05/17/Linux%E7%BB%93%E6%9E%84%E5%8C%96%E5%91%BD%E4%BB%A4which/"/>
    <id>https://ytlogos.github.io/2018/05/17/Linux结构化命令which/</id>
    <published>2018-05-17T13:19:05.000Z</published>
    <updated>2018-05-19T09:40:42.827Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="for命令"><a href="#for命令" class="headerlink" title="for命令"></a><code>for</code>命令</h2><p><code>for</code>命令允许你创建一个遍历一系列值的循环，每次迭代都是用其中一个值来执行已定义好的命令。具体格式如下：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">list</span></div><div class="line"><span class="keyword">do</span></div><div class="line">    commands</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p><code>for</code>循环假定每个值都是用空格分隔的，如果有包含空格的数据值，用双引号圈起来</p>
<h3 id="读取列表中的值"><a href="#读取列表中的值" class="headerlink" title="读取列表中的值"></a>读取列表中的值</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ cat test1</div><div class="line"><span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment"># basic for command</span></div><div class="line"><span class="keyword">for</span> test <span class="keyword">in</span> Alabama Alaska Arizona Arkansas California Colorado</div><div class="line">do</div><div class="line">echo The next <span class="keyword">state</span> is <span class="variable">$test</span></div><div class="line">done</div><div class="line">$ ./test1</div><div class="line">The next <span class="keyword">state</span> is Alabama</div><div class="line">The next <span class="keyword">state</span> is Alaska</div><div class="line">The next <span class="keyword">state</span> is Arizona</div><div class="line">The next <span class="keyword">state</span> is Arkansas</div><div class="line">The next <span class="keyword">state</span> is California</div><div class="line">The next <span class="keyword">state</span> is Colorado</div></pre></td></tr></table></figure>
<h3 id="读取列表中的复杂值"><a href="#读取列表中的复杂值" class="headerlink" title="读取列表中的复杂值"></a>读取列表中的复杂值</h3><p>看下面的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ cat badtest1</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># another example of how not to use the for command</span></div><div class="line"><span class="keyword">for</span> <span class="built_in">test</span> <span class="keyword">in</span> I don<span class="string">'t know if this'</span>ll work</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"word:<span class="variable">$test</span>"</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./badtest1</div><div class="line">word:I</div><div class="line">word:dont know <span class="keyword">if</span> thisll</div><div class="line">word:work</div></pre></td></tr></table></figure></p>
<p>结果并不是我们想要的</p>
<p>有两种办法解决该问题：</p>
<ul>
<li>使用转义字符(反斜线)来将单引号转义</li>
<li>使用双引号来定义用到单引号的值</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ cat test2</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># another example of how not to use the for command</span></div><div class="line"><span class="keyword">for</span> <span class="built_in">test</span> <span class="keyword">in</span> I don\<span class="string">'t know if "this'</span>ll<span class="string">" work</span></div><div class="line">do</div><div class="line">echo "word:<span class="variable">$test</span><span class="string">"</span></div><div class="line">done</div><div class="line">$ ./test2</div><div class="line">word:I</div><div class="line">word:don't</div><div class="line">word:know</div><div class="line">word:if</div><div class="line">word:this'll</div><div class="line">word:work</div></pre></td></tr></table></figure>
<h3 id="从变量读取列表"><a href="#从变量读取列表" class="headerlink" title="从变量读取列表"></a>从变量读取列表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ cat test4</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># using a variable to hold the list</span></div><div class="line">list=<span class="string">"Alabama Alaska Arizona Arkansas Colorado"</span></div><div class="line">list=<span class="variable">$list</span><span class="string">" Connecticut"</span></div><div class="line"><span class="keyword">for</span> state <span class="keyword">in</span> <span class="variable">$list</span></div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Have you ever visited <span class="variable">$state</span>?"</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./test4</div><div class="line">Have you ever visited Alabama?</div><div class="line">Have you ever visited Alaska?</div><div class="line">Have you ever visited Arizona?</div><div class="line">Have you ever visited Arkansas?</div><div class="line">Have you ever visited Colorado?</div><div class="line">Have you ever visited Connecticut?</div></pre></td></tr></table></figure>
<h3 id="从命令读取值"><a href="#从命令读取值" class="headerlink" title="从命令读取值"></a>从命令读取值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ cat test5</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># reading values from a file</span></div><div class="line">file=<span class="string">"states"</span></div><div class="line"><span class="keyword">for</span> state <span class="keyword">in</span> $(cat <span class="variable">$file</span>)</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Visit beautiful <span class="variable">$state</span>"</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$ cat states</div><div class="line">Alabama</div><div class="line">Alaska</div><div class="line">Arizona</div><div class="line">Arkansas</div><div class="line">Colorado</div><div class="line">Connecticut</div><div class="line">Delaware</div><div class="line">Florida</div><div class="line">Georgia</div><div class="line">$ ./test5</div><div class="line">Visit beautiful Alabama</div><div class="line">Visit beautiful Alaska</div><div class="line">Visit beautiful Arizona</div><div class="line">Visit beautiful Arkansas</div><div class="line">Visit beautiful Colorado</div><div class="line">Visit beautiful Connecticut</div><div class="line">Visit beautiful Delaware</div><div class="line">Visit beautiful Florida</div><div class="line">Visit beautiful Georgia</div></pre></td></tr></table></figure>
<h3 id="更改字段分隔符"><a href="#更改字段分隔符" class="headerlink" title="更改字段分隔符"></a>更改字段分隔符</h3><p>造成这个问题的原因是特殊的环境变量IFS，叫做内部字段分隔符，IFS环境变量定义了<strong>bash shell</strong>用作分隔符的一系列字符。默认情况下，<strong>bash shell</strong>将下列字符当作字段分隔符：</p>
<ul>
<li>空格</li>
<li>制表符</li>
<li>换行符</li>
</ul>
<p>要解决上面遇到的处理文件中含有字段分隔符的问题，可以在<strong>shell</strong>脚本中临时更改IFS环境变量的值来限制被<strong>bahs shell</strong>当作字段分隔符的字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ cat test5b</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># reading values from a file</span></div><div class="line">file=<span class="string">"states"</span></div><div class="line">IFS=$<span class="string">'\n'</span></div><div class="line"><span class="keyword">for</span> state <span class="keyword">in</span> $(cat <span class="variable">$file</span>)</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Visit beautiful <span class="variable">$state</span>"</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./test5b</div><div class="line">Visit beautiful Alabama</div><div class="line">Visit beautiful Alaska</div><div class="line">Visit beautiful Arizona</div><div class="line">Visit beautiful Arkansas</div><div class="line">Visit beautiful Colorado</div><div class="line">Visit beautiful Connecticut</div><div class="line">Visit beautiful Delaware</div><div class="line">Visit beautiful Florida</div><div class="line">Visit beautiful Georgia</div><div class="line">Visit beautiful New York</div><div class="line">Visit beautiful New Hampshire</div><div class="line">Visit beautiful North Carolina</div></pre></td></tr></table></figure>
<p>如果要指定多个IFS字符，只要将它们在赋值行串起来就行：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">IFS=$'\n':;<span class="string">"</span></div></pre></td></tr></table></figure>
<p>这个赋值会将换行符、冒号、分号和双引号作为字段分隔符</p>
<h3 id="用通配符读取目录"><a href="#用通配符读取目录" class="headerlink" title="用通配符读取目录"></a>用通配符读取目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ cat test6</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># iterate through all the files in a directory</span></div><div class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /home/rich/<span class="built_in">test</span>/*</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">if</span> [ -d <span class="string">"<span class="variable">$file</span>"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is a directory"</span></div><div class="line"><span class="keyword">elif</span> [ -f <span class="string">"<span class="variable">$file</span>"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is a file"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line">$ ./test6</div><div class="line">/home/rich/<span class="built_in">test</span>/dir1 is a directory</div><div class="line">/home/rich/<span class="built_in">test</span>/myprog.c is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/myprog is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/myscript is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/newdir is a directory</div><div class="line">/home/rich/<span class="built_in">test</span>/newfile is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/newfile2 is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/testdir is a directory</div><div class="line">/home/rich/<span class="built_in">test</span>/testing is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/testprog is a file</div><div class="line">/home/rich/<span class="built_in">test</span>/testprog.c is a file</div></pre></td></tr></table></figure>
<h3 id="C语言风格的for命令"><a href="#C语言风格的for命令" class="headerlink" title="C语言风格的for命令"></a><code>C</code>语言风格的<code>for</code>命令</h3><p><strong>bash</strong>中<code>C</code>语言风格的<code>for</code>循环的基本格式:</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (( <span class="keyword">variable</span> assignment ; condition ; iteration process ))</div></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat test8</div><div class="line"><span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment"># testing the C-style for loop</span></div><div class="line"><span class="keyword">for</span> (( i=<span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ ))</div><div class="line">do</div><div class="line">echo <span class="string">"The next number is $i"</span></div><div class="line">done</div><div class="line">$ ./test8</div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">1</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">2</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">3</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">4</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">5</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">6</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">7</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">8</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">9</span></div><div class="line">The next <span class="built_in">number</span> <span class="keyword">is</span> <span class="number">10</span></div></pre></td></tr></table></figure>
<h3 id="使用多个变量"><a href="#使用多个变量" class="headerlink" title="使用多个变量"></a>使用多个变量</h3><p><code>C</code>语言风格的<code>for</code>命令也允许为迭代使用多个变量。循环会单独处理每个变量，你可以为每个变量定义不同的迭代过程。尽管可以使用多个变量，但你只能在<code>for</code>循环中定义一种条件:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat test9</div><div class="line">#!/bin/bash</div><div class="line"># multiple variables</div><div class="line">for (( a=<span class="number">1</span>, b=<span class="number">10</span>; a &lt;= <span class="number">10</span>; a++, b-- ))</div><div class="line">do</div><div class="line">echo <span class="string">"$a - $b"</span></div><div class="line">done</div><div class="line">$ ./test9</div><div class="line"><span class="number">1</span> - <span class="number">10</span></div><div class="line"><span class="number">2</span> - <span class="number">9</span></div><div class="line"><span class="number">3</span> - <span class="number">8</span></div><div class="line"><span class="number">4</span> - <span class="number">7</span></div><div class="line"><span class="number">5</span> - <span class="number">6</span></div><div class="line"><span class="number">6</span> - <span class="number">5</span></div><div class="line"><span class="number">7</span> - <span class="number">4</span></div><div class="line"><span class="number">8</span> - <span class="number">3</span></div><div class="line"><span class="number">9</span> - <span class="number">2</span></div><div class="line"><span class="number">10</span> - <span class="number">1</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux之结构化命令</title>
    <link href="https://ytlogos.github.io/2018/05/16/Linux%E4%B9%8B%E7%BB%93%E6%9E%84%E5%8C%96%E5%91%BD%E4%BB%A4/"/>
    <id>https://ytlogos.github.io/2018/05/16/Linux之结构化命令/</id>
    <published>2018-05-16T13:19:05.000Z</published>
    <updated>2018-05-19T08:56:00.898Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="test语句"><a href="#test语句" class="headerlink" title="test语句"></a><code>test</code>语句</h2><p><code>test</code>命令提供了在<code>if-then</code>语句中测试不同条件的途径。如果<code>test</code>命令中列出的条件成立，<code>test</code>命令就会推出并返回退出状态码0。如果条件不成立，<code>test</code>命令就会推出并返回非零的退出状态码，这使得<code>if-then</code>语句不会被执行。<code>test</code>命令格式非常简单:</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">test </span>condition</div></pre></td></tr></table></figure>
<p>在<code>if-then</code>语句中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="built_in">test</span> condition</div><div class="line"><span class="keyword">then</span></div><div class="line">    commands</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p><strong>bash shell</strong>提供了另一种条件测试方法，无需在<code>if-then</code>语句中声明<code>test</code>命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ condition ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    commands</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<blockquote>
<p>方括号定义了测试条件，需要注意的是，第一个方括号之后和第二个方括号之前必须加上一个空格，否则会报错。</p>
</blockquote>
<p><code>test</code>命令可以判断三类条件</p>
<ul>
<li>数值比较(bash shell只能处理整数)</li>
<li>字符串比较</li>
<li>文件比较</li>
</ul>
<blockquote>
<p>在比较测试中，大写字母被认为是小于小写字母的，但是<code>sort</code>命令恰好相反。比较测试中使用的是标准的<strong>ASCⅡ</strong>，根据每个字符的<strong>ASCⅡ</strong>数值来决定排序结果。<code>sort</code>命令使用的是系统的本地化语言设置中定义的排序顺序，对于英语，本地化设置指定了在排序顺序中小写字母出现在大写字母之前。<code>test</code>命令和测试表达式使用标准的数字比较符号来表示字符串比较，而用文本代码来表示数值比较。</p>
</blockquote>
<h2 id="if-then高级特性"><a href="#if-then高级特性" class="headerlink" title="if-then高级特性"></a><code>if-then</code>高级特性</h2><p><strong>bash shell</strong>提供了两项可在<code>if-then</code>语句中使用的高级特性：</p>
<ul>
<li>用于数学表达式的双括号(无需转义)</li>
<li>用于高级字符串处理功能的双方括号(支持模式匹配)</li>
</ul>
<h3 id="使用双括号"><a href="#使用双括号" class="headerlink" title="使用双括号"></a>使用双括号</h3><p>双括号提供了使用高级数学表达式的功能，双括号命令格式如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(( <span class="name">expression</span> ))</div></pre></td></tr></table></figure>
<h3 id="使用双方括号"><a href="#使用双方括号" class="headerlink" title="使用双方括号"></a>使用双方括号</h3><p>双方括号命令提供了针对字符串比较的高级特性，其命令格式如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">[[ expression ]]</span></div></pre></td></tr></table></figure>
<h2 id="case命令"><a href="#case命令" class="headerlink" title="case命令"></a><code>case</code>命令</h2><p><code>case</code>命令会将指定的变量与不同模式进行比较，如果变量和模式模式匹配，那么<code>shell</code>会执行为该模式指定的命令。可以通过竖线操作符来分隔出多个模式，星号会捕获所有与已知模式不匹配的值。格式具体如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">case variable <span class="keyword">in</span> </div><div class="line">pattern1 | pattern2) command1;;</div><div class="line">pattern3) command2;;</div><div class="line">*)<span class="built_in"> default </span>commands;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<p>举个例子<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ cat test26.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># using the case command</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$USER</span> <span class="keyword">in</span></div><div class="line">rich | barbara)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Welcome, <span class="variable">$USER</span>"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Please enjoy your visit"</span>;;</div><div class="line">testing)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Special testing account"</span>;;</div><div class="line">jessica)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Do not forget to log off when you're done"</span>;;</div><div class="line">*)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Sorry, you are not allowed here"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line">$</div><div class="line">$ ./test26.sh</div><div class="line">Welcome, rich</div><div class="line">Please enjoy your visit</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令</title>
    <link href="https://ytlogos.github.io/2018/05/15/Linux%E5%91%BD%E4%BB%A4/"/>
    <id>https://ytlogos.github.io/2018/05/15/Linux命令/</id>
    <published>2018-05-15T13:19:05.000Z</published>
    <updated>2018-05-19T06:30:54.079Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><ul>
<li><strong>tail</strong>命令添加-f参数允许在其他进程使用该文件时查看文件的内容。<strong>tail</strong>命令会保持活动状态。</li>
<li>变量名、等号和值之间没有空格，如果要赋值一个含有空格的字符串组，必须用单引号来界定字符串的首尾。</li>
<li>删除已经存在的环境变量，可以用<code>unset</code>命令完成。在涉及环境变量名时，需要记住的一点是：如果要用到环境变量，使用\$，如果要操作变量，不使用\$。一个例外就是使用<code>printenv</code>显示某个变量的值。</li>
<li>/etc/profile文件是<code>bash shell</code>默认的主启动文件，只要登录了<strong>Linux</strong>系统，<code>bash</code>就会执行/etc/profile启动文件中的内容。</li>
<li>用来向<strong>Linux</strong>系统添加新用户的主要工具是<code>useradd</code>,删除用户使用<code>userdel</code>。</li>
<li><strong>Vim</strong>编辑器中<code>G</code>表示移到最后一行，<code>num G</code>表示移到第<code>num</code>行，<code>gg</code>表示移到第一行。</li>
<li><code>echo</code>命令如果想将文本字符串和命令输出显示在同一行中，可以用<code>echo</code>语句的<code>-n</code>参数。需要在字符串的两侧使用引号，保证要显示的字符串尾部有一个空格。</li>
<li>使用等号将值赋给用户变量，在变量、等号和值之间不能出现空格。</li>
<li><p>有两种方法可以将命令输出赋给变量</p>
<ul>
<li>反引号字符(`)</li>
<li>$()格式</li>
</ul>
</li>
<li><p>重定向输出时，<code>&gt;</code>会覆盖已有文件，<code>&gt;&gt;</code>追加数据</p>
</li>
<li>输入重定向和输出重定向正好相反，输入重定向将文件的内容重定到命令，而非将命令的输出重定向到文件。输入重定向的符号是<code>&lt;</code>：<code>command &lt; inputfile</code>。一个记忆方法是：在命令行上，命令总在左侧，而重定向符号指向数据流动的方向。</li>
<li>使用方括号进行数学运算，在<strong>bash</strong>中将一个数学运算结果赋值给某个变量时，可以用美元符和方括号<code>($[ operation ])</code>将数学表达式围起来</li>
</ul>
<h2 id="结构化命令"><a href="#结构化命令" class="headerlink" title="结构化命令"></a>结构化命令</h2><h3 id="使用if-then语句"><a href="#使用if-then语句" class="headerlink" title="使用if-then语句"></a>使用<code>if-then</code>语句</h3><p><code>if-then</code>语句是最基本的结构化语句，其格式如下：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">command</span></div><div class="line"><span class="keyword">then</span> </div><div class="line">    <span class="keyword">command</span></div><div class="line">fi</div></pre></td></tr></table></figure>
<p><strong>bash shell</strong>的语句会运行<code>if</code>后面的命令，如果该命令的退出码是0(表示该命令运行成功),位于<code>then</code>部分的命令就会被执行，否则<code>then</code>部分的命令不会被执行，<strong>bash shell</strong>会继续执行脚本中的下一个命令。<code>fi</code>语句用来表示<code>if-then</code>语句到此结束。</p>
<h3 id="使用if-then-else语句"><a href="#使用if-then-else语句" class="headerlink" title="使用if-then-else语句"></a>使用<code>if-then-else</code>语句</h3><p>在<code>if-then</code>语句中，不管命令是否成功执行，都只有一种选择。如果命令返回一个非零退出状态码，<code>bash shell</code>会继续执行脚本中的下一条命令。在这种情况下，如果能够执行另一组命令就好了，这正是<code>if-then-else</code>语句的作用。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">command</span></div><div class="line"><span class="keyword">then</span>  </div><div class="line">     <span class="keyword">command</span></div><div class="line"><span class="keyword">else</span></div><div class="line">     <span class="keyword">command</span></div><div class="line">fi</div></pre></td></tr></table></figure>
<p>与<code>if-then</code>相似，区别就是当<code>if</code>语句中的命令返回非零退出状态码时,<code>bash shell</code>会执行<code>else</code>部分中的命令。</p>
<h3 id="嵌套if"><a href="#嵌套if" class="headerlink" title="嵌套if"></a>嵌套<code>if</code></h3><p>有时需要检查脚本代码中的多种条件，可以使用嵌套的<code>if-then</code>语句。嵌套的<code>if-then</code>语句位于主<code>if-then-else</code>语句的<code>else</code>代码块中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">$ ls -d /home/NoSuchUser/</div><div class="line">/home/NoSuchUser/</div><div class="line">$</div><div class="line">$ cat test5.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Testing nested ifs</span></div><div class="line"><span class="comment">#</span></div><div class="line">testuser=NoSuchUser</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> grep <span class="variable">$testuser</span> /etc/passwd</div><div class="line"><span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The user <span class="variable">$testuser</span> exists on this system."</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The user <span class="variable">$testuser</span> does not exist on this system."</span></div><div class="line">   <span class="keyword">if</span> ls -d /home/<span class="variable">$testuser</span>/</div><div class="line">   <span class="keyword">then</span></div><div class="line">      <span class="built_in">echo</span> <span class="string">"However, <span class="variable">$testuser</span> has a directory."</span></div><div class="line">   <span class="keyword">fi</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">$</div><div class="line">$ ./test5.sh</div><div class="line">The user NoSuchUser does not exist on this system.</div><div class="line">/home/NoSuchUser/</div><div class="line">However, NoSuchUser has a directory.</div></pre></td></tr></table></figure>
<p>可以使用<code>else</code>部分的另一种形式:<code>elif</code>。这样就不用书写多个<code>if-then</code>语句了，<code>elif</code>使用另一个<code>if-then</code>语句延续<code>else</code>部分。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">command</span></div><div class="line"><span class="keyword">then</span></div><div class="line">    <span class="keyword">command</span></div><div class="line">elif <span class="keyword">command</span></div><div class="line"><span class="keyword">then</span></div><div class="line">    more <span class="keyword">command</span></div><div class="line">fi</div></pre></td></tr></table></figure>
<p><code>elif</code>语句提供了另一个要测试的命令，这类似于原始的<code>if</code>语句行。如果<code>elif</code>后命令的退出状态码是0，则<code>bash</code>会执行第二个<code>then</code>语句部分的命令。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">$ cat test5.sh</div><div class="line"><span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment"># Testing nested ifs - use elif &amp; else</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="attribute">testuser</span>=NoSuchUser</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> grep <span class="variable">$testuser</span> /etc/passwd</div><div class="line">then</div><div class="line">echo <span class="string">"The user <span class="variable">$testuser</span> exists on this system."</span></div><div class="line"><span class="comment">#</span></div><div class="line">elif ls -d /home/<span class="variable">$testuser</span></div><div class="line">then</div><div class="line">echo <span class="string">"The user <span class="variable">$testuser</span> does not exist on this system."</span></div><div class="line">echo <span class="string">"However, <span class="variable">$testuser</span> has a directory."</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">else</span></div><div class="line">echo <span class="string">"The user <span class="variable">$testuser</span> does not exist on this system."</span></div><div class="line">echo <span class="string">"And, <span class="variable">$testuser</span> does not have a directory."</span></div><div class="line">fi</div><div class="line">$</div><div class="line">$ ./test5.sh</div><div class="line">/home/NoSuchUser</div><div class="line">The<span class="built_in"> user </span>NoSuchUser does <span class="keyword">not</span> exist on this system.</div><div class="line">However, NoSuchUser has a directory.</div><div class="line">$</div><div class="line">$ sudo rmdir /home/NoSuchUser</div><div class="line">[sudo] password <span class="keyword">for</span> Christine:</div><div class="line">$</div><div class="line">$ ./test5.sh</div><div class="line">ls: cannot access /home/NoSuchUser: <span class="literal">No</span> such file <span class="keyword">or</span> directory</div><div class="line">The<span class="built_in"> user </span>NoSuchUser does <span class="keyword">not</span> exist on this system.</div><div class="line"><span class="keyword">And</span>, NoSuchUser does <span class="keyword">not</span> have a directory.</div></pre></td></tr></table></figure>
<blockquote>
<p>需要注意的是，在<code>elif</code>语句中，紧跟其后的<code>else</code>语句属于<code>elif</code>代码块。它们并不属于之前的<code>if-then</code>代码块</p>
</blockquote>
<p>可以继续将多个<code>elif</code>语句串起来，形成一个大的<code>if-then-elif</code>嵌套组合。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> command1</div><div class="line"><span class="keyword">then</span></div><div class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 1</div><div class="line"><span class="keyword">elif</span> command2</div><div class="line"><span class="keyword">then</span></div><div class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 2</div><div class="line"><span class="keyword">elif</span> command3</div><div class="line"><span class="keyword">then</span></div><div class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 3</div><div class="line"><span class="keyword">elif</span> command4</div><div class="line"><span class="keyword">then</span></div><div class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 4</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<blockquote>
<p>每块命令都会根据命令是否会返回退出状态码0来执行。记住，<code>bash shell</code>会依次执行<code>if</code>语句，只有第一个返回退出状态码0的语句中的<code>then</code>部分会被执行。</p>
</blockquote>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180204/7bEcJiH4l2.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://ytlogos.github.io/categories/Linux/"/>
    
    
      <category term="Shell" scheme="https://ytlogos.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>R编程题目练习1</title>
    <link href="https://ytlogos.github.io/2018/04/24/R%E7%BC%96%E7%A8%8B%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A01/"/>
    <id>https://ytlogos.github.io/2018/04/24/R编程题目练习1/</id>
    <published>2018-04-24T13:19:05.000Z</published>
    <updated>2018-05-20T03:55:43.823Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180520/8DLlfLA4dc.png?imageslim" alt="mark"></p>
<a id="more"></a>
<h2 id="Multiples-of-3-and-5"><a href="#Multiples-of-3-and-5" class="headerlink" title="Multiples of 3 and 5"></a>Multiples of 3 and 5</h2><p>Problem 1 </p>
<p>If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.</p>
<p>Find the sum of all the multiples of 3 or 5 below 1000.</p>
<p><strong>answer</strong>：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="title">n</span> &lt;- c()</div><div class="line"><span class="title">n</span>[<span class="number">1</span>] &lt;- <span class="number">0</span></div><div class="line"><span class="title">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">999</span>)&#123;</div><div class="line">  <span class="keyword">if</span> (i%%<span class="number">3</span>==<span class="number">0</span>)&#123;</div><div class="line">    n &lt;- n+i</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(i%%<span class="number">3</span>!=<span class="number">0</span>&amp;i%%<span class="number">5</span>==<span class="number">0</span>)&#123;</div><div class="line">    n &lt;- n+i</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="title">cat</span>(<span class="string">"The answer is:"</span>, n)</div></pre></td></tr></table></figure>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The answer <span class="keyword">is</span>: <span class="number">233168</span></div></pre></td></tr></table></figure>
<h2 id="Even-Fibonacci-numbers"><a href="#Even-Fibonacci-numbers" class="headerlink" title="Even Fibonacci numbers"></a>Even Fibonacci numbers</h2><p>Problem 2<br>Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:</p>
<p>1, 2, 3, 5, 8, 13, 21, 34, 55, 89, …</p>
<p>By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.、</p>
<p><strong>answer</strong>:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">f &lt;- c()</div><div class="line">f[<span class="number">1</span>] &lt;- <span class="number">1</span></div><div class="line">f[<span class="number">2</span>] &lt;- <span class="number">2</span></div><div class="line">i &lt;- <span class="number">3</span></div><div class="line">repeat&#123;</div><div class="line">  f[i] &lt;- f[i<span class="number">-2</span>]+f[i<span class="number">-1</span>]</div><div class="line">  if(f[i]&gt;<span class="number">4000000</span>)break</div><div class="line">  i &lt;- i+<span class="number">1</span></div><div class="line">&#125;</div><div class="line">f &lt;- f[-length(f)]</div><div class="line">f_even_index &lt;- f%%<span class="number">2</span>==<span class="number">0</span></div><div class="line">f_even_sum &lt;- sum(f[f_even_index])</div><div class="line">cat(<span class="string">"The answer is:"</span>, f_even_sum,<span class="string">"<span class="subst">\n</span>"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The answer <span class="keyword">is</span>: <span class="number">4613732</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180520/8DLlfLA4dc.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="R编程" scheme="https://ytlogos.github.io/categories/R%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="编程能力" scheme="https://ytlogos.github.io/tags/%E7%BC%96%E7%A8%8B%E8%83%BD%E5%8A%9B/"/>
    
  </entry>
  
  <entry>
    <title>群体遗传进化</title>
    <link href="https://ytlogos.github.io/2018/04/24/%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0%E8%BF%9B%E5%8C%96/"/>
    <id>https://ytlogos.github.io/2018/04/24/群体遗传进化/</id>
    <published>2018-04-24T13:19:05.000Z</published>
    <updated>2018-05-05T07:40:12.795Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/3dDKl9a3DD.png?imageslim" alt="mark"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>群体结构又称为群体分层，指所研究的群体中存在基因频率不同的亚群。其基本原理是将群体分成k个服从哈迪温伯格平衡的亚群，将每个材料归到各个亚群并计算每个材料基因组变异源于第k个亚群的可能性，主要是利用Q矩阵进行衡量，一般来说Q值越大，表明每个材料来自于某个亚群的可能性越大。群体结构分析的软件有很多，比如：<code>STRUCTURE</code>、<code>ADMIXTURE</code>、<code>FASTSTRUCTURE</code>、<code>TESS</code>、<code>BAPS</code>等。这里不介绍如何使用这些软件进行群体结构分析，下次有时间再进行介绍。本文主要介绍利用R包<code>pophelper</code>对这些软件生成的数据进行展示。具体情况可以参考<code>pophelper</code>的<a href="http://royfrancis.github.io/pophelper/" target="_blank" rel="external"><strong>vignette</strong></a></p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装过程不多说</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">install.packages(c(<span class="string">"Cairo"</span>,<span class="string">"devtools"</span>,<span class="string">"ggplot2"</span>,<span class="string">"gridExtra"</span>,<span class="string">"gtable"</span>,<span class="string">"tidyr"</span>),dependencies=T)</div><div class="line">devtools::install_github(<span class="string">'royfrancis/pophelper'</span>)</div></pre></td></tr></table></figure>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/Gg71K3jgfa.png?imageslim" alt="workflow"></p>
<h3 id="数据读取"><a href="#数据读取" class="headerlink" title="数据读取"></a>数据读取</h3><p>使用<code>pophelper</code>提供的数据,这里只使用structure软件生成的格式文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(pophelper)</div><div class="line">sfiles &lt;- list.files(path=system.file(&quot;files/structure&quot;,package = &quot;pophelper&quot;), full.names = T)</div><div class="line">sfiles</div></pre></td></tr></table></figure>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">##  [<span class="number">1</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_01"</span></div><div class="line">##  [<span class="number">2</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_02"</span></div><div class="line">##  [<span class="number">3</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_03"</span></div><div class="line">##  [<span class="number">4</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_04"</span></div><div class="line">##  [<span class="number">5</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_05"</span></div><div class="line">##  [<span class="number">6</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_06"</span></div><div class="line">##  [<span class="number">7</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_07"</span></div><div class="line">##  [<span class="number">8</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_08"</span></div><div class="line">##  [<span class="number">9</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_09"</span></div><div class="line">## [<span class="number">10</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_10"</span></div><div class="line">## [<span class="number">11</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_11"</span></div><div class="line">## [<span class="number">12</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_12"</span></div><div class="line">## [<span class="number">13</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_13"</span></div><div class="line">## [<span class="number">14</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_14"</span></div><div class="line">## [<span class="number">15</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_15"</span></div><div class="line">## [<span class="number">16</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_16"</span></div><div class="line">## [<span class="number">17</span>] <span class="string">"D:/R-3.5.0/library/pophelper/files/structure/structure_17"</span></div></pre></td></tr></table></figure>
<p>可以看到总共有17个structure文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">slist &lt;- readQ(files = sfiles,indlabfromfile = T, filetype = &quot;structure&quot;)</div><div class="line">tr1 &lt;- tabulateQ(qlist = slist)</div><div class="line">summariseQ(tr1, writetable = TRUE)</div></pre></td></tr></table></figure>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   loci ind k runs  elpdmean     elpdsd elpdmin elpdmax</div><div class="line">## <span class="number">1</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">2</span>    <span class="number">3</span> <span class="number">-7509.367</span>  <span class="number">0.8082904</span> <span class="number">-7510.1</span> <span class="number">-7508.5</span></div><div class="line">## <span class="number">2</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">3</span>    <span class="number">3</span> <span class="number">-7476.000</span>  <span class="number">0.4358899</span> <span class="number">-7476.5</span> <span class="number">-7475.7</span></div><div class="line">## <span class="number">3</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">4</span>    <span class="number">3</span> <span class="number">-7650.800</span> <span class="number">46.1418465</span> <span class="number">-7687.5</span> <span class="number">-7599.0</span></div><div class="line">## <span class="number">4</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">5</span>    <span class="number">3</span> <span class="number">-7743.567</span> <span class="number">74.0671542</span> <span class="number">-7828.5</span> <span class="number">-7692.4</span></div><div class="line">## <span class="number">5</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">6</span>    <span class="number">3</span> <span class="number">-7985.833</span> <span class="number">32.6353081</span> <span class="number">-8023.3</span> <span class="number">-7963.6</span></div><div class="line">## <span class="number">6</span>   <span class="number">25</span> <span class="number">149</span> <span class="number">7</span>    <span class="number">2</span> <span class="number">-8614.000</span> <span class="number">60.5283405</span> <span class="number">-8656.8</span> <span class="number">-8571.2</span></div></pre></td></tr></table></figure>
<p><code>summariseQ</code>会给出一些信息，<code>writetable = TRUE</code>将文件写入到工作文件夹中</p>
<h3 id="估计最佳分层数"><a href="#估计最佳分层数" class="headerlink" title="估计最佳分层数"></a>估计最佳分层数</h3><p>函数<code>evannoMethodStructure</code>用来估计最佳分层数k,使用的方法是<strong>Evanno method</strong>，这一函数只适应于STRUCTURE软件运行的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sr1 &lt;- summariseQ(tr1)</div><div class="line">p &lt;- evannoMethodStructure(data = sr1, exportplot = F, returnplot = T, returndata = F, basesize = 12, linesize = 0.7)</div><div class="line">gridExtra::grid.arrange(p)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/mjEIL6a5Kj.png?imageslim" alt="mark"></p>
<p>一般我们是通过看ΔK来确定最佳分群，这里可以看到是k=3</p>
<p><strong>pophelper</strong>提供了一个封装函数，可以一次性出来所有结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">analyseQ(sfiles)</div></pre></td></tr></table></figure></p>
<p>可以挑出k=3时的structure图</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/3dDKl9a3DD.png?imageslim" alt="mark"></p>
<h2 id="美化"><a href="#美化" class="headerlink" title="美化"></a>美化</h2><p><strong>pophelper</strong>还提供了一个绘图函数<code>plotQ</code>,里面内置了大量图形参数设置用来美化图片，这里就不一一展示了，有兴趣的可以去实践一下</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/KecCc9fciG.png?imageslim" alt="mark"></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># R version 3.5.0 (2018-04-23)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Running under: Windows 10 x64 (build 16299)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Matrix products: default</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># locale:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] LC_COLLATE=Chinese (Simplified)_China.936 </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [2] LC_CTYPE=Chinese (Simplified)_China.936   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [3] LC_MONETARY=Chinese (Simplified)_China.936</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [4] LC_NUMERIC=C                              </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [5] LC_TIME=Chinese (Simplified)_China.936    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># attached base packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># other attached packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] pophelper_2.2.5.1 ggplot2_2.2.1     Cairo_1.5-9      </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># loaded via a namespace (and not attached):</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [1] Rcpp_0.12.16     knitr_1.20       magrittr_1.5     tidyselect_0.2.4</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [5] munsell_0.4.3    colorspace_1.3-2 rlang_0.2.0      stringr_1.3.0   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [9] plyr_1.8.4       tools_3.5.0      grid_3.5.0       gtable_0.2.0    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [13] htmltools_0.3.6  yaml_2.1.19      lazyeval_0.2.1   rprojroot_1.3-2 </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [17] digest_0.6.15    tibble_1.4.2     gridExtra_2.3    purrr_0.2.4     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [21] tidyr_0.8.0      glue_1.2.0       evaluate_0.10.1  rmarkdown_1.9   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [25] labeling_0.3     stringi_1.1.7    compiler_3.5.0   pillar_1.2.2    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [29] scales_0.5.0     backports_1.1.2</span></span></div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180505/3dDKl9a3DD.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;群体结构又称为群体分层，指所研究的群体中存在基因频率不同的亚群。其基本原理是将群体分成k个服从哈迪温伯格平衡的亚群，将每个材料归到各个亚群并计算每个材料基因组变异源于第k个亚群的可能性，主要是利用Q矩阵进行衡量，一般来说Q值越大，表明每个材料来自于某个亚群的可能性越大。群体结构分析的软件有很多，比如：&lt;code&gt;STRUCTURE&lt;/code&gt;、&lt;code&gt;ADMIXTURE&lt;/code&gt;、&lt;code&gt;FASTSTRUCTURE&lt;/code&gt;、&lt;code&gt;TESS&lt;/code&gt;、&lt;code&gt;BAPS&lt;/code&gt;等。这里不介绍如何使用这些软件进行群体结构分析，下次有时间再进行介绍。本文主要介绍利用R包&lt;code&gt;pophelper&lt;/code&gt;对这些软件生成的数据进行展示。具体情况可以参考&lt;code&gt;pophelper&lt;/code&gt;的&lt;a href=&quot;http://royfrancis.github.io/pophelper/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;strong&gt;vignette&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="群体遗传进化" scheme="https://ytlogos.github.io/categories/%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0%E8%BF%9B%E5%8C%96/"/>
    
    
      <category term="进化，选择性清除分析" scheme="https://ytlogos.github.io/tags/%E8%BF%9B%E5%8C%96%EF%BC%8C%E9%80%89%E6%8B%A9%E6%80%A7%E6%B8%85%E9%99%A4%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>利用ComplexHeatmap绘制热图(一)</title>
    <link href="https://ytlogos.github.io/2018/04/08/%E5%88%A9%E7%94%A8ComplexHeatmap%E7%BB%98%E5%88%B6%E7%83%AD%E5%9B%BE(%E4%B8%80)/"/>
    <id>https://ytlogos.github.io/2018/04/08/利用ComplexHeatmap绘制热图(一)/</id>
    <published>2018-04-08T13:19:05.000Z</published>
    <updated>2018-04-15T07:27:51.313Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/6hE9lcGmjf.png?imageslim" alt="mark"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>Complexheatmap</strong>是由<a href="https://github.com/jokergoo" target="_blank" rel="external">顾祖光</a>博士创建的绘制热图的R包，在他的<a href="https://github.com/jokergoo/ComplexHeatmap" target="_blank" rel="external"><strong>GitHub</strong></a>有十分详细的<code>小品文(Vignettes)</code>说明。<strong>Complexheatmap</strong>是基于绘图系统<strong>grid</strong>，因此如果有相应<strong>grid</strong>的知识，学习起来应该更顺手！</p>
<a id="more"></a>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p><strong>Complexheatmap</strong>提供了一套非常灵活的方法用于多热图也就是热图列表布局以及支持自定义注释绘图，一个热图列表包含若干热图以及注释信息</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/FBA7hkj7a4.png?imageslim" alt=""></p>
<h2 id="绘制单个热图"><a href="#绘制单个热图" class="headerlink" title="绘制单个热图"></a>绘制单个热图</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>包的安装就不细说了，有不懂的可以翻我以前的博客，里面有详细的教程，下面直接给出安装代码不解释</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># installed <span class="keyword">from</span> bioconductor</div><div class="line">source(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</div><div class="line">options(BioC_mirror=<span class="string">"http://mirrors.ustc.edu.cn/bioc/"</span>)</div><div class="line">biocLite(<span class="string">"ComplexHeatmap"</span>)</div><div class="line"># installed <span class="keyword">from</span> GitHub</div><div class="line"><span class="keyword">if</span>(!require(devtools))&#123;install.packages(<span class="string">"devtools"</span>)&#125;</div><div class="line">devtools::install_github(<span class="string">"jokergoo/ComplexHeatmap"</span>)</div></pre></td></tr></table></figure>
<h3 id="创建数据集"><a href="#创建数据集" class="headerlink" title="创建数据集"></a>创建数据集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">pacman::p_load(ComplexHeatmap, circlize)</div><div class="line">set.seed(7)</div><div class="line">mat &lt;- cbind(rbind(matrix(rnorm(16, -1),4), matrix(rnorm(32, 1), 8)), rbind(matrix(rnorm(24, 1), 4), matrix(rnorm(48, -1), 8)))</div><div class="line">mat &lt;- mat[sample(nrow(mat), nrow(mat)), sample(ncol(mat), ncol(mat))]</div><div class="line">rownames(mat) &lt;- paste0(&quot;R&quot;, 1:12)</div><div class="line">colnames(mat) &lt;- paste0(&quot;C&quot;, 1:10)</div></pre></td></tr></table></figure>
<h3 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h3><p><strong>ComplexHeatmap</strong>绘制热图十分简单,使用默认参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/KlK9dIHkk0.png?imageslim" alt="mark"></p>
<h2 id="定制化"><a href="#定制化" class="headerlink" title="定制化"></a>定制化</h2><p><strong>ComplexHeatmap</strong>十分灵活，可以自定义多种参数绘制热图</p>
<h3 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h3><p>大多数情况下，绘制热图的矩阵都是连续性变量，通过提供颜色映射函数，我们可以自定义颜色，这主要是通过<strong>circlize</strong>包中的<code>colorRamp2()</code>函数来实现的,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mat2 &lt;- mat</div><div class="line">mat2[1,1] &lt;- 100000</div><div class="line">Heatmap(mat2, col = colorRamp2(c(-3,0,3), c(&quot;green&quot;,&quot;white&quot;,&quot;red&quot;)), cluster_rows = FALSE, cluster_columns = FALSE)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/iGBchD1c3J.png?imageslim" alt="mark"></p>
<p>可以看出，<strong>ComplexHeatmap</strong>对于异常值也能显示出来，不会剔除掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, col = rev(rainbow(10)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/eHkcmJld54.png?imageslim" alt="mark"></p>
<p>如果是离散型变量或者数值型、字符型变量的话，这时就需要特别指定颜色了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#离散型变量/数值型变量</div><div class="line">discrete_mat &lt;- matrix(sample(1:4, 100, replace = TRUE), 10, 10)</div><div class="line">colors &lt;- structure(circlize::rand_color(4), names=c(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;))</div><div class="line">Heatmap(discrete_mat, col = colors)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/C4IIB3Kebi.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#字符型变量</div><div class="line">character_mat &lt;- matrix(sample(letters[1:4], 100, replace = TRUE), 10, 10)</div><div class="line">colors &lt;- structure(circlize::rand_color(4), names=letters[1:4])</div><div class="line">Heatmap(character_mat, col = colors)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/DALJBe1FKb.png?imageslim" alt="mark"></p>
<p>可以看出，对于离散型变量/数值型变量，默认对行/列进行聚类，而对于字符型变量，则不进行聚类</p>
<p><strong>ComplexHeatmap</strong>允许数据中含有<code>NA</code>,只需要通过参数<code>na_col</code>来控制<code>NA</code>的颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mat_with_NA &lt;- mat</div><div class="line">mat_with_NA[sample(c(TRUE, FALSE), nrow(mat)*ncol(mat), replace = TRUE, prob = c(1,9))] &lt;- NA</div><div class="line">Heatmap(mat_with_NA, na_col = &quot;orange&quot;, clustering_distance_rows = &quot;pearson&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/3d9FbLfE8b.png?imageslim" alt="mark"></p>
<p><strong>ComplexHeatmap</strong>默认使用<a href="https://en.wikipedia.org/wiki/Lab_color_space" target="_blank" rel="external">LAB颜色空间(LAB color space)</a>，<code>colorRamp2()</code>提供了选择颜色空间的参数选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">f1 &lt;- colorRamp2(seq(min(mat), max(mat), length=3), c(&quot;blue&quot;,&quot;#EEEEEE&quot;, &quot;red&quot;))</div><div class="line">f2 &lt;- colorRamp2(seq(min(mat), max(mat), length=3), c(&quot;blue&quot;,&quot;#EEEEEE&quot;, &quot;red&quot;), space = &quot;RGB&quot;)</div><div class="line">H1 &lt;- Heatmap(mat, col = f1, column_title = &quot;LAB color space&quot;)</div><div class="line">H2 &lt;- Heatmap(mat, col = f2, column_title = &quot;RGB color space&quot;)</div><div class="line">H1+H2</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/6hE9lcGmjf.png?imageslim" alt="mark"></p>
<p><strong>ComplexHeatmap</strong>提供了多种颜色空间选项，可以根据自身数据不断调整，选取合适的颜色空间</p>
<h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>一个热图的标题有：图标题、图例标题、行列标题等<br><code>Heatmap</code>里提供的<code>name</code>参数默认的是图例的标题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, name = &quot;legend&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/43dh8Jc9h3.png?imageslim" alt="mark"></p>
<p>图里标题可以通过<code>heatmap_legend_param()</code>进行修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, heatmap_legend_param = list(title=&quot;legend&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/fa86cCBd61.png?imageslim" alt="mark"></p>
<p>行列标题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, name = &quot;legend&quot;, column_title = &quot;Column&quot;, row_title = &quot;Row&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/i220513hIG.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, name = &quot;legend&quot;, column_title = &quot;Column&quot;, column_title_side = &quot;bottom&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/ECkjcEedbA.png?imageslim" alt="mark"></p>
<p>如果需要修改图例参数，可以通过<code>gpar()</code>参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, name = &quot;legend&quot;,column_title = &quot;Column&quot;, row_title = &quot;Row&quot;, column_title_gp = gpar(fontsize=20, fontface=&quot;bold&quot;), row_title_gp = gpar(fontsize=20, fontface=&quot;bold&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/bi079kAgg7.png?imageslim" alt="mark"></p>
<p>标题可以旋转(水平或竖直)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(mat, name = &quot;legend&quot;, row_title = &quot;Row&quot;, row_title_rot = 0)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/i9dA7DDbLJ.png?imageslim" alt="mark"></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># R version 3.4.4 (2018-03-15)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Running under: Windows 10 x64 (build 16299)</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Matrix products: default</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># locale:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] LC_COLLATE=Chinese (Simplified)_China.936 </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [2] LC_CTYPE=Chinese (Simplified)_China.936   </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [3] LC_MONETARY=Chinese (Simplified)_China.936</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [4] LC_NUMERIC=C                              </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [5] LC_TIME=Chinese (Simplified)_China.936    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># attached base packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] grid      stats     graphics  grDevices utils     datasets  methods  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [8] base     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># other attached packages:</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [1] circlize_0.4.3        ComplexHeatmap_1.17.1</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># loaded via a namespace (and not attached):</span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [1] Rcpp_0.12.16         digest_0.6.15        rprojroot_1.3-2     </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [4] backports_1.1.2      pacman_0.4.6         magrittr_1.5        </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  [7] evaluate_0.10.1      GlobalOptions_0.0.13 stringi_1.1.7       </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [10] GetoptLong_0.1.6     rmarkdown_1.9        RColorBrewer_1.1-2  </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [13] rjson_0.2.15         tools_3.4.4          stringr_1.3.0       </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [16] yaml_2.1.18          compiler_3.4.4       colorspace_1.3-2    </span></span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="comment"># [19] shape_1.4.4          htmltools_0.3.6      knitr_1.20</span></span></div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180415/6hE9lcGmjf.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Complexheatmap&lt;/strong&gt;是由&lt;a href=&quot;https://github.com/jokergoo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;顾祖光&lt;/a&gt;博士创建的绘制热图的R包，在他的&lt;a href=&quot;https://github.com/jokergoo/ComplexHeatmap&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;strong&gt;GitHub&lt;/strong&gt;&lt;/a&gt;有十分详细的&lt;code&gt;小品文(Vignettes)&lt;/code&gt;说明。&lt;strong&gt;Complexheatmap&lt;/strong&gt;是基于绘图系统&lt;strong&gt;grid&lt;/strong&gt;，因此如果有相应&lt;strong&gt;grid&lt;/strong&gt;的知识，学习起来应该更顺手！&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="Complexheatmap" scheme="https://ytlogos.github.io/tags/Complexheatmap/"/>
    
  </entry>
  
  <entry>
    <title>全基因组加倍及串联重复基因</title>
    <link href="https://ytlogos.github.io/2018/04/05/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%8A%A0%E5%80%8D%E5%8F%8A%E4%B8%B2%E8%81%94%E9%87%8D%E5%A4%8D%E5%9F%BA%E5%9B%A0/"/>
    <id>https://ytlogos.github.io/2018/04/05/全基因组加倍及串联重复基因/</id>
    <published>2018-04-05T13:19:05.000Z</published>
    <updated>2018-04-14T08:39:32.809Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/ADC8bKhGm4.png?imageslim" alt="mark"></p>
<blockquote>
<p>串联重复基因是植物基因组中一类具有功能的串联重复序列，在植物基因组进化和环境适应的过程中起着十分重要的作用。串联重复基因主要是由串联重复事件产生的。在植物基因组中，串联重复事件的发生频率比较高，为植物基因组带来了基因拷贝数的增加以及等位基因变异。串联重复事件伴随着拟南芥和芸薹属物种的整个进化过程，而且芸薹属物种的多倍化事件并没有影响串联重复事件的发生。</p>
</blockquote>
<a id="more"></a>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180405/2h8a9544k1.png?imageslim" alt="mark"></p>
<ul>
<li>基因共线性分析</li>
</ul>
<p>拟南芥在进化过程中先后经历了三次基因组加倍事件(α、β和γ多倍化事件)。通过对拟南芥基因组的三次基因组加倍事件产生的共线性基因对分析，获得了α、β和γ多倍化事件后分别产生的3530，1421和505共线性基因对。在拟南芥细胞色素P450基因家族的进化分析发现，仅有CYP94基因家族中一对基因在γ基因组加倍化事件后产生的共线性基因对中被保留下来。这可能意味着CYP94基因家族的这两个成员在双子叶植物的祖先在经历γ基因组多倍化事件之前就存在。对于β基因组多倍化事件，CYP86、CYP72和CYP81基因家族中各有一对基因对被检测到保留下来，这意味着这些P450基因在β基因组多倍化事件之前就存在并在β基因组多倍化事件之后被保留下来。对于α基因组加倍事件产生的共线性基因对，共获得了11个P450基因对在α基因组加倍化事件后被保留下来，意味着这22个P450基因在α基因组多倍化事件之前就已存在并在α基因组加倍事件后保留下来。</p>
<blockquote>
<p>在拟南芥和芸薹属的祖先物种分化之后，芸薹属祖先物种经历了自身的三倍化事件，然后进一步产生了现在的白菜和甘蓝，通过与拟南芥基因组中24个十字花科保守区段的共线性关系构建了白菜和甘蓝基因组中的三倍化区段。根据三倍化区段上基因密度的差异，两个芸薹属物种中的三倍化区段划分为三个亚基因组：MF1(中度丢失)、NF2(高度丢失)和LF(低度丢失)。</p>
</blockquote>
<ul>
<li><p>通过古基因组学研究可追溯源到由7931条原基因模型和7条染色体构成的双子叶植物祖先基因组，以及由9138条原基因模型和5条染色体构成的单子叶植物祖先基因组。显花植物研究表明，被子植物基因组经历二倍化(α)、四倍化(β)和六倍化(γ)3次古全基因组复制(WGD)事件。</p>
</li>
<li><p>同源多倍体来源于种内WGD事件，异源多倍体来源于种间杂交。芸薹属(<em>Brassica</em>)植物经历了3次基因组WGD事件(α、β和γ)和种系全基因组三倍化事件，是基因组多倍化研究的重要模式物种。</p>
</li>
</ul>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/ADC8bKhGm4.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;串联重复基因是植物基因组中一类具有功能的串联重复序列，在植物基因组进化和环境适应的过程中起着十分重要的作用。串联重复基因主要是由串联重复事件产生的。在植物基因组中，串联重复事件的发生频率比较高，为植物基因组带来了基因拷贝数的增加以及等位基因变异。串联重复事件伴随着拟南芥和芸薹属物种的整个进化过程，而且芸薹属物种的多倍化事件并没有影响串联重复事件的发生。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="重复基因" scheme="https://ytlogos.github.io/tags/%E9%87%8D%E5%A4%8D%E5%9F%BA%E5%9B%A0/"/>
    
      <category term="古基因组学" scheme="https://ytlogos.github.io/tags/%E5%8F%A4%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>跨物种单拷贝直系同源基因</title>
    <link href="https://ytlogos.github.io/2018/04/02/%E8%B7%A8%E7%89%A9%E7%A7%8D%E5%8D%95%E6%8B%B7%E8%B4%9D%E7%9B%B4%E7%B3%BB%E5%90%8C%E6%BA%90%E5%9F%BA%E5%9B%A0/"/>
    <id>https://ytlogos.github.io/2018/04/02/跨物种单拷贝直系同源基因/</id>
    <published>2018-04-02T13:19:05.000Z</published>
    <updated>2018-04-14T07:53:34.867Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/KAl4De8m8L.png?imageslim" alt="mark"></p>
<h2 id="同源-Homology"><a href="#同源-Homology" class="headerlink" title="同源(Homology)"></a>同源(Homology)</h2><p><strong>同源(Homology)</strong> 的概念是这样定义的：</p>
<blockquote>
<p>Homology:the existence of shared abcestry between a pair of strctures,or genes, in different species</p>
</blockquote>
<p>如果两个或多个结构具有相同的祖先，也就是它们由一个共同祖先演化而来，则称它们<strong>同源(Homology)</strong></p>
<p>在生物信息学中，同源主要指的是序列上的同源，即用来说明两个或多个蛋白质氨基酸序列或者DNA序列具有共同的祖先。同源的序列一般具有相似的功能，序列中同源的部分也称为<strong>保守的(conserved)</strong></p>
<a id="more"></a>
<p>蛋白质和DNA的同源性常常根据它们序列的<strong>相似性(Sequence similarity)</strong>来判定，相似性一般用检测序列和目标序列之间的<strong>序列一致性(Percent identity)</strong>来表示</p>
<p><strong>相似性(Sequence similarity)</strong>是指序列比对过程中用来描述检测序列与目标序列之间相同DNA或氨基酸残基所占比例。一般来说，相似程度高于50%则认为序列之间是同源序列</p>
<h2 id="直系同源-orthology-与旁系同源-paralogy"><a href="#直系同源-orthology-与旁系同源-paralogy" class="headerlink" title="直系同源(orthology)与旁系同源(paralogy)"></a><strong>直系同源(orthology)</strong>与<strong>旁系同源(paralogy)</strong></h2><p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180321/LIbg3Cm50d.png?imageslim" alt="mark"></p>
<p>同源现象可分为<strong>直系同源(orthology)</strong>与<strong>旁系同源(paralogy)</strong></p>
<blockquote>
<p>Orthologys(orthology genes) are genes in dofferent pecies that originated by vertical descent from a single gene of the last common ancestor</p>
</blockquote>
<p><strong>直系同源(orthology)</strong>是指不同物种中的某一基因来自同一祖先，在演化过程中因物种形成(speciation)而被区分开来</p>
<blockquote>
<p>Paralogys(paralogous genes) are created by a duplication event within the genome. For gene duplicationevents, if a gene in an organism is duplicated to occupy two different positions in the same genome, then the two copies are paralogous</p>
</blockquote>
<p>旁系同源(paralogy)是指种系间的基因复制</p>
<h2 id="趋同演化-Convergent-evolution-和趋异进化-Divergent-evolution"><a href="#趋同演化-Convergent-evolution-和趋异进化-Divergent-evolution" class="headerlink" title="趋同演化(Convergent evolution)和趋异进化(Divergent evolution)"></a><strong>趋同演化(Convergent evolution)</strong>和<strong>趋异进化(Divergent evolution)</strong></h2><p>相似不一定同源，但是一般来说同源的必定是相似的</p>
<blockquote>
<p>趋同演化(Convergent evolution)：Convergent evolution creats analogous structure that have similar form or function, but that are not present in that last common ancestor of those groups</p>
<p>趋异演化(Divergent evolution): the accumulation of differences between groups which can lead to the formation of new species, usually a result of diffusion of the same species to different and isolated environments which blocks the gene flow among the distinct populations allowing differential fixation of characteristics through genetic drift and natural selection</p>
</blockquote>
<p>趋异演化(Divergent evolution):同一物种不同群体之间累积性差异导致新物种的形成，通常是同一物种扩散后，在不同隔离的环境下通过基因漂流和自然选择，基因分化固定后的结果，也就是说，两个或多个生物学特征具有共同演化起源，源自同一物种，但在演化过程中因环境等自然选择压力的原因，逐渐分化的现象</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/KAl4De8m8L.png?imageslim" alt="mark"></p>
<h2 id="蛋白家族-protein-family-和蛋白质超家族-protein-superfamilies"><a href="#蛋白家族-protein-family-和蛋白质超家族-protein-superfamilies" class="headerlink" title="蛋白家族(protein family)和蛋白质超家族(protein superfamilies)"></a><strong>蛋白家族(protein family)</strong>和<strong>蛋白质超家族(protein superfamilies)</strong></h2><p><strong>蛋白家族(protein family)</strong>家族有时我们也称为基因家族(gene family)，我们一般检索基因家族的时候都是根据数据库比如<code>Pfam</code>来搜索，大多是根据蛋白质氨基酸序列来搜索保守结构域。不同的<strong>蛋白质家族(protein family)</strong>又可被归于一个蛋白质超家族</p>
<blockquote>
<p>Protein family is a group of evolutionarily-related proteins. In many cases a protein family has a corresponding gene family, in which each gene encodes a corresponding protein with a 1:1 realtionship. Proteins in a family descend from a common ancestor and typicallly have similar three-dimensional, functions, and significant sequence similarity</p>
<p>Families are sometimes grouped together into a larger clades called superfamilies based on structured and mechanistic similarity, even if there is no identifiable sequence homology</p>
</blockquote>
<p><strong>蛋白质超家族(protein superfamilies)</strong>：一些蛋白质家族被归入更大的进化分支，基于结构机制的相似性，尽管其没有可确定的显著的序列同源性。简单而言就是蛋白质家族包含了更多进化分支的蛋白，虽然没有同源性，但是因为其结构域或功能基本相似，也被归为一个大类。蛋白质家族的同源关系是可以确定，同源关系上更加严格些</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/5d22B3e1bj.png?imageslim" alt="mark"></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180414/KAl4De8m8L.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;同源-Homology&quot;&gt;&lt;a href=&quot;#同源-Homology&quot; class=&quot;headerlink&quot; title=&quot;同源(Homology)&quot;&gt;&lt;/a&gt;同源(Homology)&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;同源(Homology)&lt;/strong&gt; 的概念是这样定义的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Homology:the existence of shared abcestry between a pair of strctures,or genes, in different species&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果两个或多个结构具有相同的祖先，也就是它们由一个共同祖先演化而来，则称它们&lt;strong&gt;同源(Homology)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在生物信息学中，同源主要指的是序列上的同源，即用来说明两个或多个蛋白质氨基酸序列或者DNA序列具有共同的祖先。同源的序列一般具有相似的功能，序列中同源的部分也称为&lt;strong&gt;保守的(conserved)&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="同源基因" scheme="https://ytlogos.github.io/tags/%E5%90%8C%E6%BA%90%E5%9F%BA%E5%9B%A0/"/>
    
  </entry>
  
  <entry>
    <title>植物转录因子WRKY</title>
    <link href="https://ytlogos.github.io/2018/03/30/%E6%A4%8D%E7%89%A9%E8%BD%AC%E5%BD%95%E5%9B%A0%E5%AD%90WRKY/"/>
    <id>https://ytlogos.github.io/2018/03/30/植物转录因子WRKY/</id>
    <published>2018-03-30T13:19:05.000Z</published>
    <updated>2018-04-09T02:01:43.329Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180408/ElmaeG5H85.png?imageslim" alt="WRKYs in plant biotic stress signaling network"></p>
<h2 id="WRKY结构特点"><a href="#WRKY结构特点" class="headerlink" title="WRKY结构特点"></a>WRKY结构特点</h2><ul>
<li><strong>WRKY</strong>转录因子家族具有相同的结构特征，N端都有包含<code>WRKYGQK</code>七肽序列的<code>WRKY</code>结构域，C端则含有C<sub>2</sub>H<sub>2</sub>-或C<sub>2</sub>HC-锌指结构，二者是WRKY特异性与启动子中W-box序列(C/T)TGAC(T/C)结合必不可少的组件。根据这些特点，WRKY可以分为三个亚家族：第Ⅰ亚家族含有两个<code>WRKY</code>结构域和两个C<sub>2</sub>H<sub>2</sub>锌指结构，第Ⅱ亚家族含有一个<code>WRKY</code>结构域和一个C<sub>2</sub>H<sub>2</sub>锌指结构，第Ⅲ亚家族含有一个<code>WRKY</code>结构域和一个C<sub>2</sub>HC锌指结构。第Ⅱ亚家族又被分为Ⅱa,Ⅱb,Ⅱc,Ⅱd和Ⅱe五个小亚族。</li>
</ul>
<a id="more"></a>
<ul>
<li>禾本科作物比如水稻、玉米以及高粱含有更多的第Ⅲ亚族<em>WRKY</em>，而Ⅱc亚家族和Ⅱa+Ⅱb亚家族则广泛地存在于十字花科和豆科中。</li>
</ul>
<h2 id="WRKY在植物逆境胁迫方面作用"><a href="#WRKY在植物逆境胁迫方面作用" class="headerlink" title="WRKY在植物逆境胁迫方面作用"></a><em>WRKY</em>在植物逆境胁迫方面作用</h2><ul>
<li>在非生物胁迫中的作用</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180408/dc9AE5i2Bb.png?imageslim" alt="WRKYs in plant abiotic stress signaling network"></p>
<ul>
<li>在生物胁迫中的作用</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180408/ElmaeG5H85.png?imageslim" alt="WRKYs in plant biotic stress signaling network"></p>
<p>第Ⅱ亚家族中的Ⅱc成员据推测可能是干旱胁迫以及盐胁迫的关键转录调控因子，几乎所有的<em>WRKY</em>基因都有参与到生物胁迫中，这说明：</p>
<ul>
<li><em>WRKY</em>的祖先在很早以前就已经进化有了植物免疫的功能</li>
<li><em>WRKY</em>的剂量是影响植物环境适应性的关键因子</li>
</ul>
<h2 id="WRKY在植物生长发育中的作用"><a href="#WRKY在植物生长发育中的作用" class="headerlink" title="WRKY在植物生长发育中的作用"></a><em>WRKY</em>在植物生长发育中的作用</h2><p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180408/Aff7IFllGd.png?imageslim" alt="mark"></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180408/ElmaeG5H85.png?imageslim&quot; alt=&quot;WRKYs in plant biotic stress signaling network&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;WRKY结构特点&quot;&gt;&lt;a href=&quot;#WRKY结构特点&quot; class=&quot;headerlink&quot; title=&quot;WRKY结构特点&quot;&gt;&lt;/a&gt;WRKY结构特点&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WRKY&lt;/strong&gt;转录因子家族具有相同的结构特征，N端都有包含&lt;code&gt;WRKYGQK&lt;/code&gt;七肽序列的&lt;code&gt;WRKY&lt;/code&gt;结构域，C端则含有C&lt;sub&gt;2&lt;/sub&gt;H&lt;sub&gt;2&lt;/sub&gt;-或C&lt;sub&gt;2&lt;/sub&gt;HC-锌指结构，二者是WRKY特异性与启动子中W-box序列(C/T)TGAC(T/C)结合必不可少的组件。根据这些特点，WRKY可以分为三个亚家族：第Ⅰ亚家族含有两个&lt;code&gt;WRKY&lt;/code&gt;结构域和两个C&lt;sub&gt;2&lt;/sub&gt;H&lt;sub&gt;2&lt;/sub&gt;锌指结构，第Ⅱ亚家族含有一个&lt;code&gt;WRKY&lt;/code&gt;结构域和一个C&lt;sub&gt;2&lt;/sub&gt;H&lt;sub&gt;2&lt;/sub&gt;锌指结构，第Ⅲ亚家族含有一个&lt;code&gt;WRKY&lt;/code&gt;结构域和一个C&lt;sub&gt;2&lt;/sub&gt;HC锌指结构。第Ⅱ亚家族又被分为Ⅱa,Ⅱb,Ⅱc,Ⅱd和Ⅱe五个小亚族。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="转录因子" scheme="https://ytlogos.github.io/tags/%E8%BD%AC%E5%BD%95%E5%9B%A0%E5%AD%90/"/>
    
  </entry>
  
  <entry>
    <title>油菜形成、进化及基因家族概况(三)</title>
    <link href="https://ytlogos.github.io/2018/03/23/%E6%B2%B9%E8%8F%9C%E5%BD%A2%E6%88%90%E5%8F%8A%E8%BF%9B%E5%8C%96(%E4%B8%89)/"/>
    <id>https://ytlogos.github.io/2018/03/23/油菜形成及进化(三)/</id>
    <published>2018-03-23T13:19:05.000Z</published>
    <updated>2018-04-01T08:18:31.305Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180401/78JFehmBF4.png?imageslim" alt="mark"></p>
<h2 id="同源基因"><a href="#同源基因" class="headerlink" title="同源基因"></a>同源基因</h2><p>同源基因包括直系同源基因(Orthologs)和旁系同源基因(Paralogs)。</p>
<ul>
<li>直系同源基因</li>
</ul>
<p>直系同源基因是指分布于两种或两种以上物种的基因组中，在进化上起源于一个祖先基因并垂直传递的同源基因，直系同源基因之间的功能高度保守，有些近乎相同。</p>
<ul>
<li>旁系同源基因</li>
</ul>
<p>旁系同源基因是指同一基因组(或同系物种的基因组)中，由于祖先基因的基因复制产生的同源基因。旁系同源基因尽管在结构上具有一定程度的相似性，但是他们的功能可能相似，也可能并不相似，甚至失去功能变成了假基因。</p>
<a id="more"></a>
<h2 id="基因家族及其扩增"><a href="#基因家族及其扩增" class="headerlink" title="基因家族及其扩增"></a>基因家族及其扩增</h2><p>基因复制对基因组中的基因家族扩增起着非常重要的作用。复制模式主要有三种：染色体片段复制(Segmental duplication)、串联复制(Tandem duplication)以及反转录转座(Retrotransposition)</p>
<ul>
<li>染色体片段复制</li>
</ul>
<p>大部分植物都经历过古老的全基因组复制事件，它是一种大规模的染色体倍增事件，一次性增加一个物种所有基因的剂量，导致基因组中保留着大量染色体倍增的片段。全基因组复制造成的重复区通常是一大片区域中所有基因的重复，而不是单个基因或几个基因的重复。</p>
<ul>
<li>串联复制</li>
</ul>
<p>串联复制主要发生在染色体重组区域，串联复制形成的基因家族成员通常紧密排列在同一条染色体上，形成一个序列相似、功能相近的基因簇。</p>
<ul>
<li>反转录转座</li>
</ul>
<p>反转录转座是指件已经转录和剪切的mRNA，再经过逆转录过程形成cDNA，然后随机插入到染色体的某一位置形成新的重复基因的过程。经反转录转座形成的新基因往往由于缺少必要的调控序列，通常都是不能表达的假基因。</p>
<blockquote>
<p>许多重要的基因家族在基因组中成簇存在，即同一基因家族的不同成员在基因组中串联重复排列。这些成簇存在的基因是种系生殖细胞在减数分裂过程中，通过染色体不等交换以及基因转换形成的。一些基因超家族通常含有成簇和分散存在的基因，成簇存在的基因(通常组成多基因家族)具有相似的功能，而分散存在的基因一般具有不同的功能。</p>
</blockquote>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180401/78JFehmBF4.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;同源基因&quot;&gt;&lt;a href=&quot;#同源基因&quot; class=&quot;headerlink&quot; title=&quot;同源基因&quot;&gt;&lt;/a&gt;同源基因&lt;/h2&gt;&lt;p&gt;同源基因包括直系同源基因(Orthologs)和旁系同源基因(Paralogs)。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;直系同源基因&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;直系同源基因是指分布于两种或两种以上物种的基因组中，在进化上起源于一个祖先基因并垂直传递的同源基因，直系同源基因之间的功能高度保守，有些近乎相同。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;旁系同源基因&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;旁系同源基因是指同一基因组(或同系物种的基因组)中，由于祖先基因的基因复制产生的同源基因。旁系同源基因尽管在结构上具有一定程度的相似性，但是他们的功能可能相似，也可能并不相似，甚至失去功能变成了假基因。&lt;/p&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="Brassica" scheme="https://ytlogos.github.io/tags/Brassica/"/>
    
  </entry>
  
  <entry>
    <title>油菜形成、进化及基因家族概况(二)</title>
    <link href="https://ytlogos.github.io/2018/03/21/%E6%B2%B9%E8%8F%9C%E5%BD%A2%E6%88%90%E5%8F%8A%E8%BF%9B%E5%8C%96(%E4%BA%8C)/"/>
    <id>https://ytlogos.github.io/2018/03/21/油菜形成及进化(二)/</id>
    <published>2018-03-21T13:19:05.000Z</published>
    <updated>2018-03-29T03:45:27.124Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180329/0L8a4haFDJ.png?imageslim" alt="mark"></p>
<h2 id="基因家族"><a href="#基因家族" class="headerlink" title="基因家族"></a>基因家族</h2><p>由一个共同的祖先基因经过重复(duplication)和突变(mutation)产生的、外显子中具有相似的序列的一组相关基因称为基因家族(gene family)。基因重复主要有三种形式：片段复制、串联重复和逆转录转座或其它转座事件等，基因重复后可以彼此形成基因簇(gene clusters)，同一家族中的成员有时紧密排列在一起成为一个基因簇；更多时候他们却分散在同一染色体的不同部位，甚至位于不同染色体上，具有不同的表达调控模式。</p>
<a id="more"></a>
<h2 id="假基因"><a href="#假基因" class="headerlink" title="假基因"></a>假基因</h2><p>在多基因家族中，某些成员并不产生有功能的基因产物，这些基因称为假基因(pseudogene)。假基因与有功能的基因同源，原来可能是有功能的基因，但由于缺失、倒位或点突变，使这一基因失去活性，成为无功能基因。与相应的正常基因相比，假基因往往缺少正常基因的内含子，两侧具有顺向重复序列。据推测假基因的来源之一可能是基因经过转录后生成的RNA的前体通过剪切失去内含子形成mRNA，如果mRNA经反复转录产生cDNA，再整合到染色体DNA中，便有可能成为假基因，因此该假基因是没有内含子的，在这个过程中，可能同时会发生缺失、倒位或点突变等变化，从而使假基因不能表达。假基因一般缺乏必要的启动子序列和缺乏一个或多个具有活性的成员中特有的内含子序列。</p>
<h2 id="DNA重复"><a href="#DNA重复" class="headerlink" title="DNA重复"></a>DNA重复</h2><p>DNA重复通常是指DNA片段数的增加，它可以是一个完整基因的重复(基因重复)、基因的一部分重复、一个完整染色体的重复(非整倍体)或整个基因组的重复(多倍体)。基因家族是由于连续的基因重复所造成的。非整倍体常导致生物体不育，而基因组重复只是增加基因拷贝数，并不产生新的基因，对基因组的复杂性并没有改变。从基因组计划的角度来看，更多的是考虑单个基因或一些基因的重复，而不是整个基因组的重复。</p>
<h2 id="超基因家族"><a href="#超基因家族" class="headerlink" title="超基因家族"></a>超基因家族</h2><p>多基因家族是一类具有序列同源性及功能相似性的基因；而超基因家族是一类具有序列同源性而不具有相似功能的基因。</p>
<h2 id="基因簇"><a href="#基因簇" class="headerlink" title="基因簇"></a>基因簇</h2><p>许多重要的基因家族在基因组中成簇存在，也即同一基因家族的不同成员在基因组中重复串联排列。这些成簇存在的基因是种系生殖细胞在减数分裂过程中通过染色体不等交换和基因转换形成的。成簇存在的基因(通常组成多基因家族)具有相似的功能，而分散存在的基因往往具有不同的功能，当然也有例外。分散存在的基因家族一般认为是通过RNA逆转录、随后整合到基因组中形成的。整合序列(integrated sequence)或逆转录序列(retrosequence)来源于基因的RNA转录本，因此无内含子。大多数逆转录序列变为不具功能的逆转录假基因(retropesudogene)，只有极少数逆转录序列保留了功能。</p>
<h2 id="基因家族形成的分子机制"><a href="#基因家族形成的分子机制" class="headerlink" title="基因家族形成的分子机制"></a>基因家族形成的分子机制</h2><ul>
<li>基因重复和点突变</li>
</ul>
<p>基因发生重复的主要分子机制包括多倍体化、串联重复及逆转录转座。多倍体化导致了许多基因家族的形成，串联重复参与了成簇存在的基因家族的进化，重复的DNA区域可以小于或大于一个基因的长度，但在基因家族的进化过程中，整个基因的重复尤为重要。在种系减数分裂过程中，染色体不等交换引起基因串联重复，一旦一个基因簇形成，不等交换率就会升高。在具有相似功能成员的多基因家族中，频繁的染色体不等交换导致了家族成员的协同进化。</p>
<ul>
<li>自然选择和随机漂变</li>
</ul>
<p>任何重复基因或多拷贝基因，如果被表达且具有功能，则正经历着纯化性自然选择(purifying selection)，多拷贝基因的进化率比单个基因的突变率低很多。自然选择限制程度随基因冗余而减弱，只要有一个基因保留其功能，有害的突变就有可能富集。对于大对数基因家族来说，有害突变的积累可被纯化性选择阻止，纯化性自然选择可以检测到具有功能的完整基因的数目。使突变基因拷贝数增加或减少的协同进化有利于自然选择。<br>正向自然选择(positive selection)是在重复基因获得新功能时发生的。许多重复基因产生后加快了氨基酸的替代，氨基酸替代可以通过同义及非同义突变的频率进行估计。<br>基因重复的另一后果是基因表达模式的变化，也即多拷贝基因的功能特化或亚功能化。这种变化对于参与发育过程的转录因子及其他蛋白尤为重要，这类基因功能的变化与生物的形态学进化直接相关。</p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180329/0L8a4haFDJ.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;基因家族&quot;&gt;&lt;a href=&quot;#基因家族&quot; class=&quot;headerlink&quot; title=&quot;基因家族&quot;&gt;&lt;/a&gt;基因家族&lt;/h2&gt;&lt;p&gt;由一个共同的祖先基因经过重复(duplication)和突变(mutation)产生的、外显子中具有相似的序列的一组相关基因称为基因家族(gene family)。基因重复主要有三种形式：片段复制、串联重复和逆转录转座或其它转座事件等，基因重复后可以彼此形成基因簇(gene clusters)，同一家族中的成员有时紧密排列在一起成为一个基因簇；更多时候他们却分散在同一染色体的不同部位，甚至位于不同染色体上，具有不同的表达调控模式。&lt;/p&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="Brassica" scheme="https://ytlogos.github.io/tags/Brassica/"/>
    
  </entry>
  
  <entry>
    <title>油菜形成、进化及基因家族概况</title>
    <link href="https://ytlogos.github.io/2018/03/20/%E6%B2%B9%E8%8F%9C%E5%BD%A2%E6%88%90%E5%8F%8A%E8%BF%9B%E5%8C%96/"/>
    <id>https://ytlogos.github.io/2018/03/20/油菜形成及进化/</id>
    <published>2018-03-20T13:19:05.000Z</published>
    <updated>2018-03-28T11:56:26.070Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/180328/JK3HalKdab.png?imageslim" alt="mark"></p>
<h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>十字花科祖先于2400-4000万年前出现，然后拟南芥与芸薹属在1200-2000万年前分化，之后不久芸薹属经历了特有的基因组三倍化，而后又经历了大规模的基因丢失、基因获得和包括部分复制和部分丢失的染色体重排。芸薹属两个重要的二倍体基本种白菜油菜(AA,2n=20)与甘蓝(CC,2n=18)于460万年前分化。甘蓝型油菜是由白菜型油菜和甘蓝通过种间自然杂交后又经染色体加倍而形成的一个异源四倍体。因此甘蓝型油菜基因组中通常会含有2个或2个以上的重复基因序列。</p>
<a id="more"></a>
<h2 id="转录因子"><a href="#转录因子" class="headerlink" title="转录因子"></a>转录因子</h2><p>在植物生长发育过程中，植物体需要对各种功能相关基因表达进行精确调控，从而对不同环境、组织和发育信号等作出相应的调节反应，其中转录因子在基因的表达调控中起着关键性作用。大部分真核生物中基因的表达很大程度上为转录水平的调控，这一调控是由多个不同蛋白质族群间的相互协调来达到，这些蛋白统称为转录因子，一般来说可以识别它们所调控的基因的启动子区域内特定的DNA序列的蛋白。通过蛋白之间的相互作用，转录因子调节RNA聚合酶Ⅱ的激活以及mRNA的合成。</p>
<h3 id="转录因子结构"><a href="#转录因子结构" class="headerlink" title="转录因子结构"></a>转录因子结构</h3><p>转录因子一般由4个功能区域组成：DNA结合域、转录调控区、寡聚化位点以及核定位信号。转录因子通过这些功能区域进入细胞核，与启动子中的顺式作用元件或其它转录因子的功能区域相互作用来调控基因转录表达。DNA结合域是指转录因子中能够识别并结合DNA顺式作用元件的一段氨基酸序列。同类型转录因子中DNA结合域的氨基酸序列是比较保守的，这决定了转录因子与顺式作用元件间识别与结合的特异性。转录调控区包括转录激活区以及转录抑制区，这一区域决定了同类转录因子间的差异，使之具有不同的功能。核定位信号控制转录因子进入细胞核的过程，该区域富含精氨酸和赖氨酸残基。寡聚化位点具有很保守的氨基酸序列，它是不同转录因子借以发生相互作用的功能域，形成同源或异源二聚体。<br>转录因子基因结构可以通过<strong>Gene Structure Display Server 2.0(GSDS2.0)</strong>进行分析。</p>
<h3 id="串联复制"><a href="#串联复制" class="headerlink" title="串联复制"></a>串联复制</h3><p>如果两个基因中间间隔有不多于5个基因且属于同一个基因家族，那么这两个基因称为串联复制。用<strong>MCScanX</strong>中的<code>mcscanx</code>对拟南芥基因组和甘蓝型油菜基因组分别做共线性分析，若一个基因与另一个基因有共线性关系，其周围有两对以上基因都是共线性关系，则这两个基因为部分复制。另外利用<strong>MCScanX</strong>中的<code>add ka and ks to collinearity</code>模块计算共线性关系基因对的Ks(同义替换)值，再利用T=Ks/2λ来推测部分复制发生的时间，对于十字花科而言，λ为1.5*10<sup>-8</sup>。</p>
<h3 id="转录因子理化性质"><a href="#转录因子理化性质" class="headerlink" title="转录因子理化性质"></a>转录因子理化性质</h3><p>在<strong>ExPASy</strong>中对拟南芥和推测出来的甘蓝型油菜基因家族成员的氨基酸序列进行分析，获得它们的理论等电点(pIs)以及蛋白质的相对分子量(Mw)。</p>
<h2 id="多倍化"><a href="#多倍化" class="headerlink" title="多倍化"></a>多倍化</h2><p>多倍化是物种进化的重要动力，多数高等植物在进化过程中都经历了不同水平的多倍化。十字花科物种都经历了三倍化。拟南芥与白菜分化自同一祖先物种。大约20-40M，拟南芥与白菜的共同祖先发生了一次基因组水平上的复制事件，称为α事件。芸薹属物种在此后又经历了一次基因组水平三倍化事件。在5-9M，甘蓝与白菜的共同祖先经历了一次基因组水平三倍化，白菜与甘蓝分化时间大约在4M。相较于拟南芥，甘蓝和白菜各发生了一次基因组复制。甘蓝型油菜大约在7500~12500年前由白菜和甘蓝天然杂交形成。物种的进化实质是基因的进化，多倍体事件是基因家族扩张的主要动力，在多倍化之后，基因数目呈倍数增长。</p>
<h2 id="进化分析"><a href="#进化分析" class="headerlink" title="进化分析"></a>进化分析</h2><h3 id="基因家族聚类"><a href="#基因家族聚类" class="headerlink" title="基因家族聚类"></a>基因家族聚类</h3><p>同源的蛋白质可以分为直系同源与旁系同源，当同源是基因复制的结果，两份拷贝在一个物种的历史上是平行演化的，这样的基因被称为旁系同源基因。当同源是物种形成的结果，基因的历史反映了物种的历史，被称为直系同源；直系同源是不同物种内的同源序列，它们是来自于物种形成时的共同祖先基因，通常认为直系同源基因具有相似的生物学功能。</p>
<h3 id="假基因"><a href="#假基因" class="headerlink" title="假基因"></a>假基因</h3><p>对不能转录或转录后生成无功能蛋白质的基因。假基因在及基因组中形成稳定的和无活性的拷贝，由活化的原始基因突变而来(复制突变或者加工型假基因)。这是因为存在着在某个阶段伤及基因表达的一种或多种缺陷(如启动子错误、有缺陷的剪接信号、框架中有终止信号等)之故。</p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>JianShu: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>Blog: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/180328/JK3HalKdab.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;起源&quot;&gt;&lt;a href=&quot;#起源&quot; class=&quot;headerlink&quot; title=&quot;起源&quot;&gt;&lt;/a&gt;起源&lt;/h2&gt;&lt;p&gt;十字花科祖先于2400-4000万年前出现，然后拟南芥与芸薹属在1200-2000万年前分化，之后不久芸薹属经历了特有的基因组三倍化，而后又经历了大规模的基因丢失、基因获得和包括部分复制和部分丢失的染色体重排。芸薹属两个重要的二倍体基本种白菜油菜(AA,2n=20)与甘蓝(CC,2n=18)于460万年前分化。甘蓝型油菜是由白菜型油菜和甘蓝通过种间自然杂交后又经染色体加倍而形成的一个异源四倍体。因此甘蓝型油菜基因组中通常会含有2个或2个以上的重复基因序列。&lt;/p&gt;
    
    </summary>
    
      <category term="bioinformatics" scheme="https://ytlogos.github.io/categories/bioinformatics/"/>
    
    
      <category term="Brassica" scheme="https://ytlogos.github.io/tags/Brassica/"/>
    
  </entry>
  
</feed>
