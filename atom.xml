<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Logos</title>
  <subtitle>Stay hungry,Stay foolish</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ytlogos.github.io/"/>
  <updated>2017-09-19T04:09:16.364Z</updated>
  <id>https://ytlogos.github.io/</id>
  
  <author>
    <name>TaoYan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ggplot2高效实用指南</title>
    <link href="https://ytlogos.github.io/2017/09/19/ggplot2%E9%AB%98%E6%95%88%E5%AE%9E%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://ytlogos.github.io/2017/09/19/ggplot2高效实用指南/</id>
    <published>2017-09-19T04:29:46.000Z</published>
    <updated>2017-09-19T04:09:16.364Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/emJBf4A306.png?imageslim" alt="mark"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文内容基本是来源于<a href="http://www.sthda.com/english/wiki/be-awesome-in-ggplot2-a-practical-guide-to-be-highly-effective-r-software-and-data-visualization" target="_blank" rel="external">STHDA</a>，这是一份十分详细的<strong>ggplot2</strong>使用指南，因此我将其翻译成中文，一是有助于我自己学习理解，另外其他R语言爱好者或者可视化爱好者可以用来学习。翻译过程肯定不能十全十美，各位读者有建议或改进的话，十分欢迎发<strong>Email</strong>(tyan@zju.edu.cn)给我。</p>
<a id="more"></a>
<p><a href="https://ggplot2.tidyverse.org/reference/" target="_blank" rel="external"><strong>ggplot2</strong></a>是由<strong>Hadley Wickham</strong>创建的一个十分强大的可视化R包。按照<strong>ggplot2</strong>的绘图理念，Plot(图)= data(数据集)+ Aesthetics(美学映射)+ Geometry(几何对象)：</p>
<ul>
<li>data: 数据集，主要是data frame；</li>
<li>Aesthetics: 美学映射，比如将变量映射给x,y坐标轴，或者映射给颜色、大小、形状等图形属性；</li>
<li>Geometry: 几何对象，比如柱形图、直方图、散点图、线图、密度图等。</li>
</ul>
<p>在<strong>ggplot2</strong>中有两个主要绘图函数：qplot()以及ggplot()。</p>
<ul>
<li>qplot(): 顾名思义，快速绘图；</li>
<li>ggplot()：此函数才是<strong>ggplot2</strong>的精髓，远比qplot()强大，可以一步步绘制十分复杂的图形。</li>
</ul>
<p>由<strong>ggplot2</strong>绘制出来的ggplot图可以作为一个变量，然后由print()显示出来。</p>
<h2 id="图形类型"><a href="#图形类型" class="headerlink" title="图形类型"></a>图形类型</h2><p>根据数据集，<strong>ggplot2</strong>提供不同的方法绘制图形，主要是为下面几类数据类型提供绘图方法：</p>
<ul>
<li>一个变量x: 连续或离散</li>
<li>两个变量x&amp;y：连续和(或)离散</li>
<li>连续双变量分布x&amp;y: 都是连续</li>
<li>误差棒</li>
<li>地图</li>
<li>三变量</li>
</ul>
<h2 id="安装及加载"><a href="#安装及加载" class="headerlink" title="安装及加载"></a>安装及加载</h2><p>安装<strong>ggplot2</strong>提供三种方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#直接安装tidyverse，一劳永逸（推荐,数据分析大礼包）</div><div class="line">install.packages(&quot;tidyverse&quot;)</div><div class="line">#直接安装ggplot2</div><div class="line">install.packages(&quot;ggplot2&quot;)</div><div class="line">#从Github上安装最新的版本，先安装devtools(如果没安装的话)</div><div class="line">devtools::install_github(&quot;tidyverse/ggplot2&quot;)</div></pre></td></tr></table></figure>
<p>加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">library(ggplot2)</div></pre></td></tr></table></figure></p>
<h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><blockquote>
<p>数据集应该数据框data.frame</p>
</blockquote>
<p>本文将使用数据集<strong>mtcars</strong>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#load the data set</div><div class="line">data(mtcars)</div><div class="line">df &lt;- mtcars[, c(&quot;mpg&quot;,&quot;cyl&quot;,&quot;wt&quot;)]</div><div class="line">#将cyl转为因子型factor</div><div class="line">df$cyl &lt;- as.factor(df$cyl)</div><div class="line">head(df)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##                    mpg cyl    wt</div><div class="line">## Mazda RX4         21.0   6 2.620</div><div class="line">## Mazda RX4 Wag     21.0   6 2.875</div><div class="line">## Datsun 710        22.8   4 2.320</div><div class="line">## Hornet 4 Drive    21.4   6 3.215</div><div class="line">## Hornet Sportabout 18.7   8 3.440</div><div class="line">## Valiant           18.1   6 3.460</div></pre></td></tr></table></figure>
<h2 id="qplot"><a href="#qplot" class="headerlink" title="qplot()"></a>qplot()</h2><p>qplot()类似于R基本绘图函数plot(),可以快速绘制常见的几种图形：散点图、箱线图、小提琴图、直方图以及密度曲线图。其绘图格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(x, y=NULL, data, geom=&quot;auto&quot;)</div></pre></td></tr></table></figure></p>
<p>其中：</p>
<ul>
<li>x,y: 根据需要绘制的图形使用;</li>
<li>data：数据集;</li>
<li>geom：几何图形，变量x,y同时指定的话默认为散点图，只指定x的话默认为直方图。</li>
</ul>
<h3 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(x=mpg, y=wt, data=df, geom = &quot;point&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/DlJaE4eke3.png?imageslim" alt=""><br>也可以添加平滑曲线<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(x=mpg, y=wt, data = df, geom = c(&quot;point&quot;, &quot;smooth&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/i3lHIh2jdD.png?imageslim" alt=""><br>还有其他参数可以修改，比如点的形状、大小、颜色等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#将变量cyl映射给颜色和形状</div><div class="line">qplot(x=mpg, y=wt, data = df, colour=cyl, shape=cyl)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/D6Aflkkhab.png?imageslim" alt=""></p>
<h3 id="箱线图、小提琴图、点图"><a href="#箱线图、小提琴图、点图" class="headerlink" title="箱线图、小提琴图、点图"></a>箱线图、小提琴图、点图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#构造数据集</div><div class="line">set.seed(1234)</div><div class="line">wdata &lt;- data.frame(</div><div class="line">  sex=factor(rep(c(&quot;F&quot;, &quot;M&quot;), each=200)),</div><div class="line">  weight=c(rnorm(200, 55), rnorm(200, 58))</div><div class="line">)</div><div class="line">head(wdata)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   sex   weight</div><div class="line">## 1   F 53.79293</div><div class="line">## 2   F 55.27743</div><div class="line">## 3   F 56.08444</div><div class="line">## 4   F 52.65430</div><div class="line">## 5   F 55.42912</div><div class="line">## 6   F 55.50606</div></pre></td></tr></table></figure>
<p>箱线图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(sex, weight, data = wdata, geom = &quot;boxplot&quot;, fill=sex)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/92K2e20idg.png?imageslim" alt=""></p>
<p>小提琴图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(sex, weight, data = wdata, geom = &quot;violin&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/3m8H660Cl9.png?imageslim" alt=""></p>
<p>点图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(sex, weight, data = wdata, geom = &quot;dotplot&quot;, stackdir=&quot;center&quot;, binaxis=&quot;y&quot;, dotsize=0.5, color=sex)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Hb7G4J8875.png?imageslim" alt=""></p>
<h3 id="直方图、密度图"><a href="#直方图、密度图" class="headerlink" title="直方图、密度图"></a>直方图、密度图</h3><p>直方图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(weight, data = wdata, geom = &quot;histogram&quot;, fill=sex)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/gd448CcLDb.png?imageslim" alt=""></p>
<p>密度图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(weight, data = wdata, geom = &quot;density&quot;, color=sex, linetype=sex)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/dl77b5BDdm.png?imageslim" alt=""></p>
<h2 id="ggplot"><a href="#ggplot" class="headerlink" title="ggplot()"></a>ggplot()</h2><p>上文中的qplot()绘制散点图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qplot(x=mpg, y=wt, data=df, geom = &quot;point&quot;)</div></pre></td></tr></table></figure></p>
<p>在ggplot()中完全可以如下实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(data=df, aes(x=mpg, y=wt))+</div><div class="line">  geom_point()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/80fkCC4Kgh.png?imageslim" alt=""></p>
<p>改变点形状、大小、颜色等属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=df, aes(x=mpg, y=wt))+geom_point(color=&quot;blue&quot;, size=2, shape=23)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/6LbL12Jmhm.png?imageslim" alt=""></p>
<p>绘图过程中常常要用到转换(transformation),这时添加图层的另一个方法是用stat_*()函数。<br>下例中的geom_density()与stat_density()是等价的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(wdata, aes(x=weight))+geom_density()</div></pre></td></tr></table></figure></p>
<p>等价于<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(wdata, aes(x=weight))+stat_density()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/D3ca6EAf3F.png?imageslim" alt=""></p>
<blockquote>
<p>对于每一种几何图形。<strong>ggplot2</strong> 基本都提供了 geom<em><em>()</em>和 stat</em><em>()</em></p>
</blockquote>
<h3 id="一个变量：连续型"><a href="#一个变量：连续型" class="headerlink" title="一个变量：连续型"></a>一个变量：连续型</h3><p>使用数据集wdata，先计算出不同性别的体重平均值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(plyr)</div><div class="line">mu &lt;- ddply(wdata, &quot;sex&quot;, summarise, grp.mean=mean(weight))</div></pre></td></tr></table></figure></p>
<p>先绘制一个图层a,后面逐步添加图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a &lt;- ggplot(wdata, aes(x=weight))</div></pre></td></tr></table></figure></p>
<p>可能添加的图层有：</p>
<ul>
<li>对于一个连续变量：<ul>
<li>面积图geom_area()</li>
<li>密度图geom_density()</li>
<li>点图geom_dotplot()</li>
<li>频率多边图geom_freqpoly()</li>
<li>直方图geom_histogram()</li>
<li>经验累积密度图stat_ecdf()</li>
<li>QQ图stat_qq()</li>
</ul>
</li>
<li>对于一个离散变量：<ul>
<li>条形图geom_bar()</li>
</ul>
</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/gcLBC7cG47.png?imageslim" alt=""></p>
<h4 id="面积图"><a href="#面积图" class="headerlink" title="面积图"></a>面积图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_area(stat = &quot;bin&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/J288ccH2m5.png?imageslim" alt=""></p>
<p>改变颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a+geom_area(aes(fill=sex), stat = &quot;bin&quot;, alpha=0.6)+</div><div class="line">  theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/LIj4mJbKb2.png?imageslim" alt=""></p>
<blockquote>
<p>注意：y轴默认为变量weight的数量即count，如果y轴要显示密度，可用以下代码：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_area(aes(y=..density..), stat = &quot;bin&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/kkCc85KCeJ.png?imageslim" alt=""></p>
<p>可以通过修改不同属性如透明度、填充颜色、大小、线型等自定义图形：</p>
<h4 id="密度图"><a href="#密度图" class="headerlink" title="密度图"></a>密度图</h4><p>使用以下函数：</p>
<ul>
<li>geom_density():绘制密度图</li>
<li>geom_vline():添加竖直线</li>
<li>scale_color_manual():手动修改颜色</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_density()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/c1EL7I2a49.png?imageslim" alt=""></p>
<p>根据sex修改颜色，将sex映射给line颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_density(aes(color=sex))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/72Ahbf7K6h.png?imageslim" alt=""></p>
<p>修改填充颜色以及透明度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_density(aes(fill=sex), alpha=0.4)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/ejijLE9IfG.png?imageslim" alt=""></p>
<p>添加均值线以及手动修改颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a+geom_density(aes(color=sex))+</div><div class="line">  geom_vline(data=mu, aes(xintercept=grp.mean, color=sex), linetype=&quot;dashed&quot;)+</div><div class="line">  scale_color_manual(values = c(&quot;red&quot;, &quot;blue&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/mAFhH7lleK.png?imageslim" alt=""></p>
<h4 id="点图"><a href="#点图" class="headerlink" title="点图"></a>点图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_dotplot()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/H1mDL0HCJI.png?imageslim" alt=""></p>
<p>将sex映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_dotplot(aes(fill=sex))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/6bfHaEcBAl.png?imageslim" alt=""></p>
<p>手动修改颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a+geom_dotplot(aes(fill=sex))+</div><div class="line">  scale_fill_manual(values=c(&quot;#999999&quot;, &quot;#E69F00&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/kiE9Lci30h.png?imageslim" alt=""></p>
<h4 id="频率多边图"><a href="#频率多边图" class="headerlink" title="频率多边图"></a>频率多边图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_freqpoly()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/K40Fch448J.png?imageslim" alt=""></p>
<p>y轴显示为密度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a+geom_freqpoly(aes(y=..density..))+</div><div class="line">  theme_minimal()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/CgCf1eAgf8.png?imageslim" alt=""></p>
<p>修改颜色以及线型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a+geom_freqpoly(aes(color=sex, linetype=sex))+</div><div class="line">  theme_minimal()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/jaaBibcFjH.png?imageslim" alt=""></p>
<h4 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_histogram()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/bHilai3a9l.png?imageslim" alt=""></p>
<p>将sex映射给线颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+geom_histogram(aes(color=sex), fill=&quot;white&quot;, position = &quot;dodge&quot;)+theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/eD7iLDJId1.png?imageslim" alt=""></p>
<h4 id="经验累积密度图"><a href="#经验累积密度图" class="headerlink" title="经验累积密度图"></a>经验累积密度图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a+stat_ecdf()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/f83Imkm4jm.png?imageslim" alt=""></p>
<h4 id="QQ图"><a href="#QQ图" class="headerlink" title="QQ图"></a>QQ图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data = mtcars, aes(sample=mpg))+stat_qq()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/e7G7hbeLID.png?imageslim" alt=""></p>
<h3 id="一个离散变量"><a href="#一个离散变量" class="headerlink" title="一个离散变量"></a>一个离散变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#加载数据集</div><div class="line">data(mpg)</div><div class="line">b &lt;- ggplot(mpg, aes(x=fl))</div><div class="line">b+geom_bar()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/b4FJFb7H99.png?imageslim" alt=""></p>
<p>修改填充颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b+geom_bar(fill=&quot;steelblue&quot;, color=&quot;black&quot;)+theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/ih6I2ammG4.png?imageslim" alt=""></p>
<h3 id="两个变量：x-y皆连续"><a href="#两个变量：x-y皆连续" class="headerlink" title="两个变量：x,y皆连续"></a>两个变量：x,y皆连续</h3><p>使用数据集mtcars， 先创建一个ggplot图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b &lt;- ggplot(data = mtcars, aes(x=wt, y=mpg))</div></pre></td></tr></table></figure></p>
<p>可能添加的图层有：</p>
<ul>
<li>geom_point():散点图</li>
<li>geom_smooth():平滑线</li>
<li>geom_quantile():分位线</li>
<li>geom_rug():边际地毯线</li>
<li>geom_jitter():避免重叠</li>
<li>geom_text():添加文本注释</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/ld1EAJgd88.png?imageslim" alt=""></p>
<h4 id="散点图-1"><a href="#散点图-1" class="headerlink" title="散点图"></a>散点图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/796GlJi3Al.png?imageslim" alt=""></p>
<p>将变量cyl映射给点的颜色和形状<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b + geom_point(aes(color = factor(cyl), shape = factor(cyl)))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/J6dfJ1EL33.png?imageslim" alt=""></p>
<p>自定义颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">b+geom_point(aes(color=factor(cyl), shape=factor(cyl)))+</div><div class="line">  scale_color_manual(values=c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;))+theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/3695bEj0Ha.png?imageslim" alt=""></p>
<h4 id="平滑线"><a href="#平滑线" class="headerlink" title="平滑线"></a>平滑线</h4><p>可以添加回归曲线<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b+geom_smooth()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/1hJGKGeLc2.png?imageslim" alt=""></p>
<p>散点图+回归线<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">b+geom_point()+</div><div class="line">  geom_smooth(method = &quot;lm&quot;, se=FALSE)#去掉置信区间</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Gl47fkb2c2.png?imageslim" alt=""></p>
<p>使用loess方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">b+geom_point()+</div><div class="line">  geom_smooth(method = &quot;loess&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/6jaCLAL3Fc.png?imageslim" alt=""></p>
<p>将变量映射给颜色和形状<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">b+geom_point(aes(color=factor(cyl), shape=factor(cyl)))+</div><div class="line">  geom_smooth(aes(color=factor(cyl), shape=factor(cyl)), method = &quot;lm&quot;, se=FALSE, fullrange=TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/7hjfJ89K4c.png?imageslim" alt=""></p>
<h4 id="分位线"><a href="#分位线" class="headerlink" title="分位线"></a>分位线</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(data = mpg, aes(cty, hwy))+</div><div class="line">  geom_point()+geom_quantile()+</div><div class="line">  theme_minimal()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/l0F005kgih.png?imageslim" alt=""></p>
<h4 id="边际地毯线"><a href="#边际地毯线" class="headerlink" title="边际地毯线"></a>边际地毯线</h4><p>使用数据集<strong>faithful</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(data = faithful, aes(x=eruptions, y=waiting))+</div><div class="line">  geom_point()+geom_rug()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/7H7BlJE35k.png?imageslim" alt=""></p>
<h4 id="避免重叠"><a href="#避免重叠" class="headerlink" title="避免重叠"></a>避免重叠</h4><p>实际上<code>geom_jitter()</code>是<code>geom_point(position=&quot;jitter&quot;)</code>的简称,下面使用数据集<strong>mpg</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(data = mpg, aes(displ, hwy))</div><div class="line">p+geom_point()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Ad2aBaaEED.png?imageslim" alt=""><br>增加抖动防止重叠<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+geom_jitter(width = 0.5, height = 0.5)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/DmKBbIGK2c.png?imageslim" alt=""></p>
<p>其中两个参数：</p>
<ul>
<li>width：x轴方向的抖动幅度</li>
<li>height：y轴方向的抖动幅度</li>
</ul>
<h4 id="文本注释"><a href="#文本注释" class="headerlink" title="文本注释"></a>文本注释</h4><p>参数label用来指定注释标签<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b+geom_text(aes(label=rownames(mtcars)))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/L6CaLD26ga.png?imageslim" alt=""></p>
<h3 id="两个变量：连续二元分布"><a href="#两个变量：连续二元分布" class="headerlink" title="两个变量：连续二元分布"></a>两个变量：连续二元分布</h3><p>使用数据集<strong>diamonds</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">head(diamonds[, c(&quot;carat&quot;, &quot;price&quot;)])</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## # A tibble: 6 x 2</div><div class="line">##   carat price</div><div class="line">##   &lt;dbl&gt; &lt;int&gt;</div><div class="line">## 1  0.23   326</div><div class="line">## 2  0.21   326</div><div class="line">## 3  0.23   327</div><div class="line">## 4  0.29   334</div><div class="line">## 5  0.31   335</div><div class="line">## 6  0.24   336</div></pre></td></tr></table></figure>
<p>创建ggplot图层,后面再逐步添加图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c &lt;- ggplot(data=diamonds, aes(carat, price))</div></pre></td></tr></table></figure></p>
<p>可添加的图层有：</p>
<ul>
<li>geom_bin2d(): 二维封箱热图</li>
<li>geom_hex(): 六边形封箱图</li>
<li>geom_density_2d(): 二维等高线密度图</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/mIdJKh6F1G.png?imageslim" alt=""></p>
<h4 id="二维封箱热图"><a href="#二维封箱热图" class="headerlink" title="二维封箱热图"></a>二维封箱热图</h4><p><code>geom_bin2d()</code>将点的数量用矩形封装起来，通过颜色深浅来反映点密度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c+geom_bin2d()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/BgC3g377mE.png?imageslim" alt=""><br>设置bin的数量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c+geom_bin2d(bins=150)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/4ejegHkcbF.png?imageslim" alt=""></p>
<h4 id="六边形封箱图"><a href="#六边形封箱图" class="headerlink" title="六边形封箱图"></a>六边形封箱图</h4><p>geom_hex()依赖于另一个R包<strong>hexbin</strong>，所以没安装的先安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;hexbin&quot;)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(hexbin)</div><div class="line">c+geom_hex()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/f9Fbl2IAKj.png?imageslim" alt=""></p>
<p>修改bin的数目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c+geom_hex(bins=10)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/bIc44CGdC8.png?imageslim" alt=""></p>
<h4 id="二维等高线密度图"><a href="#二维等高线密度图" class="headerlink" title="二维等高线密度图"></a>二维等高线密度图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(faithful, aes(x=eruptions, y=waiting))</div><div class="line">sp+geom_point()+ geom_density_2d()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/imG9fLLlb6.png?imageslim" alt=""></p>
<h3 id="两个变量：连续函数"><a href="#两个变量：连续函数" class="headerlink" title="两个变量：连续函数"></a>两个变量：连续函数</h3><p>主要是如何通过线来连接两个变量，使用数据集<strong>economics</strong>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">head(economics)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## # A tibble: 6 x 6</div><div class="line">##         date   pce    pop psavert uempmed unemploy</div><div class="line">##       &lt;date&gt; &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;int&gt;</div><div class="line">## 1 1967-07-01 507.4 198712    12.5     4.5     2944</div><div class="line">## 2 1967-08-01 510.5 198911    12.5     4.7     2945</div><div class="line">## 3 1967-09-01 516.3 199113    11.7     4.6     2958</div><div class="line">## 4 1967-10-01 512.9 199311    12.5     4.9     3143</div><div class="line">## 5 1967-11-01 518.1 199498    12.5     4.7     3066</div><div class="line">## 6 1967-12-01 525.8 199657    12.1     4.8     3018</div></pre></td></tr></table></figure>
<p>先创建一个ggplot图层，后面逐步添加图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">d &lt;- ggplot(data = economics, aes(x=date, y=unemploy))</div></pre></td></tr></table></figure></p>
<p>可添加的图层有：</p>
<ul>
<li>geom_area():面积图</li>
<li>geom_line()：折线图</li>
<li>geom_step(): 阶梯图</li>
</ul>
<h4 id="面积图-1"><a href="#面积图-1" class="headerlink" title="面积图"></a>面积图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">d+geom_area()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/dj4fHa6Kh2.png?imageslim" alt=""></p>
<h4 id="线图"><a href="#线图" class="headerlink" title="线图"></a>线图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">d+geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/DhLc531J92.png?imageslim" alt=""></p>
<h4 id="阶梯图"><a href="#阶梯图" class="headerlink" title="阶梯图"></a>阶梯图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">set.seed(1111)</div><div class="line">ss &lt;- economics[sample(1:nrow(economics), 20),]</div><div class="line">ggplot(ss, aes(x=date, y=unemploy))+</div><div class="line">  geom_step()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/l5lHl5944G.png?imageslim" alt=""></p>
<h3 id="两个变量：x离散，y连续"><a href="#两个变量：x离散，y连续" class="headerlink" title="两个变量：x离散，y连续"></a>两个变量：x离散，y连续</h3><p>使用数据集<strong>ToothGrowth</strong>,其中的变量len(Tooth length)是连续变量，dose是离散变量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)</div><div class="line">head(ToothGrowth)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##    len supp dose</div><div class="line">## 1  4.2   VC  0.5</div><div class="line">## 2 11.5   VC  0.5</div><div class="line">## 3  7.3   VC  0.5</div><div class="line">## 4  5.8   VC  0.5</div><div class="line">## 5  6.4   VC  0.5</div><div class="line">## 6 10.0   VC  0.5</div></pre></td></tr></table></figure>
<p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e &lt;- ggplot(data = ToothGrowth, aes(x=dose, y=len))</div></pre></td></tr></table></figure></p>
<p>可添加的图层有：</p>
<ul>
<li>geom_boxplot(): 箱线图</li>
<li>geom_violin()：小提琴图</li>
<li>geom_dotplot()：点图</li>
<li>geom_jitter(): 带状图</li>
<li>geom_line(): 线图</li>
<li>geom_bar(): 条形图</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/3F447J6d7L.png?imageslim" alt=""></p>
<h4 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_boxplot()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/37J7f7hfCJ.png?imageslim" alt=""></p>
<p>添加有缺口的箱线图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_boxplot(notch = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/952cibHB9E.png?imageslim" alt=""></p>
<p>按dose分组映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_boxplot(aes(color=dose))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/15dJjbIGkB.png?imageslim" alt=""></p>
<p>将dose映射给填充颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_boxplot(aes(fill=dose))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Am1A6Efaa6.png?imageslim" alt=""></p>
<p>按supp进行分类并映射给填充颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(ToothGrowth, aes(x=dose, y=len))+ geom_boxplot(aes(fill=supp))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/jfFFF1Hh99.png?imageslim" alt=""></p>
<h4 id="小提琴图"><a href="#小提琴图" class="headerlink" title="小提琴图"></a>小提琴图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_violin(trim = FALSE)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/fG1DmbmaIB.png?imageslim" alt=""></p>
<p>添加中值点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">e+geom_violin(trim = FALSE)+</div><div class="line">  stat_summary(fun.data = mean_sdl, fun.args = list(mult=1), </div><div class="line">               geom=&quot;pointrange&quot;, color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/GAkDaEHJe2.png?imageslim" alt=""></p>
<p>与箱线图结合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e+geom_violin(trim = FALSE)+</div><div class="line">  geom_boxplot(width=0.2)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/igef2H376K.png?imageslim" alt=""></p>
<p>将dose映射给颜色进行分组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_violin(aes(color=dose), trim = FALSE)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/g6G0aI5DaE.png?imageslim" alt=""></p>
<h4 id="点图-1"><a href="#点图-1" class="headerlink" title="点图"></a>点图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e+geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/60aB2FKkBj.png?imageslim" alt=""></p>
<p>添加中值点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;) + </div><div class="line">  stat_summary(fun.data=mean_sdl, color = &quot;red&quot;,geom = &quot;pointrange&quot;,fun.args=list(mult=1))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/B1A5h69HDF.png?imageslim" alt=""></p>
<p>与箱线图结合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_boxplot() + </div><div class="line">  geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/JkebcfeiHH.png?imageslim" alt=""></p>
<p>添加小提琴图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_violin(trim = FALSE) +</div><div class="line">  geom_dotplot(binaxis=&apos;y&apos;, stackdir=&apos;center&apos;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/DGm19F7hde.png?imageslim" alt=""></p>
<p>将dose映射给颜色以及填充色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_dotplot(aes(color = dose, fill = dose), </div><div class="line">                 binaxis = &quot;y&quot;, stackdir = &quot;center&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/AGABHiI43E.png?imageslim" alt=""></p>
<h4 id="带状图"><a href="#带状图" class="headerlink" title="带状图"></a>带状图</h4><p>带状图是一种一维散点图，当样本量很小时，与箱线图相当<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">e + geom_jitter(position=position_jitter(0.2))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/KE0EHFl7h0.png?imageslim" alt=""></p>
<p>添加中值点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">e + geom_jitter(position=position_jitter(0.2)) + </div><div class="line">  stat_summary(fun.data=&quot;mean_sdl&quot;,  fun.args = list(mult=1), </div><div class="line">               geom=&quot;pointrange&quot;, color = &quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/GF9c4kHDKI.png?imageslim" alt="mark"></p>
<p>与点图结合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_jitter(position=position_jitter(0.2)) + </div><div class="line">  geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/238j5KGmEB.png?imageslim" alt="mark"></p>
<p>与小提琴图结合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e + geom_violin(trim = FALSE) +</div><div class="line">  geom_jitter(position=position_jitter(0.2))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/lEADE3fA1h.png?imageslim" alt="mark"></p>
<p>将dose映射给颜色和形状<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e +  geom_jitter(aes(color = dose, shape = dose),</div><div class="line">                 position=position_jitter(0.2))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/7lKfKkE5d6.png?imageslim" alt="mark"></p>
<h4 id="线图-1"><a href="#线图-1" class="headerlink" title="线图"></a>线图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#构造数据集</div><div class="line">df &lt;- data.frame(supp=rep(c(&quot;VC&quot;, &quot;OJ&quot;), each=3),</div><div class="line">                dose=rep(c(&quot;D0.5&quot;, &quot;D1&quot;, &quot;D2&quot;),2),</div><div class="line">                len=c(6.8, 15, 33, 4.2, 10, 29.5))</div><div class="line">head(df)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   supp dose  len</div><div class="line">## 1   VC D0.5  6.8</div><div class="line">## 2   VC   D1 15.0</div><div class="line">## 3   VC   D2 33.0</div><div class="line">## 4   OJ D0.5  4.2</div><div class="line">## 5   OJ   D1 10.0</div><div class="line">## 6   OJ   D2 29.5</div></pre></td></tr></table></figure>
<p>将supp映射线型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(df, aes(x=dose, y=len, group=supp)) +</div><div class="line">  geom_line(aes(linetype=supp))+</div><div class="line">  geom_point()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Bjl125A2Im.png?imageslim" alt="mark"></p>
<p>修改线型、点的形状以及颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(df, aes(x=dose, y=len, group=supp)) +</div><div class="line">  geom_line(aes(linetype=supp, color = supp))+</div><div class="line">  geom_point(aes(shape=supp, color = supp))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/j9e39B9cKB.png?imageslim" alt="mark"></p>
<h4 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a>条形图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#构造数据集</div><div class="line">df &lt;- data.frame(dose=c(&quot;D0.5&quot;, &quot;D1&quot;, &quot;D2&quot;),</div><div class="line">                len=c(4.2, 10, 29.5))</div><div class="line">head(df)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##   dose  len</div><div class="line">## 1 D0.5  4.2</div><div class="line">## 2   D1 10.0</div><div class="line">## 3   D2 29.5</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df2 &lt;- data.frame(supp=rep(c(&quot;VC&quot;, &quot;OJ&quot;), each=3),</div><div class="line">                dose=rep(c(&quot;D0.5&quot;, &quot;D1&quot;, &quot;D2&quot;),2),</div><div class="line">                len=c(6.8, 15, 33, 4.2, 10, 29.5))</div><div class="line">head(df2)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   supp dose  len</div><div class="line">## 1   VC D0.5  6.8</div><div class="line">## 2   VC   D1 15.0</div><div class="line">## 3   VC   D2 33.0</div><div class="line">## 4   OJ D0.5  4.2</div><div class="line">## 5   OJ   D1 10.0</div><div class="line">## 6   OJ   D2 29.5</div></pre></td></tr></table></figure>
<p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(df, aes(x = dose, y = len))</div><div class="line">f + geom_bar(stat = &quot;identity&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/FF7A37l9j4.png?imageslim" alt="mark"></p>
<p>修改填充色以及添加标签<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">f + geom_bar(stat=&quot;identity&quot;, fill=&quot;steelblue&quot;)+</div><div class="line">  geom_text(aes(label=len), vjust=-0.3, size=3.5)+</div><div class="line">  theme_minimal()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/hBa9871IE9.png?imageslim" alt="mark"></p>
<p>将dose映射给条形图颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f + geom_bar(aes(color = dose),</div><div class="line">             stat=&quot;identity&quot;, fill=&quot;white&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/HIGAAJLiFl.png?imageslim" alt="mark"></p>
<p>修改填充色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f + geom_bar(aes(fill = dose), stat=&quot;identity&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/LGFlfJGmHi.png?imageslim" alt="mark"></p>
<p>将变量supp映射给填充色，从而达到分组效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">g &lt;- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) </div><div class="line">g + geom_bar(stat = &quot;identity&quot;)#position默认为stack</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/dLGm6lij04.png?imageslim" alt="mark"></p>
<p>修改position为dodge<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">g + geom_bar(stat=&quot;identity&quot;, position=position_dodge())</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/Di23jj9kC9.png?imageslim" alt="mark"></p>
<h3 id="两个变量：x、y皆离散"><a href="#两个变量：x、y皆离散" class="headerlink" title="两个变量：x、y皆离散"></a>两个变量：x、y皆离散</h3><p>使用数据集diamonds中的两个离散变量color以及cut<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds, aes(cut, color)) +</div><div class="line">  geom_jitter(aes(color = cut), size = 0.5)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/c8Fh5DI7cE.png?imageslim" alt="mark"></p>
<h3 id="两个变量：绘制误差图"><a href="#两个变量：绘制误差图" class="headerlink" title="两个变量：绘制误差图"></a>两个变量：绘制误差图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df &lt;- ToothGrowth</div><div class="line">df$dose &lt;- as.factor(df$dose)</div><div class="line">head(df)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##    len supp dose</div><div class="line">## 1  4.2   VC  0.5</div><div class="line">## 2 11.5   VC  0.5</div><div class="line">## 3  7.3   VC  0.5</div><div class="line">## 4  5.8   VC  0.5</div><div class="line">## 5  6.4   VC  0.5</div><div class="line">## 6 10.0   VC  0.5</div></pre></td></tr></table></figure>
<p>绘制误差图需要知道均值以及标准误，下面这个函数用来计算每组的均值以及标准误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">data_summary &lt;- function(data, varname, grps)&#123;</div><div class="line">  require(plyr)</div><div class="line">  summary_func &lt;- function(x, col)&#123;</div><div class="line">    c(mean = mean(x[[col]], na.rm=TRUE),</div><div class="line">      sd = sd(x[[col]], na.rm=TRUE))</div><div class="line">  &#125;</div><div class="line">  data_sum&lt;-ddply(data, grps, .fun=summary_func, varname)</div><div class="line">  data_sum &lt;- rename(data_sum, c(&quot;mean&quot; = varname))</div><div class="line"> return(data_sum)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>计算均值以及标准误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df2 &lt;- data_summary(df, varname=&quot;len&quot;, grps= &quot;dose&quot;)</div><div class="line"># Convert dose to a factor variable</div><div class="line">df2$dose=as.factor(df2$dose)</div><div class="line">head(df2)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##   dose    len       sd</div><div class="line">## 1  0.5 10.605 4.499763</div><div class="line">## 2    1 19.735 4.415436</div><div class="line">## 3    2 26.100 3.774150</div></pre></td></tr></table></figure>
<p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(df2, aes(x = dose, y = len, </div><div class="line">                     ymin = len-sd, ymax = len+sd))</div></pre></td></tr></table></figure></p>
<p>可添加的图层有：</p>
<ul>
<li>geom_crossbar(): 空心柱，上中下三线分别代表ymax、mean、ymin</li>
<li>geom_errorbar(): 误差棒</li>
<li>geom_errorbarh(): 水平误差棒</li>
<li>geom_linerange()：竖直误差线</li>
<li>geom_pointrange()：中间为一点的误差线</li>
</ul>
<p>具体如下：</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/521m2AHCDg.png?imageslim" alt=""></p>
<h4 id="geom-crossbar"><a href="#geom-crossbar" class="headerlink" title="geom_crossbar()"></a>geom_crossbar()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_crossbar()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/18EIA26lgI.png?imageslim" alt="mark"></p>
<p>将dose映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_crossbar(aes(color=dose))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/jH5eDIHjHL.png?imageslim" alt="mark"></p>
<p>自定义颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f+geom_crossbar(aes(color=dose))+</div><div class="line">  scale_color_manual(values = c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;))+theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/jcBCFdKlmH.png?imageslim" alt="mark"></p>
<p>修改填充色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">f+geom_crossbar(aes(fill=dose))+</div><div class="line">  scale_fill_manual(values = c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;))+</div><div class="line">  theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/6c5A4l9d2D.png?imageslim" alt="mark"></p>
<p>通过将supp映射给颜色实现分组，可以利用函数stat_summary()来计算mean和sd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(df, aes(x=dose, y=len, color=supp))</div><div class="line">f+stat_summary(fun.data = mean_sdl, fun.args = list(mult=1), geom=&quot;crossbar&quot;, width=0.6, position = position_dodge(0.8))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/3e3Ic9486G.png?imageslim" alt="mark"></p>
<h4 id="误差棒"><a href="#误差棒" class="headerlink" title="误差棒"></a>误差棒</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(df2, aes(x=dose, y=len, ymin=len-sd, ymax=len+sd))</div></pre></td></tr></table></figure>
<p>将dose映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_errorbar(aes(color=dose), width=0.2)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/HLJe8aLajg.png?imageslim" alt="mark"></p>
<p>与线图结合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f+geom_line(aes(group=1))+</div><div class="line">  geom_errorbar(width=0.15)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/2E0aKa6GgJ.png?imageslim" alt="mark"></p>
<p>与条形图结合，并将变量dose映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f+geom_bar(aes(color=dose), stat = &quot;identity&quot;, fill=&quot;white&quot;)+</div><div class="line">  geom_errorbar(aes(color=dose), width=0.1)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170918/1GllA47ajF.png?imageslim" alt="mark"></p>
<h4 id="水平误差棒"><a href="#水平误差棒" class="headerlink" title="水平误差棒"></a>水平误差棒</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#构造数据集</div><div class="line">df2 &lt;- data_summary(ToothGrowth, varname=&quot;len&quot;, grps = &quot;dose&quot;)</div><div class="line">df2$dose &lt;- as.factor(df2$dose)</div><div class="line">head(df2)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##   dose    len       sd</div><div class="line">## 1  0.5 10.605 4.499763</div><div class="line">## 2    1 19.735 4.415436</div><div class="line">## 3    2 26.100 3.774150</div></pre></td></tr></table></figure>
<p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(data = df2, aes(x=len, y=dose,xmin=len-sd, xmax=len+sd))</div></pre></td></tr></table></figure></p>
<p>参数xmin与xmax用来设置水平误差棒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_errorbarh()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/2KAK9FgCDF.png?imageslim" alt="mark"></p>
<p>通过映射实现分组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_errorbarh(aes(color=dose))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/G3cJmg13EI.png?imageslim" alt="mark"></p>
<h4 id="geom-linerange-与geom-pointrange"><a href="#geom-linerange-与geom-pointrange" class="headerlink" title="geom_linerange()与geom_pointrange()"></a>geom_linerange()与geom_pointrange()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f &lt;- ggplot(df2, aes(x=dose, y=len, ymin=len-sd, ymax=len+sd))</div></pre></td></tr></table></figure>
<p>line range<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_linerange()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/95BJEFgb1c.png?imageslim" alt="mark"></p>
<p>point range<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f+geom_pointrange()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/5kAAd2dhJl.png?imageslim" alt="mark"></p>
<h4 id="点图-误差棒"><a href="#点图-误差棒" class="headerlink" title="点图+误差棒"></a>点图+误差棒</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">g &lt;- ggplot(df, aes(x=dose, y=len))+</div><div class="line">  geom_dotplot(binaxis = &quot;y&quot;, stackdir = &quot;center&quot;)</div></pre></td></tr></table></figure>
<p>添加geom_crossbar()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">g+stat_summary(fun.data = mean_sdl, fun.args = list(mult=1), geom=&quot;crossbar&quot;, color=&quot;red&quot;, width=0.1)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/gb1G7K8D25.png?imageslim" alt="mark"></p>
<p>添加geom_errorbar()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">g + stat_summary(fun.data=mean_sdl, fun.args = list(mult=1), </div><div class="line">        geom=&quot;errorbar&quot;, color=&quot;red&quot;, width=0.2) +</div><div class="line">  stat_summary(fun.y=mean, geom=&quot;point&quot;, color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/HBjmlf502b.png?imageslim" alt="mark"></p>
<p>添加geom_pointrange()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">g + stat_summary(fun.data=mean_sdl, fun.args = list(mult=1), </div><div class="line">                 geom=&quot;pointrange&quot;, color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/E3K5E0cg9B.png?imageslim" alt="mark"></p>
<h3 id="两个变量：地图绘制"><a href="#两个变量：地图绘制" class="headerlink" title="两个变量：地图绘制"></a>两个变量：地图绘制</h3><p><strong>ggplot2</strong>提供了绘制地图的函数<code>geom_map()</code>，依赖于包<strong>maps</strong>提供地理信息。<br>安装<strong>map</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.paclages(&quot;maps&quot;)</div></pre></td></tr></table></figure></p>
<p>下面将绘制美国地图，数据集采用<strong>USArrests</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(maps)</div><div class="line">head(USArrests)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##            Murder Assault UrbanPop Rape</div><div class="line">## Alabama      13.2     236       58 21.2</div><div class="line">## Alaska       10.0     263       48 44.5</div><div class="line">## Arizona       8.1     294       80 31.0</div><div class="line">## Arkansas      8.8     190       50 19.5</div><div class="line">## California    9.0     276       91 40.6</div><div class="line">## Colorado      7.9     204       78 38.7</div></pre></td></tr></table></figure>
<p>对数据进行整理一下,添加一列state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">crimes &lt;- data.frame(state=tolower(rownames(USArrests)), USArrests)</div><div class="line">head(crimes)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##            Murder Assault UrbanPop Rape</div><div class="line">## Alabama      13.2     236       58 21.2</div><div class="line">## Alaska       10.0     263       48 44.5</div><div class="line">## Arizona       8.1     294       80 31.0</div><div class="line">## Arkansas      8.8     190       50 19.5</div><div class="line">## California    9.0     276       91 40.6</div><div class="line">## Colorado      7.9     204       78 38.7</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#数据重铸</div><div class="line">library(reshape2)</div><div class="line">crimesm &lt;- melt(crimes, id=1)</div><div class="line">head(crimesm)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##        state variable value</div><div class="line">## 1    alabama   Murder  13.2</div><div class="line">## 2     alaska   Murder  10.0</div><div class="line">## 3    arizona   Murder   8.1</div><div class="line">## 4   arkansas   Murder   8.8</div><div class="line">## 5 california   Murder   9.0</div><div class="line">## 6   colorado   Murder   7.9</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">map_data &lt;- map_data(&quot;state&quot;)</div><div class="line">#绘制地图，使用Murder进行着色</div><div class="line">ggplot(crimes, aes(map_id=state))+</div><div class="line">  geom_map(aes(fill=Murder), map=map_data)+</div><div class="line">  expand_limits(x=map_data$long, y=map_data$lat)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/I05fI783fH.png?imageslim" alt="mark"></p>
<h3 id="三个变量"><a href="#三个变量" class="headerlink" title="三个变量"></a>三个变量</h3><p>使用数据集<strong>mtcars</strong>，首先绘制一个相关性图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#构造数据</div><div class="line">df &lt;- mtcars[, c(1,3,4,5,6,7)]</div><div class="line">head(df)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##                    mpg disp  hp drat    wt  qsec</div><div class="line">## Mazda RX4         21.0  160 110 3.90 2.620 16.46</div><div class="line">## Mazda RX4 Wag     21.0  160 110 3.90 2.875 17.02</div><div class="line">## Datsun 710        22.8  108  93 3.85 2.320 18.61</div><div class="line">## Hornet 4 Drive    21.4  258 110 3.08 3.215 19.44</div><div class="line">## Hornet Sportabout 18.7  360 175 3.15 3.440 17.02</div><div class="line">## Valiant           18.1  225 105 2.76 3.460 20.22</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cormat &lt;- round(cor(df), 2)</div><div class="line">cormat_melt &lt;- melt(cormat)</div><div class="line">head(cormat)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##        mpg  disp    hp  drat    wt  qsec</div><div class="line">## mpg   1.00 -0.85 -0.78  0.68 -0.87  0.42</div><div class="line">## disp -0.85  1.00  0.79 -0.71  0.89 -0.43</div><div class="line">## hp   -0.78  0.79  1.00 -0.45  0.66 -0.71</div><div class="line">## drat  0.68 -0.71 -0.45  1.00 -0.71  0.09</div><div class="line">## wt   -0.87  0.89  0.66 -0.71  1.00 -0.17</div><div class="line">## qsec  0.42 -0.43 -0.71  0.09 -0.17  1.00</div></pre></td></tr></table></figure>
<p>创建图层：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">g &lt;- ggplot(cormat_melt, aes(x=Var1, y=Var2))</div></pre></td></tr></table></figure></p>
<p>在此基础上可添加的图层有：</p>
<ul>
<li>geom_tile(): 瓦片图</li>
<li>geom_raster(): 光栅图，瓦片图的一种，只不过所有的tiles都是一样的大小 </li>
</ul>
<p>现在使用使用geom_tile()绘制相关性矩阵图，我们这里这绘制下三角矩阵图，首先要整理数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#获得相关矩阵的下三角</div><div class="line">get_lower_tri &lt;- function(cormat)&#123;</div><div class="line">  cormat[upper.tri(cormat)] &lt;- NA</div><div class="line">  return(cormat)</div><div class="line">&#125;</div><div class="line">#获得相关矩阵的上三角</div><div class="line">get_upper_tri &lt;- function(cormat)&#123;</div><div class="line">  cormat[lower.tri(cormat)] &lt;- NA</div><div class="line">  return(cormat)</div><div class="line">&#125;</div><div class="line">upper_tri &lt;- get_upper_tri(cormat = cormat)</div><div class="line">head(upper_tri)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##      mpg  disp    hp  drat    wt  qsec</div><div class="line">## mpg    1 -0.85 -0.78  0.68 -0.87  0.42</div><div class="line">## disp  NA  1.00  0.79 -0.71  0.89 -0.43</div><div class="line">## hp    NA    NA  1.00 -0.45  0.66 -0.71</div><div class="line">## drat  NA    NA    NA  1.00 -0.71  0.09</div><div class="line">## wt    NA    NA    NA    NA  1.00 -0.17</div><div class="line">## qsec  NA    NA    NA    NA    NA  1.00</div></pre></td></tr></table></figure>
<p>绘制相关矩阵图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#数据重铸</div><div class="line">upper_tri_melt &lt;- melt(upper_tri, na.rm = TRUE)</div><div class="line">ggplot(data=upper_tri_melt, aes(Var1, y=Var2, fill=value))+</div><div class="line">  geom_tile(color=&quot;white&quot;)+</div><div class="line">  scale_fill_gradient2(low = &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;, midpoint = 0, limit=c(-1, 1), space = &quot;Lab&quot;, name=&quot;Person\nCorrelation&quot;)+</div><div class="line">  theme_minimal()+</div><div class="line">  theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 12, hjust = 1))+</div><div class="line">  coord_fixed()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/LL96JDbLi4.png?imageslim" alt="mark"></p>
<blockquote>
<p>上图中蓝色代表互相关，红色代表正相关，至于coord_fixed()保证x，y轴比例为1</p>
</blockquote>
<p>可以看出上图顺序有点乱，我们可以对相关矩阵进行排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#构造函数</div><div class="line">reorder_cormat &lt;- function(cormat)&#123;</div><div class="line">  dd &lt;- as.dist((1-cormat)/2)</div><div class="line">  hc &lt;- hclust(dd)</div><div class="line">  cormat &lt;- cormat[hc$order, hc$order]</div><div class="line">&#125;</div><div class="line">cormat &lt;- reorder_cormat(cormat)</div><div class="line">lower_tri &lt;- get_lower_tri(cormat)</div><div class="line">lower_tri_melt &lt;- melt(lower_tri, na.rm = TRUE)</div><div class="line">head(lower_tri_melt)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   Var1 Var2 value</div><div class="line">## 1   hp   hp  1.00</div><div class="line">## 2 disp   hp  0.79</div><div class="line">## 3   wt   hp  0.66</div><div class="line">## 4 qsec   hp -0.71</div><div class="line">## 5  mpg   hp -0.78</div><div class="line">## 6 drat   hp -0.45</div></pre></td></tr></table></figure>
<p>绘制图形<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ggheatmap &lt;- ggplot(lower_tri_melt, aes(Var1, Var2, fill=value))+</div><div class="line">  geom_tile(color=&quot;white&quot;)+</div><div class="line">  scale_fill_gradient2(low = &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;, midpoint = 0, limit=c(-1, 1), space = &quot;Lab&quot;, name=&quot;Person\nCorrelation&quot;)+</div><div class="line">  theme_minimal()+</div><div class="line"> theme(axis.text.x = element_text(angle = 45, vjust = 1, </div><div class="line">    size = 12, hjust = 1))+</div><div class="line"> coord_fixed()</div><div class="line">print(ggheatmap)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/FDdmmgjJL5.png?imageslim" alt="mark"></p>
<h3 id="图元：多边形、路径、带状、射线（线段）、矩形等"><a href="#图元：多边形、路径、带状、射线（线段）、矩形等" class="headerlink" title="图元：多边形、路径、带状、射线（线段）、矩形等"></a>图元：多边形、路径、带状、射线（线段）、矩形等</h3><p>本节主要讲述的是添加图形元件，将用到一下函数：</p>
<ul>
<li>geom_polygon()：添加多边形</li>
<li>geom_path(): 路径</li>
<li>geom_ribbon(): 带状</li>
<li>geom_segment(): 射线、线段</li>
<li>geom_curve(): 曲线</li>
<li>geom_rect(): 二维矩形</li>
</ul>
<h4 id="添加多边形"><a href="#添加多边形" class="headerlink" title="添加多边形"></a>添加多边形</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(dplyr)</div><div class="line">map_data(&quot;world&quot;)%&gt;%</div><div class="line">  filter(region==c(&quot;China&quot;, &quot;Taiwan&quot;))%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(fill=&quot;red&quot;, color=&quot;black&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/Gj3I6E4Kh6.png?imageslim" alt="mark"></p>
<h4 id="添加路径、带状、矩形"><a href="#添加路径、带状、矩形" class="headerlink" title="添加路径、带状、矩形"></a>添加路径、带状、矩形</h4><p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">h &lt;- ggplot(economics, aes(date, unemploy))</div></pre></td></tr></table></figure></p>
<p>添加路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">h+geom_path()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/hKCeGeja0m.png?imageslim" alt="mark"></p>
<p>添加带状<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">h+geom_ribbon(aes(ymin=unemploy-800, ymax=unemploy+800), fill = &quot;grey70&quot;)+geom_line(aes(y=unemploy))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/FKG84CB8f1.png?imageslim" alt="mark"></p>
<p>添加矩形<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">h+</div><div class="line">  geom_path()+</div><div class="line">  geom_rect(aes(xmin=as.Date(&quot;1980-01-01&quot;), ymin=-Inf, xmax=as.Date(&quot;1985-01-01&quot;), ymax=Inf), fill=&quot;steelblue&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/c5iBDliiKB.png?imageslim" alt="mark"></p>
<h4 id="添加线段"><a href="#添加线段" class="headerlink" title="添加线段"></a>添加线段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">i &lt;- ggplot(mtcars, aes(wt, mpg))+geom_point()</div><div class="line">#添加线段</div><div class="line">i+geom_segment(aes(x=2, y=15, xend=3, yend=15))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/lF9GiCg023.png?imageslim" alt="mark"></p>
<p>添加箭头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">i+geom_segment(aes(x=5, y=30, xend=3.5, yend=25), arrow = arrow(length = unit(0.5, &quot;cm&quot;)))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/ebGE0KdHlc.png?imageslim" alt="mark"></p>
<h4 id="添加曲线"><a href="#添加曲线" class="headerlink" title="添加曲线"></a>添加曲线</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">i+geom_curve(aes(x=2, y=15, xend=3, yend=15), color=&quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/BHJd8191Am.png?imageslim" alt="mark"></p>
<h3 id="图形参数：主标题、坐标轴标签、图例标题"><a href="#图形参数：主标题、坐标轴标签、图例标题" class="headerlink" title="图形参数：主标题、坐标轴标签、图例标题"></a>图形参数：主标题、坐标轴标签、图例标题</h3><p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)</div><div class="line">p &lt;- ggplot(ToothGrowth, aes(x=dose, y=len))+geom_boxplot()</div></pre></td></tr></table></figure></p>
<p>修改标题以及标签的函数有：</p>
<ul>
<li>ggtitle(“New main title”): 添加主标题</li>
<li>xlab(“New X axis label”): 修改x轴标签</li>
<li>ylab(“New Y axis label”): 修改y轴标签</li>
<li>labs(title = “New main title”, x = “New X axis label”, y = “New Y axis label”): 可同时添加主标题以及坐标轴标签，另外，图例标题也可以用此函数修改</li>
</ul>
<h4 id="修改主标题以及标签"><a href="#修改主标题以及标签" class="headerlink" title="修改主标题以及标签"></a>修改主标题以及标签</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(p &lt;- p+labs(title=&quot;Plot of length\nby dose&quot;, x=&quot;Dose (mg)&quot;, y=&quot;teeth length&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/h0dhdgD0H5.png?imageslim" alt="mark"></p>
<h4 id="修改标签属性：颜色、字体、大小等"><a href="#修改标签属性：颜色、字体、大小等" class="headerlink" title="修改标签属性：颜色、字体、大小等"></a>修改标签属性：颜色、字体、大小等</h4><p>使用theme()修改,element_text()可以具体修改图形参数，element_blank()隐藏标签<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#修改标签</div><div class="line">p+theme(</div><div class="line">plot.title = element_text(color = &quot;red&quot;, size = 14, face = &quot;bold.italic&quot;),</div><div class="line">axis.title.x = element_text(color=&quot;blue&quot;, size = 14, face = &quot;bold&quot;),</div><div class="line">axis.title.y = element_text(color=&quot;#993333&quot;, size = 14, face = &quot;bold&quot;)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/28K0J6j688.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#隐藏标签</div><div class="line">p+theme(</div><div class="line">  plot.title = element_blank(),</div><div class="line">  axis.title.x = element_blank(),</div><div class="line">  axis.title.y = element_blank()</div><div class="line">)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/0Fe5dGADJi.png?imageslim" alt="mark"></p>
<h4 id="修改图例标题"><a href="#修改图例标题" class="headerlink" title="修改图例标题"></a>修改图例标题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(ToothGrowth, aes(x=dose, y=len, fill=dose))+</div><div class="line">  geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/Afhm8Dbaa3.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改图例标题</div><div class="line">p+labs(fill=&quot;Dose (mg)&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/dLAe8a3a7K.png?imageslim" alt="mark"></p>
<h3 id="图例位置以及外观"><a href="#图例位置以及外观" class="headerlink" title="图例位置以及外观"></a>图例位置以及外观</h3><h4 id="修改图例位置以及外观"><a href="#修改图例位置以及外观" class="headerlink" title="修改图例位置以及外观"></a>修改图例位置以及外观</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#图例位置在最上面，有五个选项：&quot;left&quot;,&quot;top&quot;, &quot;right&quot;, &quot;bottom&quot;, &quot;none&quot;</div><div class="line">p+theme(legend.position = &quot;top&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/52gIJkL4Fj.png?imageslim" alt="mark"></p>
<p>移除图例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+theme(legend.position = &quot;none&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/akg12aak7l.png?imageslim" alt="mark"></p>
<p>修改图例标题以及标签外观<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p+theme(</div><div class="line">  legend.title = element_text(color=&quot;blue&quot;),</div><div class="line">  legend.text = element_text(color=&quot;red&quot;)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/7AgB3J5C56.png?imageslim" alt="mark"></p>
<p>修改图例背景<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+theme(legend.background = element_rect(fill=&quot;lightblue&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/jB9CJj91hj.png?imageslim" alt="mark"></p>
<h4 id="利用scale-函数自定义图例"><a href="#利用scale-函数自定义图例" class="headerlink" title="利用scale()函数自定义图例"></a>利用scale()函数自定义图例</h4><p>主要两个函数：</p>
<ul>
<li>scale_x_discrete()：修改图例标签顺序</li>
<li>scale_fill_discrete(): 修改图例标题以及标签</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改顺序</div><div class="line">p+scale_x_discrete(limits=c(&quot;2&quot;, &quot;0.5&quot;, &quot;1&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/AbFBaAl2a3.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改标题以及标签</div><div class="line">p+scale_fill_discrete(name=&quot;Dose&quot;, label=c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/AcKFcEl5j4.png?imageslim" alt="mark"></p>
<h3 id="自动-手动修改颜色"><a href="#自动-手动修改颜色" class="headerlink" title="自动/手动修改颜色"></a>自动/手动修改颜色</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mtcars$cyl &lt;- as.factor(mtcars$cyl)</div></pre></td></tr></table></figure>
<p>创建图层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># boxplot</div><div class="line">bp &lt;- ggplot(ToothGrowth, aes(x=dose, y=len))</div><div class="line"># scatter plot</div><div class="line">sp &lt;- ggplot(mtcars, aes(x=wt, y=mpg))</div></pre></td></tr></table></figure></p>
<h4 id="修改填充色、轮廓线颜色"><a href="#修改填充色、轮廓线颜色" class="headerlink" title="修改填充色、轮廓线颜色"></a>修改填充色、轮廓线颜色</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bp+geom_boxplot(fill=&quot;steelblue&quot;, color=&quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/L09ec6fJdi.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp+geom_point(color=&quot;darkblue&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/dm838FcDID.png?imageslim" alt="mark"></p>
<h4 id="通过映射分组修改颜色"><a href="#通过映射分组修改颜色" class="headerlink" title="通过映射分组修改颜色"></a>通过映射分组修改颜色</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(bp &lt;- bp+geom_boxplot(aes(fill=dose)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/39aG8c99CA.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(sp &lt;- sp+geom_point(aes(color=cyl)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/6lAKJH6FcI.png?imageslim" alt="mark"></p>
<h4 id="手动修改颜色"><a href="#手动修改颜色" class="headerlink" title="手动修改颜色"></a>手动修改颜色</h4><p>主要两个函数：</p>
<ul>
<li>scale_fill_manual(): 填充色</li>
<li>scale_color_manual()：轮廓色，如点线</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Box plot</div><div class="line">bp + scale_fill_manual(values=c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/5l8CkJeG3b.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Scatter plot</div><div class="line">sp + scale_color_manual(values=c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/mlmKH9mDm0.png?imageslim" alt="mark"></p>
<h4 id="使用RColorBrewer调色板"><a href="#使用RColorBrewer调色板" class="headerlink" title="使用RColorBrewer调色板"></a>使用<strong>RColorBrewer</strong>调色板</h4><ul>
<li>scale_fill_brewer(): 填充色</li>
<li>scale_color_brewer()：轮廓色，如点线</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Box plot</div><div class="line">bp + scale_fill_brewer(palette=&quot;Dark2&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/fdgD6lfCLK.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Scatter plot</div><div class="line">sp + scale_color_brewer(palette=&quot;Dark2&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/I4K7c25E00.png?imageslim" alt="mark"></p>
<p><strong>RColorBrewer</strong>包提供以下调色板</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170917/2mh2le2j13.png?imageslim" alt=""></p>
<p>还专门有一个灰度调色板：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Box plot</div><div class="line">bp + scale_fill_grey() + theme_classic()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/el4C3gckcd.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Scatter plot</div><div class="line">sp + scale_color_grey() + theme_classic()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/5B3cgiFbH6.png?imageslim" alt="mark"></p>
<h4 id="梯度或连续颜色"><a href="#梯度或连续颜色" class="headerlink" title="梯度或连续颜色"></a>梯度或连续颜色</h4><p>有时我们会将某个连续变量映射给颜色，这时修改这种梯度或连续型颜色就可以使用以下函数：</p>
<ul>
<li>scale_color_gradient(), scale_fill_gradient()：两种颜色的连续梯度</li>
<li>scale_color_gradient2(), scale_fill_gradient2()：不同梯度</li>
<li>scale_color_gradientn(), scale_fill_gradientn()：多种颜色梯度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Color by qsec values</div><div class="line">sp2&lt;-ggplot(mtcars, aes(x=wt, y=mpg)) +</div><div class="line">  geom_point(aes(color = qsec))</div><div class="line">sp2</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/DfKHLjH6mm.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Change the low and high colors</div><div class="line"># Sequential color scheme</div><div class="line">sp2+scale_color_gradient(low=&quot;blue&quot;, high=&quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/g4mj6HBA2d.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Diverging color scheme</div><div class="line">mid&lt;-mean(mtcars$qsec)</div><div class="line">sp2+scale_color_gradient2(midpoint=mid, low=&quot;blue&quot;, mid=&quot;white&quot;,</div><div class="line">                          high=&quot;red&quot;, space = &quot;Lab&quot; )</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/jemKdg7ai2.png?imageslim" alt="mark"></p>
<h3 id="点颜色、大小、形状"><a href="#点颜色、大小、形状" class="headerlink" title="点颜色、大小、形状"></a>点颜色、大小、形状</h3><p>R提供的点形状是由数字表示的，具体如下：</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170917/g7gjFCb420.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Basic scatter plot</div><div class="line">ggplot(mtcars, aes(x=wt, y=mpg)) +</div><div class="line">  geom_point(shape = 18, color = &quot;steelblue&quot;, size = 4)</div></pre></td></tr></table></figure>
<p>  <img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/EG65iAcdaI.png?imageslim" alt="mark"></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Change point shapes and colors by groups</div><div class="line">ggplot(mtcars, aes(x=wt, y=mpg)) +</div><div class="line">  geom_point(aes(shape = cyl, color = cyl))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/mKAb95CAk6.png?imageslim" alt="mark"></p>
<p>可通过以下方法对点的颜色、大小、形状进行修改：</p>
<ul>
<li>scale_shape_manual() : to change point shapes</li>
<li>scale_color_manual() : to change point colors</li>
<li>scale_size_manual() : to change the size of points</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Change colors and shapes manually</div><div class="line">ggplot(mtcars, aes(x=wt, y=mpg, group=cyl)) +</div><div class="line">  geom_point(aes(shape=cyl, color=cyl), size=2)+</div><div class="line">  scale_shape_manual(values=c(3, 16, 17))+</div><div class="line">  scale_color_manual(values=c(&apos;#999999&apos;,&apos;#E69F00&apos;, &apos;#56B4E9&apos;))+</div><div class="line">  theme(legend.position=&quot;top&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/Cj4aedai9j.png?imageslim" alt="mark"></p>
<h3 id="文本注释-1"><a href="#文本注释-1" class="headerlink" title="文本注释"></a>文本注释</h3><p>对图形进行文本注释有以下方法：</p>
<ul>
<li>geom_text(): 文本注释</li>
<li>geom_label(): 文本注释,类似于geom_text(),只是多了个背景框</li>
<li>annotate(): 文本注释</li>
<li>annotation_custom(): 分面时可以在所有的面板进行文本注释</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set.seed(1234)</div><div class="line">df &lt;- mtcars[sample(1:nrow(mtcars), 10), ]</div><div class="line">df$cyl &lt;- as.factor(df$cyl)</div></pre></td></tr></table></figure>
<p>散点图注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Scatter plot</div><div class="line">sp &lt;- ggplot(df, aes(x=wt, y=mpg))+ geom_point() </div><div class="line"># Add text, change colors by groups</div><div class="line">sp + geom_text(aes(label = rownames(df), color = cyl),</div><div class="line">               size = 3, vjust = -1)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/0EAk2aFEJG.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Add text at a particular coordinate</div><div class="line">sp + geom_text(x = 3, y = 30, label = &quot;Scatter plot&quot;,</div><div class="line">              color=&quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/8A620eJKDl.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># geom_label()进行注释</div><div class="line">sp + geom_label(aes(label=rownames(df)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/D6ick1LI9i.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># annotation_custom(),需要用到textGrob()</div><div class="line">library(grid)</div><div class="line"># Create a text</div><div class="line">grob &lt;- grobTree(textGrob(&quot;Scatter plot&quot;, x=0.1,  y=0.95, hjust=0,</div><div class="line">  gp=gpar(col=&quot;red&quot;, fontsize=13, fontface=&quot;italic&quot;)))</div><div class="line"># Plot</div><div class="line">sp + annotation_custom(grob)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/80EK39ebBA.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#分面注释</div><div class="line">sp + annotation_custom(grob)+facet_wrap(~cyl, scales=&quot;free&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/cdfK8keKee.png?imageslim" alt="mark"></p>
<h3 id="线型"><a href="#线型" class="headerlink" title="线型"></a>线型</h3><p>R里的线型有七种：“blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, “twodash”，对应数字0，1，2，3，4，5，6.</p>
<p>具体如下：</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170917/2gAL9gilee.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Create some data</div><div class="line">df2 &lt;- data.frame(sex = rep(c(&quot;Female&quot;, &quot;Male&quot;), each=3),</div><div class="line">                  time=c(&quot;breakfeast&quot;, &quot;Lunch&quot;, &quot;Dinner&quot;),</div><div class="line">                  bill=c(10, 30, 15, 13, 40, 17) )</div><div class="line">head(df2)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##      sex       time bill</div><div class="line">## 1 Female breakfeast   10</div><div class="line">## 2 Female      Lunch   30</div><div class="line">## 3 Female     Dinner   15</div><div class="line">## 4   Male breakfeast   13</div><div class="line">## 5   Male      Lunch   40</div><div class="line">## 6   Male     Dinner   17</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Line plot with multiple groups</div><div class="line"># Change line types and colors by groups (sex)</div><div class="line">ggplot(df2, aes(x=time, y=bill, group=sex)) +</div><div class="line">  geom_line(aes(linetype = sex, color = sex))+</div><div class="line">  geom_point(aes(color=sex))+</div><div class="line">  theme(legend.position=&quot;top&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/leH2fj5jf7.png?imageslim" alt="mark"></p>
<p>同点一样，线也可以类似修改：</p>
<ul>
<li>scale_linetype_manual() : to change line types</li>
<li>scale_color_manual() : to change line colors</li>
<li>scale_size_manual() : to change the size of lines</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Change line types, colors and sizes</div><div class="line">ggplot(df2, aes(x=time, y=bill, group=sex)) +</div><div class="line">  geom_line(aes(linetype=sex, color=sex, size=sex))+</div><div class="line">  geom_point()+</div><div class="line">  scale_linetype_manual(values=c(&quot;twodash&quot;, &quot;dotted&quot;))+</div><div class="line">  scale_color_manual(values=c(&apos;#999999&apos;,&apos;#E69F00&apos;))+</div><div class="line">  scale_size_manual(values=c(1, 1.5))+</div><div class="line">  theme(legend.position=&quot;top&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/j9EajEBa9b.png?imageslim" alt="mark"></p>
<h3 id="主题与背景颜色"><a href="#主题与背景颜色" class="headerlink" title="主题与背景颜色"></a>主题与背景颜色</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Convert the column dose from numeric to factor variable</div><div class="line">ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)</div></pre></td></tr></table></figure>
<p>创建箱线图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(ToothGrowth, aes(x=dose, y=len))+</div><div class="line">  geom_boxplot()</div></pre></td></tr></table></figure></p>
<p>修改主题<br><strong>ggplot2</strong>提供了好几种主题，另外有一个扩展包<strong>ggthemes</strong>专门提供了一主题，可以安装利用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;ggthemes&quot;)</div></pre></td></tr></table></figure></p>
<ul>
<li>theme_gray(): gray background color and white grid lines</li>
<li>theme_bw() : white background and gray grid lines</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+theme_gray(base_size = 14)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/hj1eIbED8J.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+theme_bw()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/DIL3A3j3H0.png?imageslim" alt="mark"></p>
<ul>
<li>theme_linedraw : black lines around the plot</li>
<li>theme_light : light gray lines and axis (more attention towards the data)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme_linedraw()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/dllCEkgbJd.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme_light()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/HIE1djID57.png?imageslim" alt="mark"></p>
<ul>
<li>theme_minimal: no background annotations</li>
<li>theme_classic : theme with axis lines and no grid lines</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme_minimal()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/DldJFIi1jG.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme_classic()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/kdb786kHb6.png?imageslim" alt="mark"></p>
<p><strong>ggthemes</strong>提供的主题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+ggthemes::theme_economist()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/mhE0cglig4.png?imageslim" alt="mark"></p>
<h4 id="坐标轴：最大最小值"><a href="#坐标轴：最大最小值" class="headerlink" title="坐标轴：最大最小值"></a>坐标轴：最大最小值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(cars, aes(x=speed, y=dist))+geom_point()</div></pre></td></tr></table></figure>
<p>修改坐标轴范围有以下几种方式：<br>1、不删除数据</p>
<ul>
<li>p+coord_cartesian(xlim=c(5, 20), ylim=c(0, 50)):笛卡尔坐标系，这是设定修改不会删除数据</li>
</ul>
<p>2、会删除部分数据：不在此范围内的数据都会被删除,因此在此基础上添加图层时数据是不完整的</p>
<ul>
<li>p+xlim(5, 20)+ylim(0, 50)</li>
<li>p+scale_x_continuous(limits=c(5, 20))+scale_y_continuous(limits=c(0, 50))</li>
</ul>
<p>3、扩展图形范围：expand()函数，扩大范围</p>
<ul>
<li>p+expand_limits(x=0, y=0):设置截距为0，即过原点</li>
<li>p+expand_limits(x=c(5, 50), y=c(0, 150))：扩大坐标轴范围，这样图形显示就小了</li>
</ul>
<p>下面通过图形演示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/45E5EkIbmH.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#通过coord_cartesian()函数修改坐标轴范围</div><div class="line">p+coord_cartesian(xlim =c (5, 20), ylim = c(0, 50))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/cbia8kk48E.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#通过xlim()和ylim()函数修改</div><div class="line">p+xlim(5, 20)+ylim(0, 50)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/cbia8kk48E.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#expand limits</div><div class="line">p+expand_limits(x=c(5, 50), y=c(0, 150))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/m44Dlla2Cl.png?imageslim" alt="mark"></p>
<h4 id="坐标变换"><a href="#坐标变换" class="headerlink" title="坐标变换"></a>坐标变换</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(cars, aes(x=speed, y=dist))+geom_point()</div></pre></td></tr></table></figure>
<p>坐标变换有以下几种：</p>
<ul>
<li>p+scale_x_log10(),p+scale_y_log10(): 绘图时对x，y取10的对数</li>
<li>p+scale_x_sqrt(),p+scale_x_sqrt(): 开根号</li>
<li>p+scale_x_reverse(),p+scale_x_reverse()：坐标轴反向</li>
<li>p+coord_trans(x =“log10”, y=“log10”): 同上，可以对坐标轴取对数、根号等</li>
<li>p+scale_x_continuous(trans=”log2”),p+scale_x_continuous(trans=”log2”): 同上，取对数的另外一种方法</li>
</ul>
<p>下面实例演示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/90aD77ldKb.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p+scale_x_continuous(trans = &quot;log2&quot;)+</div><div class="line">  scale_y_continuous(trans = &quot;log2&quot;)</div></pre></td></tr></table></figure>
<p>  <img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/mI8LDhgJE9.png?imageslim" alt="mark"></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#修改坐标刻度标签</div><div class="line">require(scales)</div><div class="line">p+scale_y_continuous(trans=log2_trans(),</div><div class="line">                     breaks = trans_breaks(&quot;log2&quot;, function(x) 2^x),</div><div class="line">                     labels=trans_format(&quot;log2&quot;, math_format(2^.x)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/F94egDhaID.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#坐标轴反向</div><div class="line">p+scale_y_reverse()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/L68AbbdeH9.png?imageslim" alt="mark"></p>
<h4 id="坐标刻度：刻度线、标签、顺序等"><a href="#坐标刻度：刻度线、标签、顺序等" class="headerlink" title="坐标刻度：刻度线、标签、顺序等"></a>坐标刻度：刻度线、标签、顺序等</h4><p>更改坐标轴刻度线标签等函数：</p>
<ul>
<li>element_text(face, color, size, angle): 修改文本风格</li>
<li>element_blank(): 隐藏文本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(p &lt;- ggplot(ToothGrowth, aes(x=dose, y=len))+geom_boxplot())</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/22F52FHA0H.png?imageslim" alt="mark"></p>
<p>修改刻度标签等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p+theme(axis.text.x = element_text(face = &quot;bold&quot;, color=&quot;#993333&quot;, size=14, angle = 45),</div><div class="line">        axis.text.y = element_text(face = &quot;bold&quot;, size = 14, color = &quot;blue&quot;, angle = 45))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/7k09a4DhDb.png?imageslim" alt="mark"></p>
<p>移除刻度标签等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p + theme(</div><div class="line">  axis.text.x = element_blank(), # Remove x axis tick labels</div><div class="line">  axis.text.y = element_blank(), # Remove y axis tick labels</div><div class="line">  axis.ticks = element_blank()) # Remove ticks</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/lmmg7BEa1m.png?imageslim" alt="mark"></p>
<p>当然可以自定义坐标轴了</p>
<ul>
<li><p>离散非连续坐标轴</p>
<ul>
<li>scale_x_discrete(name, breaks, labels, limits)</li>
<li>scale_y_discrete(name, breaks, labels, limits)</li>
</ul>
</li>
<li><p>连续型坐标轴</p>
<ul>
<li>scale_x_conyinuous(name, breaks, labels, limits)</li>
<li>scale_y_continuous(name, breaks, labels, limits)</li>
</ul>
</li>
</ul>
<p>详细情况如下：</p>
<ul>
<li>name: x,y轴的标题</li>
<li>breaks: 刻度，分成几段</li>
<li>labels：坐标轴刻度线标签</li>
<li>limits: 坐标轴范围</li>
</ul>
<p>其中scale_xx()函数可以修改坐标轴的如下参数：</p>
<ul>
<li>坐标轴标题</li>
<li>坐标轴范围</li>
<li>刻度标签位置</li>
<li>手动设置刻度标签</li>
</ul>
<p>具体演示：</p>
<ul>
<li>离散坐标轴</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改标签以及顺序</div><div class="line">p+scale_x_discrete(name=&quot;Dose (mg)&quot;, limits=c(&quot;2&quot;, &quot;1&quot;, &quot;0.5&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/EFbiHLHg4H.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改刻度标签</div><div class="line">p+scale_x_discrete(breaks=c(&quot;0.5&quot;, &quot;1&quot;, &quot;2&quot;),labels=c(&quot;Dose 0.5&quot;, &quot;Dose 1&quot;, &quot;Dose 2&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/7b8a55d8e6.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#修改要显示的项</div><div class="line">p+scale_x_discrete(limits=c(&quot;0.5&quot;, &quot;2&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/KEBgH9eL6A.png?imageslim" alt="mark"></p>
<ul>
<li>连续型坐标轴<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#散点图</div><div class="line">(sp &lt;- ggplot(cars, aes(x=speed, y=dist))+geom_point())</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/6mAgGel8FI.png?imageslim" alt="mark"></p>
<p>修改坐标轴标签以及范围<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(sp &lt;- sp+scale_x_continuous(name = &quot;Speed of cars&quot;, limits = c(0, 30))+</div><div class="line">  scale_y_continuous(name = &quot;Stopping distance&quot;, limits = c(0, 150)))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/1Gfa1ki6jd.png?imageslim" alt="mark"></p>
<p>更改y轴刻度，间隔50<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp+scale_y_continuous(breaks = seq(0, 150, 50))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/67LdJdeHJJ.png?imageslim" alt="mark"></p>
<p>修改y轴标签为百分数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require(scales)</div><div class="line">sp+scale_y_continuous(labels = percent)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/lKBLj42Fmb.png?imageslim" alt="mark"></p>
<h3 id="添加直线：水平线、竖直线、回归线"><a href="#添加直线：水平线、竖直线、回归线" class="headerlink" title="添加直线：水平线、竖直线、回归线"></a>添加直线：水平线、竖直线、回归线</h3><p><strong>ggplot2</strong>提供以下方法为图形添加直线：</p>
<ul>
<li>geom_hline(yintercept, linetype, color, size): 添加水平线</li>
<li>geom_vline(xintercept, linetype, color, size)：添加竖直线</li>
<li>geom_abline(intercept, slope, linetype, color, size)：添加回归线</li>
<li>geom_segment()：添加线段</li>
</ul>
<p>实例演示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(data=mtcars, aes(x=wt, y=mpg))+ geom_point()</div></pre></td></tr></table></figure></p>
<p>添加直线：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#在y=20处添加一水平线，并设置颜色等</div><div class="line">sp+geom_hline(yintercept = 20, linetype=&quot;dashed&quot;, color=&apos;red&apos;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/klELKdJ7h2.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#在x=3处添加一竖直线，并设置颜色等</div><div class="line">sp+geom_vline(xintercept = 3, color=&quot;blue&quot;, size=1.5)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/5cIFlhkK0E.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#添加回归线</div><div class="line">sp+geom_abline(intercept = 37, slope = -5, color=&quot;blue&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/Jci00jI819.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#添加水平线段</div><div class="line">sp+geom_segment(aes(x=2, y=15, xend=3, yend=15), color=&quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/1gAEcm93JF.png?imageslim" alt="mark"></p>
<h3 id="图形旋转：旋转、反向"><a href="#图形旋转：旋转、反向" class="headerlink" title="图形旋转：旋转、反向"></a>图形旋转：旋转、反向</h3><p>主要是下面两个函数：</p>
<ul>
<li>coord_flip()：创建水平方向图</li>
<li>scale_x_reverse(),scale_y_reverse()：坐标轴反向</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set.seed(1234)</div><div class="line">(hp &lt;- qplot(x=rnorm(200), geom = &quot;histogram&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/CgC7HHLid5.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#水平柱形图</div><div class="line">hp+coord_flip()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/hD4HaiCDJI.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#y轴反向</div><div class="line">hp+scale_y_reverse()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/HCFl1ha75C.png?imageslim" alt="mark"></p>
<h3 id="分面"><a href="#分面" class="headerlink" title="分面"></a>分面</h3><p>分面就是根据一个或多个变量将图形分为几个图形以便于可视化，主要有两个方法实现：</p>
<ul>
<li>facet_grid()</li>
<li>facet_wrap()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)</div><div class="line">(p &lt;- ggplot(ToothGrowth, aes(x=dose, y=len, group=dose))+</div><div class="line">  geom_boxplot(aes(fill=dose)))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/3AfigK2AIl.png?imageslim" alt="mark"></p>
<p>针对上面图形进行分面：</p>
<ul>
<li>p+facet_grid(supp~.): 按变量supp进行竖直方向分面</li>
<li>p+facet_grid(.~supp): 按变量supp进行水平方向分面</li>
<li>p+facet_wrap(dose~supp)：按双变量supp和dose进行水平竖直方向分面</li>
<li>p+facet_wrap(~fl): 将分成的面板边靠边置于一个矩形框内</li>
</ul>
<p>1、按一个离散变量进行分面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#竖直方向进行分面</div><div class="line">p+facet_grid(supp~.)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/e5hdDE7FE0.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#水平方向分面</div><div class="line">p+facet_grid(.~supp)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/F3BgFeHc3C.png?imageslim" alt="mark"></p>
<p>2、按两个离散变量进行分面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#行按dose分面，列按supp分面</div><div class="line">p+facet_grid(dose~supp)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/9112kbBA9g.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#行按supp，列按dose分面</div><div class="line">p+facet_grid(supp~dose)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/bjm9fk0k79.png?imageslim" alt="mark"></p>
<p>从上面图形可以看出，每个面板的坐标轴比例都是一样的，我们可以通过设置参数scales来控制坐标轴比例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_grid(dose ~ supp, scales=&apos;free&apos;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/65F4K0ajaI.png?imageslim" alt="mark"></p>
<h3 id="位置调整"><a href="#位置调整" class="headerlink" title="位置调整"></a>位置调整</h3><p>很多图形需要我们调整位置，比如直方图时，由堆叠式、百分式、分离式等，具体的要通过实例说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg, aes(fl, fill=drv))</div><div class="line">#直方图边靠边排列，参数position=&quot;dodge&quot;</div><div class="line">p+geom_bar(position = &quot;dodge&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/13Cf1kA3Jc.png?imageslim" alt="mark"></p>
<p>堆叠式position=”stack”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+geom_bar(position = &quot;stack&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/J2bH42IjHA.png?imageslim" alt="mark"></p>
<p>position=”fill”类似玉堆叠图，只不过按百分比排列，所有柱子都被标准化成同样高度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+geom_bar(position = &quot;fill&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/1iblgciCm8.png?imageslim" alt="mark"></p>
<p>position=”jitter”,（主要适用于散点图）增加扰动，避免重叠，前面讲的geom_jitter()就是来源于此<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg, aes(cty, hwy))+</div><div class="line">  geom_point(position = &quot;jitter&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/01D9L4A8Ld.png?imageslim" alt="mark"></p>
<p>上面几个函数有两个重要的参数：heigth、weight。</p>
<ul>
<li>position_dodge(width, height)</li>
<li>position_fill(width, height)</li>
<li>position_stack(width, height)</li>
<li>position_jitter(width, height)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+geom_bar(position = position_dodge(width = 1))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/DaHcfl9dId.png?imageslim" alt="mark"></p>
<h3 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg, aes(fl))+geom_bar()</div></pre></td></tr></table></figure>
<p><strong>ggplot2</strong>中的坐标系主要有：</p>
<ul>
<li>p+coord_cartesian(xlim=NULL, ylim=NULL)：笛卡尔坐标系(默认)</li>
<li>p+coord_fixed(ratio=1, clim=NULL, ylim=NULL)：固定了坐标轴比例的笛卡尔坐标系。默认比例为1</li>
<li>p+coord_flip(…)：旋转笛卡尔坐标系</li>
<li>p+coord_polar(theta=”x”, start=0, direction=1)：极坐标系</li>
<li>p+coord_trans(x,y,limx,limy)：变换笛卡尔坐标系</li>
<li>coord_map()：地图坐标系</li>
</ul>
<p>各个坐标系参数如下：<br>1、笛卡尔坐标系：coord_cartesian(), coord_fixed() and coord_flip()</p>
<ul>
<li>xlim：x轴范围</li>
<li>ylim：y轴范围</li>
<li>ratio：y/x</li>
<li>…：其他参数</li>
</ul>
<p>2、极坐标系：coord_polar()</p>
<ul>
<li>theta：外延坐标，x或y</li>
<li>start：坐标开始的位置，默认为12点钟</li>
<li>direction：方向：顺时针(1),逆时针(-1)</li>
</ul>
<p>3、变换坐标系：coord_trans()</p>
<ul>
<li>x,y：变换的坐标轴</li>
<li>limx,limy：坐标轴范围</li>
</ul>
<p>实例演示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+coord_cartesian(ylim = c(0,200))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/KE5JcFmdhl.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+coord_fixed(ratio = 1/50)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/LHeG17JljH.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+coord_flip()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/8AK62ii9Ib.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+coord_polar(theta = &quot;x&quot;, direction = 1)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/HBF135cLAA.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+coord_trans(y=&quot;sqrt&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/DhI4Ha1m91.png?imageslim" alt="mark"></p>
<h2 id="ggplot2包资料扩展：包、函数"><a href="#ggplot2包资料扩展：包、函数" class="headerlink" title="ggplot2包资料扩展：包、函数"></a><strong>ggplot2</strong>包资料扩展：包、函数</h2><ul>
<li><strong>ggplot2</strong>有一个官方网站，里面有十分详细的说明，<a href="http://ggplot2.tidyverse.org/reference/" target="_blank" rel="external">点击这里直达</a></li>
<li><strong>ggplot2</strong>还有十分多的扩展包，<a href="https://www.ggplot2-exts.org/" target="_blank" rel="external">点击这里直达</a></li>
</ul>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line"></div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.3 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0</div><div class="line">## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">##  [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C              </div><div class="line">##  [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8    </div><div class="line">##  [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8   </div><div class="line">##  [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C                 </div><div class="line">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </div><div class="line">## [11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C       </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] grid      stats     graphics  grDevices utils     datasets  methods  </div><div class="line">## [8] base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] scales_0.5.0   bindrcpp_0.2   dplyr_0.7.3    reshape2_1.4.2</div><div class="line">## [5] maps_3.2.0     hexbin_1.27.1  plyr_1.8.4     ggplot2_2.2.1 </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12        bindr_0.1           compiler_3.4.1     </div><div class="line">##  [4] RColorBrewer_1.1-2  base64enc_0.1-3     tools_3.4.1        </div><div class="line">##  [7] rpart_4.1-11        digest_0.6.12       checkmate_1.8.3    </div><div class="line">## [10] htmlTable_1.9       evaluate_0.10.1     tibble_1.3.4       </div><div class="line">## [13] gtable_0.2.0        lattice_0.20-35     pkgconfig_2.0.1    </div><div class="line">## [16] rlang_0.1.2         Matrix_1.2-11       yaml_2.1.14        </div><div class="line">## [19] gridExtra_2.3       stringr_1.2.0       knitr_1.17         </div><div class="line">## [22] cluster_2.0.6       htmlwidgets_0.9     rprojroot_1.2      </div><div class="line">## [25] nnet_7.3-12         glue_1.1.1          data.table_1.10.4  </div><div class="line">## [28] R6_2.2.2            survival_2.41-3     foreign_0.8-69     </div><div class="line">## [31] rmarkdown_1.6       latticeExtra_0.6-28 Formula_1.2-2      </div><div class="line">## [34] magrittr_1.5        ggthemes_3.4.0      backports_1.1.0    </div><div class="line">## [37] Hmisc_4.0-3         htmltools_0.3.6     MASS_7.3-47        </div><div class="line">## [40] splines_3.4.1       assertthat_0.2.0    colorspace_1.3-2   </div><div class="line">## [43] labeling_0.3        stringi_1.1.5       acepack_1.4.1      </div><div class="line">## [46] lazyeval_0.2.0      munsell_0.4.3</div></pre></td></tr></table></figure>
<hr>
<p>联系方式：</p>
<hr>
<p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<p>个人简介：</p>
<hr>
<p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170919/emJBf4A306.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;本文内容基本是来源于&lt;a href=&quot;http://www.sthda.com/english/wiki/be-awesome-in-ggplot2-a-practical-guide-to-be-highly-effective-r-software-and-data-visualization&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;STHDA&lt;/a&gt;，这是一份十分详细的&lt;strong&gt;ggplot2&lt;/strong&gt;使用指南，因此我将其翻译成中文，一是有助于我自己学习理解，另外其他R语言爱好者或者可视化爱好者可以用来学习。翻译过程肯定不能十全十美，各位读者有建议或改进的话，十分欢迎发&lt;strong&gt;Email&lt;/strong&gt;(tyan@zju.edu.cn)给我。&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggplot2" scheme="https://ytlogos.github.io/tags/ggplot2/"/>
    
  </entry>
  
  <entry>
    <title>README</title>
    <link href="https://ytlogos.github.io/2017/09/19/README-MDOWN/"/>
    <id>https://ytlogos.github.io/2017/09/19/README-MDOWN/</id>
    <published>2017-09-19T00:39:01.459Z</published>
    <updated>2017-09-19T00:39:01.462Z</updated>
    
    <content type="html"><![CDATA[<p>本博客主要是用来记载我的日常学习笔记，以便于自己学习以及与他人交流</p>
<p>有兴趣的可转至我的博客：<a href="https://ytlogos.github.io/">logos</a></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本博客主要是用来记载我的日常学习笔记，以便于自己学习以及与他人交流&lt;/p&gt;
&lt;p&gt;有兴趣的可转至我的博客：&lt;a href=&quot;https://ytlogos.github.io/&quot;&gt;logos&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;联系方式：&quot;&gt;&lt;a href=&quot;#联系方
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>tidyverse实践之绘制简单地图</title>
    <link href="https://ytlogos.github.io/2017/09/16/tidyverse%E5%AE%9E%E8%B7%B5%E4%B9%8B%E7%BB%98%E5%88%B6%E7%AE%80%E5%8D%95%E5%9C%B0%E5%9B%BE/"/>
    <id>https://ytlogos.github.io/2017/09/16/tidyverse实践之绘制简单地图/</id>
    <published>2017-09-16T02:47:05.000Z</published>
    <updated>2017-09-19T04:09:48.799Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/Big70i5b36.jpeg?imageslim" alt=""></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>tidyverse</strong>是一个数据科学的综合包，里面包含了数据分析一系列流程涉及的包，今天主要利用它绘制地图。这并不是它的强项，绘制地图<strong>leaflet</strong>才是利器，本文只是<strong>tidyverse</strong>的一个小练习。<br>目前该包支持有限的几个国家，比如美国，新西兰、意大利等，当然世界地图是支持的。</p>
<a id="more"></a>
<h2 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">library(tidyverse)</div><div class="line">map_data(&quot;usa&quot;)%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/i32kBBc1DA.png?imageslim" alt=""></p>
<p>可以绘制美国的不同州，就行我国的省份一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;state&quot;)%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(color=&quot;white&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/5haC8L95Fd.png?imageslim" alt=""></p>
<p>另外我们可以只单独绘制几个state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;state&quot;)%&gt;%</div><div class="line">  filter(region%in%c(&quot;california&quot;,&quot;nevada&quot;,&quot;oregon&quot;,&quot;washington&quot;))%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/md9HG40mi8.png?imageslim" alt=""></p>
<p>再绘制细一点的地图，相当于市、县等<br><figure class="highlight plain"><figcaption><span>fig.height=6, fig.width=4&#125;</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;county&quot;)%&gt;%</div><div class="line">  filter(region %in% c(&quot;california&quot;,&quot;nevada&quot;,&quot;oregon&quot;,&quot;washington&quot;))%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(color=&quot;white&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/iEIjLcgIaK.png?imageslim" alt=""></p>
<h2 id="世界地图"><a href="#世界地图" class="headerlink" title="世界地图"></a>世界地图</h2><p>很简单，只需将map_data()里的usa换成world就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;world&quot;)%&gt;%ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(color=&quot;white&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/cK0LAl2cmd.png?imageslim" alt=""></p>
<p>在世界地图中标出中国<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;world&quot;)%&gt;%</div><div class="line">  filter(region==&quot;China&quot;)%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(fill=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/f0f3fBgG7F.png?imageslim" alt=""></p>
<p>美帝用心险恶，不承认台湾属于中国,自己添上去就是了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">map_data(&quot;world&quot;)%&gt;%</div><div class="line">  filter(region==c(&quot;China&quot;,&quot;Taiwan&quot;))%&gt;%</div><div class="line">  ggplot(aes(x=long, y=lat, group=group))+</div><div class="line">  geom_polygon(fill=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/BDd5BLBmaa.png?imageslim" alt=""></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 10 x64 (build 15063)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C                              </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">##  [1] bindrcpp_0.2         maps_3.2.0           dplyr_0.7.2         </div><div class="line">##  [4] purrr_0.2.3          readr_1.1.1          tidyr_0.7.1         </div><div class="line">##  [7] tibble_1.3.4         ggplot2_2.2.1        tidyverse_1.1.1     </div><div class="line">## [10] RevoUtilsMath_10.0.0</div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12     cellranger_1.1.0 compiler_3.4.1   plyr_1.8.4      </div><div class="line">##  [5] bindr_0.1        forcats_0.2.0    tools_3.4.1      digest_0.6.12   </div><div class="line">##  [9] lubridate_1.6.0  jsonlite_1.5     evaluate_0.10.1  nlme_3.1-131    </div><div class="line">## [13] gtable_0.2.0     lattice_0.20-35  pkgconfig_2.0.1  rlang_0.1.2     </div><div class="line">## [17] psych_1.7.8      yaml_2.1.14      parallel_3.4.1   haven_1.1.0     </div><div class="line">## [21] xml2_1.1.1       httr_1.3.1       stringr_1.2.0    knitr_1.17      </div><div class="line">## [25] hms_0.3          RevoUtils_10.0.5 rprojroot_1.2    grid_3.4.1      </div><div class="line">## [29] glue_1.1.1       R6_2.2.2         readxl_1.0.0     foreign_0.8-69  </div><div class="line">## [33] rmarkdown_1.6    modelr_0.1.1     reshape2_1.4.2   magrittr_1.5    </div><div class="line">## [37] backports_1.1.0  scales_0.5.0     htmltools_0.3.6  rvest_0.3.2     </div><div class="line">## [41] assertthat_0.2.0 mnormt_1.5-5     colorspace_1.3-2 labeling_0.3    </div><div class="line">## [45] stringi_1.1.5    lazyeval_0.2.0   munsell_0.4.3    broom_0.4.2</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170916/Big70i5b36.jpeg?imageslim&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;tidyverse&lt;/strong&gt;是一个数据科学的综合包，里面包含了数据分析一系列流程涉及的包，今天主要利用它绘制地图。这并不是它的强项，绘制地图&lt;strong&gt;leaflet&lt;/strong&gt;才是利器，本文只是&lt;strong&gt;tidyverse&lt;/strong&gt;的一个小练习。&lt;br&gt;目前该包支持有限的几个国家，比如美国，新西兰、意大利等，当然世界地图是支持的。&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="tidyverse" scheme="https://ytlogos.github.io/tags/tidyverse/"/>
    
      <category term="map" scheme="https://ytlogos.github.io/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>创建及自定义ggplot分面图形参数</title>
    <link href="https://ytlogos.github.io/2017/09/14/%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89ggplot%E5%88%86%E9%9D%A2%E5%9B%BE%E5%BD%A2%E5%8F%82%E6%95%B0/"/>
    <id>https://ytlogos.github.io/2017/09/14/创建及自定义ggplot分面图形参数/</id>
    <published>2017-09-13T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.453Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://os3hnmzbp.bkt.clouddn.com/5.png" alt=""></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>ggplot2</strong>有一个十分重要的功能就是分面，而今天要讲得R包<strong>ggpubr</strong>中也有一个函数facet()专门用来进行分面操作。</p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;ggpubr&quot;)</div><div class="line">#or</div><div class="line">if(!require(devtools)) install.packages(&quot;devtools&quot;)</div><div class="line">devtools::install_github(&quot;kassambara/ggpubr&quot;)</div></pre></td></tr></table></figure>
<h2 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">library(ggpubr)</div><div class="line">df &lt;- ToothGrowth</div><div class="line">df$dose &lt;- as.factor(df$dose)</div><div class="line">head(df)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##    len supp dose</div><div class="line">## 1  4.2   VC  0.5</div><div class="line">## 2 11.5   VC  0.5</div><div class="line">## 3  7.3   VC  0.5</div><div class="line">## 4  5.8   VC  0.5</div><div class="line">## 5  6.4   VC  0.5</div><div class="line">## 6 10.0   VC  0.5</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggdensity(df, x=&quot;len&quot;, fill = &quot;dose&quot;, palette = &quot;jco&quot;, ggtheme = theme_light(), legend=&quot;top&quot;)</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://os3hnmzbp.bkt.clouddn.com/1.png" alt=""></p>
<h2 id="分面"><a href="#分面" class="headerlink" title="分面"></a>分面</h2><h3 id="水平方向分面"><a href="#水平方向分面" class="headerlink" title="水平方向分面"></a>水平方向分面</h3><p>按照变量<code>supp</code>进行水平方向的分面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">facet(p, facet.by = &quot;supp&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://os3hnmzbp.bkt.clouddn.com/2.png" alt=""></p>
<h3 id="竖直方向分面"><a href="#竖直方向分面" class="headerlink" title="竖直方向分面"></a>竖直方向分面</h3><p>按照变量<code>supp</code>进行竖直方向的分面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">facet(p, facet.by = &quot;supp&quot;, ncol = 1)</div></pre></td></tr></table></figure></p>
<p><img src="http://os3hnmzbp.bkt.clouddn.com/3.png" alt=""></p>
<h3 id="双变量分面"><a href="#双变量分面" class="headerlink" title="双变量分面"></a>双变量分面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#divide with &quot;supp&quot; vertical, &quot;dose&quot; horizontal</div><div class="line">facet(p, facet.by = c(&quot;supp&quot;, &quot;dose&quot;), short.panel.labs = FALSE)</div></pre></td></tr></table></figure>
<p><img src="http://os3hnmzbp.bkt.clouddn.com/4.png" alt=""></p>
<h2 id="修改面板外观"><a href="#修改面板外观" class="headerlink" title="修改面板外观"></a>修改面板外观</h2><p>主要有以下参数进行修改：</p>
<ul>
<li>short.panel.label:默认为TRUE，此时变量名不会显示</li>
<li>panel.label: 通过自定义label来设置面板label,是一个list</li>
<li>panel.labs.background: 控制面板背景，里面参数设置很多</li>
<li>panel.labs.font: 设置字体</li>
</ul>
<p>下面演示一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#divide with &quot;supp&quot; vertical, &quot;sode&quot; horizontal</div><div class="line">facet(p, facet.by = c(&quot;supp&quot;, &quot;dose&quot;),</div><div class="line">      panel.labs = list(</div><div class="line">        supp=c(&quot;Orange Juice&quot;, &quot;Vitamin C&quot;),</div><div class="line">        dose=c(&quot;D0.5&quot;, &quot;D1&quot;, &quot;D2&quot;)),</div><div class="line">      panel.labs.background = list(</div><div class="line">        color=&quot;steelblue&quot;, </div><div class="line">        fill=&quot;steelblue&quot;,</div><div class="line">        size=0.5),</div><div class="line">      panel.labs.font = list(color=&quot;white&quot;),</div><div class="line">      panel.labs.font.x = list(angle=45, color=&quot;white&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://os3hnmzbp.bkt.clouddn.com/5.png" alt=""></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.3 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0</div><div class="line">## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">##  [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C              </div><div class="line">##  [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8    </div><div class="line">##  [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8   </div><div class="line">##  [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C                 </div><div class="line">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </div><div class="line">## [11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C       </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] ggpubr_0.1.5  magrittr_1.5  ggplot2_2.2.1</div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12     bindr_0.1        knitr_1.17       munsell_0.4.3   </div><div class="line">##  [5] colorspace_1.3-2 R6_2.2.2         rlang_0.1.2      stringr_1.2.0   </div><div class="line">##  [9] plyr_1.8.4       dplyr_0.7.3      tools_3.4.1      grid_3.4.1      </div><div class="line">## [13] gtable_0.2.0     htmltools_0.3.6  yaml_2.1.14      lazyeval_0.2.0  </div><div class="line">## [17] rprojroot_1.2    digest_0.6.12    assertthat_0.2.0 tibble_1.3.4    </div><div class="line">## [21] bindrcpp_0.2     ggsci_2.7        reshape2_1.4.2   purrr_0.2.3     </div><div class="line">## [25] glue_1.1.1       evaluate_0.10.1  rmarkdown_1.6    labeling_0.3    </div><div class="line">## [29] stringi_1.1.5    compiler_3.4.1   scales_0.5.0     backports_1.1.0 </div><div class="line">## [33] pkgconfig_2.0.1</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://os3hnmzbp.bkt.clouddn.com/5.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;ggplot2&lt;/strong&gt;有一个十分重要的功能就是分面，而今天要讲得R包&lt;strong&gt;ggpubr&lt;/strong&gt;中也有一个函数facet()专门用来进行分面操作。&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggpubr" scheme="https://ytlogos.github.io/tags/ggpubr/"/>
    
  </entry>
  
  <entry>
    <title>ggpubr包学习笔记之轻松修改图形参数</title>
    <link href="https://ytlogos.github.io/2017/09/13/ggpubr%E5%8C%85%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E8%BD%BB%E6%9D%BE%E4%BF%AE%E6%94%B9%E5%9B%BE%E5%BD%A2%E5%8F%82%E6%95%B0/"/>
    <id>https://ytlogos.github.io/2017/09/13/ggpubr包学习笔记之轻松修改图形参数/</id>
    <published>2017-09-13T05:00:55.000Z</published>
    <updated>2017-09-19T00:39:01.449Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/dm80Clb7Eh.png?imageslim" alt="mark"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>越学习包<strong>ggpubr</strong>越感觉其功能强大，本文主要讲解一下如何修改图形参数，我们知道<strong>ggplot2</strong>有着十分强大的绘图功能，但是其参数之复杂足以让人望而却步。<strong>ggpubr</strong>提供的函数ggpar()可以十分轻松地让我们修改图形参数，并且可以无缝对接到ggplot图形中。ggpar()可以修改以下图形参数：<br><a id="more"></a></p>
<ul>
<li>图形标题，包括坐标轴标题以及图例标题</li>
<li>图例的位置以及外观</li>
<li>颜色必需的能修改</li>
<li>坐标轴limits</li>
<li>坐标转换</li>
<li>坐标刻度</li>
<li>主题</li>
<li>翻转等</li>
</ul>
<h2 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#two ways to isntall the ggpubr package</div><div class="line">install.packages(&quot;ggpubr&quot;)</div><div class="line">#install the packages from the Github</div><div class="line">devtools::install_github(&quot;kassambara/ggpubr&quot;)</div></pre></td></tr></table></figure>
<h2 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">library(ggpubr)#load ggpubr</div><div class="line">#basic plots</div><div class="line">p &lt;- ggboxplot(ToothGrowth, x=&quot;dose&quot;, y=&quot;len&quot;, color=&quot;dose&quot;)</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/7hKdEb1ehB.png?imageslim" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#add grids by the function grids()</div><div class="line">p+grids(linetype=&quot;dashed&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/f77I1FIlbB.png?imageslim" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#add panel borders lines by the function border()</div><div class="line">p+border(&quot;black&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/cGa2dj6AB8.png?imageslim" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#change background color</div><div class="line">p+bgcolor(&quot;#BFD5E3&quot;)+border(&quot;#BFD5E3&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/jAIc0AjBi8.png?imageslim" alt=""></p>
<h2 id="修改标题以及坐标轴标签"><a href="#修改标题以及坐标轴标签" class="headerlink" title="修改标题以及坐标轴标签"></a>修改标题以及坐标轴标签</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">p2 &lt;- ggpar(p,</div><div class="line">            title = &quot;Box plot created with ggpubr&quot;,</div><div class="line">            subtitle = &quot;Length by dose&quot;,</div><div class="line">            caption = &quot;Source: ggpubr&quot;,</div><div class="line">            xlab = &quot;Dose (mg)&quot;,</div><div class="line">            ylab = &quot;Teeth length&quot;,</div><div class="line">            legend.title = &quot;Dose (mg)&quot;)</div><div class="line">p2</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/5K7D23dIcC.png?imageslim" alt="mark"></p>
<h2 id="修改标题以及标签的字体"><a href="#修改标题以及标签的字体" class="headerlink" title="修改标题以及标签的字体"></a>修改标题以及标签的字体</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggpar(p2, </div><div class="line">      font.title = c(14, &quot;bold.italic&quot;, &quot;red&quot;),</div><div class="line">      font.subtitle = c(10, &quot;orange&quot;),</div><div class="line">      font.caption = c(10, &quot;orange&quot;),</div><div class="line">      font.x = c(14, &quot;blue&quot;),</div><div class="line">      font.y = c(14, &quot;#993333&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/dm80Clb7Eh.png?imageslim" alt="mark"></p>
<p>当然也可以直接用函数font()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p2+</div><div class="line">  font(&quot;title&quot;, size = 14, color = &quot;red&quot;, face = &quot;bold.italic&quot;)+</div><div class="line">  font(&quot;subtitle&quot;, size = 10, color = &quot;orange&quot;)+</div><div class="line">  font(&quot;caption&quot;, size = 10, color = &quot;orange&quot;)+</div><div class="line">  font(&quot;xlab&quot;, size = 12, color = &quot;blue&quot;)+</div><div class="line">  font(&quot;ylab&quot;, size = 12, color = &quot;#993333&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/6EHIKCbjdB.png?imageslim" alt="mark"></p>
<p>从上面可以看出我们可以一次性完成添加标题以及修改字体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggpar(p,</div><div class="line">      title = &quot;Plot of length \n by dose&quot;,</div><div class="line">      xlab = &quot;Dose (mg)&quot;,</div><div class="line">      legend.title = &quot;Dose (mg)&quot;,</div><div class="line">      font.title = c(14, &quot;bold.italic&quot;, &quot;red&quot;),</div><div class="line">      font.x = c(14, &quot;bold&quot;, &quot;#2E9FDF&quot;),</div><div class="line">      font.y = c(14, &quot;bold&quot;, &quot;#E7B800&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/K5Hh142DDJ.png?imageslim" alt="mark"></p>
<h2 id="修改图例位置与外观"><a href="#修改图例位置与外观" class="headerlink" title="修改图例位置与外观"></a>修改图例位置与外观</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggpar(p,</div><div class="line">      legend = &quot;right&quot;, legend.title = &quot;Dose (mg)&quot;)+</div><div class="line">  font(&quot;legend.title&quot;, color=&quot;blue&quot;, face = &quot;bold&quot;)+</div><div class="line">  font(&quot;legend.text&quot;, color = &quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/66Fl04A1Eg.png?imageslim" alt="mark"></p>
<h2 id="颜色修改"><a href="#颜色修改" class="headerlink" title="颜色修改"></a>颜色修改</h2><p>ggpar()中有一个参数palette，即调色板，除了可以我们自定义颜色外，还可以调用RColorBrewer中的调色板以及包<strong>ggsci</strong>中的专门用于学术杂志的配色。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#use custom color palette</div><div class="line">ggpar(p, palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/j04LBcgCFf.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#use the RColorBrewer palette</div><div class="line">ggpar(p, palette = &quot;Dark2&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/gg16gmeE3D.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggpar(p, palette = &quot;grey&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/3h1K0f5aaK.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#use the ggsci palette</div><div class="line">ggpar(p, palette = &quot;npg&quot;)#nature</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/13fcD9GfDC.png?imageslim" alt="mark"></p>
<p>当然也可以直接用<strong>ggpubr</strong>中的函数color_palette()以及fill_palette()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#jco color palette</div><div class="line">p+color_palette(&quot;jco&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/aD2IK0b75D.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#custom color</div><div class="line">p+color_palette(c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/Jj9BG7J24h.png?imageslim" alt="mark"></p>
<h2 id="颜色梯度"><a href="#颜色梯度" class="headerlink" title="颜色梯度"></a>颜色梯度</h2><p><strong>ggpubr</strong>提供了两个函数用来处理颜色梯度：gradient_color()和gradient_fill()<br>通过一个例子来看如何运作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#first create a scatter plot</div><div class="line">p3 &lt;- ggscatter(mtcars, x=&quot;wt&quot;, y=&quot;mpg&quot;, color=&quot;mpg&quot;, size = 2)</div><div class="line">#change the gradient color</div><div class="line">#use one custom color</div><div class="line">p3+gradient_color(&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/ah3ed5b1Ai.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#use two colors</div><div class="line">p3+gradient_color(c(&quot;blue&quot;, &quot;red&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/1H7KBAdKLd.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#three colors</div><div class="line">p3+gradient_color(c(&quot;blue&quot;, &quot;white&quot;, &quot;red&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/kCaHdmcG6i.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#use the RColorBrewer palette</div><div class="line">p3+gradient_color(&quot;RdYlBu&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/FHKlGj4H8F.png?imageslim" alt="mark"><br>gradient_fill()用法也一样，不过是填充，这里就不演示了。</p>
<h2 id="修改坐标轴limits、scales"><a href="#修改坐标轴limits、scales" class="headerlink" title="修改坐标轴limits、scales"></a>修改坐标轴limits、scales</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#change y axis limits</div><div class="line">ggpar(p, ylim = c(0, 50))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/CFamb4cglg.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#change y axis cale to log2</div><div class="line">ggpar(p, yscale = &quot;log2&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/Deh1KddGKj.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#format  axis scale</div><div class="line">ggpar(p, yscale = &quot;log2&quot;, format.scale = TRUE)#format.scale=TRUE说明y轴刻度也会scale</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/IgF4D3LFiL.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#也可以直接用yscale()</div><div class="line">p+yscale(&quot;log2&quot;, .format = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/lfk8D0i00d.png?imageslim" alt="mark"></p>
<h2 id="自定义坐标轴标签及刻度"><a href="#自定义坐标轴标签及刻度" class="headerlink" title="自定义坐标轴标签及刻度"></a>自定义坐标轴标签及刻度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#change the font of x and y axis texts</div><div class="line">#rotate x and y texts</div><div class="line">p+</div><div class="line">  font(&quot;xy.text&quot;, size = 12, color = &quot;blue&quot;, face = &quot;bold&quot;)+</div><div class="line">  rotate_x_text(45)+</div><div class="line">  rotate_y_text(45)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/DhAlF966Cb.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#remove ticks and axis texts</div><div class="line">p+rremove(&quot;ticks&quot;)+</div><div class="line">  rremove(&quot;axis.text&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/c6cHkJj7Hk.png?imageslim" alt="mark"></p>
<h2 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h2><p>默认主题为theme_pubr(),可以调用包<strong>ggthemes</strong>里面的主题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(ggthemes)</div><div class="line">p+ggthemes::theme_economist()</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/k49JlfLfDg.png?imageslim" alt="mark"></p>
<h2 id="移除ggplot组件"><a href="#移除ggplot组件" class="headerlink" title="移除ggplot组件"></a>移除ggplot组件</h2><p>通过ggpubr::rremove()可以移除组件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggboxplot(ToothGrowth, x=&quot;dose&quot;, y=&quot;len&quot;, ggtheme = theme_igray())</div><div class="line">p</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/G53edij9j4.png?imageslim" alt="mark"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+rremove(&quot;grid&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/CciAa0JEhH.png?imageslim" alt="mark"></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.3 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0</div><div class="line">## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">##  [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C              </div><div class="line">##  [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8    </div><div class="line">##  [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8   </div><div class="line">##  [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C                 </div><div class="line">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </div><div class="line">## [11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C       </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] ggthemes_3.4.0 ggpubr_0.1.5   magrittr_1.5   ggplot2_2.2.1 </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12       bindr_0.1          knitr_1.17        </div><div class="line">##  [4] munsell_0.4.3      colorspace_1.3-2   R6_2.2.2          </div><div class="line">##  [7] rlang_0.1.2        stringr_1.2.0      plyr_1.8.4        </div><div class="line">## [10] dplyr_0.7.3        tools_3.4.1        grid_3.4.1        </div><div class="line">## [13] gtable_0.2.0       htmltools_0.3.6    yaml_2.1.14       </div><div class="line">## [16] lazyeval_0.2.0     rprojroot_1.2      digest_0.6.12     </div><div class="line">## [19] assertthat_0.2.0   tibble_1.3.4       bindrcpp_0.2      </div><div class="line">## [22] ggsci_2.7          RColorBrewer_1.1-2 purrr_0.2.3       </div><div class="line">## [25] glue_1.1.1         evaluate_0.10.1    rmarkdown_1.6     </div><div class="line">## [28] labeling_0.3       stringi_1.1.5      compiler_3.4.1    </div><div class="line">## [31] scales_0.5.0       backports_1.1.0    pkgconfig_2.0.1</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170913/dm80Clb7Eh.png?imageslim&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;越学习包&lt;strong&gt;ggpubr&lt;/strong&gt;越感觉其功能强大，本文主要讲解一下如何修改图形参数，我们知道&lt;strong&gt;ggplot2&lt;/strong&gt;有着十分强大的绘图功能，但是其参数之复杂足以让人望而却步。&lt;strong&gt;ggpubr&lt;/strong&gt;提供的函数ggpar()可以十分轻松地让我们修改图形参数，并且可以无缝对接到ggplot图形中。ggpar()可以修改以下图形参数：&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggpubr" scheme="https://ytlogos.github.io/tags/ggpubr/"/>
    
  </entry>
  
  <entry>
    <title>About me</title>
    <link href="https://ytlogos.github.io/2017/09/12/README/"/>
    <id>https://ytlogos.github.io/2017/09/12/README/</id>
    <published>2017-09-11T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.465Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introductiom"><a href="#Introductiom" class="headerlink" title="Introductiom"></a>Introductiom</h1><hr>
<p>The posts resource of my personal blog</p>
<ul>
<li>code &amp; data &amp; graph</li>
<li>R &amp; RStudio</li>
<li>If you are interested in my blog, you can go to the home of my <a href="https://ytlogos.github.io/">blog</a></li>
</ul>
<h1 id="About-me"><a href="#About-me" class="headerlink" title="About me"></a>About me</h1><hr>
<p>严涛</p>
<p>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
<hr>
<p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Introductiom&quot;&gt;&lt;a href=&quot;#Introductiom&quot; class=&quot;headerlink&quot; title=&quot;Introductiom&quot;&gt;&lt;/a&gt;Introductiom&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;The posts resource of my 
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>一篇关于国旗与奥运会奖牌的可视化笔记</title>
    <link href="https://ytlogos.github.io/2017/09/12/%E4%B8%80%E7%AF%87%E5%85%B3%E4%BA%8E%E5%9B%BD%E6%97%97%E4%B8%8E%E5%A5%A5%E8%BF%90%E4%BC%9A%E5%A5%96%E7%89%8C%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AC%94%E8%AE%B0/"/>
    <id>https://ytlogos.github.io/2017/09/12/一篇关于国旗与奥运会奖牌的可视化笔记/</id>
    <published>2017-09-11T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.445Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170912/k58bFmLk2c.png?imageslim" alt=""></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文主要介绍一个R包<strong>ggflags</strong>，可以用于绘制国旗。安装的话从<a href="https://github.com/baptiste/ggflags" target="_blank" rel="external">Github</a>上利用包<strong>devtools</strong>安装。</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">devtools::install_github(&quot;baptiste/ggflags&quot;)</div></pre></td></tr></table></figure>
<p>下面看个小例子来介绍一下</p>
<h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">library(ggflags)#load package</div><div class="line">set.seed(1111)</div><div class="line">#create the dataset</div><div class="line">data &lt;- data.frame(x=rnorm(50), y=rnorm(50),</div><div class="line">                   country=sample(c(&quot;ar&quot;, &quot;us&quot;, &quot;cn&quot;, &quot;fr&quot;, &quot;gb&quot;, &quot;es&quot;), 50 ,replace = TRUE),</div><div class="line">                   stringsAsFactors=FALSE)</div><div class="line">head(data)</div><div class="line">    x	             y	     country</div><div class="line">-0.0865801	-0.7055274	gb</div><div class="line">1.3225244	-0.5910791	fr</div><div class="line">0.6397020	-0.2796410	us</div><div class="line">1.1747866	-1.3209782	cn</div><div class="line">0.1162903	0.5851085	gb</div><div class="line">-2.9308464	0.0198323	ar</div></pre></td></tr></table></figure>
<h2 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(ggplot2)</div><div class="line">ggplot(data, aes(x=x, y=y, country=country, size=x))+</div><div class="line">  geom_flag()+</div><div class="line">  scale_country()+</div><div class="line">  scale_size(range = c(0, 10))</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170912/KB9E0de5H5.png?imageslim" alt=""></p>
<p>国旗的图片是来自于<a href="https://github.com/eosrei/emojione-color-font" target="_blank" rel="external">EmojiOne数据集</a>,有兴趣的可以去看看了解一下。<br>题目有奥运会奖牌，所以接下来就可视化一下索契冬奥运会各国奖牌，本次用国旗与国家联系起来。</p>
<h2 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">library(dplyr)</div><div class="line">library(rvest)</div><div class="line">url &lt;- &quot;http://www.nbcolympics.com/medals&quot;</div><div class="line">medals &lt;- read_html(url)%&gt;%</div><div class="line">  html_nodes(&quot;table&quot;)%&gt;%</div><div class="line">  .[[1]]%&gt;%</div><div class="line">  html_table()</div><div class="line">knitr::kable(head(medals))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Country	      Gold	Silver	Bronze	Total</div><div class="line">Russia	       13	11	9	33</div><div class="line">United States	9	7	12	28</div><div class="line">Norway	       11	5	10	26</div><div class="line">Canada	       10	10	5	25</div><div class="line">Netherlands	8	7	9	24</div><div class="line">Germany	        8	6	5	19</div></pre></td></tr></table></figure>
<p>爬取完数据之后进行清洗</p>
<h2 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h2><p>本文重要的一环是将国家与国旗联系起来，因此首先要将国家名缩写弄出来，这就要用到<a href="https://github.com/vincentarelbundock/countrycode" target="_blank" rel="external"><strong>countrycode</strong></a>这个包了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#install the package</div><div class="line">install.packages(&quot;countrycode&quot;)</div></pre></td></tr></table></figure>
<p>数据清洗<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">library(countrycode)</div><div class="line">library(tidyr)</div><div class="line">medals &lt;- medals%&gt;%</div><div class="line">  mutate(code=countrycode(Country, &quot;country.name&quot;, &quot;iso2c&quot;))%&gt;%</div><div class="line">  mutate(code=tolower(code))%&gt;%</div><div class="line">  gather(medal_color, count, Gold, Silver, Bronze)%&gt;%</div><div class="line">  mutate(medal_color=factor(medal_color, levels = c(&quot;Gold&quot;, &quot;Silver&quot;, &quot;Bronze&quot;)))%&gt;%</div><div class="line">  drop_na(Country, code)</div><div class="line">knitr::kable(head(medals))</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Country	      Total	code	medal_color count</div><div class="line">Russia	       33	 ru	   Gold	      13</div><div class="line">United States  28	 us	   Gold	       9</div><div class="line">Norway	       26	 no	   Gold	      11</div><div class="line">Canada	       25	 ca	   Gold       10</div><div class="line">Netherlands    24	 nl	   Gold	       8</div><div class="line">Germany	       19	 de	   Gold	       8</div></pre></td></tr></table></figure>
<h2 id="绘图-1"><a href="#绘图-1" class="headerlink" title="绘图"></a>绘图</h2><p>由于国家数量太多，并且好多国家奖牌数基本为零，因此我们筛选一下：只绘制总奖牌数不小于5的国家。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">medals%&gt;%filter(Total&gt;=5)%&gt;%</div><div class="line">  ggplot(aes(x=reorder(Country, Total), y=count))+</div><div class="line">  geom_bar(stat = &quot;identity&quot;, aes(fill=medal_color))+</div><div class="line">  geom_flag(aes(y=-2,country=code), size=10)+</div><div class="line">  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 7, vjust = 0.5))+</div><div class="line">  scale_fill_manual(values = c(</div><div class="line">    &quot;Gold&quot;=&quot;gold&quot;,</div><div class="line">    &quot;Bronze&quot; = &quot;#cd7f32&quot;,</div><div class="line">    &quot;Silver&quot; = &quot;#C0C0C0&quot;</div><div class="line">  ))+</div><div class="line">  scale_y_continuous(expand = c(0.1, 1))+</div><div class="line">  xlab(&quot;Country&quot;)+</div><div class="line">  ylab(&quot;Number of medals&quot;)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid = element_blank())+</div><div class="line">  theme(legend.justification = c(1, 0), legend.position = c(1, 0))+</div><div class="line">  theme(legend.title = element_blank())+</div><div class="line">  coord_flip()</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170912/k58bFmLk2c.png?imageslim" alt=""></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.3 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0</div><div class="line">## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">##  [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C              </div><div class="line">##  [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8    </div><div class="line">##  [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8   </div><div class="line">##  [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C                 </div><div class="line">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </div><div class="line">## [11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C       </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] bindrcpp_0.2     tidyr_0.7.1      countrycode_0.19 rvest_0.3.2     </div><div class="line">## [5] xml2_1.1.1       dplyr_0.7.3      ggflags_0.0.1    ggplot2_2.2.1   </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12     compiler_3.4.1   plyr_1.8.4       highr_0.6       </div><div class="line">##  [5] bindr_0.1        tools_3.4.1      digest_0.6.12    evaluate_0.10.1 </div><div class="line">##  [9] tibble_1.3.4     gtable_0.2.0     pkgconfig_2.0.1  rlang_0.1.2     </div><div class="line">## [13] curl_2.8.1       yaml_2.1.14      stringr_1.2.0    httr_1.3.1      </div><div class="line">## [17] knitr_1.17       tidyselect_0.2.0 rprojroot_1.2    grid_3.4.1      </div><div class="line">## [21] glue_1.1.1       R6_2.2.2         XML_3.98-1.9     rmarkdown_1.6   </div><div class="line">## [25] purrr_0.2.3      selectr_0.3-1    magrittr_1.5     backports_1.1.0 </div><div class="line">## [29] scales_0.5.0     htmltools_0.3.6  assertthat_0.2.0 colorspace_1.3-2</div><div class="line">## [33] labeling_0.3     stringi_1.1.5    lazyeval_0.2.0   munsell_0.4.3</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170912/k58bFmLk2c.png?imageslim&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;本文主要介绍一个R包&lt;strong&gt;ggflags&lt;/strong&gt;，可以用于绘制国旗。安装的话从&lt;a href=&quot;https://github.com/baptiste/ggflags&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github&lt;/a&gt;上利用包&lt;strong&gt;devtools&lt;/strong&gt;安装。&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="ggflags" scheme="https://ytlogos.github.io/tags/ggflags/"/>
    
      <category term="爬虫rvest" scheme="https://ytlogos.github.io/tags/%E7%88%AC%E8%99%ABrvest/"/>
    
  </entry>
  
  <entry>
    <title>利用tximport进行RNA-seq分析</title>
    <link href="https://ytlogos.github.io/2017/09/08/%E5%88%A9%E7%94%A8tximport%E8%BF%9B%E8%A1%8CRNA-seq%E5%88%86%E6%9E%90/"/>
    <id>https://ytlogos.github.io/2017/09/08/利用tximport进行RNA-seq分析/</id>
    <published>2017-09-08T10:31:07.000Z</published>
    <updated>2017-09-19T00:39:01.441Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>RNA-seq后续分析可以利用R包edgeR、DESeq2以及limma-voom等，而tximport包则可以将RNA-seq上游定量分析软件产生的结果导入到R语言中，进而方便后续的分析。具体的情况可以参考这篇文献：</p>
<blockquote>
<p>Charlotte Soneson, Michael I. Love, Mark D. Robinson (2015): Differential analyses for RNA-seq: transcript-level estimates improve gene-level inferences. F1000Research <a href="http://sci-hub.cc/10.12688/f1000research.7563.1" target="_blank" rel="external">http://sci-hub.cc/10.12688/f1000research.7563.1</a></p>
</blockquote>
<a id="more"></a>
<p>tximport具有以下优点：</p>
<ul>
<li>对于样本之间因基因长度不同导致的差异具有纠正功能</li>
<li>一些上游分析软件(Salmon, Sailfish, kallisto)等的结果可以完美对接到R语言中，这些软件运行速度更快更稳定，且占用更少的内存</li>
<li>更高的灵敏度，因为它可以避免那些比对到多基因的片段的丢失</li>
</ul>
<h2 id="导入转录组数据"><a href="#导入转录组数据" class="headerlink" title="导入转录组数据"></a>导入转录组数据</h2><p>下面我们将使用包tximportData中的数据进行演示，tximport可以处理多种类型的上游定量结果，只需要在参数type中设定就行。 先安装包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source(&quot;https://bioconductor.org/biocLite.R&quot;)</div><div class="line">options(BioC_mirror=&quot;http://mirrors.ustc.edu.cn/bioc/&quot;)#设置中科大镜像</div><div class="line">biocLite(&quot;tximportData&quot;)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(tximportData)</div><div class="line">dir &lt;- system.file(&quot;extdata&quot;, package = &quot;tximportData&quot;)#set directory</div><div class="line">list.files(dir)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##  [1] &quot;cufflinks&quot;            &quot;kallisto&quot;             &quot;kallisto_boot&quot;       </div><div class="line">##  [4] &quot;rsem&quot;                 &quot;sailfish&quot;             &quot;salmon&quot;              </div><div class="line">##  [7] &quot;salmon_gibbs&quot;         &quot;samples.txt&quot;          &quot;samples_extended.txt&quot;</div><div class="line">## [10] &quot;tx2gene.csv&quot;</div></pre></td></tr></table></figure>
<p>可以看到dir中存在这些文件，接下来我们其中的samples.txt读进来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">samples &lt;- read.table(file.path(dir, &quot;samples.txt&quot;), header = TRUE)</div><div class="line">samples</div><div class="line">##   pop center                assay    sample experiment       run</div><div class="line">## 1 TSI  UNIGE NA20503.1.M_111124_5 ERS185497  ERX163094 ERR188297</div><div class="line">## 2 TSI  UNIGE NA20504.1.M_111124_7 ERS185242  ERX162972 ERR188088</div><div class="line">## 3 TSI  UNIGE NA20505.1.M_111124_6 ERS185048  ERX163009 ERR188329</div><div class="line">## 4 TSI  UNIGE NA20507.1.M_111124_7 ERS185412  ERX163158 ERR188288</div><div class="line">## 5 TSI  UNIGE NA20508.1.M_111124_2 ERS185362  ERX163159 ERR188021</div><div class="line">## 6 TSI  UNIGE NA20514.1.M_111124_4 ERS185217  ERX163062 ERR188356</div></pre></td></tr></table></figure></p>
<p>再将salmon与samples以及quant.sf一起创建每个样本的文件地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">files &lt;- file.path(dir, &quot;salmon&quot;, samples$run, &quot;quant.sf&quot;)</div><div class="line">names(files) &lt;- paste0(&quot;sample&quot;, 1:6)</div><div class="line">all(file.exists(files))</div><div class="line">## [1] TRUE</div></pre></td></tr></table></figure></p>
<p>结果显示TRUE说明运行成功，可以进行下一步，要进行基因表达差异分析，首先要将转录本与基因名关联起来，这就需要我们创建一个两列的名为tx2gene的数据框，最简单的就是通过TxDb创建,再通过AnnotationDbi包里的函数select()进行选取<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">library(TxDb.Hsapiens.UCSC.hg19.knownGene)</div><div class="line">txdb &lt;- TxDb.Hsapiens.UCSC.hg19.knownGene</div><div class="line">k &lt;- keys(txdb, keytype = &quot;GENEID&quot;)</div><div class="line">df &lt;- select(txdb, keys = k, keytype = &quot;GENEID&quot;, columns = &quot;TXNAME&quot;)</div><div class="line">tx2gene &lt;- df[, 2:1]#tx ID在前，gene ID在后</div><div class="line">#这里我们演示就使用现有的tx2gene</div><div class="line">tx2gene &lt;- read.csv(file.path(dir, &quot;tx2gene.csv&quot;))</div><div class="line">head(tx2gene)</div><div class="line">##         TXNAME   GENEID</div><div class="line">## 1    NM_130786     A1BG</div><div class="line">## 2    NR_015380 A1BG-AS1</div><div class="line">## 3 NM_001198818     A1CF</div><div class="line">## 4 NM_001198819     A1CF</div><div class="line">## 5 NM_001198820     A1CF</div><div class="line">## 6    NM_014576     A1CF</div></pre></td></tr></table></figure></p>
<p>最后就是将转录组水平的数据导入就行了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">library(tximport)</div><div class="line">library(readr)</div><div class="line">txi &lt;- tximport(files, type = &quot;salmon&quot;, tx2gene = tx2gene)</div><div class="line">names(txi)</div><div class="line">## [1] &quot;abundance&quot;           &quot;counts&quot;              &quot;length&quot;             </div><div class="line">## [4] &quot;countsFromAbundance&quot;</div><div class="line">head(txi$counts)</div><div class="line">##             sample1   sample2    sample3   sample4   sample5   sample6</div><div class="line">## A1BG     109.232000 316.22400 110.638000 116.00000  86.38430  76.91630</div><div class="line">## A1BG-AS1  83.969700 138.44900 119.274000 151.08300 123.98500 103.25100</div><div class="line">## A1CF       9.030691  10.01847   5.019242  13.01820  25.21914  25.07356</div><div class="line">## A2M       24.000000   2.00000  21.000000   6.00000  38.00000   8.00000</div><div class="line">## A2M-AS1    1.000000   1.00000   1.000000   1.00000   0.00000   0.00000</div><div class="line">## A2ML1      3.047950   1.02987   4.076160   1.04945   3.07761   5.12409</div></pre></td></tr></table></figure></p>
<h2 id="差异分析"><a href="#差异分析" class="headerlink" title="差异分析"></a>差异分析</h2><p>下游分析主要使用Bioconductor包进行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">library(edgeR)</div><div class="line">cts &lt;- txi$counts</div><div class="line">normMat &lt;- txi$length</div><div class="line">normMat &lt;- normMat/exp(rowMeans(log(normMat)))</div><div class="line">o &lt;- log(calcNormFactors(cts/normMat))+log(colSums(cts/normMat))</div><div class="line">y &lt;- DGEList(cts)</div><div class="line">y$offset &lt;- t(t(log(normMat))+o)</div></pre></td></tr></table></figure></p>
<p>接下来的y就可以用来后续的分析</p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 10 x64 (build 15063)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C                              </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats4    parallel  stats     graphics  grDevices utils     datasets </div><div class="line">## [8] methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">##  [1] edgeR_3.18.1                           </div><div class="line">##  [2] limma_3.32.5                           </div><div class="line">##  [3] readr_1.1.1                            </div><div class="line">##  [4] tximport_1.4.0                         </div><div class="line">##  [5] TxDb.Hsapiens.UCSC.hg19.knownGene_3.2.2</div><div class="line">##  [6] GenomicFeatures_1.28.4                 </div><div class="line">##  [7] AnnotationDbi_1.38.2                   </div><div class="line">##  [8] Biobase_2.36.2                         </div><div class="line">##  [9] GenomicRanges_1.28.4                   </div><div class="line">## [10] GenomeInfoDb_1.12.2                    </div><div class="line">## [11] IRanges_2.10.3                         </div><div class="line">## [12] S4Vectors_0.14.3                       </div><div class="line">## [13] BiocGenerics_0.22.0                    </div><div class="line">## [14] tximportData_1.4.0                     </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] Rcpp_0.12.12               compiler_3.4.1            </div><div class="line">##  [3] XVector_0.16.0             bitops_1.0-6              </div><div class="line">##  [5] tools_3.4.1                zlibbioc_1.22.0           </div><div class="line">##  [7] biomaRt_2.32.1             digest_0.6.12             </div><div class="line">##  [9] bit_1.1-12                 lattice_0.20-35           </div><div class="line">## [11] evaluate_0.10.1            RSQLite_2.0               </div><div class="line">## [13] memoise_1.1.0              tibble_1.3.4              </div><div class="line">## [15] pkgconfig_2.0.1            rlang_0.1.2               </div><div class="line">## [17] Matrix_1.2-11              DelayedArray_0.3.12       </div><div class="line">## [19] DBI_0.7                    yaml_2.1.14               </div><div class="line">## [21] GenomeInfoDbData_0.99.0    rtracklayer_1.36.4        </div><div class="line">## [23] stringr_1.2.0              knitr_1.17                </div><div class="line">## [25] hms_0.3                    Biostrings_2.44.2         </div><div class="line">## [27] locfit_1.5-9.1             grid_3.4.1                </div><div class="line">## [29] rprojroot_1.2              bit64_0.9-7               </div><div class="line">## [31] R6_2.2.2                   XML_3.98-1.9              </div><div class="line">## [33] BiocParallel_1.10.1        rmarkdown_1.6             </div><div class="line">## [35] blob_1.1.0                 magrittr_1.5              </div><div class="line">## [37] matrixStats_0.52.2         GenomicAlignments_1.12.2  </div><div class="line">## [39] backports_1.1.0            Rsamtools_1.28.0          </div><div class="line">## [41] htmltools_0.3.6            SummarizedExperiment_1.6.3</div><div class="line">## [43] stringi_1.1.5              RCurl_1.95-4.8            </div><div class="line">## [45] rjson_0.2.15</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;RNA-seq后续分析可以利用R包edgeR、DESeq2以及limma-voom等，而tximport包则可以将RNA-seq上游定量分析软件产生的结果导入到R语言中，进而方便后续的分析。具体的情况可以参考这篇文献：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Charlotte Soneson, Michael I. Love, Mark D. Robinson (2015): Differential analyses for RNA-seq: transcript-level estimates improve gene-level inferences. F1000Research &lt;a href=&quot;http://sci-hub.cc/10.12688/f1000research.7563.1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://sci-hub.cc/10.12688/f1000research.7563.1&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="RNA-seq" scheme="https://ytlogos.github.io/categories/RNA-seq/"/>
    
    
      <category term="RNA-seq" scheme="https://ytlogos.github.io/tags/RNA-seq/"/>
    
  </entry>
  
  <entry>
    <title>A brief introduction of salmon</title>
    <link href="https://ytlogos.github.io/2017/09/06/A-brief-introduction-of-salmon/"/>
    <id>https://ytlogos.github.io/2017/09/06/A-brief-introduction-of-salmon/</id>
    <published>2017-09-06T10:31:06.000Z</published>
    <updated>2017-09-19T00:39:01.436Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Salmon是一款定量分析RNA-seq的软件，号称Fast、accurate、bias-aware and Don’t count…quantify定量分析转录本。本文主要简要的介绍一下Salmon。具体的情况可移步<a href="https://combine-lab.github.io/salmon/" target="_blank" rel="external">Salmon官网</a></p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>可以去<a href="https://github.com/COMBINE-lab/salmon" target="_blank" rel="external">Github</a>里下载Salmon进行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir Salmon &amp;&amp; cd Salmon</div><div class="line">$ wget  https://github.com/COMBINE-lab/salmon/releases/download/v0.8.2/Salmon-0.8.2_linux_x86_64.tar.gz</div><div class="line">$ tar zxvf Salmon-0.8.2_linux_x86_64.tar.gz</div></pre></td></tr></table></figure></p>
<p>至于路径则根据自己电脑进行配置，这里不讲，安装成功的话则可以用<code>salmon -h</code>查看帮助文件。应该可以看到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ salmon -h</div><div class="line">Salmon v0.8.1</div><div class="line"></div><div class="line">Usage:  salmon -h|--help or</div><div class="line">        salmon -v|--version or</div><div class="line">        salmon -c|--cite or</div><div class="line">        salmon [--no-version-check] &lt;COMMAND&gt; [-h | options]</div><div class="line"></div><div class="line">Commands:</div><div class="line">     cite  Show salmon citation information</div><div class="line">     index Create a salmon index</div><div class="line">     quant Quantify a sample</div><div class="line">     swim  Perform super-secret operation</div></pre></td></tr></table></figure>
<p>也可以利用conda安装，这样就可以省去很多麻烦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ conda install salmon</div></pre></td></tr></table></figure></p>
<h2 id="获取转录组"><a href="#获取转录组" class="headerlink" title="获取转录组"></a>获取转录组</h2><p>Salmon是直接将原始序列map到转录组上而不是全基因组上(这是很重要的一点，千万不要搞混了，这也是作者一直在强调的)，这里我们就以拟南芥为例下载其转录组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#Creat a directory </div><div class="line">$ mkdir RNA-seq_test cd RNA-seq_test</div><div class="line">$ wget ftp://ftp.ensemblgenomes.org/pub/plants/release-28/fasta/arabidopsis_thaliana/cdna/Arabidopsis_thaliana.TAIR10.28.cdna.all.fa.gz -o athal.fa.gz</div></pre></td></tr></table></figure>
<p>好了，现在转录组已下载好，接下来就是建立索引了</p>
<h2 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h2><p>利用Salmon建立索引十分简单，一行命令就搞定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ salmon index -t athal.fa.gz -i athal_index</div><div class="line">```</div></pre></td></tr></table></figure></p>
<p>这里解释一下几个参数：</p>
<ul>
<li>-t: 表示需要用到的转录组，这里是拟南芥的，我们刚下载好的athal.fa.gz</li>
<li>-i: 表示我们建立的索引的名称，它是一个文件夹</li>
</ul>
<p>更多的参数设置可以<a href="http://salmon.readthedocs.io/en/latest/" target="_blank" rel="external">参考说明</a></p>
<h2 id="获取序列数据"><a href="#获取序列数据" class="headerlink" title="获取序列数据"></a>获取序列数据</h2><p>一次试验数据往往很多，我们可以写一个脚本进行下载，这里简单示例一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">mkdir data</div><div class="line">cd data</div><div class="line">for i in &apos;seq 25 40&apos;;</div><div class="line">do</div><div class="line">  madir DRR0161$&#123;i&#125;;</div><div class="line">  cd DRR0161$&#123;i&#125;;</div><div class="line">  wget ftp://ftp.sra.ebi.ac.uk/vol1/fastq/DRR016/DRR0161$&#123;i&#125;/DRR0161$&#123;i&#125;_1.fastq.gz; </div><div class="line">  wget ftp://ftp.sra.ebi.ac.uk/vol1/fastq/DRR016/DRR0161$&#123;i&#125;/DRR0161$&#123;i&#125;_2.fastq.gz; </div><div class="line">  cd ..; </div><div class="line">done</div><div class="line">cd ..</div></pre></td></tr></table></figure></p>
<p>将其保存为obtain_reads.sh,将其运行只需以下命令就行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ bash obtain_reads.sh</div></pre></td></tr></table></figure></p>
<h2 id="定量样本"><a href="#定量样本" class="headerlink" title="定量样本"></a>定量样本</h2><p>这次也写一个简单脚本进行定量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">for fn in data/DRR0161&#123;25..40&#125;;</div><div class="line">do</div><div class="line">samp=`basename $&#123;fn&#125;`</div><div class="line">echo &quot;Processing sample $&#123;samp&#125;&quot;</div><div class="line">salmon quant -i athal_index -l A \</div><div class="line">         -1 $&#123;fn&#125;/$&#123;samp&#125;_1.fastq.gz \</div><div class="line">         -2 $&#123;fn&#125;/$&#123;samp&#125;_2.fastq.gz \</div><div class="line">         -p 8 -o quants/$&#123;samp&#125;_quant</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>这里简单说明一下几个参数：</p>
<ul>
<li>-i: 用来告诉salmon哪里寻找索引index</li>
<li>-l A: 告诉salmon自行决定是何种类型的序列数据</li>
<li>-1，-2：就是两端测序的两个序列了</li>
<li>-p 8: 8线程</li>
<li>-o: 输出文件，这里是所有输出文件都保存至quants，并且文件命名为sample_quant</li>
</ul>
<p>更多参数选择及说明可以参考<a href="http://salmon.readthedocs.io/en/latest/" target="_blank" rel="external">说明文件</a><br>这里每个样品文件里都含有一个主文件quant.sf。在后续的差异分析中有重要作用，后续再讲。<br>定量之后接下来就是进行具体分析了，一般来说都在R里面进行，R&amp;Bioconductor有大量的包进行下游的分析，比如<a href="https://bioconductor.org/packages/DESeq2" target="_blank" rel="external">DESeq2</a>、<a href="https://bioconductor.org/packages/edgeR" target="_blank" rel="external">edgeR</a>、<a href="https://bioconductor.org/packages/limma" target="_blank" rel="external">limma</a>以及<a href="http://pachterlab.github.io/sleuth/" target="_blank" rel="external">sleuth</a>等，后续文章我会讲解如何通过 <a href="http://bioconductor.org/packages/tximport" target="_blank" rel="external"><code>tximport</code></a>将定量化的转录组数据导入到R语言中进行差异分析。</p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;Salmon是一款定量分析RNA-seq的软件，号称Fast、accurate、bias-aware and Don’t count…quantify定量分析转录本。本文主要简要的介绍一下Salmon。具体的情况可移步&lt;a href=&quot;https://combine-lab.github.io/salmon/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Salmon官网&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="RNA-seq" scheme="https://ytlogos.github.io/categories/RNA-seq/"/>
    
    
      <category term="RNA-seq" scheme="https://ytlogos.github.io/tags/RNA-seq/"/>
    
  </entry>
  
  <entry>
    <title>图像处理R包magick学习笔记</title>
    <link href="https://ytlogos.github.io/2017/09/03/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86R%E5%8C%85magick%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://ytlogos.github.io/2017/09/03/图像处理R包magick学习笔记/</id>
    <published>2017-09-03T10:29:46.000Z</published>
    <updated>2017-09-19T00:39:01.433Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/a2jGAc87jB.gif" alt=""></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文主要简单介绍一下magick包，主要用于图像处理</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#安装的话就直接从CRAN安装进行</div><div class="line">install.packages(&quot;magick&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#Load the package</div><div class="line">library(magick)</div><div class="line">#查看支持哪些格式</div><div class="line">str(magick_config())</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">## List of 21</div><div class="line">##  $ version           :Class &apos;numeric_version&apos;  hidden list of 1</div><div class="line">##   ..$ : int [1:4] 6 9 9 9</div><div class="line">##  $ modules           : logi FALSE</div><div class="line">##  $ cairo             : logi TRUE</div><div class="line">##  $ fontconfig        : logi FALSE</div><div class="line">##  $ freetype          : logi TRUE</div><div class="line">##  $ fftw              : logi TRUE</div><div class="line">##  $ ghostscript       : logi TRUE</div><div class="line">##  $ jpeg              : logi TRUE</div><div class="line">##  $ lcms              : logi TRUE</div><div class="line">##  $ libopenjp2        : logi FALSE</div><div class="line">##  $ lzma              : logi TRUE</div><div class="line">##  $ pangocairo        : logi TRUE</div><div class="line">##  $ pango             : logi TRUE</div><div class="line">##  $ png               : logi TRUE</div><div class="line">##  $ rsvg              : logi TRUE</div><div class="line">##  $ tiff              : logi TRUE</div><div class="line">##  $ webp              : logi TRUE</div><div class="line">##  $ wmf               : logi FALSE</div><div class="line">##  $ x11               : logi FALSE</div><div class="line">##  $ xml               : logi TRUE</div><div class="line">##  $ zero-configuration: logi FALSE</div></pre></td></tr></table></figure>
<p>可以看出大部分格式都是支持的</p>
<h2 id="读取图像"><a href="#读取图像" class="headerlink" title="读取图像"></a>读取图像</h2><p>读取的话可以直接从本地读取，也可以读取URL格式的图片，主要通过image_read()来读取，image_info()则可以显示图像的一些属性数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#读取网上随便选的图片</div><div class="line">night_king &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/ha6Cchfk38.jpg?imageslim&quot;)</div><div class="line">image_info(night_king)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##   format width height colorspace filesize</div><div class="line">## 1   JPEG   189    267       sRGB     6449</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#通过image_write()可以讲图片以任何格式输出，比如将刚读取的图片以png格式输出。</div><div class="line">image_write(night_king, path = &quot;night_king.png&quot;, format = &quot;png&quot;)</div></pre></td></tr></table></figure>
<h2 id="转换格式"><a href="#转换格式" class="headerlink" title="转换格式"></a>转换格式</h2><p>通过image_convert()可以将图片转换为我们需要的格式，比如这里我们可以将night_king的格式转换为png格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">night_king.png &lt;- image_convert(night_king, &quot;png&quot;)</div><div class="line">image_info(night_king.png)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##   format width height colorspace filesize</div><div class="line">## 1    PNG   189    267       sRGB        0</div></pre></td></tr></table></figure>
<p>可以看到这里的filesize为0，直到被渲染（这里涉及到ImageMagick方面，我不是很懂）。</p>
<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p>在RStudio中可以查看我们读取的图片</p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/1kEj0h191l.png?imageslim" alt=""></p>
<h2 id="转换-transformations"><a href="#转换-transformations" class="headerlink" title="转换(transformations)"></a>转换(transformations)</h2><p>magick提供一系列函数对图片进行裁剪以及编辑，主要有以下函数：</p>
<ul>
<li>image_crop(image, “100x150+50”):裁剪</li>
<li>image_scale(image, “200”):按宽比例进行放大缩小</li>
<li>image_scale(image, “x200”):按高比例进行放大缩小</li>
<li>image_fill(image, “blue”, “+100+200”):对特定部位着色</li>
<li>image_border(image, “red”, “20x10”):添加边框</li>
</ul>
<p>下面我们来试试这些函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#Example image</div><div class="line">wolf &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/4h96Df21AI.png?imageslim&quot;)</div><div class="line">print(wolf)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/4h96Df21AI.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Add 20px left/right and 10px top/bottom</div><div class="line">image_border(image_background(wolf, &quot;hotpink&quot;), &quot;#000080&quot;, &quot;20x10&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/6LE8j4jECf.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#trim margins</div><div class="line">image_trim(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/HB0lELbmhE.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#裁剪</div><div class="line">image_crop(wolf, &quot;500x300+50&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/f05HDcIG4d.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Resize</div><div class="line">image_scale(wolf, &quot;300&quot;)#width:300px</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/KjfE0bhl7H.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Resize</div><div class="line">image_scale(wolf, &quot;x300&quot;)#heigth:300px</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/0me686bm2e.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Rotate or mirror</div><div class="line">image_rotate(wolf, 45)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/1H6D4bjKbm.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Flip</div><div class="line">image_flip(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/4CGL43f8AK.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Flop</div><div class="line">image_flop(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/Cg4hL5Hi72.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Paint </div><div class="line">image_fill(wolf, &quot;red&quot;, point = &quot;+190+100&quot;, fuzz = 4000)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/fd7IfD0m2a.png?imageslim" alt=""></p>
<p>这个函数最难掌握，我本来是想将wolf的眼睛渲染成红色，但是不断调整point以及fuzz都没弄成，感兴趣的可以自己捣鼓捣鼓。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Add randomness</div><div class="line">image_blur(wolf, 10, 5)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/k5EF1DA9Lk.png?imageslim" alt=""></p>
<p>可以通过调整参数来设置模糊度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">image_noise(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/D92FH0I3G1.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Silly filters</div><div class="line">image_charcoal(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/KAEA3gIIF0.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">image_oilpaint(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/ACD0Fg5675.png?imageslim" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">image_negate(wolf)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/kILkaEe9kl.png?imageslim" alt=""></p>
<h2 id="文字注释"><a href="#文字注释" class="headerlink" title="文字注释"></a>文字注释</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Add some text on the image</div><div class="line">image_annotate(wolf, &quot;I am the King of wolf&quot;, size=25, gravity = &quot;southeast&quot;, color=&quot;gold&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/dfc3iB0E3D.png?imageslim" alt=""></p>
<p>当然也可以自定义text</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#customize the text</div><div class="line">image_annotate(wolf, &quot;I am the King&quot;, size=30, color=&quot;red&quot;, boxcolor = &quot;pink&quot;, degrees = 45, location = &quot;+30+30&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/59CEEa0gm0.png?imageslim" alt=""></p>
<p>还可以设置字体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Set the font times-new-roman</div><div class="line">image_annotate(wolf, &quot;I am the King&quot;, size=30, color=&quot;red&quot;, boxcolor = &quot;pink&quot;, degrees = 45, location = &quot;+30+30&quot;, font = &apos;times-new-roman&apos;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/BIbiF712bE.png?imageslim" alt=""></p>
<h2 id="管道操作"><a href="#管道操作" class="headerlink" title="管道操作"></a>管道操作</h2><p>你没看错，magick支持管道操作，下面试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">library(magrittr)</div><div class="line">wolf%&gt;%</div><div class="line">  image_rotate(270)%&gt;%</div><div class="line">  image_background(&quot;white&quot;, flatten = TRUE)%&gt;%</div><div class="line">  image_border(&quot;red&quot;, &quot;10x10&quot;)%&gt;%</div><div class="line">  image_annotate(&quot;I am the King&quot;, color=&apos;red&apos;, size = 25, location = &quot;+100+300&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/mEG1lL005b.png?imageslim" alt=""></p>
<h2 id="图片向量"><a href="#图片向量" class="headerlink" title="图片向量"></a>图片向量</h2><p>magick除了支持管道操作外，还支持图层叠加、拼图以及动图处理，来个经典的动态地球<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">earth &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/a9CjAEGiC5.gif&quot;)</div><div class="line">length(earth)</div><div class="line">print(earth)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/a9CjAEGiC5.gif" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rev(earth) %&gt;% </div><div class="line">  image_flip() %&gt;% </div><div class="line">  image_annotate(&quot;This is the Earth&quot;, size = 20, color = &quot;white&quot;)</div></pre></td></tr></table></figure>
<p>不知什么鬼，图片竟然显示出来乱的，电脑渣的话还是别搞动画</p>
<h2 id="图层"><a href="#图层" class="headerlink" title="图层"></a>图层</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bigdata &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/JclK3efbB3.jpg?imageslim&quot;)</div><div class="line">logo &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/JdjdB88CLm.png?imageslim&quot;)</div><div class="line">frink &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/E5fbmb1FIb.png?imageslim&quot;)</div><div class="line">img &lt;- c(bigdata, logo, frink)</div><div class="line">img &lt;- image_scale(img, &quot;300x300&quot;)</div><div class="line">image_mosaic(img)</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/EE0CEL1K57.jpeg?imageslim" alt=""></p>
<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">image_animate(image_scale(img, &quot;200x200&quot;), fps = 1, dispose = &quot;previous&quot;)#fps控制放映速度</div></pre></td></tr></table></figure>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/0Bi5fCJBE5.gif" alt=""></p>
<h2 id="静图-动图"><a href="#静图-动图" class="headerlink" title="静图+动图"></a>静图+动图</h2><p>静图就用我以前绘制过的，具体可看<a href="https://ytlogos.github.io/2017/08/24/ggplot2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%BE%E5%BD%A2%E6%8E%92%E5%88%97/">博客</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">image1 &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/kLeL888DbI.png?imageslim&quot;)</div><div class="line">dance_man &lt;- image_read(&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/86iEDe36lf.gif&quot;)</div><div class="line">dance_man &lt;- image_scale(dance_man, &quot;200&quot;)</div><div class="line">#Background image</div><div class="line">background &lt;- image_background(image_scale(image1, &quot;800&quot;), &quot;white&quot;, flatten = TRUE)</div><div class="line">#Combine and flatten frames</div><div class="line">frames &lt;- image_apply(dance_man, function(frame)&#123;</div><div class="line">  image_composite(background, frame, offset = &quot;+500+270&quot;)</div><div class="line">&#125;)</div><div class="line">#Turn frames into animation</div><div class="line">animation &lt;- image_animate(frames, fps = 10)</div><div class="line">print(animation)</div></pre></td></tr></table></figure></p>
<p><img src="http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/a2jGAc87jB.gif" alt=""></p>
<p>还有一些有趣的功能这里我就不讲了，有兴趣的可以试试，还是很好玩的。</p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line"></div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 10 x64 (build 15063)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C                              </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] magrittr_1.5 magick_1.2  </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] compiler_3.4.1  backports_1.1.0 rprojroot_1.2   tools_3.4.1    </div><div class="line">##  [5] htmltools_0.3.6 curl_2.8.1      yaml_2.1.14     Rcpp_0.12.12   </div><div class="line">##  [9] stringi_1.1.5   rmarkdown_1.6   knitr_1.17      stringr_1.2.0  </div><div class="line">## [13] digest_0.6.12   evaluate_0.10.1</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ov520p4qw.bkt.clouddn.com/ytlogos/170903/a2jGAc87jB.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;本文主要简单介绍一下magick包，主要用于图像处理&lt;/p&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="magick" scheme="https://ytlogos.github.io/tags/magick/"/>
    
  </entry>
  
  <entry>
    <title>R语言可视化学习笔记之基因组数据可视化</title>
    <link href="https://ytlogos.github.io/2017/08/25/R%E8%AF%AD%E8%A8%80%E5%8F%AF%E8%A7%86%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9F%BA%E5%9B%A0%E7%BB%84%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <id>https://ytlogos.github.io/2017/08/25/R语言可视化学习笔记之基因组数据可视化/</id>
    <published>2017-08-24T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.469Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-38d068706ad3b03a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>本文主要利用<strong>ggpubr</strong>包来探索基因组数据,主要是可视化TCGA基因组数据的基因表达谱。<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">library(ggpubr)#加载包</div></pre></td></tr></table></figure></p>
<p>TCGA是一个包含大量癌症数据的数据库，由Marcin Kosinski创建的RTCGA包可以让我们很方便的获取这些数据。主要有三个包：RTCGA、RTCGA.clininal、RTCGA.mRNA。安装方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#Load the bioconductor installersource</div><div class="line">(&quot;http://bioconductor.org/biocLite.R&quot;&quot;)</div><div class="line">#设置镜像，这里我们选择中科大的镜像options(BioC_mirror=&quot;http://ustc.edu.cn/bioc&quot;)</div><div class="line">#下载包</div><div class="line">biocLite(&quot;RTCGA&quot;)</div><div class="line">biocLite(&quot;RTCGA.clininal&quot;)</div><div class="line">biocLite(&quot;RTCGA.mRNA&quot;)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(RTCGA)</div><div class="line">#查看每一种癌症的数据集</div><div class="line">infoTCGA()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-b34678958936acea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这里只显示部分"></p>
<p><strong>RTCGA</strong>包里的函数<code>expressionTCGA()</code>可以十分方便地从不同数据集中提取基因的表达值，下面我们将从三个数据集BRCA(乳腺癌)、OV(卵巢癌)、LUSC(肺癌)中提取五个基因的表达值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(RTCGA)</div><div class="line">library(RTCGA.mRNA)</div><div class="line">expr &lt;- expressionsTCGA(BRCA.mRNA, OV.mRNA, LUSC.mRNA, </div><div class="line">extract.cols = c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;, &quot;ESR1&quot;, &quot;MUC1&quot;))</div><div class="line">expr</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d4a71b05d7b47010.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>查看每个数据集中的样品数量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">nb_samples &lt;- table(expr$dataset)nb_samples</div><div class="line"></div><div class="line">## </div><div class="line">## BRCA.mRNA  LUSC.mRNA  OV.mRNA </div><div class="line">##    590        154      561</div></pre></td></tr></table></figure></p>
<p>为了方便，我们将部分数据集名称简化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">expr$dataset &lt;- gsub(pattern = &quot;.mRNA&quot;, replacement = &quot;&quot;, expr$dataset)</div><div class="line">expr$bcr_patient_barcode &lt;- paste0(expr$dataset, c(1:590, 1:561, 1:154))</div><div class="line">expr</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-af94785de32b871b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>接下来绘制图形：<br>1、箱线图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(ggpubr)</div><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title=&quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-08c6ecf624be4f0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>我们可以一次性绘制多个基因，然后一一查看，而不用每次写代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#Creat a list of plots</div><div class="line">p &lt;- ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;, &quot;ESR1&quot;, &quot;MUC1&quot;),</div><div class="line">title = c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;, &quot;ESR1&quot;, &quot;MUC1&quot;), </div><div class="line">ylab = &quot;EXpression&quot;, color = &quot;dataset&quot;, palette = &quot;jco&quot;)</div><div class="line">#接下来一一查看每个plot</div><div class="line">p$GATA3</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4bb5efef9d761338.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p$PTEN</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-ad563d41e1fa856d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p$XBP1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-afe413c51f1795d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p$ESR1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5e292cfe7f0d5e3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p$MUC1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-b61b9b569685a032.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>当一次性绘制多个基因时，xlab,ylab,title也可以是一个跟y等长的向量。 接下来就是添加p-value以及显著性了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my_comparisons &lt;- list(c(&quot;BRCA&quot;, &quot;OV&quot;), c(&quot;OV&quot;, &quot;LUSC&quot;))</div><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title = &quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;)+ stat_compare_means(comparisons = my_comparisons)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-bb70ab12668b7010.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>也可以查看每个类型中每一个基因的比较：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compare_means(c(GATA3, PTEN, XBP1)~dataset, data = expr)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-387bd27a2b95a30c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>可以通过select以及remove来决定比较那几个类型，比如这里我们只比较BRCA和OV<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title = &quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, select = c(&quot;BRCA&quot;, &quot;OV&quot;))#通过select选择</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-bef1e0aa4148b8be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title = &quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, remove = &quot;BRCA&quot;)#通过remove选择</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-ccb18f7da8288c6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过order来改变各类型在x轴上的顺序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title = &quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, order = c(&quot;LUSC&quot;, &quot;OV&quot;, &quot;BRCA&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4598a0d2c3d4f402.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过rotate=TRUE来变换坐标轴<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=&quot;GATA3&quot;, title = &quot;GATA3&quot;, ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, rotate=TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-46f6e3b2c093c6c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过combine=TRUE来进行分面（类似于facet）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), ylab = &quot;Expression&quot;, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, combine = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-3562a99a0a400f3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过merge=TRUE或者merge=“axis”将三个类型的plot绘制在一个panel中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), ylab = &quot;Expression&quot;,</div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, merge = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d90335d2c9e74f13.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过merge=flip利用不同癌症类型进行group<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), </div><div class="line">ylab = &quot;Expression&quot;, palette = &quot;jco&quot;, merge = &quot;flip&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-efc44aeb7221760f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过add=jitter增加抖动点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE,</div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, ylab = &quot;Expression&quot;, add = &quot;jitter&quot;, </div><div class="line">add.params = list(size=0.1, jitter=0.2))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5659d5845c1699f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过add=dotplot增加dotplot<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), </div><div class="line">combine = TRUE, color = &quot;dataset&quot;, palette = &quot;jco&quot;, ylab = &quot;Expression&quot;, </div><div class="line">add = &quot;dotplot&quot;, add.params = list(binwidth=0.1, dotsize=0.2))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8111c788c1ceba23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>很多时候我们很像知道箱线图两端的数据，我们可以通过label来进行展示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggboxplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE,</div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, ylab = &quot;Expression&quot;, add = &quot;jitter&quot;, </div><div class="line">add.params = list(size=0.1, jitter=0.2), label = &quot;bcr_patient_barcode&quot;, </div><div class="line">label.select = list(top.up=2, top.down=2), </div><div class="line">font.label = list(size=9, face=&quot;italic&quot;), repel = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-38d068706ad3b03a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>2、小提琴图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggviolin(expr,x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, ylab = &quot;Expression&quot;, add = &quot;boxplot&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a24be637c1b4db89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>通过修改add来更改添加小提琴图里的图形<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggviolin(expr,x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, ylab = &quot;Expression&quot;, add = &quot;median_iqr&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-845354aeeec09083.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>add有好多选项可以选择：“mean”, “mean_se”, “mean_sd”, “mean_ci”, “mean_range”, “median”, “median_iqr”, “median_mad”, “median_range”.有兴趣的可以自己试试。</p>
</blockquote>
<p>3、带状图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggstripchart(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE,</div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, size = 0.1, jitter=0.2, ylab = &quot;Expression&quot;, </div><div class="line">add = &quot;median_iqr&quot;, add.params = list(color=&quot;red&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-52925943216eac0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>4、dotplot<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggdotplot(expr, x=&quot;dataset&quot;, y=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;, fill = &quot;white&quot;, binwidth = 0.1, ylab = &quot;Expression&quot;,</div><div class="line">add = &quot;median_iqr&quot;, add.params = list(size=0.9))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-80f7238f464bba66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>5、密度图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggdensity(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..density..&quot;, </div><div class="line">combine = TRUE, xlab = &quot;Expression&quot;, add = &quot;median&quot;, rug = TRUE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5f6de57b9d6109d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>将dataset映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggdensity(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..density..&quot;, combine = TRUE,</div><div class="line">xlab = &quot;Expression&quot;, add = &quot;median&quot;, rug = TRUE, color = &quot;dataset&quot;, </div><div class="line">fill = &quot;dataset&quot;, palette = &quot;jco&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-2495e6aa4b3f106f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>将三幅图整合进一个panel中，并对y轴进行..count..，而不是..density..<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggdensity(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..count..&quot;, xlab = &quot;Expression&quot;,</div><div class="line">add = &quot;median&quot;, rug = TRUE, palette = &quot;jco&quot;)</div><div class="line">## $GATA3</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c020bff5daa5174a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $PTEN</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-357acb14cd62ea30.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $XBP1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-9f4facdd2b3bbe8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>颜色映射，将x轴变量映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggdensity(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..count..&quot;, color = &quot;.x.&quot;, </div><div class="line">fill = &quot;.x.&quot;, merge = TRUE, xlab = &quot;Expression&quot;, add = &quot;median&quot;, rug = TRUE, palette = &quot;jco&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8d0a6cf618230ec0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>按dataset进行分面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggdensity(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..count..&quot;, color = &quot;.x.&quot;, </div><div class="line">fill = &quot;.x.&quot;, merge = TRUE, xlab = &quot;Expression&quot;, add = &quot;median&quot;, </div><div class="line">rug = TRUE, palette = &quot;jco&quot;, facet.by = &quot;dataset&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-cf2dac791630c3ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>6、直方图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gghistogram(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..density..&quot;, </div><div class="line">xlab = &quot;Expression&quot;, add = &quot;median&quot;, rug = TRUE)</div><div class="line">## $GATA3</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-be8c87506d85f929.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $PTEN</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a0ae7fae20c787bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $XBP1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-709bc0692833b95c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>将dataset映射给颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gghistogram(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), y=&quot;..density..&quot;, xlab = &quot;Expression&quot;, </div><div class="line">add = &quot;median&quot;, rug = TRUE, color = &quot;dataset&quot;, fill = &quot;dataset&quot;, palette = &quot;jco&quot;)</div><div class="line">## $GATA3</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-08d17067003638cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $PTEN</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-0e291051fdf8709b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## ## $XBP1</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-3e69df4a748c733c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>后面还有一些将几幅图整合在一个panel以及分面等大同小异就不讲了。<br>7、Q-Q图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggqqplot(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE, size = 0.5)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-438ad8dd5a855bae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>颜色映射<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggqqplot(expr, x=c(&quot;GATA3&quot;, &quot;PTEN&quot;, &quot;XBP1&quot;), combine = TRUE, size = 0.5, </div><div class="line">color = &quot;dataset&quot;, palette = &quot;jco&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-edb0e229e75a1e2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>#sessionInfo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.0 (2017-04-21)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.2 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/libblas/libblas.so.3.6.0</div><div class="line">## LAPACK: /usr/lib/lapack/liblapack.so.3.6.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C </div><div class="line">## [3] LC_TIME=zh_CN.UTF-8 LC_COLLATE=en_US.UTF-8 </div><div class="line">## [5] LC_MONETARY=zh_CN.UTF-8 LC_MESSAGES=en_US.UTF-8</div><div class="line">## [7] LC_PAPER=zh_CN.UTF-8 LC_NAME=C </div><div class="line">## [9] LC_ADDRESS=C LC_TELEPHONE=C </div><div class="line">## [11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats graphics grDevices utils datasets methods base </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] bindrcpp_0.2 RTCGA.mRNA_1.4.0 RTCGA_1.6.0 ggpubr_0.1.3 </div><div class="line">## [5] magrittr_1.5 ggplot2_2.2.1 </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] zoo_1.8-0 reshape2_1.4.2 purrr_0.2.2.2 </div><div class="line">## [4] splines_3.4.0 ggthemes_3.4.0 lattice_0.20-35 </div><div class="line">## [7] colorspace_1.3-2 htmltools_0.3.6 viridisLite_0.2.0</div><div class="line">## [10] yaml_2.1.14 survival_2.41-3 XML_3.98-1.9 </div><div class="line">## [13] survMisc_0.5.4 rlang_0.1.1 foreign_0.8-68 </div><div class="line">## [16] glue_1.1.0 bindr_0.1 plyr_1.8.4 </div><div class="line">## [19] stringr_1.2.0 ggsignif_0.2.0 munsell_0.4.3 </div><div class="line">## [22] gtable_0.2.0 ggsci_2.7 rvest_0.3.2 </div><div class="line">## [25] psych_1.7.5 evaluate_0.10 labeling_0.3 </div><div class="line">## [28] knitr_1.16 parallel_3.4.0 broom_0.4.2 </div><div class="line">## [31] Rcpp_0.12.11 xtable_1.8-2 scales_0.4.1</div><div class="line">## [34] backports_1.1.0 cmprsk_2.2-7 km.ci_0.5-2 </div><div class="line">## [37] gridExtra_2.2.1 mnormt_1.5-5 digest_0.6.12 </div><div class="line">## [40] stringi_1.1.5 ggrepel_0.6.5 dplyr_0.7.0 </div><div class="line">## [43] KMsurv_0.1-5 grid_3.4.0 rprojroot_1.2 </div><div class="line">## [46] tools_3.4.0 lazyeval_0.2.0 tibble_1.3.3 </div><div class="line">## [49] tidyr_0.6.3 Matrix_1.2-10 data.table_1.10.4</div><div class="line">## [52] xml2_1.1.1 survminer_0.4.0 assertthat_0.2.0 </div><div class="line">## [55] rmarkdown_1.6 httr_1.2.1 viridis_0.4.0 </div><div class="line">## [58] R6_2.2.2 nlme_3.1-131 compiler_3.4.0</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-38d068706ad3b03a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;本文主要利用&lt;strong&gt;ggpubr&lt;/strong&gt;包来探索基因组数据,主要是可视化TCGA基因组数据的基因表达谱。&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggpubr" scheme="https://ytlogos.github.io/tags/ggpubr/"/>
    
  </entry>
  
  <entry>
    <title>ggplot2学习笔记之图形排列</title>
    <link href="https://ytlogos.github.io/2017/08/24/ggplot2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%BE%E5%BD%A2%E6%8E%92%E5%88%97/"/>
    <id>https://ytlogos.github.io/2017/08/24/ggplot2学习笔记之图形排列/</id>
    <published>2017-08-23T16:00:00.000Z</published>
    <updated>2017-09-19T00:39:01.428Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e6bf2901af3d315e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>R语言基本绘图函数中可以利用par()以及layout()来进行图形排列，但是这两个函数对于ggplot图则不太适用，本文主要讲解如何对多ggplot图形多页面进行排列。主要讲解如何利用包gridExtra、cowplot以及ggpubr中的函数进行图形排列。<br><a id="more"></a></p>
<h2 id="绘制图形"><a href="#绘制图形" class="headerlink" title="绘制图形"></a>绘制图形</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#load packages</div><div class="line">library(gridExtra)</div><div class="line">library(cowplot)</div><div class="line">library(ggpubr)</div><div class="line">#dataset ToothGrowth and mtcars</div><div class="line">mtcars$name &lt;- rownames(mtcars)</div><div class="line">mtcars$cyl &lt;- as.factor(mtcars$cyl)</div><div class="line">head(mtcars[, c(&quot;name&quot;, &quot;wt&quot;,&quot;mpg&quot;, &quot;cyl&quot;)])</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e97fd1379156e2e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#First let&apos;s create some plots</div><div class="line">#Box plot(bxp)</div><div class="line">bxp &lt;- ggboxplot(ToothGrowth, x=&quot;dose&quot;, y=&quot;len&quot;, color = &quot;dose&quot;, palette = &quot;jco&quot;)</div><div class="line">#Dot plot(dp)</div><div class="line">dp &lt;- ggdotplot(ToothGrowth, x=&quot;dose&quot;, y=&quot;len&quot;, color = &quot;dose&quot;, palette = &quot;jco&quot;, binwidth = 1)</div><div class="line">#An ordered Bar plot(bp)</div><div class="line">bp &lt;- ggbarplot(mtcars, x=&quot;name&quot;, y=&quot;mpg&quot;, fill=&quot;cyl&quot;, #change fill color by cyl </div><div class="line">color=&quot;white&quot;, #Set bar border colors to white </div><div class="line">palette = &quot;jco&quot;, #jco jourbal color palette </div><div class="line">sort.val = &quot;asc&quot;, #Sort the value in ascending order </div><div class="line">sort.by.groups = TRUE, #Sort inside each group </div><div class="line">x.text.angle=90 #Rotate vertically x axis texts )</div><div class="line">bp+font(&quot;x.text&quot;, size = 8)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-f1195474adb47ef5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#Scatter plots(sp)</div><div class="line">sp &lt;- ggscatter(mtcars, x=&quot;wt&quot;, y=&quot;mpg&quot;, add = &quot;reg.line&quot;, #Add regression line </div><div class="line">conf.int = TRUE, #Add confidence interval </div><div class="line">color = &quot;cyl&quot;, palette = &quot;jco&quot;,#Color by group cyl </div><div class="line">shape = &quot;cyl&quot; #Change point shape by groups cyl </div><div class="line">)+ </div><div class="line">stat_cor(aes(color=cyl), label.x = 3) #Add correlation coefficientsp</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-60d2ce55b9ce82f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="图形排列"><a href="#图形排列" class="headerlink" title="图形排列"></a>图形排列</h2><blockquote>
<p>多幅图形排列于一面</p>
</blockquote>
<ul>
<li>ggpubr::ggarrange()<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggarrange(bxp, dp, bp+rremove(&quot;x.text&quot;), labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), ncol = 2, nrow = 2)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-dbc9f5f6ba4082ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>cowplot::plot.grid()<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot_grid(bxp, dp, bp+rremove(&quot;x.text&quot;), labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), ncol = 2, nrow = 2)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-dbc9f5f6ba4082ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>gridExtra::grid.arrange()<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grid.arrange(bxp, dp, bp+rremove(&quot;x.text&quot;), ncol=2, nrow=2)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-0d3d087bce2af907.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="排列图形注释"><a href="#排列图形注释" class="headerlink" title="排列图形注释"></a>排列图形注释</h2><ul>
<li>ggpubr::annotate_figure()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">figure &lt;- ggarrange(sp, bp+font(&quot;x.text&quot;, size = 10), ncol = 1, nrow = 2)</div><div class="line">annotate_figure(figure, top=text_grob(&quot;Visualizing mpg&quot;, color = &quot;red&quot;, </div><div class="line">face = &quot;bold&quot;, size=14), bottom = text_grob(&quot;Data source:\n mtcars data set&quot;, </div><div class="line">color = &quot;blue&quot;, hjust = 1, x=1, face = &quot;italic&quot;, size=10), left = text_grob(&quot;Figure arranged using ggpubr&quot;, color = &quot;green&quot;, rot = 90), </div><div class="line">right = &quot;I&apos;m done, thanks :-)!&quot;, fig.lab = &quot;Figure 1&quot;, fig.lab.face = &quot;bold&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-36ca476191d8af86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="绘图面板对齐"><a href="#绘图面板对齐" class="headerlink" title="绘图面板对齐"></a>绘图面板对齐</h2><ul>
<li>绘制生存曲线<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">library(survival)</div><div class="line">head(colon[, c(1:4)])</div><div class="line">#Fit survival curves</div><div class="line">fit &lt;- survfit(Surv(time, status)~adhere, data = colon)</div><div class="line">library(survminer)</div><div class="line">ggsurv &lt;- ggsurvplot(fit, data = colon, palette = &quot;jco&quot;, #jco palette </div><div class="line">pval = TRUE, pval.coord=c(500, 0.4), #Add p-value </div><div class="line">risk.table = TRUE #Add risk table)</div><div class="line">names(ggsurv)</div><div class="line">`</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## [1] &quot;plot&quot; &quot;table&quot; &quot;data.survplot&quot; &quot;data.survtable&quot;</div></pre></td></tr></table></figure>
<blockquote>
<p>ggsurv是一个包含两部分的list </p>
<ul>
<li>plot：生存曲线</li>
<li>table：风险表<br>可以用ggarrange()进行排列这两者<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggarrange(ggsurv$plot, ggsurv$table, heights = c(2, 0.7), ncol = 1, nrow = 2)</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e53edb9d332af479.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>上图中的坐标轴没有对齐，可以通过参数align来设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggarrange(ggsurv$plot, ggsurv$table, heights = c(2, 0.7), ncol = 1, nrow = 2, align = &quot;v&quot;)</div></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4e2c926c330d1680.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="改变排列图的行列"><a href="#改变排列图的行列" class="headerlink" title="改变排列图的行列"></a>改变排列图的行列</h2><p>设置面板为两行两列，其中sp占据第一行的两列，bxp以及dp置于第二行的两列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggarrange(sp, #First row with scatter plot(sp) </div><div class="line">ggarrange(bxp, dp, ncol = 2, labels = c(&quot;B&quot;,&quot;C&quot;)),#Second row with box and dot plot </div><div class="line">nrow = 2, labels = &quot;A&quot; #Labels of the scatter plot)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-6b2884cdeeb38d66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="R包cowplot"><a href="#R包cowplot" class="headerlink" title="R包cowplot"></a>R包cowplot</h2><blockquote>
<p>cowplot::ggdraw()可以将图形置于特定位置, ggdraw()首先会初始化一个绘图面板， 接下来draw_plot()则是将图形绘制于初始化的绘图面板中，通过参数设置可以将图形置于特定位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">draw_plot(plot, x=0, y=0, width=1, height=1)</div></pre></td></tr></table></figure></p>
</blockquote>
<p>其中： </p>
<ul>
<li>plot:将要放置的图形 </li>
<li>x,y:控制图形位置 </li>
<li>width,height:图形的宽度和高度</li>
<li>draw_plot_label():为图形添加标签<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">draw_plot_label(label, x=0, y=1, size=16, ...)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>其中：</p>
<ul>
<li>label:标签</li>
<li>x,y:控制标签位置</li>
<li>size:标签字体大小</li>
</ul>
<p>下面通过一个例子来讲解如何将多个图形放置在特定的位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggdraw()+ draw_plot(bxp, x=0, y=0.5, width=0.5, height = 0.5)+</div><div class="line">draw_plot(dp, x=0.5, y=0.5, width = 0.5, height = 0.5)+ </div><div class="line">draw_plot(bp, x=0, y=0, width = 1.5, height = 0.5)+ </div><div class="line">draw_plot_label(label = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), size = 15, x=c(0, 0.5, 0), y=c(1, 1, 0.5))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a342161e1f1e5cf4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="R包gridExtra"><a href="#R包gridExtra" class="headerlink" title="R包gridExtra"></a>R包gridExtra</h2><blockquote>
<p>gridExtra::arrangeGrop()改变行列分布</p>
</blockquote>
<p>下面将sp置于第一行并横跨两列，而bxp和dp分别分布于第二行两列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grid.arrange(sp, #First row with one plot spaning over 2 columns</div><div class="line">arrangeGrob(bxp, dp, ncol = 2), #Second row with 2plots in 2 different columns </div><div class="line">nrow=2) #number of rows</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-bd23e000d25050e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>也可以通过函数grid.arrange中的layout_matrix来设置复杂的图形布局<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grid.arrange(bp, #bar plot spaning two columns </div><div class="line">bxp, sp, #box plot amd scatter plot </div><div class="line">ncol=2, nrow=2, layout_matrix=rbind(c(1, 1), c(2, 3)))</div></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-918661a64ae22dcc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>要相对grid.arrange()以及arrangeGrob()的输出进行注释，首先要利用as_ggplot()将其转化为ggplot图形，进而利用函数draw_plot_label()对其进行注释。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gt &lt;- arrangeGrob(bp, bxp, sp, layout_matrix = rbind(c(1,1),c(2, 3)))</div><div class="line">p &lt;- as_ggplot(gt)+ </div><div class="line">draw_plot_label(label = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), size = 15, x=c(0, 0, 0.5), y=c(1, 0.5, 0.5))</div><div class="line">p</div></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-251b2907ceddcbc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="R包grid"><a href="#R包grid" class="headerlink" title="R包grid"></a>R包grid</h2><blockquote>
<p>R包grid中的grid.layout()可以设置复杂的图形布局，viewport()可以定义一个区域用来安置图形排列，print()则用来将图形置于特定区域。 总结起来步骤如下：</p>
</blockquote>
<ul>
<li>创建图形p1,p2,p3,…</li>
<li>grid.newpage()创建一个画布</li>
<li>创建图形布局，几行几列</li>
<li>定义布局的矩形区域</li>
<li>print：将图形置于特定区域<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">library(grid)</div><div class="line">#Move to a new page</div><div class="line">grid.newpage()</div><div class="line">#Create layout:nrow=3, ncol=2</div><div class="line">pushViewport(viewport(layout = grid.layout(nrow=3, ncol=2)))</div><div class="line">#A helper function to define a region on the layout</div><div class="line">define_region &lt;- function(row, col)&#123; </div><div class="line">viewport(layout.pos.row = row, layout.pos.col = col)&#125;</div><div class="line">#Arrange the plots</div><div class="line">print(sp, vp=define_region(row=1, col=1:2)) #Span over two columns</div><div class="line">print(bxp, vp=define_region(row=2, col=1))</div><div class="line">print(dp, vp=define_region(row=2, col=2))</div><div class="line">print(bp+rremove(&quot;x.text&quot;), vp=define_region(row=3, col=1:2))</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="设置共同图例"><a href="#设置共同图例" class="headerlink" title="设置共同图例"></a>设置共同图例</h2><blockquote>
<p>ggpubr::ggarrange()可以为组合图形添加共同图例</p>
</blockquote>
<ul>
<li>common.legeng=TRUE:在图形旁边添加图例</li>
<li>legend：指定legend的位置，主要选项有：top、bottom、left、right。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggarrange(bxp, dp, labels = c(&quot;A&quot;, &quot;B&quot;), common.legend = TRUE, legend = &quot;bottom&quot;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-ca42c6bbb45bcfdf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="含有边际密度图的散点图"><a href="#含有边际密度图的散点图" class="headerlink" title="含有边际密度图的散点图"></a>含有边际密度图的散点图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggscatter(iris, x=&quot;Sepal.Length&quot;, y=&quot;Sepal.Width&quot;, color=&quot;Species&quot;, </div><div class="line">palette = &quot;jco&quot;, size=3, alpha=0.6)+border()</div><div class="line">#Marginal density plot of x(top panel) and y(right panel)</div><div class="line">xplot &lt;- ggdensity(iris, &quot;Sepal.Length&quot;, fill=&quot;Species&quot;,palette = &quot;jco&quot;)</div><div class="line">yplot &lt;- ggdensity(iris, &quot;Sepal.Width&quot;, fill=&quot;Species&quot;, palette = &quot;jco&quot;)+rotate()</div><div class="line">#Clean the plots</div><div class="line">xplot &lt;- xplot+clean_theme()</div><div class="line">yplot &lt;- yplot+clean_theme()</div><div class="line">#Arrange the plots</div><div class="line">ggarrange(xplot, NULL, sp, yplot, ncol = 2, nrow = 2, align = &quot;hv&quot;, widths = c(2, 1), </div><div class="line">heights = c(1, 2), common.legend = TRUE)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1565dd7ff1900770.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="ggplot图、文本、表格组合"><a href="#ggplot图、文本、表格组合" class="headerlink" title="ggplot图、文本、表格组合"></a>ggplot图、文本、表格组合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">density.p &lt;- ggdensity(iris, x=&quot;Sepal.Length&quot;, fill=&quot;Species&quot;, palette = &quot;jco&quot;)</div><div class="line">#Compute the summary table of Sepal.Length</div><div class="line">stable &lt;- desc_statby(iris, measure.var = &quot;Sepal.Length&quot;, grps = &quot;Species&quot;)</div><div class="line">stable &lt;- stable[, c(&quot;Species&quot;, &quot;length&quot;, &quot;mean&quot;, &quot;sd&quot;)]</div><div class="line">#Summary table plot, medium and theme</div><div class="line">stable.p &lt;- ggtexttable(stable, rows = NULL, theme = ttheme(&quot;mOrange&quot;))</div><div class="line">text &lt;- paste(&quot;iris data set gives the measurements in cm&quot;, &quot;of the variables sepal length and width&quot;, &quot;and petal length and width, respectively,&quot;, &quot;for 50 flowers from each of 3 species of iris.&quot;, &quot;The species are Iris setosa, versicolor, and virginica.&quot;, sep = &quot; &quot;)</div><div class="line">text.p &lt;- ggparagraph(text = text, face = &quot;italic&quot;, size = 11, color = &quot;black&quot;)</div><div class="line">#Arrange the plots on the same page</div><div class="line">ggarrange(density.p, stable.p, text.p, ncol = 1, nrow = 3, heights = c(1, 0.5, 0.3))</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-6d68d9bbc420bdd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="ggplot图形中嵌入图形元素"><a href="#ggplot图形中嵌入图形元素" class="headerlink" title="ggplot图形中嵌入图形元素"></a>ggplot图形中嵌入图形元素</h2><blockquote>
<p>ggplot2::annotation_custom()可以添加各种图形元素到ggplot图中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">annotation_custom(grob, xmin, xmax, ymin, ymax)</div></pre></td></tr></table></figure></p>
</blockquote>
<p>其中：</p>
<ul>
<li>grob:要添加的图形元素</li>
<li>xmin, xmax: x轴方向位置（水平方向）</li>
<li>ymin, ymax: y轴方向位置（竖直方向）</li>
</ul>
<h2 id="ggplot图形中添加table"><a href="#ggplot图形中添加table" class="headerlink" title="ggplot图形中添加table"></a>ggplot图形中添加table</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">density.p+annotation_custom(ggplotGrob(stable.p), xmin = 5.5, xmax = 8, ymin = 0.7)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-3806bee958243f30.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="ggplot图形中添加box-plot"><a href="#ggplot图形中添加box-plot" class="headerlink" title="ggplot图形中添加box plot"></a>ggplot图形中添加box plot</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggscatter(iris, x=&quot;Sepal.Length&quot;, y=&quot;Sepal.Width&quot;, color = &quot;Species&quot;, palette = &quot;jco&quot;, size = 3, alpha=0.6)</div><div class="line">xbp &lt;- ggboxplot(iris$Sepal.Length, width = 0.3, fill = &quot;lightgray&quot;)+ rotate()+theme_transparent()</div><div class="line">ybp &lt;- ggboxplot(iris$Sepal.Width, width = 0.3, fill=&quot;lightgray&quot;)+theme_transparent()</div><div class="line"># Create the external graphical objects</div><div class="line"># called a &quot;grop&quot; in Grid terminology</div><div class="line">xbp_grob &lt;- ggplotGrob(xbp)</div><div class="line">ybp_grob &lt;- ggplotGrob(ybp)</div><div class="line">#place box plots inside the scatter plot</div><div class="line">xmin &lt;- min(iris$Sepal.Length)</div><div class="line">xmax &lt;- max(iris$Sepal.Length)</div><div class="line">ymin &lt;- min(iris$Sepal.Width)</div><div class="line">ymax &lt;- max(iris$Sepal.Width)</div><div class="line">yoffset &lt;- (1/15)*ymax</div><div class="line">xoffset &lt;- (1/15)*xmax</div><div class="line"># Insert xbp_grob inside the scatter plots</div><div class="line">p+annotation_custom(grob = xbp_grob, xmin = xmin, xmax = xmax, </div><div class="line">ymin = ymin-yoffset, ymax = ymin+yoffset)+</div><div class="line"># Insert ybp_grob inside the scatter plot</div><div class="line">annotation_custom(grob = ybp_grob, xmin = xmin-xoffset, </div><div class="line">xmax=xmin+xoffset, ymin=ymin, ymax=ymax)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d94210f5f4783fbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="ggplot图形添加背景"><a href="#ggplot图形添加背景" class="headerlink" title="ggplot图形添加背景"></a>ggplot图形添加背景</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#import the imageimg.file &lt;- system.file(file.path(&quot;images&quot;, &quot;background-image.png&quot;), package = &quot;ggpubr&quot;)</div><div class="line">img &lt;- png::readPNG(img.file)</div></pre></td></tr></table></figure>
<blockquote>
<p>利用ggpubr::background_image()为ggplot图形添加背景图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(ggplot2)</div><div class="line">library(ggpubr)</div><div class="line">ggplot(iris, aes(Species,Sepal.Length))+</div><div class="line">background_image(img)+</div><div class="line">geom_boxplot(aes(fill=Species), color=&quot;white&quot;)+ fill_palette(&quot;jco&quot;)</div></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5f7514c22e7add04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="修改透明度"><a href="#修改透明度" class="headerlink" title="修改透明度"></a>修改透明度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(iris, aes(Species,Sepal.Length))+</div><div class="line">background_image(img)+geom_boxplot(aes(fill=Species), color=&quot;white&quot;, alpha=0.5)+ </div><div class="line">fill_palette(&quot;jco&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-cd305569d612b588.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="多页排列"><a href="#多页排列" class="headerlink" title="多页排列"></a>多页排列</h2><blockquote>
<p>日常工作中我们有时要绘制许多图，假如我们有16幅图，每页排列4张的话就需要4页才能排完，而ggpubr::ggarrange()可以通过制定行列数自动在多页之间进行图形排列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">multi.page &lt;-ggarrange(bxp, dp, bp, sp, nrow = 1, ncol = 2)</div></pre></td></tr></table></figure></p>
</blockquote>
<p>上述代码返回两页每页两图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">multi.page[[1]]</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-033d7bb70f07ee91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">multi.page[[2]]</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a92858066ced1ad0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="利用ggarrange-嵌套布局"><a href="#利用ggarrange-嵌套布局" class="headerlink" title="利用ggarrange()嵌套布局"></a>利用ggarrange()嵌套布局</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p1 &lt;- ggarrange(sp, bp+font(&quot;x.text&quot;, size = 9), ncol = 1, nrow = 2)</div><div class="line">p2 &lt;- ggarrange(density.p, stable.p, text.p, ncol = 1, nrow = 3, </div><div class="line">heights = c(1, 0.5, 0.3))</div><div class="line">ggarrange(p1, p2, ncol = 2, nrow = 1)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e6bf2901af3d315e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 10 x64 (build 15063)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936 </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C</div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936 </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] grid stats graphics grDevices utils datasets methods </div><div class="line">## [8] base </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] survminer_0.4.0 survival_2.41-3 ggpubr_0.1.5 magrittr_1.5 </div><div class="line">## [5] cowplot_0.8.0 ggplot2_2.2.1 gridExtra_2.2.1</div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] zoo_1.8-0 purrr_0.2.3 reshape2_1.4.2 </div><div class="line">## [4] splines_3.4.1 lattice_0.20-35 colorspace_1.3-2 </div><div class="line">## [7] htmltools_0.3.6 yaml_2.1.14 survMisc_0.5.4</div><div class="line">## [10] rlang_0.1.2 foreign_0.8-69 glue_1.1.1 </div><div class="line">## [13] bindrcpp_0.2 bindr_0.1 plyr_1.8.4 </div><div class="line">## [16] stringr_1.2.0 munsell_0.4.3 gtable_0.2.0 </div><div class="line">## [19] ggsci_2.7 psych_1.7.5 evaluate_0.10.1 </div><div class="line">## [22] labeling_0.3 knitr_1.17 parallel_3.4.1 </div><div class="line">## [25] broom_0.4.2 Rcpp_0.12.12 xtable_1.8-2 </div><div class="line">## [28] scales_0.4.1 backports_1.1.0 cmprsk_2.2-7 </div><div class="line">## [31] km.ci_0.5-2 mnormt_1.5-5 png_0.1-7 </div><div class="line">## [34] digest_0.6.12 stringi_1.1.5 dplyr_0.7.2 </div><div class="line">## [37] KMsurv_0.1-5 rprojroot_1.2 tools_3.4.1 </div><div class="line">## [40] lazyeval_0.2.0 tibble_1.3.3 tidyr_0.7.0 </div><div class="line">## [43] pkgconfig_2.0.1 Matrix_1.2-11 data.table_1.10.4</div><div class="line">## [46] assertthat_0.2.0 rmarkdown_1.6 R6_2.2.2 </div><div class="line">## [49] nlme_3.1-131 compiler_3.4.1</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><ul>
<li>wechat: yt056410</li>
<li>Email: tyan@zju.edu.cn</li>
<li>QQ: 1051927088</li>
<li>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></li>
<li>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></li>
<li>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></li>
</ul>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛</p>
<ul>
<li>浙江大学作物遗传育种在读研究生（生物信息学方向）</li>
<li>伪码农，R语言爱好者，爱开源</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-e6bf2901af3d315e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;R语言基本绘图函数中可以利用par()以及layout()来进行图形排列，但是这两个函数对于ggplot图则不太适用，本文主要讲解如何对多ggplot图形多页面进行排列。主要讲解如何利用包gridExtra、cowplot以及ggpubr中的函数进行图形排列。&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggpubr" scheme="https://ytlogos.github.io/tags/ggpubr/"/>
    
  </entry>
  
  <entry>
    <title>R语言学习笔记之热图绘制</title>
    <link href="https://ytlogos.github.io/2017/08/21/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%83%AD%E5%9B%BE%E7%BB%98%E5%88%B6/"/>
    <id>https://ytlogos.github.io/2017/08/21/R语言学习笔记之热图绘制/</id>
    <published>2017-08-20T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.474Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-076503522b98e6a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文将绘制静态与交互式热图，需要使用到以下R包和函数：<br><code>heatmap()</code>:用于绘制简单热图的函数<br><code>heatmap.2()</code>:绘制增强热图的函数<br><code>d3heatmap</code>:用于绘制交互式热图的R包<br><code>ComplexHeatmap</code>:用于绘制、注释和排列复杂热图的R&amp;bioconductor包（非常适用于基因组数据分析）<br><a id="more"></a></p>
<h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><p>使用R内置数据集<code>mtcars</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df &lt;- as.matrix((scale(mtcars)))#归一化、矩阵化</div></pre></td></tr></table></figure></p>
<h2 id="使用基本函数绘制简单简单热图"><a href="#使用基本函数绘制简单简单热图" class="headerlink" title="使用基本函数绘制简单简单热图"></a>使用基本函数绘制简单简单热图</h2><p>主要是函数<code>heatmap(x, scale=&quot;row&quot;)</code></p>
<ul>
<li>x:数据矩阵</li>
<li>scale：表示不同方向，可选值有：row, columa, none</li>
<li>Default plotheatmap(df, scale = “none”)<br><img src="http://upload-images.jianshu.io/upload_images/2084719-c7bea2866745dab0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Use custom colors</div><div class="line">col &lt;- colorRampPalette(c(&quot;red&quot;, &quot;white&quot;, &quot;blue&quot;))(256)</div><div class="line">heatmap(df, scale = &quot;none&quot;, col=col)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-ebc5d8bff1232cd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#Use RColorBrewer color palette names</div><div class="line">library(RColorBrewer)col &lt;- colorRampPalette(brewer.pal(10, &quot;RdYlBu&quot;))(256)#自设置调色板dim(df)#查看行列数</div><div class="line">## [1] 32 11</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">heatmap(df, scale = &quot;none&quot;, col=col, RowSideColors = rep(c(&quot;blue&quot;, &quot;pink&quot;), each=16), </div><div class="line">ColSideColors = c(rep(&quot;purple&quot;, 5), rep(&quot;orange&quot;, 6)))</div><div class="line">#参数RowSideColors和ColSideColors用于分别注释行和列颜色等,可help(heatmap)详情</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4d1b42636045984b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="增强热图"><a href="#增强热图" class="headerlink" title="增强热图"></a>增强热图</h2><p>函数<code>heatmap.2()</code><br>在热图绘制方面提供许多扩展，此函数包装在<code>gplots</code>包里。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(gplots)heatmap.2(df, scale = &quot;none&quot;, col=bluered(100), </div><div class="line">trace = &quot;none&quot;, density.info = &quot;none&quot;)#还有其他参数可参考help(heatmap.2())</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-68ac84c2447943b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="交互式热图绘制"><a href="#交互式热图绘制" class="headerlink" title="交互式热图绘制"></a>交互式热图绘制</h2><p><code>d3heatmap</code>包可用于生成交互式热图绘制,可通过以下代码生成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (!require(&quot;devtools&quot;)) </div><div class="line">install.packages(&quot;devtools&quot;) </div><div class="line">devtools::install_github(&quot;rstudio/d3heatmap&quot;)</div></pre></td></tr></table></figure></p>
<p> 函数<code>d3heatmap()</code>用于创建交互式热图，有以下功能：</p>
<ul>
<li>将鼠标放在感兴趣热图单元格上以查看行列名称及相应值</li>
<li>可选择区域进行缩放<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">library(d3heatmap)d3heatmap(df, colors = &quot;RdBu&quot;, k_row = 4, k_col = 2)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><code>k_row</code>、<code>k_col</code>分别指定用于对行列中树形图分支进行着色所需组数。进一步信息可<code>help(d3heatmap())</code>获取。</p>
<h2 id="使用dendextend包增强热图"><a href="#使用dendextend包增强热图" class="headerlink" title="使用dendextend包增强热图"></a>使用<code>dendextend</code>包增强热图</h2><p>软件包<code>dendextend</code>可以用于增强其他软件包的功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">library(dendextend)# order for rows</div><div class="line">Rowv &lt;- mtcars %&gt;% scale %&gt;% dist %&gt;% </div><div class="line">hclust %&gt;% as.dendrogram %&gt;%</div><div class="line"> set(&quot;branches_k_color&quot;, k = 3) %&gt;% </div><div class="line">set(&quot;branches_lwd&quot;, 1.2) %&gt;% ladderize# Order for columns# </div><div class="line">We must transpose the data</div><div class="line">Colv &lt;- mtcars %&gt;% scale %&gt;% t %&gt;% dist %&gt;% </div><div class="line">hclust %&gt;% as.dendrogram %&gt;%</div><div class="line"> set(&quot;branches_k_color&quot;, k = 2, value = c(&quot;orange&quot;, &quot;blue&quot;)) %&gt;% set(&quot;branches_lwd&quot;, 1.2) %&gt;% ladderize</div><div class="line">增强heatmap()函数</div><div class="line">---</div><div class="line">heatmap(df, Rowv = Rowv, Colv = Colv, scale = &quot;none&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-efdf6c2b659c0af0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#增强heatmap.2()函数</div><div class="line">heatmap.2(df, scale = &quot;none&quot;, col = bluered(100), Rowv = Rowv, Colv = Colv, trace = &quot;none&quot;, density.info = &quot;none&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e26e47cd2f8df3c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#增强交互式绘图函数</div><div class="line">d2heatmap()d3heatmap(scale(mtcars), colors = &quot;RdBu&quot;, Rowv = Rowv, Colv = Colv)</div></pre></td></tr></table></figure></p>
<h2 id="绘制复杂热图"><a href="#绘制复杂热图" class="headerlink" title="绘制复杂热图"></a>绘制复杂热图</h2><p><code>ComplexHeatmap</code>包是<code>bioconductor</code>包，用于绘制复杂热图，它提供了一个灵活的解决方案来安排和注释多个热图。它还允许可视化来自不同来源的不同数据之间的关联热图。可通过以下代码安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if (!require(&quot;devtools&quot;)) install.packages(&quot;devtools&quot;) </div><div class="line">devtools::install_github(&quot;jokergoo/ComplexHeatmap&quot;)</div></pre></td></tr></table></figure></p>
<p><code>ComplexHeatmap</code>包的主要功能函数是<code>Heatmap()</code>,格式为：<code>Heatmap(matrix, col, name)</code></p>
<ul>
<li><code>matrix</code>：矩阵</li>
<li><code>col</code>：颜色向量（离散色彩映射）或颜色映射函数（如果矩阵是连续数）</li>
<li><code>name</code>：热图名称<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(ComplexHeatmap)</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-30f041fb4859171f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#自设置颜色</div><div class="line">library(circlize)</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = colorRamp2(c(-2, 0, 2), c(&quot;green&quot;, &quot;white&quot;, &quot;red&quot;)))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-b118f36783b5d212.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="使用调色板"><a href="#使用调色板" class="headerlink" title="使用调色板"></a>使用调色板</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;,col = colorRamp2(c(-2, 0, 2), brewer.pal(n=3, name=&quot;RdBu&quot;)))</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-de34356535c8a3e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#自定义颜色</div><div class="line">mycol &lt;- colorRamp2(c(-2, 0, 2), c(&quot;blue&quot;, &quot;white&quot;, &quot;red&quot;))</div></pre></td></tr></table></figure></p>
<p>#热图及行列标题设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, column_title = &quot;Column title&quot;, row_title = </div><div class="line">&quot;Row title&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-2f553afb61a6370a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>注意，行标题的默认位置是“left”，列标题的默认是“top”。可以使用以下选项更改：</p>
<ul>
<li><code>row_title_side</code>：允许的值为“左”或“右”（例如：row_title_side =“right”）</li>
<li><code>column_title_side</code>：允许的值为“top”或“bottom”（例如：column_title_side =“bottom”） 也可以使用以下选项修改字体和大小：</li>
<li><code>row_title_gp</code>：用于绘制行文本的图形参数</li>
<li><code>column_title_gp</code>：用于绘制列文本的图形参数<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, column_title = &quot;Column title&quot;, </div><div class="line">column_title_gp = gpar(fontsize = 14, fontface = &quot;bold&quot;), </div><div class="line">row_title = &quot;Row title&quot;, row_title_gp = gpar(fontsize = 14, fontface = &quot;bold&quot;))</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-f35f017c7d0118d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>在上面的R代码中，<code>fontface</code>的可能值可以是整数或字符串：1 = plain，2 = bold，3 =斜体，4 =粗体斜体。如果是字符串，则有效值为：“plain”，“bold”，“italic”，“oblique”和“bold.italic”。<br>显示行/列名称：</p>
<ul>
<li><code>show_row_names</code>：是否显示行名称。默认值为<code>TRUE</code></li>
<li><code>show_column_names</code>：是否显示列名称。默认值为<code>TRUE</code></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, show_row_names = FALSE)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d0c74b9038eb0021.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="更改聚类外观"><a href="#更改聚类外观" class="headerlink" title="更改聚类外观"></a>更改聚类外观</h2><p>默认情况下，行和列是包含在聚类里的。可以使用参数修改：</p>
<ul>
<li><code>cluster_rows = FALSE</code>。如果为<code>TRUE</code>，则在行上创建集群</li>
<li><code>cluster_columns = FALSE</code>。如果<code>为TRUE</code>，则将列置于簇上<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Inactivate cluster on rows</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, cluster_rows = FALSE)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1935cb8a6b1bc7ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>如果要更改列集群的高度或宽度，可以使用选项<code>column_dend_height</code><br>和<code>row_dend_width</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, column_dend_height = unit(2, &quot;cm&quot;), </div><div class="line">row_dend_width = unit(2, &quot;cm&quot;) )</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c7fb9371e59ca553.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>我们还可以利用<code>color_branches()</code>自定义树状图外观<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(dendextend)</div><div class="line">row_dend = hclust(dist(df)) # row clustering</div><div class="line">col_dend = hclust(dist(t(df))) # column clustering</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, cluster_rows = </div><div class="line">color_branches(row_dend, k = 4), cluster_columns = color_branches(col_dend, k = 2))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1d01beb556d77bdd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="不同的聚类距离计算方式"><a href="#不同的聚类距离计算方式" class="headerlink" title="不同的聚类距离计算方式"></a>不同的聚类距离计算方式</h2><p>参数<code>clustering_distance_rows</code>和<code>clustering_distance_columns</code><br>用于分别指定行和列聚类的度量标准，允许的值有“<code>euclidean</code>”, “<code>maximum</code>”, “<code>manhattan</code>”, “<code>canberra</code>”, “<code>binary</code>”, “<code>minkowski</code>”, “<code>pearson</code>”, “<code>spearman</code>”, “<code>kendall</code>”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, clustering_distance_rows = &quot;pearson&quot;, </div><div class="line">clustering_distance_columns = &quot;pearson&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-3f47cf3bfa173e5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#也可以自定义距离计算方式</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, clustering_distance_rows = function(m) dist(m))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-30f041fb4859171f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, clustering_distance_rows = function(x, y) 1 - cor(x, y))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-f5c6d3f00a17d107.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>请注意，在上面的R代码中，通常为指定行聚类的度量的参数  <code>clustering_distance_rows</code>显示示例。建议对参数<code>clustering_distance_columns</code>（列聚类的度量标准）使用相同的度量标准。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Clustering metric function</div><div class="line">robust_dist = function(x, y) &#123; </div><div class="line">qx = quantile(x, c(0.1, 0.9)) qy = quantile(y, c(0.1, 0.9)) l = x &gt; qx[1] &amp; x &lt; qx[2] &amp; y </div><div class="line">&gt; qy[1] &amp; y &lt; qy[2] x = x[l] y = y[l] sqrt(sum((x - y)^2))&#125;</div><div class="line"># Heatmap</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, clustering_distance_rows = robust_dist, </div><div class="line">clustering_distance_columns = robust_dist, </div><div class="line">col = colorRamp2(c(-2, 0, 2), c(&quot;purple&quot;, &quot;white&quot;, &quot;orange&quot;)))</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a3580fa85ed00103.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="聚类方法"><a href="#聚类方法" class="headerlink" title="聚类方法"></a>聚类方法</h2><p>参数<code>clustering_method_rows</code>和<code>clustering_method_columns</code>可用于指定进行层次聚类的方法。允许的值是<code>hclust()</code>函数支持的值，包括“ward.D”，“ward.D2”，“single”，“complete”，“average”，…（见?hclust）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Heatmap(df, name = &quot;mtcars&quot;, clustering_method_rows = &quot;ward.D&quot;, </div><div class="line">clustering_method_columns = &quot;ward.D&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c542bd89bd2b8ef2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="热图拆分"><a href="#热图拆分" class="headerlink" title="热图拆分"></a>热图拆分</h2><p>有很多方法来拆分热图。一个解决方案是应用<code>k-means</code>使用参数<code>km</code>。<br>在执行<code>k-means</code>时使用<code>set.seed()</code>函数很重要，这样可以在稍后精确地再现结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set.seed(1122)</div><div class="line"># split into 2 groupsHeatmap(df, name = &quot;mtcars&quot;, col = mycol, k = 2)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a12bdb36af791864.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># split by a vector specifying row classes， 有点类似于ggplot2里的分面</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, split = mtcars$cyl )</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-03aaca5b56b58b89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#split也可以是一个数据框，其中不同级别的组合拆分热图的行。</div><div class="line"># Split by combining multiple variables</div><div class="line">Heatmap(df, name =&quot;mtcars&quot;, col = mycol, split = data.frame(cyl = mtcars$cyl, am = mtcars$am))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-ddb8f5cd7783f7ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Combine km and split</div><div class="line">Heatmap(df, name =&quot;mtcars&quot;, col = mycol, km = 2, split = mtcars$cyl)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5f8ed156f47b714d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#也可以自定义分割</div><div class="line">library(&quot;cluster&quot;)</div><div class="line">set.seed(1122)</div><div class="line">pa = pam(df, k = 3)Heatmap(df, name = &quot;mtcars&quot;, col = mycol, split = paste0(&quot;pam&quot;, </div><div class="line">pa$clustering))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8b2b49dda4e4d01b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>还可以将用户定义的树形图和分割相结合。在这种情况下，<code>split</code>可以指定为单个数字：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">row_dend = hclust(dist(df)) # row clusterin</div><div class="line">grow_dend = color_branches(row_dend, k = 4)</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, cluster_rows = row_dend, split = 2)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-7d0430ea9a918019.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="热图注释"><a href="#热图注释" class="headerlink" title="热图注释"></a>热图注释</h2><p>利用<code>HeatmapAnnotation()</code>对行或列注释。格式为： <code>HeatmapAnnotation(df, name, col, show_legend)</code></p>
<ul>
<li>df：带有列名的data.frame</li>
<li>name：热图标注的名称</li>
<li>col：映射到df中列的颜色列表<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Transposedf &lt;- t(df)</div><div class="line"># Heatmap of the transposed data</div><div class="line">Heatmap(df, name =&quot;mtcars&quot;, col = mycol)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-b05bd797cc012742.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># Annotation data frame</div><div class="line">annot_df &lt;- data.frame(cyl = mtcars$cyl, am = mtcars$am, mpg = mtcars$mpg)</div><div class="line"># Define colors for each levels of qualitative variables</div><div class="line"># Define gradient color for continuous variable (mpg)</div><div class="line">col = list(cyl = c(&quot;4&quot; = &quot;green&quot;, &quot;6&quot; = &quot;gray&quot;, &quot;8&quot; = &quot;darkred&quot;), am = c(&quot;0&quot; = &quot;yellow&quot;, </div><div class="line">&quot;1&quot; = &quot;orange&quot;), mpg = colorRamp2(c(17, 25), c(&quot;lightblue&quot;, &quot;purple&quot;)) )</div><div class="line"># Create the heatmap annotation</div><div class="line">ha &lt;- HeatmapAnnotation(annot_df, col = col)</div><div class="line"># Combine the heatmap and the annotation</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, top_annotation = ha)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-542529c17f0077c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#可以使用参数show_legend = FALSE来隐藏注释图例</div><div class="line">ha &lt;- HeatmapAnnotation(annot_df, col = col, show_legend = FALSE)</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, top_annotation = ha)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e82c0d3998fdf782.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#注释名称可以使用下面的R代码添加</div><div class="line">library(&quot;GetoptLong&quot;)</div><div class="line"># Combine Heatmap and annotation</div><div class="line">ha &lt;- HeatmapAnnotation(annot_df, col = col, show_legend = FALSE)</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, top_annotation = ha)</div><div class="line"># Add annotation names on the right</div><div class="line">for(an in colnames(annot_df)) &#123; </div><div class="line">seekViewport(qq(&quot;annotation_@&#123;an&#125;&quot;)) </div><div class="line">grid.text(an, unit(1, &quot;npc&quot;) + unit(2, &quot;mm&quot;), 0.5, default.units = &quot;npc&quot;, just = &quot;left&quot;)&#125;</div><div class="line">#要在左侧添加注释名称，请使用以下代码</div><div class="line"># Annotation names on the left</div><div class="line">for(an in colnames(annot_df)) &#123; seekViewport(qq(&quot;annotation_@&#123;an&#125;&quot;)) grid.text(an, </div><div class="line">unit(1, &quot;npc&quot;) - unit(2, &quot;mm&quot;), 0.5, default.units = &quot;npc&quot;, just = &quot;left&quot;)&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-f421ede2e684f6fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="复杂注释"><a href="#复杂注释" class="headerlink" title="复杂注释"></a>复杂注释</h2><p>将热图与一些基本图形结合起来进行注释，利用<code>anno_point()</code>,<code>anno_barplot()</code><br>,<code>anno_boxplot()</code>,<code>anno_density()</code>和<code>anno_histogram()</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># Define some graphics to display the distribution of columns</div><div class="line">.hist = anno_histogram(df, gp = gpar(fill = &quot;lightblue&quot;))</div><div class="line">.density = anno_density(df, type = &quot;line&quot;, gp = gpar(col = &quot;blue&quot;))</div><div class="line">ha_mix_top = HeatmapAnnotation(hist = .hist, density = .density)</div><div class="line"># Define some graphics to display the distribution of rows</div><div class="line">.violin = anno_density(df, type = &quot;violin&quot;, gp = gpar(fill = &quot;lightblue&quot;), which = &quot;row&quot;)</div><div class="line">.boxplot = anno_boxplot(df, which = &quot;row&quot;)</div><div class="line">ha_mix_right = HeatmapAnnotation(violin = .violin, bxplt = .boxplot, which = &quot;row&quot;, </div><div class="line">width = unit(4, &quot;cm&quot;))</div><div class="line"># Combine annotation with heatmap</div><div class="line">Heatmap(df, name = &quot;mtcars&quot;, col = mycol, column_names_gp = gpar(fontsize = 8), </div><div class="line">top_annotation = ha_mix_top, top_annotation_height = unit(4, &quot;cm&quot;)) + ha_mix_right</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-492515c5a7fcc4d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="热图组合"><a href="#热图组合" class="headerlink" title="热图组合"></a>热图组合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Heatmap 1</div><div class="line">ht1 = Heatmap(df, name = &quot;ht1&quot;, col = mycol, km = 2, column_names_gp = gpar(fontsize = 9))</div><div class="line"># Heatmap 2</div><div class="line">ht2 = Heatmap(df, name = &quot;ht2&quot;, col = colorRamp2(c(-2, 0, 2), c(&quot;green&quot;, &quot;white&quot;, &quot;red&quot;)), column_names_gp = gpar(fontsize = 9))</div><div class="line"># Combine the two heatmaps</div><div class="line">ht1 + ht2</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-3ce17a03ce5f71af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>可以使用选项width = unit（3，“cm”））来控制热图大小。注意，当组合多个热图时，第一个热图被视为主热图。剩余热图的一些设置根据主热图的设置自动调整。这些设置包括：删除行集群和标题，以及添加拆分等。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">draw(ht1 + ht2, </div><div class="line">      # Titles </div><div class="line">     row_title = &quot;Two heatmaps, row title&quot;,</div><div class="line">     row_title_gp = gpar(col = &quot;red&quot;), </div><div class="line">     column_title = &quot;Two heatmaps, column title&quot;, </div><div class="line">     column_title_side = &quot;bottom&quot;, </div><div class="line">      # Gap between heatmaps </div><div class="line">     gap = unit(0.5, &quot;cm&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-e348e9abf5f7cf82.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>可以使用参数<code>show_heatmap_legend = FALSE</code>，<code>show_annotation_legend = FALSE</code>删除图例。</p>
<h2 id="基因表达矩阵"><a href="#基因表达矩阵" class="headerlink" title="基因表达矩阵"></a>基因表达矩阵</h2><p>在基因表达数据中，行代表基因，列是样品值。关于基因的更多信息可以在表达热图之后附加，例如基因长度和基因类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">expr = readRDS(paste0(system.file(package = &quot;ComplexHeatmap&quot;), &quot;/extdata/gene_expression.rds&quot;))</div><div class="line">mat = as.matrix(expr[, grep(&quot;cell&quot;, colnames(expr))])</div><div class="line">type = gsub(&quot;s\\d+_&quot;, &quot;&quot;, colnames(mat))</div><div class="line">ha = HeatmapAnnotation(df = data.frame(type = type))</div><div class="line">Heatmap(mat, name = &quot;expression&quot;, km = 5, top_annotation = ha, top_annotation_height = unit(4, &quot;mm&quot;), </div><div class="line">show_row_names = FALSE, show_column_names = FALSE) +</div><div class="line">Heatmap(expr$length, name = &quot;length&quot;, width = unit(5, &quot;mm&quot;), col = colorRamp2(c(0, 100000), c(&quot;white&quot;, &quot;orange&quot;))) +</div><div class="line">Heatmap(expr$type, name = &quot;type&quot;, width = unit(5, &quot;mm&quot;)) +</div><div class="line">Heatmap(expr$chr, name = &quot;chr&quot;, width = unit(5, &quot;mm&quot;), col = rand_color(length(unique(expr$chr))))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-076503522b98e6a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>也可以可视化基因组变化和整合不同的分子水平（基因表达，DNA甲基化，…）</p>
<h2 id="可视化矩阵中列的分布"><a href="#可视化矩阵中列的分布" class="headerlink" title="可视化矩阵中列的分布"></a>可视化矩阵中列的分布</h2><p>使用函数<code>densityHeatmap()</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">densityHeatmap(df)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-de948c8b938cfa9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="Infos"><a href="#Infos" class="headerlink" title="Infos"></a>Infos</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.3.3 (2017-03-06)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 8.1 x64 (build 9600)## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936 </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936 ##</div><div class="line"> ## attached base packages:</div><div class="line">## [1] grid stats graphics grDevices utils datasets methods </div><div class="line">## [8] base </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] GetoptLong_0.1.6 cluster_2.0.5 circlize_0.3.10 </div><div class="line">## [4] ComplexHeatmap_1.12.0 dendextend_1.4.0 d3heatmap_0.6.1.1</div><div class="line">##[7] gplots_3.0.1 RColorBrewer_1.1-2 </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] Rcpp_0.12.9 DEoptimR_1.0-8 plyr_1.8.4 </div><div class="line">## [4] viridis_0.3.4 class_7.3-14 prabclus_2.2-6 </div><div class="line">## [7] bitops_1.0-6 base64enc_0.1-3 tools_3.3.3 </div><div class="line">## [10] digest_0.6.12 mclust_5.2.2 jsonlite_1.3 </div><div class="line">## [13] evaluate_0.10 tibble_1.2 gtable_0.2.0 </div><div class="line">## [16] lattice_0.20-34 png_0.1-7 yaml_2.1.14 </div><div class="line">## [19] mvtnorm_1.0-6 gridExtra_2.2.1 trimcluster_0.1-2 </div><div class="line">## [22] stringr_1.2.0 knitr_1.15.1 GlobalOptions_0.0.11</div><div class="line">## [25] htmlwidgets_0.8 gtools_3.5.0 caTools_1.17.1 </div><div class="line">## [28] fpc_2.1-10 diptest_0.75-7 nnet_7.3-12 </div><div class="line">## [31] stats4_3.3.3 rprojroot_1.2 robustbase_0.92-7 </div><div class="line">## [34] flexmix_2.3-13 rmarkdown_1.3.9002 gdata_2.17.0 </div><div class="line">## [37] kernlab_0.9-25 ggplot2_2.2.1 magrittr_1.5 </div><div class="line">## [40] whisker_0.3-2 backports_1.0.5 scales_0.4.1 </div><div class="line">## [43] htmltools_0.3.5 modeltools_0.2-21 MASS_7.3-45</div><div class="line">## [46] assertthat_0.1 shape_1.4.2 colorspace_1.3-2 </div><div class="line">## [49] KernSmooth_2.23-15 stringi_1.1.2 lazyeval_0.2.0 </div><div class="line">## [52] munsell_0.4.3 rjson_0.2.15</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-076503522b98e6a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;本文将绘制静态与交互式热图，需要使用到以下R包和函数：&lt;br&gt;&lt;code&gt;heatmap()&lt;/code&gt;:用于绘制简单热图的函数&lt;br&gt;&lt;code&gt;heatmap.2()&lt;/code&gt;:绘制增强热图的函数&lt;br&gt;&lt;code&gt;d3heatmap&lt;/code&gt;:用于绘制交互式热图的R包&lt;br&gt;&lt;code&gt;ComplexHeatmap&lt;/code&gt;:用于绘制、注释和排列复杂热图的R&amp;amp;bioconductor包（非常适用于基因组数据分析）&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="Heatmap" scheme="https://ytlogos.github.io/tags/Heatmap/"/>
    
  </entry>
  
  <entry>
    <title>ggplot2学习笔记系列之利用ggplot2绘制散点图</title>
    <link href="https://ytlogos.github.io/2017/07/12/ggplot2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%B3%BB%E5%88%97%E4%B9%8B%E5%88%A9%E7%94%A8ggplot2%E7%BB%98%E5%88%B6%E6%95%A3%E7%82%B9%E5%9B%BE/"/>
    <id>https://ytlogos.github.io/2017/07/12/ggplot2学习笔记系列之利用ggplot2绘制散点图/</id>
    <published>2017-07-11T23:47:05.000Z</published>
    <updated>2017-09-19T00:39:01.478Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c6a0647f86050fb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>1 简介<br>散点图通常用来刻画两个连续型变量之间的关系。绘制散点图时数据集中的每一个观测值都由散点图中的一个点来表示。利用包<strong>ggplot2</strong>可以绘制十分漂亮的散点图。 利用<strong>ggplot2</strong>绘图前先确保我们所使用的数据集是<strong>data.frame</strong>形式。<strong>ggplot2</strong>绘图利用映射将数据赋予给坐标轴上进而添加几何对象形成图形。绘图前先加载包<strong>ggplot2</strong> 即<strong>library(ggplot2)</strong>。<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Load packages</div><div class="line">library(ggplot2)#visualization</div></pre></td></tr></table></figure></p>
<p>加载完包之后，本文利用数据集<strong>mtcars</strong>来演示散点图绘制。 先查看数据集的前几行来了解<strong>mtcars</strong>数据集。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#check data</div><div class="line">head(mtcars)</div></pre></td></tr></table></figure></p>
<p>2 绘制简单的散点图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg)) + geom_point()</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d1d4d773b39fb55a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>2.1 <strong>shape</strong>参数修改图形的形状<br>                                         <strong>可选点图形形状</strong>:<br><img src="http://upload-images.jianshu.io/upload_images/2084719-92b206d9539bc599.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg)) +geom_point(shape=17)</div></pre></td></tr></table></figure></p>
<p>2.2 <strong>size</strong>参数修改点的大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data = mtcars, aes(x=wt, y=mpg))+geom_point(size=5)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-468edde6998fbc45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>2.3 <strong>color</strong>参数修改点的颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg))+geom_point(color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-f2a2af9082fb75b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>3 绘制分组的散点图<br>可将分组变量（因子或字符变量，可通过<strong>factor()</strong>强制性将非因子变量转为因子变量）赋值给颜色或性状属性，实现分组散点图的绘制。<br>3.1 首先将数值型变量<code>cyl</code>转换为因子型变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mtcars$cyl &lt;- factor(mtcars$cyl)</div></pre></td></tr></table></figure></p>
<p>3.2 分组变量赋值给颜色属性(变量赋值必须在aes里面)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, color=cyl))+geom_point(size=3)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c6a0647f86050fb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>3.3 分组变量赋值给性状属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, shape=cyl))+geom_point(size=3)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4d500c2263205aec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>如果对R语言默认的颜色或者形状不满意，可以通过<code>scale_color_brewer()</code>或者<code>scale_color_manual()</code>函数自定义点的颜色以及<code>scale_shape_manual()</code>函数自定义点的形状。 下面我们将分组变量<strong>cyl</strong>同时赋值给颜色和形状属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, color=cyl, shape= cyl))+</div><div class="line">geom_point(size=3)+ scale_color_brewer(palette = &quot;Accent&quot;)+</div><div class="line">scale_shape_manual(values = c(2, 9, 16))#Accent是一调色板，可选点的形状见上</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-dfd4f44ad7ba946a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>4 将连续变量映射给颜色、大小和形状等属性<br>4.1 将连续性变量disp映射给颜色属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, color=disp))+geom_point(size=3)</div></pre></td></tr></table></figure></p>
<p>从图中可以发现值越大对应的颜色越浅，以下是通过人为设置色阶使值大小与颜色深浅保持一致<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, color=disp))+</div><div class="line">geom_point(size=3)+ scale_color_gradient(low=&quot;lightblue&quot;, high=&quot;darkblue&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-95957e2d11770434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>4.2 将连续性变量disp映射给大小属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, size=disp))+geom_point(color=&quot;red&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-61861423d92dee56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>5 重叠点的处理<br>当数据量非常大时，会导致数据重叠点非常严重，可通过使用半透明的点避免。<strong>alpha</strong>参数控制点的透明度。下面利用数据集<strong>diamonds</strong>来演示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#check data</div><div class="line">head(diamonds)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#未使用透明点处理</div><div class="line">ggplot(data=diamonds, aes(x=carat, y=price))+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-10cdfaabe44eef3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#使用alpha参数调整点透明度</div><div class="line">ggplot(data=diamonds, aes(x=carat, y=price))+geom_point(alpha=0.1)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1c751afcdaa834e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>6 为散点图添加拟合曲线<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#使用数据集mtcars</div><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg))+geom_point()+stat_smooth(method=&quot;lm&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4fa6e3822fcf9a7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#也可以去除掉拟合曲线的置信区间</div><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg))+geom_point()+stat_smooth(method=&quot;lm&quot;, se=FALSE)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8a8be783c2d23499.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#也可以针对不同类型的cyl来进行拟合</div><div class="line">ggplot(data=mtcars, aes(x=wt, y=mpg, color=cyl))+</div><div class="line">geom_point()+stat_smooth(method=&quot;lm&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-141622fb2f69c5f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛</p>
<p>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-c6a0647f86050fb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;1 简介&lt;br&gt;散点图通常用来刻画两个连续型变量之间的关系。绘制散点图时数据集中的每一个观测值都由散点图中的一个点来表示。利用包&lt;strong&gt;ggplot2&lt;/strong&gt;可以绘制十分漂亮的散点图。 利用&lt;strong&gt;ggplot2&lt;/strong&gt;绘图前先确保我们所使用的数据集是&lt;strong&gt;data.frame&lt;/strong&gt;形式。&lt;strong&gt;ggplot2&lt;/strong&gt;绘图利用映射将数据赋予给坐标轴上进而添加几何对象形成图形。绘图前先加载包&lt;strong&gt;ggplot2&lt;/strong&gt; 即&lt;strong&gt;library(ggplot2)&lt;/strong&gt;。&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="scatter plot" scheme="https://ytlogos.github.io/tags/scatter-plot/"/>
    
  </entry>
  
  <entry>
    <title>r4ds学习笔记之ggplot2</title>
    <link href="https://ytlogos.github.io/2017/07/01/r4ds%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bggplot2/"/>
    <id>https://ytlogos.github.io/2017/07/01/r4ds学习笔记之ggplot2/</id>
    <published>2017-07-01T09:55:59.000Z</published>
    <updated>2017-09-19T00:39:01.425Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-515da9e1fb644123.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>为了进一步加强以及整合自己<strong>data science</strong>的能力，最近打算在<a href="https://ytlogos.github.io/">我的博客</a>开辟一个新类<strong>r4ds</strong>，专门用来记录学习<strong>Hadley Wickham</strong>大神的新作<a href="http://r4ds.had.co.nz/" target="_blank" rel="external">R for Data Science</a>的读书笔记。该书推荐我们入门data science可以从可视化开始，这也是该书目录布局的第一章。因此开始学习R语言可视化。</p>
<a id="more"></a>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>本章主要聚焦于可视化包<strong>ggplot2</strong>,为了写这本书，大神专门整合了一系列神包成为一个包<strong>tidyverse</strong>，因此第一步就是要先安装该包并加载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#install tidyverse</div><div class="line">install.packages(&quot;tidyverse&quot;)</div><div class="line">#load tidyverse</div><div class="line">library(tidyverse)</div></pre></td></tr></table></figure></p>
<h2 id="ggplot2简介"><a href="#ggplot2简介" class="headerlink" title="ggplot2简介"></a>ggplot2简介</h2><p>利用数据集<strong>mpg</strong>来探究发动机大小跟好友耗油是否存在某种关系，先check一下该数据集。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">head(mpg)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-08f00cbdb4b66222.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>在各个变量中：</p>
<ul>
<li>disp:车发动机大小</li>
<li>hwy:衡量耗油率的一个指标，更多信息可？mpg查看</li>
</ul>
<p>要探究displ与hwy的关系，最快就是画个图了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data=mpg)+ geom_point(mapping = aes(x=displ, y=hwy))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8feb017d39aaa075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>图中显示两者呈现负相关，disp越大，hwy越低。<br><strong>ggplot2</strong>绘图规则主要如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(data=&lt;DATA&gt;)+</div><div class="line">     &lt;GEOM_FUNCTION&gt;(mapping=aes(&gt;MAPPINGS&gt;))</div></pre></td></tr></table></figure></p>
<p><strong>ggplot()</strong>会创建一个底板，然后可以通过<strong>geom_function()</strong>不断地添加图形元素，进行丰富。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg)#create an empty graph</div><div class="line">p+geom_point(aes(x=displ, y=hwy))#add a layer to the empty graph</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8feb017d39aaa075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="美学映射Aesthetic-Mappings"><a href="#美学映射Aesthetic-Mappings" class="headerlink" title="美学映射Aesthetic Mappings"></a>美学映射Aesthetic Mappings</h2><p>美学映射在<strong>ggplot2</strong>中是一个十分重要的概念，比如前文我们将displ、hwy分别映射给x、y轴，同时还可以用来控制图形元素大小、形状、颜色等属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg)+ </div><div class="line">geom_point(aes(x=displ, y=hwy, color=class))#将class映射给颜色属性，这样不同class就表现不同颜色</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-515da9e1fb644123.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>可以看到，通过颜色映射<strong>ggplot2</strong>会自动创建一个<strong>legend</strong>，需要注意的是这里颜色颜色我们是利用class，这是一个离散性变量，如果我们将之映射给点的size，则会出现warning,至于原因，看warning。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg)+ geom_point(aes(x=displ, y=hwy, size=class))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-75b7814d86b5f5b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>或者将class映射给alpha参数，这是一个控制点透明度的参数;shape是一个控制形状的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg)+ geom_point(aes(x=displ, y=hwy, alpha=class))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1d6dd6c8cbe3b016.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg)+ geom_point(aes(x=displ, y=hwy, shape=class))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-53c76d1b9cf0fea6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>发现当映射shape其中SUV是没有形状的，这是因为<strong>ggplot2</strong>只默认6种形状，这个问题后续解决。 需要注意的是映射参数必须在aes(),不然就无法映射。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg)+ geom_point(aes(x=displ, y=hwy), color=&quot;blue&quot;)#all the points are blue</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-742710de940018e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>今天就讲到这，下次继续</p>
<h2 id="SessionInfo"><a href="#SessionInfo" class="headerlink" title="SessionInfo"></a>SessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.1 (2017-06-30)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 8.1 x64 (build 9600)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936 </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C ## [5] LC_TIME=Chinese (Simplified)_China.936 </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats graphics grDevices utils datasets methods base </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] forcats_0.2.0 stringr_1.2.0 dplyr_0.7.1 </div><div class="line">## [4] purrr_0.2.2.2 readr_1.1.1 tidyr_0.6.3 </div><div class="line">## [7] tibble_1.3.3 ggplot2_2.2.1 tidyverse_1.1.1.9000</div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] Rcpp_0.12.11 cellranger_1.1.0 compiler_3.4.1 </div><div class="line">## [4] plyr_1.8.4 bindr_0.1 tools_3.4.1 </div><div class="line">## [7] digest_0.6.12 lubridate_1.6.0 jsonlite_1.5 </div><div class="line">## [10] evaluate_0.10.1 nlme_3.1-131 gtable_0.2.0 </div><div class="line">## [13] lattice_0.20-35 pkgconfig_2.0.1 rlang_0.1.1 </div><div class="line">## [16] psych_1.7.5 rstudioapi_0.6 yaml_2.1.14 </div><div class="line">## [19] parallel_3.4.1 haven_1.0.0 bindrcpp_0.2 </div><div class="line">## [22] xml2_1.1.1 httr_1.2.1 knitr_1.16 </div><div class="line">## [25] hms_0.3 rprojroot_1.2 grid_3.4.1 </div><div class="line">## [28] glue_1.1.1 R6_2.2.2 readxl_1.0.0 </div><div class="line">## [31] foreign_0.8-69 rmarkdown_1.6 modelr_0.1.0 </div><div class="line">## [34] reshape2_1.4.2 magrittr_1.5 clisymbols_1.2.0 </div><div class="line">## [37] boxes_0.0.0.9000 backports_1.1.0 scales_0.4.1 </div><div class="line">## [40] htmltools_0.3.6 rvest_0.3.2 assertthat_0.2.0 </div><div class="line">## [43] mnormt_1.5-5 colorspace_1.3-2 labeling_0.3 </div><div class="line">## [46] stringi_1.1.5 lazyeval_0.2.0 munsell_0.4.3 </div><div class="line">## [49] broom_0.4.2 crayon_1.3.2.9000</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-515da9e1fb644123.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;为了进一步加强以及整合自己&lt;strong&gt;data science&lt;/strong&gt;的能力，最近打算在&lt;a href=&quot;https://ytlogos.github.io/&quot;&gt;我的博客&lt;/a&gt;开辟一个新类&lt;strong&gt;r4ds&lt;/strong&gt;，专门用来记录学习&lt;strong&gt;Hadley Wickham&lt;/strong&gt;大神的新作&lt;a href=&quot;http://r4ds.had.co.nz/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;R for Data Science&lt;/a&gt;的读书笔记。该书推荐我们入门data science可以从可视化开始，这也是该书目录布局的第一章。因此开始学习R语言可视化。&lt;/p&gt;
    
    </summary>
    
      <category term="r4ds" scheme="https://ytlogos.github.io/categories/r4ds/"/>
    
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
  </entry>
  
  <entry>
    <title>R语言data manipulation学习笔记之subset data</title>
    <link href="https://ytlogos.github.io/2017/06/29/R%E8%AF%AD%E8%A8%80data-manipulation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bsubset-data/"/>
    <id>https://ytlogos.github.io/2017/06/29/R语言data-manipulation学习笔记之subset-data/</id>
    <published>2017-06-29T12:58:25.000Z</published>
    <updated>2017-09-19T00:39:01.421Z</updated>
    
    <content type="html"><![CDATA[<center><img src="C:\Users\user\Desktop\下载.jpg" alt=""></center>

<p>数据分析过程中我们常常需要从数据集中抽取部分数据，本文将介绍如何提取子数据集，主要利用R自带的函数，以后会专门介绍data manipulation包<strong>dplyr</strong>。 提取子数据集主要分为select以及exclude，这里主要介绍两种方法，一是利用操作符[]进行选取，二是利用subset()进行抽取。<br><a id="more"></a></p>
<p>利用[]进行提取<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#use the iris dataset</div><div class="line">head(iris)</div><div class="line">## Sepal.Length Sepal.Width Petal.Length Petal.Width Species </div><div class="line">## 1   5.1          3.5          1.4        0.2       setosa</div><div class="line">## 2   4.9          3.0          1.4        0.2       setosa</div><div class="line">## 3   4.7          3.2          1.3        0.2       setosa</div><div class="line">## 4   4.6          3.1          1.5        0.2       setosa</div><div class="line">## 5   5.0          3.6          1.4        0.2       setosa</div><div class="line">## 6   5.4          3.9          1.7        0.4       setosa</div><div class="line"># check the column namenames(iris)</div><div class="line"></div><div class="line">## [1] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot; &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Species&quot;</div></pre></td></tr></table></figure></p>
<p>加入我们想要提取Sepal.Length、Sepal.Width两列数据，可以使用如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">dt1 &lt;- iris[, c(&quot;Sepal.Length&quot;,&quot;Sepal.Width&quot;)]head(dt1)</div><div class="line"></div><div class="line">##   Sepal.Length Sepal.Width</div><div class="line">## 1      5.1         3.5</div><div class="line">## 2      4.9         3.0</div><div class="line">## 3      4.7         3.2</div><div class="line">## 4      4.6         3.1</div><div class="line">## 5      5.0         3.6</div><div class="line">## 6      5.4         3.9</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#也可以直接用列序号代替，比如这里我们想要提要前两列</div><div class="line">dt2 &lt;- iris[, c(1, 2)]head(dt2)</div><div class="line">##   Sepal.Length Sepal.Width</div><div class="line">## 1      5.1         3.5</div><div class="line">## 2      4.9         3.0</div><div class="line">## 3      4.7         3.2</div><div class="line">## 4      4.6         3.1</div><div class="line">## 5      5.0         3.6</div><div class="line">## 6      5.4         3.9</div></pre></td></tr></table></figure>
<p>如果我们需要删除前两列，只需在序号之前添加符号 - 就行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">dt3 &lt;- iris[, c(-1, -2)]head(dt3)</div><div class="line"></div><div class="line">##   Petal.Length Petal.Width Species  </div><div class="line">## 1     1.4          0.2      setosa</div><div class="line">## 2     1.4          0.2      setosa</div><div class="line">## 3     1.3          0.2      setosa</div><div class="line">## 4     1.5          0.2      setosa</div><div class="line">## 5     1.4          0.2      setosa</div><div class="line">## 6     1.7          0.4      setosa</div></pre></td></tr></table></figure></p>
<p>可以看出十分简单就可以提取子数据集，下面介绍subset()<br>，subset()相比于[]主要是可以方便的根据条件提取子数据集。</p>
<h2 id="利用subset-进行提取"><a href="#利用subset-进行提取" class="headerlink" title="利用subset()进行提取"></a>利用<strong>subset()</strong>进行提取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#create a dataset</div><div class="line">fy &lt;- c(2010,2011,2012,2010,2011,2012,2010,2011,2012)</div><div class="line">company &lt;- c(&quot;Apple&quot;,&quot;Apple&quot;,&quot;Apple&quot;,&quot;Google&quot;,&quot;Google&quot;,&quot;Google&quot;,&quot;Microsoft&quot;,&quot;Microsoft&quot;,&quot;Microsoft&quot;)</div><div class="line">revenue &lt;- c(65225,108249,156508,29321,37905,50175,62484,69943,73723)</div><div class="line">profit &lt;- c(14013,25922,41733,8505,9737,10737,18760,23150,16978) </div><div class="line">companiesData &lt;- data.frame(fy, company, revenue, profit)</div><div class="line">head(companiesData)</div><div class="line">##    fy company revenue profit</div><div class="line">## 1 2010 Apple   65225 14013</div><div class="line">## 2 2011 Apple   108249 25922</div><div class="line">## 3 2012 Apple   156508 41733</div><div class="line">## 4 2010 Google   29321 8505</div><div class="line">## 5 2011 Google   37905 9737</div><div class="line">## 6 2012 Google   50175 10737</div></pre></td></tr></table></figure>
<p>假如我们想要提取revenue超过十万的公司<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">com1 &lt;- subset(companiesData, revenue&gt;100000)</div><div class="line">head(com1)</div><div class="line"></div><div class="line">##    fy company revenue profit</div><div class="line">## 2 2011 Apple   108249 25922</div><div class="line">## 3 2012 Apple   156508 41733</div></pre></td></tr></table></figure></p>
<p>或者我们想要提取在2012年revenue超过6万的公司<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">com2 &lt;- subset(companiesData, fy==&quot;2012&quot;&amp;revenue&gt;60000)</div><div class="line">head(com2)</div><div class="line"></div><div class="line">##    fy  company  revenue profit</div><div class="line">## 3 2012 Apple     156508 41733</div><div class="line">## 9 2012 Microsoft  73723 16978</div></pre></td></tr></table></figure></p>
<p>或者提取在2012年revenue超过6万、profit超过4万的公司<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">com3 &lt;- subset(companiesData, fy==&quot;2012&quot;&amp;revenue&gt;60000&amp;profit&gt;40000)</div><div class="line">com3</div><div class="line"></div><div class="line">##    fy company revenue profit</div><div class="line">## 3 2012 Apple 156508 41733</div></pre></td></tr></table></figure></p>
<p>条件选择也可以使用或，比如我们想要提取profit超过2万或者revenue低于5万的公司<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">com4 &lt;- subset(companiesData, revenue&lt;50000|profit&gt;20000)</div><div class="line">com4</div><div class="line">##    fy company   revenue profit </div><div class="line">## 2 2011 Apple     108249 25922</div><div class="line">## 3 2012 Apple     156508 41733</div><div class="line">## 4 2010 Google    29321 8505</div><div class="line">## 5 2011 Google    37905 9737</div><div class="line">## 8 2011 Microsoft 69943 23150</div></pre></td></tr></table></figure></p>
<p>本文只是粗略的讲解，其实subset()的用法很广，有兴趣的朋友可以自行探索。</p>
<h2 id="sessionInfo"><a href="#sessionInfo" class="headerlink" title="sessionInfo"></a>sessionInfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line"></div><div class="line">## R version 3.4.0 (2017-04-21)</div><div class="line">## Platform: x86_64-pc-linux-gnu (64-bit)</div><div class="line">## Running under: Ubuntu 16.04.2 LTS</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0</div><div class="line">## LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C</div><div class="line">## [3] LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 </div><div class="line">## [5] LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 </div><div class="line">## [7] LC_PAPER=en_US.UTF-8 LC_NAME=C </div><div class="line">## [9] LC_ADDRESS=C LC_TELEPHONE=C </div><div class="line">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats graphics grDevices utils datasets methods base </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] compiler_3.4.0 backports_1.1.0 magrittr_1.5 rprojroot_1.2 </div><div class="line">## [5] tools_3.4.0 htmltools_0.3.6 yaml_2.1.14 Rcpp_0.12.11 </div><div class="line">## [9] stringi_1.1.5 rmarkdown_1.6 knitr_1.16 stringr_1.2.0 </div><div class="line">## [13] digest_0.6.12 evaluate_0.10.1</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;center&gt;&lt;img src=&quot;C:\Users\user\Desktop\下载.jpg&quot; alt=&quot;&quot;&gt;&lt;/center&gt;

&lt;p&gt;数据分析过程中我们常常需要从数据集中抽取部分数据，本文将介绍如何提取子数据集，主要利用R自带的函数，以后会专门介绍data manipulation包&lt;strong&gt;dplyr&lt;/strong&gt;。 提取子数据集主要分为select以及exclude，这里主要介绍两种方法，一是利用操作符[]进行选取，二是利用subset()进行抽取。&lt;br&gt;
    
    </summary>
    
      <category term="Data Manipulation" scheme="https://ytlogos.github.io/categories/Data-Manipulation/"/>
    
    
      <category term="data management" scheme="https://ytlogos.github.io/tags/data-management/"/>
    
  </entry>
  
  <entry>
    <title>R语言data manipulation学习笔记之创建变量、重命名、数据融合</title>
    <link href="https://ytlogos.github.io/2017/06/28/R%E8%AF%AD%E8%A8%80data-manipulation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%8F%98%E9%87%8F%E3%80%81%E9%87%8D%E5%91%BD%E5%90%8D%E3%80%81%E6%95%B0%E6%8D%AE%E8%9E%8D%E5%90%88/"/>
    <id>https://ytlogos.github.io/2017/06/28/R语言data-manipulation学习笔记之创建变量、重命名、数据融合/</id>
    <published>2017-06-28T08:06:11.000Z</published>
    <updated>2017-09-19T00:39:01.417Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4a45f75977c58bb5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>数据分析中数据处理也就是data manipulation是十分繁琐的，为此我将在博客里特意建一个分类：Data Manipulation。本文将讲讲如何在R语言中创建变量、重命名以及merge。<br><a id="more"></a></p>
<p>#create a dataset<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fy &lt;- c(2010,2011,2012,2010,2011,2012,2010,2011,2012)</div><div class="line">company &lt;- c(&quot;Apple&quot;,&quot;Apple&quot;,&quot;Apple&quot;,&quot;Google&quot;,&quot;Google&quot;,&quot;Google&quot;,&quot;Microsoft&quot;,&quot;Microsoft&quot;,&quot;Microsoft&quot;)</div><div class="line">revenue &lt;- c(65225,108249,156508,29321,37905,50175,62484,69943,73723)</div><div class="line">profit &lt;- c(14013,25922,41733,8505,9737,10737,18760,23150,16978) </div><div class="line">companiesData &lt;- data.frame(fy, company, revenue, profit)</div><div class="line">head(companiesData)</div><div class="line">##     fy   company revenue profit</div><div class="line">## 1  2010   Apple   65225  14013</div><div class="line">## 2  2011   Apple  108249  25922</div><div class="line">## 3  2012   Apple  156508  41733</div><div class="line">## 4  2010  Google   29321   8505</div><div class="line">## 5  2011  Google   37905   9737</div><div class="line">## 6  2012  Google   50175  10737</div></pre></td></tr></table></figure></p>
<p>接下来我们需要查看数据集的结构，用str()函数查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">str(companiesData)</div><div class="line">## &apos;data.frame&apos;:    9 obs. of  4 variables:</div><div class="line">##  $ fy     : num  2010 2011 2012 2010 2011 ...</div><div class="line">##  $ company: Factor w/ 3 levels &quot;Apple&quot;,&quot;Google&quot;,..: 1 1 1 2 2 2 3 3 3</div><div class="line">##  $ revenue: num  65225 108249 156508 29321 37905 ...</div><div class="line">##  $ profit : num  14013 25922 41733 8505 9737 ...</div></pre></td></tr></table></figure></p>
<p>可以看到年份fy这里是是数值型，我们需要更改为因子型，方便后期处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">companiesData$fy &lt;- factor(companiesData$fy, ordered = TRUE)</div></pre></td></tr></table></figure></p>
<p>现在数据已经整理过好了，下面我们来添加变量，比如我们可以看看各个公司的利润率<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">companiesData$margin &lt;- (companiesData$profit/companiesData$revenue)*100</div><div class="line">#查看数据</div><div class="line">head(companiesData)</div><div class="line">##     fy company revenue profit   margin</div><div class="line">## 1 2010   Apple   65225  14013 21.48409</div><div class="line">## 2 2011   Apple  108249  25922 23.94664</div><div class="line">## 3 2012   Apple  156508  41733 26.66509</div><div class="line">## 4 2010  Google   29321   8505 29.00651</div><div class="line">## 5 2011  Google   37905   9737 25.68790</div><div class="line">## 6 2012  Google   50175  10737 21.39910</div></pre></td></tr></table></figure></p>
<p>小数点位数太多了，这里我们保留一位<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">companiesData$margin &lt;- round(companiesData$margin, 1)</div><div class="line">head(companiesData)</div><div class="line">##     fy company revenue profit margin</div><div class="line">## 1 2010   Apple   65225  14013   21.5</div><div class="line">## 2 2011   Apple  108249  25922   23.9</div><div class="line">## 3 2012   Apple  156508  41733   26.7</div><div class="line">## 4 2010  Google   29321   8505   29.0</div><div class="line">## 5 2011  Google   37905   9737   25.7</div><div class="line">## 6 2012  Google   50175  10737   21.4</div></pre></td></tr></table></figure></p>
<p>这样我们就创建了一个新的变量margin，当然也可以删除变量，只要复制需要删除的变量NULL就行了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#delete variable margin</div><div class="line">companiesData$margin &lt;- NULL</div><div class="line">head(companiesData)</div><div class="line">##     fy company revenue profit</div><div class="line">## 1 2010   Apple   65225  14013</div><div class="line">## 2 2011   Apple  108249  25922</div><div class="line">## 3 2012   Apple  156508  41733</div><div class="line">## 4 2010  Google   29321   8505</div><div class="line">## 5 2011  Google   37905   9737</div><div class="line">## 6 2012  Google   50175  10737</div></pre></td></tr></table></figure></p>
<p>再顺便介绍一下transform函数，用于创建变量，transform的格式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">dataFrame &lt;- transform(dataFrame, newColumn = oldColumn1 + oldColumn2)</div><div class="line">companiesData &lt;- transform(companiesData, margin=round((profit/revenue)*100), 1)</div><div class="line">head(companiesData)</div><div class="line">##     fy company revenue profit margin X1</div><div class="line">## 1 2010   Apple   65225  14013     21  1</div><div class="line">## 2 2011   Apple  108249  25922     24  1</div><div class="line">## 3 2012   Apple  156508  41733     27  1</div><div class="line">## 4 2010  Google   29321   8505     29  1</div><div class="line">## 5 2011  Google   37905   9737     26  1</div><div class="line">## 6 2012  Google   50175  10737     21  1</div></pre></td></tr></table></figure></p>
<p>接下来讲一下merge，主要是merge函数，它要求进行融合的两个数据集需要有共同的变量即id，使用格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">finaldt &lt;- merge(dataset1, dataset2, by=&quot;id&quot;)</div></pre></td></tr></table></figure></p>
<p>这里我们再创建一个数据集用于merge<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#creat another dataset</div><div class="line">company &lt;- c(&quot;Apple&quot;,&quot;Google&quot;,&quot;Microsoft&quot;)</div><div class="line">ava1 &lt;- c(1,2,3)</div><div class="line">data2 &lt;- data.frame(company, ava1)</div><div class="line">head(data2)</div><div class="line">##     company ava1</div><div class="line">## 1     Apple    1</div><div class="line">## 2    Google    2</div><div class="line">## 3 Microsoft    3</div></pre></td></tr></table></figure></p>
<p>数据集data2与数据集companiesData具有共同的变量company(id)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#merge the two dataset</div><div class="line">newdata &lt;- merge(companiesData, data2, by=&quot;company&quot;)</div></pre></td></tr></table></figure></p>
<p>这样就得到一个完整的数据集了，当然添加行、列还有两个很有用的函数：rbind()以及cbind(),这里就不介绍了 最后讲一下重命名，其实很简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">companiesData$company &lt;- c(&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;G&quot;, &quot;G&quot;, &quot;G&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;)</div><div class="line">head(companiesData)</div><div class="line">##     fy company revenue profit margin X1</div><div class="line">## 1 2010       A   65225  14013     21  1</div><div class="line">## 2 2011       A  108249  25922     24  1</div><div class="line">## 3 2012       A  156508  41733     27  1</div><div class="line">## 4 2010       G   29321   8505     29  1</div><div class="line">## 5 2011       G   37905   9737     26  1</div><div class="line">## 6 2012       G   50175  10737     21  1</div><div class="line">#rename the colname</div><div class="line">colnames(companiesData) &lt;- c(&quot;Year&quot;, &quot;Com&quot;, &quot;Rev&quot;, &quot;Pro&quot;, &quot;Mar&quot;)</div></pre></td></tr></table></figure></p>
<p>#seessioninfo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div><div class="line">## R version 3.4.0 (2017-04-21)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 8.1 x64 (build 9600)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C                              </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">##  [1] compiler_3.4.0  backports_1.1.0 magrittr_1.5    rprojroot_1.2  </div><div class="line">##  [5] tools_3.4.0     htmltools_0.3.6 yaml_2.1.14     Rcpp_0.12.11   </div><div class="line">##  [9] stringi_1.1.5   rmarkdown_1.5   knitr_1.16      stringr_1.2.0  </div><div class="line">## [13] digest_0.6.12   evaluate_0.10</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410<br>Email: tyan@zju.edu.cn<br>QQ: 1051927088<br>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a><br>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a><br>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛<br>浙江大学作物遗传育种在读研究生（生物信息学方向）<br>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-4a45f75977c58bb5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;数据分析中数据处理也就是data manipulation是十分繁琐的，为此我将在博客里特意建一个分类：Data Manipulation。本文将讲讲如何在R语言中创建变量、重命名以及merge。&lt;br&gt;
    
    </summary>
    
      <category term="Data Manipulation" scheme="https://ytlogos.github.io/categories/Data-Manipulation/"/>
    
    
      <category term="manipulation" scheme="https://ytlogos.github.io/tags/manipulation/"/>
    
  </entry>
  
  <entry>
    <title>R语言可视化学习笔记之ggpubr包</title>
    <link href="https://ytlogos.github.io/2017/06/26/R%E8%AF%AD%E8%A8%80%E5%8F%AF%E8%A7%86%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bggpubr%E5%8C%85/"/>
    <id>https://ytlogos.github.io/2017/06/26/R语言可视化学习笔记之ggpubr包/</id>
    <published>2017-06-26T11:43:11.000Z</published>
    <updated>2017-09-19T00:39:01.412Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-fbe5b444e2efcb8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><a href="http://docs.ggplot2.org/current/" target="_blank" rel="external">Hadley Wickham</a>创建的可视化包ggplot2可以流畅地进行优美的可视化，但是如果要通过ggplot2定制一套图形，尤其是适用于杂志期刊等出版物的图形，对于那些没有深入了解<strong>ggplot2</strong>的人来说就有点困难了，<strong>ggplot2</strong>的部分语法是很晦涩的。为此<a href="http://www.sthda.com/english/rpkgs/ggpubr/index.html" target="_blank" rel="external">Alboukadel Kassambara</a>创建了基于<strong>ggplot2</strong>的可视化包<strong>ggpubr</strong>用于绘制符合出版物要求的图形。<br><a id="more"></a></p>
<h2 id="安装及加载ggpubr包"><a href="#安装及加载ggpubr包" class="headerlink" title="安装及加载ggpubr包"></a>安装及加载<strong>ggpubr</strong>包</h2><p>安装方式有两种：</p>
<ul>
<li><p>直接从<strong>CRAN</strong>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;ggpubr&quot;)</div></pre></td></tr></table></figure>
</li>
<li><p>从<strong>GitHub</strong>上安装最新版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if(!require(devtools)) install.packages(&quot;devtools&quot;)</div><div class="line"> devtools::install_github(&quot;kassambara/ggpubr&quot;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>安装完之后直接加载就行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">library(ggpubr)</div></pre></td></tr></table></figure></p>
<p>#<strong>ggpubr</strong>可绘制图形：<br><strong>ggpubr</strong>可绘制大部分我们常用的图形，下面一一介绍。</p>
<p>##分布图(Distribution)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#构建数据集</div><div class="line">set.seed(1234)</div><div class="line">df &lt;- data.frame( sex=factor(rep(c(&quot;f&quot;, &quot;M&quot;), each=200)), </div><div class="line">weight=c(rnorm(200, 55), rnorm(200, 58)))</div><div class="line">head(df)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##   sex   weight</div><div class="line">## 1  f   53.79293</div><div class="line">## 2  f   55.27743</div><div class="line">## 3  f   56.08444</div><div class="line">## 4  f   52.65430</div><div class="line">## 5  f   55.42912</div><div class="line">## 6  f   55.50606</div></pre></td></tr></table></figure>
<p>###密度分布图以及边际地毯线并添加平均值线<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggdensity(df, x=&quot;weight&quot;, add = &quot;mean&quot;, rug = TRUE, color = &quot;sex&quot;, fill = &quot;sex&quot;,</div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-652675daa1359146.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###带有均值线和边际地毯线的直方图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gghistogram(df, x=&quot;weight&quot;, add = &quot;mean&quot;, rug = TRUE, color = &quot;sex&quot;, fill = &quot;sex&quot;,</div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;))</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d37833ffb4e3102b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###箱线图与小提琴图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#加载数据集ToothGrowth</div><div class="line">data(&quot;ToothGrowth&quot;)</div><div class="line">df1 &lt;- ToothGrowth</div><div class="line">head(df1)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##    len  supp  dose</div><div class="line">## 1  4.2   VC    0.5</div><div class="line">## 2  11.5  VC    0.5</div><div class="line">## 3  7.3   VC    0.5</div><div class="line">## 4  5.8   VC    0.5</div><div class="line">## 5  6.4   VC    0.5</div><div class="line">## 6  10.0  VC    0.5</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggboxplot(df1, x=&quot;dose&quot;, y=&quot;len&quot;, color = &quot;dose&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), </div><div class="line">add = &quot;jitter&quot;, shape=&quot;dose&quot;)#增加了jitter点，点shape由dose映射p</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-418d9194e641dd71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>增加不同组间的p-value值，可以自定义需要标注的组间比较<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my_comparisons &lt;- list(c(&quot;0.5&quot;, &quot;1&quot;), c(&quot;1&quot;, &quot;2&quot;), c(&quot;0.5&quot;, &quot;2&quot;))</div><div class="line">p+stat_compare_means(comparisons = my_comparisons)+#不同组间的比较</div><div class="line">stat_compare_means(label.y = 50)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8bb64a310e2d8a4c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###内有箱线图的小提琴图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggviolin(df1, x=&quot;dose&quot;, y=&quot;len&quot;, fill = &quot;dose&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), </div><div class="line">add = &quot;boxplot&quot;, add.params = list(fill=&quot;white&quot;))+ </div><div class="line">stat_compare_means(comparisons = my_comparisons, label = &quot;p.signif&quot;)+#label这里表示选择显著性标记（星号） </div><div class="line">stat_compare_means(label.y = 50)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-fbe5b444e2efcb8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###条形图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data(&quot;mtcars&quot;)</div><div class="line">df2 &lt;- mtcars</div><div class="line">df2$cyl &lt;- factor(df2$cyl)</div><div class="line">df2$name &lt;- rownames(df2)#添加一行name</div><div class="line">head(df2[, c(&quot;name&quot;, &quot;wt&quot;, &quot;mpg&quot;, &quot;cyl&quot;)])</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4ded50c82b9f83fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>按从小到大顺序绘制条形图（不分组排序）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggbarplot(df2, x=&quot;name&quot;, y=&quot;mpg&quot;, fill = &quot;cyl&quot;, color = &quot;white&quot;, </div><div class="line">palette = &quot;jco&quot;,#杂志jco的配色 </div><div class="line">sort.val = &quot;desc&quot;,#下降排序 </div><div class="line">sort.by.groups=FALSE,#不按组排序 </div><div class="line">x.text.angle=60)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-823a0b71c2e85b6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>按组进行排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggbarplot(df2, x=&quot;name&quot;, y=&quot;mpg&quot;, fill = &quot;cyl&quot;, color = &quot;white&quot;, </div><div class="line">palette = &quot;jco&quot;,#杂志jco的配色 </div><div class="line">sort.val = &quot;asc&quot;,#上升排序,区别于desc，具体看图演示 </div><div class="line">sort.by.groups=TRUE,#按组排序 </div><div class="line">x.text.angle=90)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-5c28f6c53248e8f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###偏差图<br>偏差图展示了与参考值之间的偏差<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df2$mpg_z &lt;- (df2$mpg-mean(df2$mpg))/sd(df2$mpg)</div><div class="line">df2$mpg_grp &lt;- factor(ifelse(df2$mpg_z&lt;0, &quot;low&quot;, &quot;high&quot;), levels = c(&quot;low&quot;, &quot;high&quot;))</div><div class="line">head(df2[, c(&quot;name&quot;, &quot;wt&quot;, &quot;mpg&quot;, &quot;mpg_grp&quot;, &quot;cyl&quot;)])</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-34debe47e570b508.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>绘制排序过的条形图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggbarplot(df2, x=&quot;name&quot;, y=&quot;mpg_z&quot;, fill = &quot;mpg_grp&quot;, color = &quot;white&quot;, </div><div class="line">palette = &quot;jco&quot;, sort.val = &quot;asc&quot;, sort.by.groups = FALSE, x.text.angle=60, </div><div class="line">ylab = &quot;MPG z-score&quot;, xlab = FALSE, legend.title=&quot;MPG Group&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8957ea525c3d8853.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>坐标轴变换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggbarplot(df2, x=&quot;name&quot;, y=&quot;mpg_z&quot;, fill = &quot;mpg_grp&quot;, color = &quot;white&quot;, </div><div class="line">palette = &quot;jco&quot;, sort.val = &quot;desc&quot;, sort.by.groups = FALSE, </div><div class="line">x.text.angle=90, ylab = &quot;MPG z-score&quot;, xlab = FALSE, </div><div class="line">legend.title=&quot;MPG Group&quot;, rotate=TRUE, ggtheme = theme_minimal())</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-253e214a34cb73c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>##点图(<strong>Dot charts</strong>)</p>
<p>###棒棒糖图(<strong>Lollipop chart</strong>)<br>棒棒图可以代替条形图展示数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggdotchart(df2, x=&quot;name&quot;, y=&quot;mpg&quot;, color = &quot;cyl&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), sorting = &quot;ascending&quot;, </div><div class="line">add = &quot;segments&quot;, ggtheme = theme_pubr())</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-a9f7fbd0c12c122c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>可以自设置各种参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggdotchart(df2, x=&quot;name&quot;, y=&quot;mpg&quot;, color = &quot;cyl&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), sorting = &quot;descending&quot;, </div><div class="line">add = &quot;segments&quot;, rotate = TRUE, group = &quot;cyl&quot;, dot.size = 6, </div><div class="line">label = round(df2$mpg), font.label = list(color=&quot;white&quot;, size=9, vjust=0.5), </div><div class="line">ggtheme = theme_pubr())</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-bfce6842b2744304.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###偏差图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggdotchart(df2, x=&quot;name&quot;, y=&quot;mpg_z&quot;, color = &quot;cyl&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), sorting = &quot;descending&quot;, </div><div class="line">add = &quot;segment&quot;, add.params = list(color=&quot;lightgray&quot;, size=2), </div><div class="line">group = &quot;cyl&quot;, dot.size = 6, label = round(df2$mpg_z, 1), </div><div class="line">font.label = list(color=&quot;white&quot;, size=9, vjust=0.5), ggtheme = theme_pubr())+ </div><div class="line">geom_line(yintercept=0, linetype=2, color=&quot;lightgray&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-fdc31b81879bbbd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###<strong>Cleveland</strong>点图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggdotchart(df2, x=&quot;name&quot;, y=&quot;mpg&quot;, color = &quot;cyl&quot;, </div><div class="line">palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), sorting = &quot;descending&quot;, </div><div class="line">rotate = TRUE, dot.size = 2, y.text.col=TRUE, ggtheme = theme_pubr())+ </div><div class="line">theme_cleveland()</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-1c31d9e203d4810a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""> </p>
<p>#<strong>SessionInfo</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">## R version 3.4.0 (2017-04-21)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 8.1 x64 (build 9600)</div><div class="line">## </div><div class="line">## Matrix products: default</div><div class="line">## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936 </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936 </div><div class="line">## </div><div class="line">## attached base packages:</div><div class="line">## [1] stats graphics grDevices utils datasets methods base </div><div class="line">## </div><div class="line">## other attached packages:</div><div class="line">## [1] ggpubr_0.1.3 magrittr_1.5 ggplot2_2.2.1</div><div class="line">## </div><div class="line">## loaded via a namespace (and not attached):</div><div class="line">## [1] Rcpp_0.12.11 knitr_1.16 munsell_0.4.3 colorspace_1.3-2</div><div class="line">## [5] R6_2.2.1 rlang_0.1.1 stringr_1.2.0 plyr_1.8.4 </div><div class="line">## [9] dplyr_0.5.0 tools_3.4.0 grid_3.4.0 gtable_0.2.0 </div><div class="line">## [13] DBI_0.6-1 htmltools_0.3.6 yaml_2.1.14 lazyeval_0.2.0 </div><div class="line">## [17] rprojroot_1.2 digest_0.6.12 assertthat_0.2.0 tibble_1.3.3 </div><div class="line">## [21] ggsignif_0.2.0 ggsci_2.4 purrr_0.2.2.2 evaluate_0.10 </div><div class="line">## [25] rmarkdown_1.5 labeling_0.3 stringi_1.1.5 compiler_3.4.0 </div><div class="line">## [29] scales_0.4.1 backports_1.1.0</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛</p>
<p>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-fbe5b444e2efcb8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;a href=&quot;http://docs.ggplot2.org/current/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hadley Wickham&lt;/a&gt;创建的可视化包ggplot2可以流畅地进行优美的可视化，但是如果要通过ggplot2定制一套图形，尤其是适用于杂志期刊等出版物的图形，对于那些没有深入了解&lt;strong&gt;ggplot2&lt;/strong&gt;的人来说就有点困难了，&lt;strong&gt;ggplot2&lt;/strong&gt;的部分语法是很晦涩的。为此&lt;a href=&quot;http://www.sthda.com/english/rpkgs/ggpubr/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Alboukadel Kassambara&lt;/a&gt;创建了基于&lt;strong&gt;ggplot2&lt;/strong&gt;的可视化包&lt;strong&gt;ggpubr&lt;/strong&gt;用于绘制符合出版物要求的图形。&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggpubr" scheme="https://ytlogos.github.io/tags/ggpubr/"/>
    
  </entry>
  
  <entry>
    <title>ggplot2学习笔记系列之利用ggplot2绘制误差棒及显著性标记</title>
    <link href="https://ytlogos.github.io/2017/06/25/ggplot2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%B3%BB%E5%88%97%E4%B9%8B%E5%88%A9%E7%94%A8ggplot2%E7%BB%98%E5%88%B6%E8%AF%AF%E5%B7%AE%E6%A3%92%E5%8F%8A%E6%98%BE%E8%91%97%E6%80%A7%E6%A0%87%E8%AE%B0/"/>
    <id>https://ytlogos.github.io/2017/06/25/ggplot2学习笔记系列之利用ggplot2绘制误差棒及显著性标记/</id>
    <published>2017-06-24T16:00:00.000Z</published>
    <updated>2017-09-19T00:39:01.404Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-46b1e37462ac6440.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="绘制带有误差棒的条形图"><a href="#绘制带有误差棒的条形图" class="headerlink" title="绘制带有误差棒的条形图"></a>绘制带有误差棒的条形图</h2><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">library(ggplot2)</div><div class="line">#创建数据集</div><div class="line">df &lt;- data.frame(treatment = factor(c(1, 1, 1, 2, 2, 2, 3, 3, 3)), </div><div class="line">                 response = c(2, 5, 4, 6, 9, 7, 3, 5, 8), </div><div class="line">                 group = factor(c(1, 2, 3, 1, 2, 3, 1, 2, 3)), </div><div class="line">                 se = c(0.4, 0.2, 0.4, 0.5, 0.3, 0.2, 0.4, 0.6, 0.7))</div><div class="line">head(df) #查看数据集</div><div class="line"></div><div class="line">##   treatment response group  se</div><div class="line">## 1    1         2       1    0.4</div><div class="line">## 2    1         5       2    0.2</div><div class="line">## 3    1         4       3    0.4</div><div class="line">## 4    2         6       1    0.5</div><div class="line">## 5    2         9       2    0.3</div><div class="line">## 6    2         7       3    0.2</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 使用geom_errorbar()绘制带有误差棒的条形图</div><div class="line"># 这里一定要注意position要与`geom_bar()`保持一致，由于系统默认dodge是0.9，</div><div class="line"># 因此geom_errorbar()里面position需要设置0.9，width设置误差棒的大小</div><div class="line">ggplot(data = df, aes(x = treatment, y = response, fill = group)) + </div><div class="line">geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + </div><div class="line">geom_errorbar(aes(ymax = response + se, ymin = response -  se), </div><div class="line">position = position_dodge(0.9), width = 0.15) + </div><div class="line">scale_fill_brewer(palette = &quot;Set1&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-0d1a0cc2f8ac5129.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="绘制带有显著性标记的条形图"><a href="#绘制带有显著性标记的条形图" class="headerlink" title="绘制带有显著性标记的条形图"></a>绘制带有显著性标记的条形图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">label &lt;- c(&quot;&quot;, &quot;*&quot;, &quot;**&quot;, &quot;&quot;, &quot;**&quot;, &quot;*&quot;, &quot;&quot;, &quot;&quot;, &quot;*&quot;) #这里随便设置的显著性，还有abcdef等显著性标记符号，原理一样，这里不再重复。</div><div class="line"># 添加显著性标记跟上次讲的添加数据标签是一样的，这里我们假设1是对照</div><div class="line">ggplot(data = df, aes(x = treatment, y = response, fill = group)) + </div><div class="line">geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + </div><div class="line">geom_errorbar(aes(ymax = response + se, ymin = response -  se), </div><div class="line">position = position_dodge(0.9), width = 0.15) + </div><div class="line">geom_text(aes(y = response +  1.5 * se, label = label, group = group), </div><div class="line">position = position_dodge(0.9), size = 5, fontface = &quot;bold&quot;) + </div><div class="line">scale_fill_brewer(palette = &quot;Set1&quot;) #这里的label就是刚才设置的，group是数据集中的，fontface设置字体。</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d7a71cdebe7aaecb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="绘制两条形图中间带有星号的统计图"><a href="#绘制两条形图中间带有星号的统计图" class="headerlink" title="绘制两条形图中间带有星号的统计图"></a>绘制两条形图中间带有星号的统计图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#创建一个简单的数据集</div><div class="line">Control &lt;- c(2.0,2.5,2.2,2.4,2.1)</div><div class="line">Treatment &lt;- c(3.0,3.3,3.1,3.2,3.2)</div><div class="line">mean &lt;- c(mean(Control), mean(Treatment))</div><div class="line">sd &lt;- c(sd(Control), sd(Treatment))</div><div class="line">df1 &lt;- data.frame(V=c(&quot;Control&quot;, &quot;Treatment&quot;), mean=mean, sd=sd)</div><div class="line">df1$V &lt;- factor(df1$V, levels=c(&quot;Control&quot;, &quot;Treatment&quot;))</div><div class="line">#利用geom_segment()绘制图形</div><div class="line">ggplot(data=df1, aes(x=V, y=mean, fill=V))+ </div><div class="line">geom_bar(stat = &quot;identity&quot;,position = position_dodge(0.9),color=&quot;black&quot;)+ </div><div class="line">geom_errorbar(aes(ymax=mean+sd, ymin=mean-sd), width=0.05)+ </div><div class="line">geom_segment(aes(x=1, y=2.5, xend=1, yend=3.8))+#绘制control端的竖线 </div><div class="line">geom_segment(aes(x=2, y=3.3, xend=2, yend=3.8))+#绘制treatment端竖线 </div><div class="line">geom_segment(aes(x=1, y=3.8, xend=1.45, yend=3.8))+ </div><div class="line">geom_segment(aes(x=1.55, y=3.8, xend=2, yend=3.8))+#绘制两段横线 </div><div class="line">annotate(&quot;text&quot;, x=1.5, y=3.8, label=&quot;〇&quot;, size=5)#annotate函数也可以添加标签</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-fd824d52ccfd97f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="为图形添加标题"><a href="#为图形添加标题" class="headerlink" title="为图形添加标题"></a>为图形添加标题</h2><p>图形标题有图标题、坐标轴标题、图例标题等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(data = df, aes(x = treatment, y = response, fill = group)) + </div><div class="line">geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +</div><div class="line">geom_errorbar(aes(ymax = response + se, ymin = response -  se),</div><div class="line">position = position_dodge(0.9), width = 0.15) + </div><div class="line">scale_fill_brewer(palette = &quot;Set1&quot;)# 利用ggtitle()添加图标题,还有labs（）也可以添加标题，最后会提一下。（有一个问题就是ggtitle()添加的标题总是左对齐）</div><div class="line">p + ggtitle(&quot;利用ggtitle()添加图标题&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-437d4f549444463d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 利用xlab()\ylab()添加/修改坐标轴标题</div><div class="line">p + ggtitle(&quot;利用ggtitle()添加图标题&quot;) + </div><div class="line">xlab(&quot;不同处理&quot;) + </div><div class="line">ylab(&quot;response&quot;) #标题的参数修改在theme里，theme是一个很大的函数，几乎可以定义一切，下次有时间会讲解</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-2b799bb7890f0624.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>最后再讲解一下如何将多副图至于一个页面 利用包<strong>gridExtra</strong>中<code>grid.arrange()</code>函数实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># 将四幅图放置于一个页面中</div><div class="line">p &lt;- ggplot(data = df, aes(x = treatment, y = response, fill = group)) + </div><div class="line">geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + </div><div class="line">geom_errorbar(aes(ymax = response + se, ymin = response -  se), </div><div class="line">position = position_dodge(0.9), width = 0.15) + </div><div class="line">scale_fill_brewer(palette = &quot;Set1&quot;)</div><div class="line">p1 &lt;- p + ggtitle(&quot;利用ggtitle()添加图标题&quot;)</div><div class="line">p2 &lt;- p + ggtitle(&quot;利用ggtitle()添加图标题&quot;) + xlab(&quot;不同处理&quot;) + ylab(&quot;response&quot;)</div><div class="line">p3 &lt;- ggplot(data = df, aes(x = treatment, y = response, fill = group)) + </div><div class="line">geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + </div><div class="line">geom_errorbar(aes(ymax = response + se, ymin = response -  se), </div><div class="line">position = position_dodge(0.9), width = 0.15) + </div><div class="line">geom_text(aes(y = response +  1.5 * se, label = label, group = group), </div><div class="line">position = position_dodge(0.9), size = 5, fontface = &quot;bold&quot;) + </div><div class="line">scale_fill_brewer(palette = &quot;Set1&quot;)</div><div class="line">library(gridExtra) #没有安装此包先用install.packages(&apos;gridExtra&apos;)安装</div><div class="line">grid.arrange(p, p1, p2, p3)</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-8ea6aa114eeab5ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>上次有人问坐标轴旋转的实现，坐标轴旋转有时是很有用的，下面是我看过的一个例子，用来介绍一下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#先加载他的数据</div><div class="line">url.world_ports &lt;- url(&quot;http://sharpsightlabs.com/wp-content/datasets/world_ports.RData&quot;)</div><div class="line">load(url.world_ports)</div><div class="line">knitr::kable(df.world_ports[1:5,])#该数据是关于世界上各个港口的数据汇总</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-01c06eb52b6848d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">library(dplyr) #用于数据操作，与ggplot2一样是R语言必学包#现在绘制条形图(%&gt;%上次说过是管道操作，用于连接各个代码，十分有用)</div><div class="line">df.world_ports%&gt;%filter(year==2014)%&gt;% #筛选2014年的数据 </div><div class="line">ggplot(aes(x=reorder(port_label, desc(volume)), y=volume))+ </div><div class="line">geom_bar(stat = &quot;identity&quot;, fill=&quot;darkred&quot;)+ </div><div class="line">labs(title=&quot;Busiest container ports in the world&quot;)+ </div><div class="line">labs(subtitle = &apos;2014, in order of shipping volume&apos;)+ #添加副标题 </div><div class="line">labs(x = &quot;Port&quot;, y = &quot;Shipping\nVolume&quot;)+ </div><div class="line">theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .4))#调整x轴标签，angle=90表示标签旋转90度，从图中可以看出</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-11d43dfb82953994.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#现在旋转坐标轴，并筛选排名小于25的港口，并且添加数据标签</div><div class="line">df.world_ports %&gt;% filter(year==2014, rank&lt;=25) %&gt;% #筛选2014年并且rank小于等于25的数据 </div><div class="line">ggplot(aes(x=reorder(port, volume), y=volume))+ </div><div class="line">geom_bar(stat = &quot;identity&quot;, fill=&quot;darkred&quot;)+ </div><div class="line">labs(title=&quot;Busiest container ports in the world&quot;)+ </div><div class="line">labs(subtitle = &apos;2014, in order of shipping volume&apos;)+  </div><div class="line">labs(x = &quot;Port&quot;, y = &quot;Shipping\nVolume&quot;)+ </div><div class="line">geom_text(aes(label=volume), hjust=1.2, color=&quot;white&quot;)+ </div><div class="line">coord_flip()#旋转坐标轴</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-46b1e37462ac6440.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>两图相比，明显第二幅图好，一是可以添加数据标签，二是不用歪着脖子看。<br>本来打算讲讲图例的但是发现内容太多了，就不讲了，下次吧！</p>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛</p>
<p>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-46b1e37462ac6440.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;绘制带有误差棒的条形图&quot;&gt;&lt;a href=&quot;#绘制带有误差棒的条形图&quot; class=&quot;headerlink&quot; title=&quot;绘制带有误差棒的条形图&quot;&gt;&lt;/a&gt;绘制带有误差棒的条形图&lt;/h2&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="ggplot2" scheme="https://ytlogos.github.io/tags/ggplot2/"/>
    
  </entry>
  
  <entry>
    <title>用circlize包绘制circos-plot</title>
    <link href="https://ytlogos.github.io/2017/06/25/%E7%94%A8circlize%E5%8C%85%E7%BB%98%E5%88%B6circos-plot/"/>
    <id>https://ytlogos.github.io/2017/06/25/用circlize包绘制circos-plot/</id>
    <published>2017-06-24T16:00:00.000Z</published>
    <updated>2017-09-19T00:39:01.408Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4b332e9275d7088e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="circlize包"><a href="#circlize包" class="headerlink" title="circlize包"></a><code>circlize</code>包</h2><p><code>circlize</code>包在德国癌症中心的华人博士Zuguang Gu开发的，有兴趣的可以去看看他的<a href="https://github.com/jokergoo" target="_blank" rel="external">Github主页</a>。这个包有两个文档，一个是介绍基本原理的绘制简单<a href="https://cran.r-project.org/web/packages/circlize/vignettes/circlize.pdf" target="_blank" rel="external">圈圈图</a>的，也是本次要介绍的。另外一份文档专门介绍基因组数据绘制圈圈图<a href="https://cran.r-project.org/web/packages/circlize/vignettes/genomic_plot.pdf" target="_blank" rel="external">Genomic Circos Plot</a>,我自己还没看完，下次再介绍。<br>根据我的学习发现这个包与<code>ggplot2</code>很相似，也是先创建一个图层，然后不断的添加图形元素（<code>point</code>、<code>line</code>、<code>bar</code>等），这些简单的图形元素都有<code>circos.</code>这个前缀进行绘制，比如要绘制点，则用<code>circos.points()</code>。具体的下面一一介绍。<br><a id="more"></a></p>
<h2 id="用circlize绘制圈圈图"><a href="#用circlize绘制圈圈图" class="headerlink" title="用circlize绘制圈圈图"></a>用<code>circlize</code>绘制圈圈图</h2><blockquote>
<p>照例，没有安装这个包的先安装：<code>install.packages(&quot;circlize&quot;)</code>或者<code>devtools::install_github(&quot;jokergoo/circlize&quot;)</code>。绘图第一步是先初始化(<code>circos.initialize</code>),接下来绘制<code>track</code>，再添加基本元素。需要提一下的是，由于<code>circlize</code>绘制图是不断叠加的，因此如果我们一大段代码下来我们只能看到最终的图形，这里为了演示每端代码的结果，所以每次我都得初始化以及<code>circlize.clear</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(circlize)</div><div class="line"># 简单创建一个数据集</div><div class="line">set.seed(999)</div><div class="line">n &lt;- 1000</div><div class="line">a &lt;- data.frame(factors = sample(letters[1:8], n, replace = TRUE), x = rnorm(n), y = runif(n))</div></pre></td></tr></table></figure>
<h2 id="绘制第一个track"><a href="#绘制第一个track" class="headerlink" title="绘制第一个track"></a>绘制第一个<code>track</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x) #初始化，factors来控制track数目，初始化里只有x， 没有y。这一步相当于ggplot()</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y, </div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">circos.axis()&#125;)</div><div class="line">col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4) #自定义一下颜色# 这里先解释一下，一个track有好几个cell，具体数目由factors决定的，向本数据集中factors有八个，因此绘制一个track，其包含八个cell。含有前缀circos.track的函数会在所有的cel里添加基本元素，而只有前缀circos.的函数可以在特定的track、cell里添加基本元素。具体看下演示。</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5) #所有的cell里都绘制点图</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1) #在track 1中的标记为a的cell里添加</div><div class="line">textcircos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-d3f6e3b63528471a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>##接下来绘制第二个<code>track</code></p>
<blockquote>
<p><code>circos.trackHist</code>添加柱状图，由于柱状图相对高级一点，因此<code>circos.trackHist</code>会自动创建一个<code>track</code>，无需我们<code>circos.trackPlotRegion</code>进行创建。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x)</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y, </div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">circos.axis()&#125;)</div><div class="line">col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">bg.col &lt;- rep(c(&quot;#EFEFEF&quot;, &quot;#CCCCCC&quot;), 4)</div><div class="line">circos.trackHist(a$factors, a$x, bg.col = bg.col, col = NA)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-42c29a97051139c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="创建第三个track"><a href="#创建第三个track" class="headerlink" title="创建第三个track"></a>创建第三个<code>track</code></h2><blockquote>
<p>这里又得提一下，当我们绘制多个<code>track</code>时，我们添加基本元素时要指定添加到哪个<code>track</code>(<code>track.index</code>指定)、哪个<code>cell</code>(<code>sector.index</code>指定)里，如果不指定，那么将默认<code>track</code>是我们刚刚创建的那个。<code>track.index</code>、<code>sector.index</code>等参数可以通过<code>get.cell.meta.data</code>函数获取。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x)</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y,</div><div class="line"> panel.fun = function(x, y) &#123; </div><div class="line">circos.axis()&#125;)</div><div class="line">col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">bg.col &lt;- rep(c(&quot;#EFEFEF&quot;, &quot;#CCCCCC&quot;), 4)</div><div class="line">circos.trackHist(a$factors, a$x, bg.col = bg.col, col = NA)</div><div class="line">circos.trackPlotRegion(factors = a$factors, x = a$x, y = a$y, </div><div class="line">panel.fun = function(x, y) &#123;</div><div class="line"> grey = c(&quot;#FFFFFF&quot;, &quot;#CCCCCC&quot;, &quot;#999999&quot;) </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;) #这个是第三个track，因为我们刚刚创建，这里这一步不用也可。</div><div class="line"> xlim = get.cell.meta.data(&quot;xlim&quot;)</div><div class="line"> ylim = get.cell.meta.data(&quot;ylim&quot;) </div><div class="line">circos.text(mean(xlim), mean(ylim), sector.index) </div><div class="line">circos.points(x[1:10], y[1:10], col = &quot;red&quot;, pch = 16, cex = 0.6) </div><div class="line">circos.points(x[11:20], y[11:20], col = &quot;blue&quot;, cex = 0.6)&#125;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-16e1d662c32d6e48.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>实际操作中我们常常会更新数据或者想更新图形，这是可以通过<code>circos.updatePlotRegion</code>函数在特定的<code>track</code>、<code>cell</code>里(先删除再添加)<code>update</code>，下面我们将通过<code>circos.updatePlotRegion</code>函数先删除<code>track 2</code>、<code>sector d</code>中的图形元素再添加点图。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x)</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y, </div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">circos.axis()&#125;)col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">bg.col &lt;- rep(c(&quot;#EFEFEF&quot;, &quot;#CCCCCC&quot;), 4)</div><div class="line">circos.trackHist(a$factors, a$x, bg.col = bg.col, col = NA)</div><div class="line">circos.trackPlotRegion(factors = a$factors, x = a$x, y = a$y,</div><div class="line"> panel.fun = function(x, y) &#123; </div><div class="line">grey = c(&quot;#FFFFFF&quot;, &quot;#CCCCCC&quot;, &quot;#999999&quot;) </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;)</div><div class="line"> xlim = get.cell.meta.data(&quot;xlim&quot;) </div><div class="line">ylim = get.cell.meta.data(&quot;ylim&quot;) </div><div class="line">circos.text(mean(xlim), mean(ylim), sector.index)</div><div class="line">circos.points(x[1:10], y[1:10], col = &quot;red&quot;, pch = 16, cex = 0.6)</div><div class="line"> circos.points(x[11:20], y[11:20], col = &quot;blue&quot;, cex = 0.6)&#125;)</div><div class="line"># update第2个track中标记为d的sector</div><div class="line">circos.updatePlotRegion(sector.index = &quot;d&quot;, track.index = 2)</div><div class="line">circos.points(x = -2:2, y = rep(0, 5))</div><div class="line">xlim &lt;- get.cell.meta.data(&quot;xlim&quot;)</div><div class="line">ylim &lt;- get.cell.meta.data(&quot;ylim&quot;)</div><div class="line">circos.text(mean(xlim), mean(ylim), &quot;updated&quot;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-c1739e4842120955.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="接下来绘制第四个track"><a href="#接下来绘制第四个track" class="headerlink" title="接下来绘制第四个track"></a>接下来绘制第四个<code>track</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x)</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y,</div><div class="line"> panel.fun = function(x, y) &#123; circos.axis()&#125;)</div><div class="line">col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">bg.col &lt;- rep(c(&quot;#EFEFEF&quot;, &quot;#CCCCCC&quot;), 4)</div><div class="line">circos.trackHist(a$factors, a$x, bg.col = bg.col, col = NA)</div><div class="line">circos.trackPlotRegion(factors = a$factors, x = a$x, y = a$y, </div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">grey = c(&quot;#FFFFFF&quot;, &quot;#CCCCCC&quot;, &quot;#999999&quot;) </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;) </div><div class="line">xlim = get.cell.meta.data(&quot;xlim&quot;)</div><div class="line"> ylim = get.cell.meta.data(&quot;ylim&quot;) </div><div class="line">circos.text(mean(xlim), mean(ylim), sector.index) </div><div class="line">circos.points(x[1:10], y[1:10], col = &quot;red&quot;, pch = 16, cex = 0.6) </div><div class="line">circos.points(x[11:20], y[11:20], col = &quot;blue&quot;, cex = 0.6)&#125;)</div><div class="line"># update第2个track中标记为d的sector</div><div class="line">circos.updatePlotRegion(sector.index = &quot;d&quot;, track.index = 2)</div><div class="line">circos.points(x = -2:2, y = rep(0, 5))</div><div class="line">xlim &lt;- get.cell.meta.data(&quot;xlim&quot;)</div><div class="line">ylim &lt;- get.cell.meta.data(&quot;ylim&quot;)</div><div class="line">circos.text(mean(xlim), mean(ylim), &quot;updated&quot;)</div><div class="line">circos.clear()</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y)</div><div class="line">circos.trackLines(a$factors[1:100], a$x[1:100], a$y[1:100], type = &quot;h&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-dddf4d7d14922cf1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>接下来添加<code>links</code>，<code>links</code>可以是<code>point</code>到<code>point</code>、<code>point</code>到<code>interval</code>、<code>interval</code>到<code>interval</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1), lwd = 0.1, cex = 0.6)</div><div class="line">circos.par(track.height = 0.1)</div><div class="line">circos.initialize(factors = a$factors, x = a$x)</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y,</div><div class="line"> panel.fun = function(x, y) &#123; circos.axis()&#125;)</div><div class="line">col &lt;- rep(c(&quot;#FF0000&quot;, &quot;#00FF00&quot;), 4)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">circos.trackPoints(a$factors, a$x, a$y, col = col, pch = 16, cex = 0.5)</div><div class="line">circos.text(-1, 0.5, &quot;left&quot;, sector.index = &quot;a&quot;, track.index = 1)</div><div class="line">circos.text(1, 0.5, &quot;right&quot;, sector.index = &quot;a&quot;)</div><div class="line">bg.col &lt;- rep(c(&quot;#EFEFEF&quot;, &quot;#CCCCCC&quot;), 4)</div><div class="line">circos.trackHist(a$factors, a$x, bg.col = bg.col, col = NA)</div><div class="line">circos.trackPlotRegion(factors = a$factors, x = a$x, y = a$y,</div><div class="line"> panel.fun = function(x, y) &#123;</div><div class="line"> grey = c(&quot;#FFFFFF&quot;, &quot;#CCCCCC&quot;, &quot;#999999&quot;) </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;) </div><div class="line">xlim = get.cell.meta.data(&quot;xlim&quot;) </div><div class="line">ylim = get.cell.meta.data(&quot;ylim&quot;)</div><div class="line">circos.text(mean(xlim), mean(ylim), sector.index) </div><div class="line">circos.points(x[1:10], y[1:10], col = &quot;red&quot;, pch = 16, cex = 0.6) </div><div class="line">circos.points(x[11:20], y[11:20], col = &quot;blue&quot;, cex = 0.6)&#125;)</div><div class="line"># update第2个track中标记为d的sector</div><div class="line">circos.updatePlotRegion(sector.index = &quot;d&quot;, track.index = 2)</div><div class="line">circos.points(x = -2:2, y = rep(0, 5))</div><div class="line">xlim &lt;- get.cell.meta.data(&quot;xlim&quot;)</div><div class="line">ylim &lt;- get.cell.meta.data(&quot;ylim&quot;)</div><div class="line">circos.text(mean(xlim), mean(ylim), &quot;updated&quot;)</div><div class="line">circos.clear()</div><div class="line">circos.trackPlotRegion(factors = a$factors, y = a$y)</div><div class="line">circos.trackLines(a$factors[1:100], a$x[1:100], a$y[1:100], type = &quot;h&quot;)</div><div class="line">circos.link(&quot;a&quot;, 0, &quot;b&quot;, 0, h = 0.3) #point to point</div><div class="line">circos.link(&quot;c&quot;, c(-0.5, 0.5), &quot;d&quot;, c(-0.5, 0.5), col = &quot;red&quot;, border = NA, h = 0.2) #intreval to interval</div><div class="line">circos.link(&quot;e&quot;, 0, &quot;g&quot;, c(-1, 1), col = &quot;green&quot;, border = &quot;black&quot;, lwd = 2, lty = 2) #point to interval</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-7c9b4bf33e074663.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="circlize详述"><a href="#circlize详述" class="headerlink" title="circlize详述"></a>circlize详述</h2><blockquote>
<p><code>circlize</code>的绘图规则是初始化(<code>initialize</code>)-创建<code>track</code>-添加图形元素-创建<code>track</code>-添加图形元素-…-<code>circos.clear</code>。具体参数设置以及解释由于内容太多，有兴趣的可以自己<a href="https://cran.r-project.org/web/packages/circlize/vignettes/circlize.pdf" target="_blank" rel="external">参考文档</a>。 我认为比较重要的是要理解<code>track</code>、<code>sector</code>。由于基本所有的图形元素我们都是添加在<code>sector</code><br>里面，因此就需要指定<code>track.index</code>以及<code>sector.index</code>。接下来就用个例子来讲解一下如何操纵<code>track</code>、<code>sector</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">par(mar = c(1, 1, 1, 1))</div><div class="line">factors &lt;- letters[1:8]</div><div class="line">circos.initialize(factors = factors, xlim = c(0, 1)) #初始化# 绘制三个track，并显示具体信息</div><div class="line">for (i in 1:3) &#123; </div><div class="line">circos.trackPlotRegion(ylim = c(0, 1))&#125;</div><div class="line">circos.info(plot = TRUE)</div><div class="line"># 通过draw.sector()来高亮某一sector，比如a：</div><div class="line">draw.sector(get.cell.meta.data(&quot;cell.start.degree&quot;, sector.index = &quot;a&quot;), </div><div class="line">get.cell.meta.data(&quot;cell.end.degree&quot;, sector.index = &quot;a&quot;), rou1 = 1, col = &quot;blue&quot;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-938c7de4bb4c23d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 高亮某一track， 比如第一个track：</div><div class="line">circos.initialize(factors = factors, xlim = c(0, 1))</div><div class="line">for (i in 1:3) &#123; </div><div class="line">circos.trackPlotRegion(ylim = c(0, 1))&#125;</div><div class="line">circos.info(plot = TRUE)</div><div class="line">draw.sector(0, 360, rou1 = get.cell.meta.data(&quot;cell.top.radius&quot;, track.index = 1), </div><div class="line">rou2 = get.cell.meta.data(&quot;cell.bottom.radius&quot;, track.index = 1), col = &quot;green&quot;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-45e3eb273fc3b890.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 高亮某一track某一sector，比如地2、3track中的e、f(sector)：</div><div class="line">circos.initialize(factors = factors, xlim = c(0, 1))</div><div class="line">for (i in 1:3) &#123; circos.trackPlotRegion(ylim = c(0, 1))&#125;</div><div class="line">circos.info(plot = TRUE)</div><div class="line">draw.sector(get.cell.meta.data(&quot;cell.start.degree&quot;, sector.index = &quot;e&quot;), </div><div class="line">get.cell.meta.data(&quot;cell.end.degree&quot;, sector.index = &quot;f&quot;), </div><div class="line">get.cell.meta.data(&quot;cell.top.radius&quot;, track.index = 2), </div><div class="line">get.cell.meta.data(&quot;cell.bottom.radius&quot;, track.index = 3), col = &quot;red&quot;)</div><div class="line">circos.clear() #千万别忘了circos.clear，不然下次无法绘图。</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-68e9fa0e050abfe9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="放大某一特定区域"><a href="#放大某一特定区域" class="headerlink" title="放大某一特定区域"></a>放大某一特定区域</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">df &lt;- data.frame(factors = sample(letters[1:6], 100, replace = TRUE),</div><div class="line">                          x = rnorm(100), </div><div class="line">                          y = rnorm(100), </div><div class="line">                          stringsAsFactors = FALSE)</div><div class="line"># 放大a，b区域</div><div class="line">zoom_df &lt;- df %&gt;% dplyr::filter(factors %in% c(&quot;a&quot;, &quot;b&quot;))</div><div class="line">zoom_df$factors &lt;- paste0(&quot;zoom_&quot;, zoom_df$factors)</div><div class="line">df2 &lt;- rbind(df, zoom_df)</div><div class="line">xrange &lt;- tapply(df2$x, df2$factors, function(x) max(x) - min(x))</div><div class="line">normal_sector_index &lt;- unique(df$factors)</div><div class="line">zoomed_sector_index &lt;- unique(zoom_df$factors)</div><div class="line">sector.width &lt;- c(xrange[normal_sector_index]/sum(xrange[normal_sector_index]), </div><div class="line">xrange[zoomed_sector_index]/sum(xrange[zoomed_sector_index]))</div><div class="line"># 绘图</div><div class="line">par(mar = c(1, 1, 1, 1))</div><div class="line">circos.par(start.degree = 90)</div><div class="line">circos.initialize(df2$factors, x = df2$x, sector.width = sector.width)</div><div class="line">circos.trackPlotRegion(df2$factors, x = df2$x, y = df2$y, </div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">circos.points(x, y, col = &quot;red&quot;, pch = 16, cex = 0.5) </div><div class="line">xlim = get.cell.meta.data(&quot;xlim&quot;) </div><div class="line">ylim = get.cell.meta.data(&quot;ylim&quot;) </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;) </div><div class="line">circos.text(mean(xlim), mean(ylim), sector.index, niceFacing = TRUE)&#125;)</div><div class="line"># 添加links</div><div class="line">circos.link(&quot;a&quot;, get.cell.meta.data(&quot;cell.xlim&quot;, sector.index = &quot;a&quot;), &quot;zoom_a&quot;, </div><div class="line">get.cell.meta.data(&quot;cell.xlim&quot;, sector.index = &quot;zoom_a&quot;), border = NA, col = &quot;red&quot;)</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-58a07e148222b8f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>circos.clear()</p>
<h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><blockquote>
<p>圈圈图+热图+进化树</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">set.seed(1234)</div><div class="line">data &lt;- matrix(rnorm(100 * 10), nrow = 10, ncol = 100)</div><div class="line">col &lt;- colorRamp2(c(-2, 0, 2), c(&quot;green&quot;, &quot;black&quot;, &quot;red&quot;))</div><div class="line">factors &lt;- rep(letters[1:2], times = c(30, 70))</div><div class="line">data_list &lt;- list(a = data[, factors == &quot;a&quot;], b = data[, factors == &quot;b&quot;])</div><div class="line">dend_list &lt;- list(a = as.dendrogram(hclust(dist(t(data_list[[&quot;a&quot;]])))), </div><div class="line">                  b = as.dendrogram(hclust(dist(t(data_list[[&quot;b&quot;]])))))</div><div class="line">circos.par(cell.padding = c(0, 0, 0, 0), gap.degree = 5)</div><div class="line">circos.initialize(factors = factors, xlim = cbind(c(0, 0), table(factors)))</div><div class="line">circos.track(ylim = c(0, 10), bg.border = NA, </div><div class="line">panel.fun = function(x, y) &#123;</div><div class="line"> sector.index = get.cell.meta.data(&quot;sector.index&quot;) </div><div class="line">d = data_list[[sector.index]] </div><div class="line">dend = dend_list[[sector.index]] </div><div class="line">d2 = d[, order.dendrogram(dend)] </div><div class="line">col_data = col(d2)</div><div class="line">nr = nrow(d2)</div><div class="line">nc = ncol(d2) </div><div class="line">for (i in 1:nr) &#123; </div><div class="line">circos.rect(1:nc - 1, rep(nr - i, nc), 1:nc, rep(nr - i + 1, nc),</div><div class="line">border = col_data[i, ], col = col_data[i, ]) &#125;&#125;)</div><div class="line">max_height &lt;- max(sapply(dend_list, function(x) attr(x, &quot;height&quot;)))</div><div class="line">circos.track(ylim = c(0, max_height), </div><div class="line">bg.border = NA, track.height = 0.3,</div><div class="line">panel.fun = function(x, y) &#123; </div><div class="line">sector.index = get.cell.meta.data(&quot;sector.index&quot;)</div><div class="line">dend = dend_list[[sector.index]]</div><div class="line">circos.dendrogram(dend, max_height = max_height)&#125;)</div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-4b332e9275d7088e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="多图排列"><a href="#多图排列" class="headerlink" title="多图排列"></a>多图排列</h2><blockquote>
<p>直接用layout设置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">layout(matrix(1:9, 3, 3))</div><div class="line">for (i in 1:9) &#123;</div><div class="line"> factors = letters[1:8] </div><div class="line">par(mar = c(0.5, 0.5, 0.5, 0.5)) </div><div class="line">circos.par(cell.padding = c(0, 0, 0, 0)) </div><div class="line">circos.initialize(factors = factors, xlim = c(0, 1)) </div><div class="line">circos.trackPlotRegion(ylim = c(0, 1), track.height = 0.05, </div><div class="line">bg.col = rand_color(8), bg.border = NA) </div><div class="line"># 绘制links </div><div class="line">for (i in 1:20) &#123;</div><div class="line">se = sample(letters[1:8], 2) </div><div class="line">circos.link(se[1], runif(2), se[2], runif(2),</div><div class="line">col = rand_color(1, transparency = 0.4), border = NA) </div><div class="line">&#125; </div><div class="line">circos.clear()</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2084719-51d87f7dd942126b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="sessionInfo"><a href="#sessionInfo" class="headerlink" title="sessionInfo"></a>sessionInfo</h2><blockquote>
<p>理解circlize包的原理，绘制基因组数据的图形也是一样的。有时间下次介绍(主要是我自己还没看完，看不太懂)<img src="http://upload-images.jianshu.io/upload_images/2084719-a3ebeb278e1c4ae1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">。<br>老规矩，给出<code>sessionInfo</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo()</div></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">## R version 3.4.0 (2017-04-21)</div><div class="line">## Platform: x86_64-w64-mingw32/x64 (64-bit)</div><div class="line">## Running under: Windows 8.1 x64 (build 9600)</div><div class="line">## ## Matrix products: default## </div><div class="line">## locale:</div><div class="line">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </div><div class="line">## [2] LC_CTYPE=Chinese (Simplified)_China.936 </div><div class="line">## [3] LC_MONETARY=Chinese (Simplified)_China.936</div><div class="line">## [4] LC_NUMERIC=C </div><div class="line">## [5] LC_TIME=Chinese (Simplified)_China.936 </div><div class="line">## ## attached base packages:</div><div class="line">## [1] stats graphics grDevices utils datasets methods base </div><div class="line">## ## other attached packages:</div><div class="line">## [1] circlize_0.4.0 BiocInstaller_1.26.0 forcats_0.2.0</div><div class="line">## [4] stringr_1.2.0 dplyr_0.5.0 purrr_0.2.2.2 </div><div class="line">## [7] readr_1.1.1 tidyr_0.6.3 tibble_1.3.1</div><div class="line">## [10] ggplot2_2.2.1 tidyverse_1.1.1.9000</div><div class="line">#### loaded via a namespace (and not attached):</div><div class="line">## [1] shape_1.4.2 clisymbols_1.2.0 reshape2_1.4.2 </div><div class="line">## [4] haven_1.0.0 lattice_0.20-35 colorspace_1.3-2</div><div class="line">## [7] htmltools_0.3.6 yaml_2.1.14 rlang_0.1.1 </div><div class="line">## [10] foreign_0.8-68 DBI_0.6-1 modelr_0.1.0</div><div class="line">## [13] readxl_1.0.0 plyr_1.8.4 munsell_0.4.3 </div><div class="line">## [16] gtable_0.2.0 cellranger_1.1.0 rvest_0.3.2 </div><div class="line">## [19] GlobalOptions_0.0.12 psych_1.7.5 evaluate_0.10 </div><div class="line">## [22] knitr_1.16 parallel_3.4.0 broom_0.4.2 </div><div class="line">## [25] Rcpp_0.12.11 scales_0.4.1 backports_1.1.0 </div><div class="line">## [28] formatR_1.5 jsonlite_1.4 boxes_0.0.0.9000</div><div class="line">## [31] mnormt_1.5-5 hms_0.3 digest_0.6.12 </div><div class="line">## [34] stringi_1.1.5 grid_3.4.0 rprojroot_1.2</div><div class="line">## [37] tools_3.4.0 magrittr_1.5 lazyeval_0.2.0 </div><div class="line">## [40] crayon_1.3.2.9000 xml2_1.1.1 lubridate_1.6.0 </div><div class="line">## [43] assertthat_0.2.0 rmarkdown_1.5 httr_1.2.1 </div><div class="line">## [46] rstudioapi_0.6 R6_2.2.1 nlme_3.1-131</div><div class="line">## [49] compiler_3.4.0</div></pre></td></tr></table></figure>
<hr>
<h2 id="联系方式："><a href="#联系方式：" class="headerlink" title="联系方式："></a>联系方式：</h2><p>wechat: yt056410</p>
<p>Email: tyan@zju.edu.cn</p>
<p>QQ: 1051927088</p>
<p>GitHub: <a href="https://github.com/YTLogos" target="_blank" rel="external">https://github.com/YTLogos</a></p>
<p>简书: <a href="http://www.jianshu.com/u/bd001545cf0b" target="_blank" rel="external">http://www.jianshu.com/u/bd001545cf0b</a></p>
<p>博客: <a href="https://ytlogos.github.io/">https://ytlogos.github.io/</a></p>
<h2 id="个人简介："><a href="#个人简介：" class="headerlink" title="个人简介："></a>个人简介：</h2><p>严涛</p>
<p>浙江大学作物遗传育种在读研究生（生物信息学方向）</p>
<p>伪码农，R语言爱好者，爱开源</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/2084719-4b332e9275d7088e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;circlize包&quot;&gt;&lt;a href=&quot;#circlize包&quot; class=&quot;headerlink&quot; title=&quot;circlize包&quot;&gt;&lt;/a&gt;&lt;code&gt;circlize&lt;/code&gt;包&lt;/h2&gt;&lt;p&gt;&lt;code&gt;circlize&lt;/code&gt;包在德国癌症中心的华人博士Zuguang Gu开发的，有兴趣的可以去看看他的&lt;a href=&quot;https://github.com/jokergoo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github主页&lt;/a&gt;。这个包有两个文档，一个是介绍基本原理的绘制简单&lt;a href=&quot;https://cran.r-project.org/web/packages/circlize/vignettes/circlize.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;圈圈图&lt;/a&gt;的，也是本次要介绍的。另外一份文档专门介绍基因组数据绘制圈圈图&lt;a href=&quot;https://cran.r-project.org/web/packages/circlize/vignettes/genomic_plot.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Genomic Circos Plot&lt;/a&gt;,我自己还没看完，下次再介绍。&lt;br&gt;根据我的学习发现这个包与&lt;code&gt;ggplot2&lt;/code&gt;很相似，也是先创建一个图层，然后不断的添加图形元素（&lt;code&gt;point&lt;/code&gt;、&lt;code&gt;line&lt;/code&gt;、&lt;code&gt;bar&lt;/code&gt;等），这些简单的图形元素都有&lt;code&gt;circos.&lt;/code&gt;这个前缀进行绘制，比如要绘制点，则用&lt;code&gt;circos.points()&lt;/code&gt;。具体的下面一一介绍。&lt;br&gt;
    
    </summary>
    
      <category term="可视化" scheme="https://ytlogos.github.io/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="R" scheme="https://ytlogos.github.io/tags/R/"/>
    
      <category term="visualization" scheme="https://ytlogos.github.io/tags/visualization/"/>
    
      <category term="circlize" scheme="https://ytlogos.github.io/tags/circlize/"/>
    
  </entry>
  
</feed>
